<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Apiary Project Technical Documentation</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" title="Apiary Project Technical Documentation"><div class="titlepage"><div><div><h1 class="title"><a name="d0e2"></a>Apiary Project Technical Documentation</h1></div><div><div class="author"><h3 class="author"><span class="orgname"> The <a class="link" href="http://www.txcdk.unt.edu" target="_top">Texas Center for Digital
                    Knowledge</a> (TxCDK) at the University of North Texas and the <a class="link" href="http://www.brit.org" target="_top">Botanical Research Institute of Texas</a>
                (BRIT) </span></h3></div></div><div><div class="author"><h3 class="author"><span class="orgname">Website: <a class="link" href="http://www.apiaryproject.org" target="_top">http://www.apiaryproject.org</a></span><code class="email">&lt;<a class="email" href="mailto:sean.murphy@betterourtomorrow.com">sean.murphy@betterourtomorrow.com</a>&gt;</code></h3><code class="email">&lt;<a class="email" href="mailto:sean.murphy@betterourtomorrow.com">sean.murphy@betterourtomorrow.com</a>&gt;</code></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#d0e22">Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25">1. What is the Apiary Project?</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e30">1. 
            <span class="bold"><strong>Hardware and Software Requirements</strong></span>
        </a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e38">1.  Apiary Project Workflow and Image Server </a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e41">1.1.  Hardware</a></span></dt><dt><span class="sect2"><a href="#d0e54">1.2.  Software</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e170">2.  Apiary Project Image Processing and Conversion Server </a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e173">2.1.  Hardware</a></span></dt><dt><span class="sect2"><a href="#d0e186">2.2.  Software</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e238">2. Installation and configuration documentation</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e243">1. Install Ubuntu Desktop
                    10.04</a></span></dt><dt><span class="sect1"><a href="#d0e262">2. Go to Synaptics and install</a></span></dt><dt><span class="sect1"><a href="#d0e330">3. Configure server hostname</a></span></dt><dt><span class="sect1"><a href="#d0e338">4. Enable Apache Modules</a></span></dt><dt><span class="sect1"><a href="#d0e350">5. Configure PHP</a></span></dt><dt><span class="sect1"><a href="#d0e361">6. Create Mysql Drupal and Fedora users and databases</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e369">6.1. Create Drupal user and database</a></span></dt><dt><span class="sect2"><a href="#d0e382">6.2. Create Fedora user and database</a></span></dt><dt><span class="sect2"><a href="#d0e394">6.3. Leave MySQL</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e400">7. Install Drupal</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e405">7.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e411">7.2. Extract drupal-6.22</a></span></dt><dt><span class="sect2"><a href="#d0e417">7.3. Move drupal-6.22 to /var/www/</a></span></dt><dt><span class="sect2"><a href="#d0e423">7.4. Create symbolic link to drupal dir</a></span></dt><dt><span class="sect2"><a href="#d0e434">7.5. Edit Drupal .htaccess</a></span></dt><dt><span class="sect2"><a href="#d0e442">7.6. Create writeable Drupal files directory outside the scope of the main
                    .htaccess</a></span></dt><dt><span class="sect2"><a href="#d0e456">7.7. Edit Apache2 sites</a></span></dt><dt><span class="sect2"><a href="#d0e464">7.8. Create writeable settings file for Drupal install</a></span></dt><dt><span class="sect2"><a href="#d0e473">7.9. Install Drupal via web browser</a></span></dt><dt><span class="sect2"><a href="#d0e519">7.10. Remove write permission on settings file</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e526">8. Setup Environment Variables</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e529">8.1. Locate java home directory</a></span></dt><dt><span class="sect2"><a href="#d0e535">8.2. Create symbolic link for java-home</a></span></dt><dt><span class="sect2"><a href="#d0e546">8.3. Edit user profile</a></span></dt><dt><span class="sect2"><a href="#d0e570">8.4. Restart machine</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e573">9. Install Fedora</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e578">9.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e584">9.2. Create symbolic link to fedora dir</a></span></dt><dt><span class="sect2"><a href="#d0e595">9.3. Create a keystore for SSL support</a></span></dt><dt><span class="sect2"><a href="#d0e603">9.4. Run Fedora java installer</a></span></dt><dt><span class="sect2"><a href="#d0e663">9.5. Verify Fedora&#8217;s Resource Index activation</a></span></dt><dt><span class="sect2"><a href="#d0e676">9.6. Startup Tomcat (which will install Tomcat Fedora features)</a></span></dt><dt><span class="sect2"><a href="#d0e682">9.7. Shutdown Tomcat</a></span></dt><dt><span class="sect2"><a href="#d0e688">9.8. Copy crossdomain file</a></span></dt><dt><span class="sect2"><a href="#d0e694">9.9. Setup anonymous user access</a></span></dt><dt><span class="sect2"><a href="#d0e719">9.10. Install Islandora Drupal filter</a></span></dt><dt><span class="sect2"><a href="#d0e794">9.11. Enable and rebuild Fedora&#8217;s Resource Index</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e829">10. Install Adore-Djatoka
                    Image Server</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e834">10.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e840">10.2. Extract adore-djatoka-1.1</a></span></dt><dt><span class="sect2"><a href="#d0e846">10.3. Move adore-djatoka-1.1 to /usr/local</a></span></dt><dt><span class="sect2"><a href="#d0e852">10.4. Create symbolic link to adore-djatoka dir</a></span></dt><dt><span class="sect2"><a href="#d0e863">10.5. Test functionality</a></span></dt><dt><span class="sect2"><a href="#d0e884">10.6. Add Adore-Djatoka to tomcat webapps</a></span></dt><dt><span class="sect2"><a href="#d0e913">10.7. Configure Referent Resolver</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e976">11. Install OCRopus</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e981">11.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e996">11.2. Install prerequisites</a></span></dt><dt><span class="sect2"><a href="#d0e1002">11.3. Install iulib library</a></span></dt><dt><span class="sect2"><a href="#d0e1014">11.4. Install OCRopus library</a></span></dt><dt><span class="sect2"><a href="#d0e1026">11.5. Configure Ubuntu for OCRopus</a></span></dt><dt><span class="sect2"><a href="#d0e1044">11.6. Test install</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1052">12. Install Ocrad</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1057">12.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e1069">12.2. Extract ocrad-0.21</a></span></dt><dt><span class="sect2"><a href="#d0e1075">12.3. Configure and make ocrad</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1092">13. Install GOCR</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1097">13.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e1109">13.2. Extract ocrad-0.21</a></span></dt><dt><span class="sect2"><a href="#d0e1115">13.3. Configure and make ocrad</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1135">14. Configure Drupal to work with Apiary using fedora_repository (Islandora) and
                apiary_project</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1138">14.1. Allow user access for druapl ajax calls</a></span></dt><dt><span class="sect2"><a href="#d0e1158">14.2. Enable Clean URLs</a></span></dt><dt><span class="sect2"><a href="#d0e1170">14.3. Install Required Drupal Themes</a></span></dt><dt><span class="sect2"><a href="#d0e1254">14.4. Install Required Drupal Modules</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1612">15. Install Apache-Solr</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1617">15.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e1626">15.2. Extract apache-solr-1.4.1</a></span></dt><dt><span class="sect2"><a href="#d0e1632">15.3. Move apache-solr-1.4.1</a></span></dt><dt><span class="sect2"><a href="#d0e1638">15.4. Copy Apiary Solr Schema</a></span></dt><dt><span class="sect2"><a href="#d0e1644">15.5. Configure Solr System Startup Script</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1656">16. Ingest Required Fedora Digital Objects</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1659">16.1. Ingest SpecimenBinders</a></span></dt><dt><span class="sect2"><a href="#d0e1681">16.2. dynamicOCR service definition</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1712">17. Create Apiary Project Drupal items</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1715">17.1. Create Apiary Pages</a></span></dt><dt><span class="sect2"><a href="#d0e1742">17.2. Set Homepage</a></span></dt><dt><span class="sect2"><a href="#d0e1752">17.3. Set Menus</a></span></dt><dt><span class="sect2"><a href="#d0e1765">17.4. Configure Drupal Theme for Apiary site</a></span></dt><dt><span class="sect2"><a href="#d0e1818">17.5. Configure Drupal Primary links</a></span></dt><dt><span class="sect2"><a href="#d0e1902">17.6. Configure Drupal Navigation menu</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1937">18. Start Apiary</a></span></dt><dt><span class="sect1"><a href="#d0e1946">19. Ingest Apiary Demo Objects</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1949">19.1. Browse to http://hostname/drupal/apiary/admin</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e1966">3. Using the Apiary Project Module</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e1971">1. (Re)Starting The Apiary Project</a></span></dt><dt><span class="sect1"><a href="#d0e1984">2. Administrating the Apiary Project</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1987">2.1. Browse to http://hostname/drupal/apiary/admin</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e2163">4. Using the Apiary Project Workflow</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e2168">1. Click Workspace or browse to http://hostname/drupal/apiary</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2171">1.1. Select Workflow to begin work</a></span></dt><dt><span class="sect2"><a href="#d0e2174">1.2. Load Workflow Queue</a></span></dt><dt><span class="sect2"><a href="#d0e2194">1.3. Select Specimen from Workflow Queue</a></span></dt><dt><span class="sect2"><a href="#d0e2208">1.4. View Specimen with Open
                    Layers</a></span></dt><dt><span class="sect2"><a href="#d0e2244">1.5. Create Regions of Interest (ROIs)</a></span></dt><dt><span class="sect2"><a href="#d0e2268">1.6. Transcribe ROI</a></span></dt><dt><span class="sect2"><a href="#d0e2343">1.7. Parse ROI</a></span></dt><dt><span class="sect2"><a href="#d0e2415">1.8. Delete ROI</a></span></dt><dt><span class="sect2"><a href="#d0e2421">1.9. Remove ROI from Queue</a></span></dt><dt><span class="sect2"><a href="#d0e2430">1.10. Remove Specimen from Queue</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e2442">5. Troubleshooting the Apiary Project Workflow</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e2447">1. Fedora Will Not Start</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2450">1.1. Check System Variables</a></span></dt><dt><span class="sect2"><a href="#d0e2465">1.2. Check Tomcat/Catalina logs</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e2475">6. Apiary Project Advanced Configuration</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e2480">1. Apache-Solr schema</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2483">1.1. Edit schema.xml file</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e2517">2. Configure Adore-Djatoka Database Resolver</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2520">2.1. Create and Setup djatoka mysql database</a></span></dt><dt><span class="sect2"><a href="#d0e2546">2.2. Reconfigure Djatoka properties file</a></span></dt><dt><span class="sect2"><a href="#d0e2586">2.3. Insert Images into Djatoka database</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e2605">3. Install Varnish http accelerator</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2622">3.1. Configure Apache</a></span></dt><dt><span class="sect2"><a href="#d0e2668">3.2. Install Varnish</a></span></dt><dt><span class="sect2"><a href="#d0e2689">3.3. Configure Varnish</a></span></dt><dt><span class="sect2"><a href="#d0e2713">3.4. Redirect Varnish to Apache via default.vcl file</a></span></dt><dt><span class="sect2"><a href="#d0e2739">3.5. (Re)Starting Varnish</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e2745">4. Install HERBIS</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e2750">7. Apiary Project Code Flow</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e2755">1. An internal PHP File as a Page</a></span></dt><dt><span class="sect1"><a href="#d0e2771">2. An external PHP File as a Page</a></span></dt><dt><span class="sect1"><a href="#d0e2793">3. What actually takes place when a workflow is started?</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e2824">8. Apiary Project Metadata Documentation</a></span></dt><dt><span class="chapter"><a href="#d0e2832">9. Apiary Project Fedora Object Model</a></span></dt><dt><span class="chapter"><a href="#d0e2840">10. Apiary Project Downloads</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e2847">1. VirtualBox</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e2852">11. Documentation</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e2855">1. Choices and Technical Hurdles</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2858">1.1. Working with Large Image Files</a></span></dt><dt><span class="sect2"><a href="#d0e2865">1.2. Storing Digital Objects</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e2870">2.  Performance Issues and Concerns </a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2873">2.1. Speed</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e2882">3.  Technical Documentation References</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2885">3.1. OxygenXML</a></span></dt><dt><span class="sect2"><a href="#d0e2891">3.2. Doxygen</a></span></dt></dl></dd></dl></dd></dl></div><div class="preface" title="Introduction"><div class="titlepage"><div><div><h2 class="title"><a name="d0e22"></a>Introduction</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d0e25">1. What is the Apiary Project?</a></span></dt></dl></div><div class="section" title="1.&nbsp;What is the Apiary Project?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e25"></a>1.&nbsp;What is the Apiary Project?</h2></div></div></div><p>The Apiary Project is a fundamental research project with the goal of identifying
                how human intelligence can be combined with machine processes for effective and
                efficient transformation of textual museum specimen label information into
                high-quality machine-processible parsed data. </p></div></div><div class="chapter" title="Chapter&nbsp;1.&nbsp; Hardware and Software Requirements"><div class="titlepage"><div><div><h2 class="title"><a name="d0e30"></a>Chapter&nbsp;1.&nbsp;
            <span class="bold"><strong>Hardware and Software Requirements</strong></span>
        </h2></div><div><h3 class="subtitle"><i> Servers, OS requirements, software components and dependencies</i></h3></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d0e38">1.  Apiary Project Workflow and Image Server </a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e41">1.1.  Hardware</a></span></dt><dt><span class="sect2"><a href="#d0e54">1.2.  Software</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e170">2.  Apiary Project Image Processing and Conversion Server </a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e173">2.1.  Hardware</a></span></dt><dt><span class="sect2"><a href="#d0e186">2.2.  Software</a></span></dt></dl></dd></dl></div><div class="sect1" title="1.&nbsp; Apiary Project Workflow and Image Server"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e38"></a>1.&nbsp; Apiary Project Workflow and Image Server </h2></div></div></div><div class="sect2" title="1.1.&nbsp; Hardware"><div class="titlepage"><div><div><h3 class="title"><a name="d0e41"></a>1.1.&nbsp; Hardware</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Dual to Quad core 64 bit processor</p></li><li class="listitem"><p>4-16GB RAM</p></li><li class="listitem"><p>Sizeable storage space, we used a 100GB drive for original images and
                            another 100GB for converted images</p></li></ol></div></div><div class="sect2" title="1.2.&nbsp; Software"><div class="titlepage"><div><div><h3 class="title"><a name="d0e54"></a>1.2.&nbsp; Software</h3></div></div></div><div class="sect3" title="1.2.1.&nbsp; Operating System"><div class="titlepage"><div><div><h4 class="title"><a name="d0e57"></a>1.2.1.&nbsp; Operating System</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Ubuntu 8.04 64-bit or later, primarily 10.04 Desktop</p></li></ol></div></div><div class="sect3" title="1.2.2.&nbsp; Ubuntu aptitude packages"><div class="titlepage"><div><div><h4 class="title"><a name="d0e64"></a>1.2.2.&nbsp; Ubuntu aptitude packages</h4></div></div></div><div class="sect4" title="1.2.2.1.&nbsp;Applications"><div class="titlepage"><div><div><h5 class="title"><a name="d0e67"></a>1.2.2.1.&nbsp;Applications</h5></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Apache 2</p></li><li class="listitem"><p>Mysql-server</p></li><li class="listitem"><p>PHP 5</p></li><li class="listitem"><p>Sun-java6-jdk</p></li><li class="listitem"><p>Subversion</p></li><li class="listitem"><p>curl</p></li><li class="listitem"><p>mercurial</p></li><li class="listitem"><p>scons</p></li><li class="listitem"><p>chkconfig</p></li><li class="listitem"><p>vim-nox</p></li><li class="listitem"><p>flashplugin-installer</p></li><li class="listitem"><p>varnish (*optional)</p></li></ol></div></div><div class="sect4" title="1.2.2.2.&nbsp;Libraries"><div class="titlepage"><div><div><h5 class="title"><a name="d0e107"></a>1.2.2.2.&nbsp;Libraries</h5></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>libapache2-mod-auth-mysql</p></li><li class="listitem"><p>Php5-mysql</p></li><li class="listitem"><p>Php5-curl</p></li><li class="listitem"><p>Php5-xsl</p></li><li class="listitem"><p>Php5-imagick</p></li><li class="listitem"><p>Php5-gd</p></li><li class="listitem"><p>Php5-dev</p></li><li class="listitem"><p>Php-soap</p></li><li class="listitem"><p>libjpeg-progs</p></li></ol></div></div></div><div class="sect3" title="1.2.3.&nbsp; Additional required applications"><div class="titlepage"><div><div><h4 class="title"><a name="d0e138"></a>1.2.3.&nbsp; Additional required applications</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Fedora-commons digital repository 3.2</p></li><li class="listitem"><p>Tomcat 5.5</p></li><li class="listitem"><p>Adore-Djatoka JPEG2000 Image Server</p></li><li class="listitem"><p>Apache-SOLR 1.4.1</p></li><li class="listitem"><p>Drupal content management 6.22</p></li><li class="listitem"><p>Islandora (fedora repository Drupal module)</p></li><li class="listitem"><p>OCRopus 0.4.1</p></li><li class="listitem"><p>GOCR</p></li><li class="listitem"><p>Ocrad </p></li></ol></div><a name="systemreqs"></a></div></div></div><div class="sect1" title="2.&nbsp; Apiary Project Image Processing and Conversion Server"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e170"></a>2.&nbsp; Apiary Project Image Processing and Conversion Server </h2></div></div></div><div class="sect2" title="2.1.&nbsp; Hardware"><div class="titlepage"><div><div><h3 class="title"><a name="d0e173"></a>2.1.&nbsp; Hardware</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Dual to Quad core 64 bit processor</p></li><li class="listitem"><p>4+GB RAM</p></li><li class="listitem"><p>Sizeable storage space. Note: We connect to a shared image drive from
                            the Apiary Project Server.</p></li></ol></div></div><div class="sect2" title="2.2.&nbsp; Software"><div class="titlepage"><div><div><h3 class="title"><a name="d0e186"></a>2.2.&nbsp; Software</h3></div></div></div><div class="sect3" title="2.2.1.&nbsp; Operating System"><div class="titlepage"><div><div><h4 class="title"><a name="d0e189"></a>2.2.1.&nbsp; Operating System</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Ubuntu 10.04 64-bit server</p></li></ol></div></div><div class="sect3" title="2.2.2.&nbsp; Ubuntu aptitude packages"><div class="titlepage"><div><div><h4 class="title"><a name="d0e196"></a>2.2.2.&nbsp; Ubuntu aptitude packages</h4></div></div></div><div class="sect4" title="2.2.2.1.&nbsp;Applications"><div class="titlepage"><div><div><h5 class="title"><a name="d0e199"></a>2.2.2.1.&nbsp;Applications</h5></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>ImageMagick</p></li><li class="listitem"><p>OpenJPEG</p></li></ol></div></div><div class="sect4" title="2.2.2.2.&nbsp;Libraries"><div class="titlepage"><div><div><h5 class="title"><a name="d0e209"></a>2.2.2.2.&nbsp;Libraries</h5></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>build-essential</p></li><li class="listitem"><p>libpng12-dev</p></li><li class="listitem"><p>libjpeg62-dev</p></li><li class="listitem"><p>libtiff4-dev</p></li><li class="listitem"><p>libjpeg-progs</p></li><li class="listitem"><p>libopenjpeg-dev</p></li></ol></div></div></div><div class="sect3" title="2.2.3.&nbsp; Additional required applications"><div class="titlepage"><div><div><h4 class="title"><a name="d0e231"></a>2.2.3.&nbsp; Additional required applications</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>OpenJPEG version 1.4 sources</p></li></ol></div></div></div></div></div><div class="chapter" title="Chapter&nbsp;2.&nbsp;Installation and configuration documentation"><div class="titlepage"><div><div><h2 class="title"><a name="d0e238"></a>Chapter&nbsp;2.&nbsp;Installation and configuration documentation</h2></div><div><h3 class="subtitle"><i>A step by step guide to completly installing the Apiary Project
            workflow</i></h3></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d0e243">1. Install Ubuntu Desktop
                    10.04</a></span></dt><dt><span class="sect1"><a href="#d0e262">2. Go to Synaptics and install</a></span></dt><dt><span class="sect1"><a href="#d0e330">3. Configure server hostname</a></span></dt><dt><span class="sect1"><a href="#d0e338">4. Enable Apache Modules</a></span></dt><dt><span class="sect1"><a href="#d0e350">5. Configure PHP</a></span></dt><dt><span class="sect1"><a href="#d0e361">6. Create Mysql Drupal and Fedora users and databases</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e369">6.1. Create Drupal user and database</a></span></dt><dt><span class="sect2"><a href="#d0e382">6.2. Create Fedora user and database</a></span></dt><dt><span class="sect2"><a href="#d0e394">6.3. Leave MySQL</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e400">7. Install Drupal</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e405">7.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e411">7.2. Extract drupal-6.22</a></span></dt><dt><span class="sect2"><a href="#d0e417">7.3. Move drupal-6.22 to /var/www/</a></span></dt><dt><span class="sect2"><a href="#d0e423">7.4. Create symbolic link to drupal dir</a></span></dt><dt><span class="sect2"><a href="#d0e434">7.5. Edit Drupal .htaccess</a></span></dt><dt><span class="sect2"><a href="#d0e442">7.6. Create writeable Drupal files directory outside the scope of the main
                    .htaccess</a></span></dt><dt><span class="sect2"><a href="#d0e456">7.7. Edit Apache2 sites</a></span></dt><dt><span class="sect2"><a href="#d0e464">7.8. Create writeable settings file for Drupal install</a></span></dt><dt><span class="sect2"><a href="#d0e473">7.9. Install Drupal via web browser</a></span></dt><dt><span class="sect2"><a href="#d0e519">7.10. Remove write permission on settings file</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e526">8. Setup Environment Variables</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e529">8.1. Locate java home directory</a></span></dt><dt><span class="sect2"><a href="#d0e535">8.2. Create symbolic link for java-home</a></span></dt><dt><span class="sect2"><a href="#d0e546">8.3. Edit user profile</a></span></dt><dt><span class="sect2"><a href="#d0e570">8.4. Restart machine</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e573">9. Install Fedora</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e578">9.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e584">9.2. Create symbolic link to fedora dir</a></span></dt><dt><span class="sect2"><a href="#d0e595">9.3. Create a keystore for SSL support</a></span></dt><dt><span class="sect2"><a href="#d0e603">9.4. Run Fedora java installer</a></span></dt><dt><span class="sect2"><a href="#d0e663">9.5. Verify Fedora&#8217;s Resource Index activation</a></span></dt><dt><span class="sect2"><a href="#d0e676">9.6. Startup Tomcat (which will install Tomcat Fedora features)</a></span></dt><dt><span class="sect2"><a href="#d0e682">9.7. Shutdown Tomcat</a></span></dt><dt><span class="sect2"><a href="#d0e688">9.8. Copy crossdomain file</a></span></dt><dt><span class="sect2"><a href="#d0e694">9.9. Setup anonymous user access</a></span></dt><dt><span class="sect2"><a href="#d0e719">9.10. Install Islandora Drupal filter</a></span></dt><dt><span class="sect2"><a href="#d0e794">9.11. Enable and rebuild Fedora&#8217;s Resource Index</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e829">10. Install Adore-Djatoka
                    Image Server</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e834">10.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e840">10.2. Extract adore-djatoka-1.1</a></span></dt><dt><span class="sect2"><a href="#d0e846">10.3. Move adore-djatoka-1.1 to /usr/local</a></span></dt><dt><span class="sect2"><a href="#d0e852">10.4. Create symbolic link to adore-djatoka dir</a></span></dt><dt><span class="sect2"><a href="#d0e863">10.5. Test functionality</a></span></dt><dt><span class="sect2"><a href="#d0e884">10.6. Add Adore-Djatoka to tomcat webapps</a></span></dt><dt><span class="sect2"><a href="#d0e913">10.7. Configure Referent Resolver</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e976">11. Install OCRopus</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e981">11.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e996">11.2. Install prerequisites</a></span></dt><dt><span class="sect2"><a href="#d0e1002">11.3. Install iulib library</a></span></dt><dt><span class="sect2"><a href="#d0e1014">11.4. Install OCRopus library</a></span></dt><dt><span class="sect2"><a href="#d0e1026">11.5. Configure Ubuntu for OCRopus</a></span></dt><dt><span class="sect2"><a href="#d0e1044">11.6. Test install</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1052">12. Install Ocrad</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1057">12.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e1069">12.2. Extract ocrad-0.21</a></span></dt><dt><span class="sect2"><a href="#d0e1075">12.3. Configure and make ocrad</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1092">13. Install GOCR</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1097">13.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e1109">13.2. Extract ocrad-0.21</a></span></dt><dt><span class="sect2"><a href="#d0e1115">13.3. Configure and make ocrad</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1135">14. Configure Drupal to work with Apiary using fedora_repository (Islandora) and
                apiary_project</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1138">14.1. Allow user access for druapl ajax calls</a></span></dt><dt><span class="sect2"><a href="#d0e1158">14.2. Enable Clean URLs</a></span></dt><dt><span class="sect2"><a href="#d0e1170">14.3. Install Required Drupal Themes</a></span></dt><dt><span class="sect2"><a href="#d0e1254">14.4. Install Required Drupal Modules</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1612">15. Install Apache-Solr</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1617">15.1. Download</a></span></dt><dt><span class="sect2"><a href="#d0e1626">15.2. Extract apache-solr-1.4.1</a></span></dt><dt><span class="sect2"><a href="#d0e1632">15.3. Move apache-solr-1.4.1</a></span></dt><dt><span class="sect2"><a href="#d0e1638">15.4. Copy Apiary Solr Schema</a></span></dt><dt><span class="sect2"><a href="#d0e1644">15.5. Configure Solr System Startup Script</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1656">16. Ingest Required Fedora Digital Objects</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1659">16.1. Ingest SpecimenBinders</a></span></dt><dt><span class="sect2"><a href="#d0e1681">16.2. dynamicOCR service definition</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1712">17. Create Apiary Project Drupal items</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1715">17.1. Create Apiary Pages</a></span></dt><dt><span class="sect2"><a href="#d0e1742">17.2. Set Homepage</a></span></dt><dt><span class="sect2"><a href="#d0e1752">17.3. Set Menus</a></span></dt><dt><span class="sect2"><a href="#d0e1765">17.4. Configure Drupal Theme for Apiary site</a></span></dt><dt><span class="sect2"><a href="#d0e1818">17.5. Configure Drupal Primary links</a></span></dt><dt><span class="sect2"><a href="#d0e1902">17.6. Configure Drupal Navigation menu</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e1937">18. Start Apiary</a></span></dt><dt><span class="sect1"><a href="#d0e1946">19. Ingest Apiary Demo Objects</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1949">19.1. Browse to http://hostname/drupal/apiary/admin</a></span></dt></dl></dd></dl></div><div class="sect1" title="1.&nbsp;Install Ubuntu Desktop 10.04"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e243"></a>1.&nbsp;Install <a class="link" href="http://releases.ubuntu.com/lucid/" target="_top">Ubuntu Desktop
                    10.04</a></h2></div><div><h3 class="subtitle">Note: The installation of the OS is outside the scope of this documentation,
                it is listed here to note the starting point of the installation</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>username: apiary</p></li><li class="listitem"><p>full name: password is apiary</p></li><li class="listitem"><p>password: apiary</p><p>Note: These documents will assume all passwords to be 'apiary'</p></li></ol></div></div><div class="sect1" title="2.&nbsp;Go to Synaptics and install"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e262"></a>2.&nbsp;Go to Synaptics and install</h2></div><div><h3 class="subtitle">Note: These can also be installed using aptitude from the command, i.e.
                apt-get install {package}</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Apache 2 (and its automatically added required packages)</p></li><li class="listitem"><p>Mysql-server</p><p>Note: These documents assume the root password is apiary</p></li><li class="listitem"><p>PHP 5 (and its automatically added required packages)</p></li><li class="listitem"><p>Sun-java6-jdk (and its automatically added required packages)</p></li><li class="listitem"><p>Subversion</p></li><li class="listitem"><p>curl</p></li><li class="listitem"><p>mercurial</p></li><li class="listitem"><p>scons</p></li><li class="listitem"><p>chkconfig</p></li><li class="listitem"><p>libapache2-mod-auth-mysql</p></li><li class="listitem"><p>flashplugin-installer</p></li><li class="listitem"><p>Php5-mysql</p></li><li class="listitem"><p>Php5-curl</p></li><li class="listitem"><p>Php5-xsl</p></li><li class="listitem"><p>Php5-imagick</p></li><li class="listitem"><p>Php5-gd</p></li><li class="listitem"><p>Php5-dev</p></li><li class="listitem"><p>Php-soap</p></li><li class="listitem"><p>libjpeg-progs</p></li><li class="listitem"><p>vim-nox (this fixes the weird behavior vi has with Ubuntu)</p></li></ol></div></div><div class="sect1" title="3.&nbsp;Configure server hostname"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e330"></a>3.&nbsp;Configure server hostname</h2></div></div></div><div class="cmdsynopsis"><p><code class="command">vi /etc/hostname</code> </p></div><p>change hostname</p></div><div class="sect1" title="4.&nbsp;Enable Apache Modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e338"></a>4.&nbsp;Enable Apache Modules</h2></div></div></div><div class="cmdsynopsis"><p><code class="command">a2enmod rewrite</code> </p></div><div class="cmdsynopsis"><p><code class="command">a2enmod auth_mysqlvi</code> </p></div><div class="cmdsynopsis"><p><code class="command">/etc/init.d/apache2 restart</code> </p></div></div><div class="sect1" title="5.&nbsp;Configure PHP"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e350"></a>5.&nbsp;Configure PHP</h2></div></div></div><div class="cmdsynopsis"><p><code class="command">vi /etc/php5/apache2/php.ini</code> </p></div><p>Replace &#8216;memory_limit = 16M&#8217; with &#8216;memory_limit = 256M&#8217;</p><div class="cmdsynopsis"><p><code class="command">/etc/init.d/apache2 restart</code> </p></div></div><div class="sect1" title="6.&nbsp;Create Mysql Drupal and Fedora users and databases"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e361"></a>6.&nbsp;Create Mysql Drupal and Fedora users and databases</h2></div></div></div><div class="cmdsynopsis"><p><code class="command">mysql -u root -p</code> </p></div><p>Accesses mysql command line, password is apiary</p><div class="sect2" title="6.1.&nbsp;Create Drupal user and database"><div class="titlepage"><div><div><h3 class="title"><a name="d0e369"></a>6.1.&nbsp;Create Drupal user and database</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">create database drupal;</code> </p></div><div class="cmdsynopsis"><p><code class="command">grant all on drupal.* to &#8216;drupalAdmin&#8217;@&#8217;localhost&#8217; identified by
                        &#8216;apiary&#8217;;</code> </p></div><div class="cmdsynopsis"><p><code class="command">grant all on drupal.* to &#8216;drupalAdmin&#8217;@&#8217;%&#8217; identified by
                        &#8216;apiary&#8217;;</code> </p></div><a name="createfedoradb"></a></div><div class="sect2" title="6.2.&nbsp;Create Fedora user and database"><div class="titlepage"><div><div><h3 class="title"><a name="d0e382"></a>6.2.&nbsp;Create Fedora user and database</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">create database fedora;</code> </p></div><div class="cmdsynopsis"><p><code class="command">grant all on drupal.* to &#8216;fedoraAdmin&#8217;@&#8217;localhost&#8217; identified by
                        &#8216;apiary&#8217;;</code> </p></div><div class="cmdsynopsis"><p><code class="command">grant all on drupal.* to &#8216;fedoraAdmin&#8217;@&#8217;%&#8217; identified by
                        &#8216;apiary&#8217;;</code> </p></div></div><div class="sect2" title="6.3.&nbsp;Leave MySQL"><div class="titlepage"><div><div><h3 class="title"><a name="d0e394"></a>6.3.&nbsp;Leave MySQL</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">exit;</code> </p></div></div></div><div class="sect1" title="7.&nbsp;Install Drupal"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e400"></a>7.&nbsp;Install <a class="link" href="http://drupal.org/project/drupal" target="_top">Drupal</a></h2></div></div></div><div class="sect2" title="7.1.&nbsp;Download"><div class="titlepage"><div><div><h3 class="title"><a name="d0e405"></a>7.1.&nbsp;Download</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">wget http://ftp.drupal.org/files/projects/drupal-6.22.tar.gz</code> </p></div></div><div class="sect2" title="7.2.&nbsp;Extract drupal-6.22"><div class="titlepage"><div><div><h3 class="title"><a name="d0e411"></a>7.2.&nbsp;Extract drupal-6.22</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">tar -zxvf drupal-6.22.tar.gz</code> </p></div></div><div class="sect2" title="7.3.&nbsp;Move drupal-6.22 to /var/www/"><div class="titlepage"><div><div><h3 class="title"><a name="d0e417"></a>7.3.&nbsp;Move drupal-6.22 to /var/www/</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">mv drupal-6.22 /var/www</code> </p></div></div><div class="sect2" title="7.4.&nbsp;Create symbolic link to drupal dir"><div class="titlepage"><div><div><h3 class="title"><a name="d0e423"></a>7.4.&nbsp;Create symbolic link to drupal dir</h3></div></div></div><span class="bold"><strong>
                    <p>Note: This preserves versioning as drupal updates are released</p>
                </strong></span><div class="cmdsynopsis"><p><code class="command">ln -s /var/www/drupal-6.22 /var/www/drupal</code> </p></div></div><div class="sect2" title="7.5.&nbsp;Edit Drupal .htaccess"><div class="titlepage"><div><div><h3 class="title"><a name="d0e434"></a>7.5.&nbsp;Edit Drupal .htaccess</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">vi /var/www/drupal/.htaccess </code> </p></div><p>uncomment REWRITEs for &#8216;/drupal&#8217; </p></div><div class="sect2" title="7.6.&nbsp;Create writeable Drupal files directory outside the scope of the main .htaccess"><div class="titlepage"><div><div><h3 class="title"><a name="d0e442"></a>7.6.&nbsp;Create writeable Drupal files directory outside the scope of the main
                    .htaccess</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">mkdir /var/www/drupal/sites/default/files</code> </p></div><div class="cmdsynopsis"><p><code class="command">chmod a+w /var/www/drupal/sites/default/files</code> </p></div><div class="cmdsynopsis"><p><code class="command">vi /var/www/drupal/sites/default/files/.htaccess</code> </p></div><p>Save blank file!</p></div><div class="sect2" title="7.7.&nbsp;Edit Apache2 sites"><div class="titlepage"><div><div><h3 class="title"><a name="d0e456"></a>7.7.&nbsp;Edit Apache2 sites</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">vi /etc/apache2/sites-enabled/000-default </code> </p></div><p>change AllowOverride None to AllowOverride All for / and /var/www
                    directories</p></div><div class="sect2" title="7.8.&nbsp;Create writeable settings file for Drupal install"><div class="titlepage"><div><div><h3 class="title"><a name="d0e464"></a>7.8.&nbsp;Create writeable settings file for Drupal install</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">cp /var/www/drupal/sites/default/default.settings.php
                        /var/www/drupal/sites/default/settings.php</code> </p></div><div class="cmdsynopsis"><p><code class="command">chmod a+w /var/www/drupal/sites/default/settings.php</code> </p></div></div><div class="sect2" title="7.9.&nbsp;Install Drupal via web browser"><div class="titlepage"><div><div><h3 class="title"><a name="d0e473"></a>7.9.&nbsp;Install Drupal via web browser</h3></div></div></div><div class="sect3" title="7.9.1.&nbsp;Go to http://hostname/drupal"><div class="titlepage"><div><div><h4 class="title"><a name="d0e476"></a>7.9.1.&nbsp;Go to http://hostname/drupal</h4></div></div></div></div><div class="sect3" title="7.9.2.&nbsp;Click Install Drupal in English"><div class="titlepage"><div><div><h4 class="title"><a name="d0e479"></a>7.9.2.&nbsp;Click Install Drupal in English</h4></div></div></div></div><div class="sect3" title="7.9.3.&nbsp;Enter values"><div class="titlepage"><div><div><h4 class="title"><a name="d0e482"></a>7.9.3.&nbsp;Enter values</h4></div></div></div><p>    Database name: drupal</p><p>    Database username: drupalAdmin</p><p>    Database password: apiary</p></div><div class="sect3" title="7.9.4.&nbsp;Click Save and continue"><div class="titlepage"><div><div><h4 class="title"><a name="d0e491"></a>7.9.4.&nbsp;Click Save and continue</h4></div></div></div></div><div class="sect3" title="7.9.5.&nbsp;Configure site"><div class="titlepage"><div><div><h4 class="title"><a name="d0e494"></a>7.9.5.&nbsp;Configure site</h4></div></div></div><div class="sect4" title="7.9.5.1.&nbsp;Site information"><div class="titlepage"><div><div><h5 class="title"><a name="d0e497"></a>7.9.5.1.&nbsp;Site information</h5></div></div></div><p>    Site name: hostname</p><p>    Site e-mail address: apiary@hostname.org</p></div><div class="sect4" title="7.9.5.2.&nbsp;Administrator Account"><div class="titlepage"><div><div><h5 class="title"><a name="d0e504"></a>7.9.5.2.&nbsp;Administrator Account</h5></div></div></div><p>    Username: apiary</p><p>    E-mail address: apiary@hostname.org</p><p>    Password: apiary</p></div><div class="sect4" title="7.9.5.3.&nbsp;Site e-mail address: apiary@hostname.org"><div class="titlepage"><div><div><h5 class="title"><a name="d0e513"></a>7.9.5.3.&nbsp;Site e-mail address: apiary@hostname.org</h5></div></div></div></div><div class="sect4" title="7.9.5.4.&nbsp;Click Save and continue"><div class="titlepage"><div><div><h5 class="title"><a name="d0e516"></a>7.9.5.4.&nbsp;Click Save and continue</h5></div></div></div></div></div></div><div class="sect2" title="7.10.&nbsp;Remove write permission on settings file"><div class="titlepage"><div><div><h3 class="title"><a name="d0e519"></a>7.10.&nbsp;Remove write permission on settings file</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">Chmod a-w /var/www/drupal/sites/default/settings.php </code> </p></div><a name="envirovariables"></a></div></div><div class="sect1" title="8.&nbsp;Setup Environment Variables"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e526"></a>8.&nbsp;Setup Environment Variables</h2></div></div></div><div class="sect2" title="8.1.&nbsp;Locate java home directory"><div class="titlepage"><div><div><h3 class="title"><a name="d0e529"></a>8.1.&nbsp;Locate java home directory</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">locate /rt.jar</code> </p></div></div><div class="sect2" title="8.2.&nbsp;Create symbolic link for java-home"><div class="titlepage"><div><div><h3 class="title"><a name="d0e535"></a>8.2.&nbsp;Create symbolic link for java-home</h3></div></div></div><span class="bold"><strong>
                    <p>Note: This preserves versioning</p>
                </strong></span><div class="cmdsynopsis"><p><code class="command">ln -s /usr/lib/jvm/java-6-sun-1.6.0.15 /usr/lib/jvm/java-home</code> </p></div></div><div class="sect2" title="8.3.&nbsp;Edit user profile"><div class="titlepage"><div><div><h3 class="title"><a name="d0e546"></a>8.3.&nbsp;Edit user profile</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">vi /etc/profile</code> </p></div><p>Add the following lines (Note: no spaces around equal signs!)</p><p>export FEDORA_HOME=/usr/local/fedora</p><p>export JAVA_HOME=/usr/lib/jvm/java-home</p><p>export PATH=$JAVA_HOME/bin:$PATH</p><p>export PATH=$FEDORA_HOME/server/bin:$PATH</p><p>export PATH=$FEDORA_HOME/client/bin:$PATH</p><p>export CATALINA_HOME=$FEDORA_HOME/tomcat</p><p>export LD_LIBRARY_PATH=/usr/lib/jvm/java-home</p><p>export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH</p></div><div class="sect2" title="8.4.&nbsp;Restart machine"><div class="titlepage"><div><div><h3 class="title"><a name="d0e570"></a>8.4.&nbsp;Restart machine</h3></div></div></div></div></div><div class="sect1" title="9.&nbsp;Install Fedora"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e573"></a>9.&nbsp;Install <a class="link" href="http://www.fedora-commons.org/" target="_top">Fedora</a></h2></div></div></div><div class="sect2" title="9.1.&nbsp;Download"><div class="titlepage"><div><div><h3 class="title"><a name="d0e578"></a>9.1.&nbsp;Download</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">wget
                        http://downloads.sourceforge.net/fedora-commons/fedora-installer-3.2.1.jar</code> </p></div></div><div class="sect2" title="9.2.&nbsp;Create symbolic link to fedora dir"><div class="titlepage"><div><div><h3 class="title"><a name="d0e584"></a>9.2.&nbsp;Create symbolic link to fedora dir</h3></div></div></div><span class="bold"><strong>
                    <p>Note: This preserves versioning</p>
                </strong></span><div class="cmdsynopsis"><p><code class="command">ln -s /usr/local/fedora-3.2 /usr/local/fedora</code> </p></div></div><div class="sect2" title="9.3.&nbsp;Create a keystore for SSL support"><div class="titlepage"><div><div><h3 class="title"><a name="d0e595"></a>9.3.&nbsp;Create a keystore for SSL support</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">$JAVA_HOME/bin/keytool -genkey -alias tomcat -keyalg RSA</code> </p></div><p>Password:apiary</p></div><div class="sect2" title="9.4.&nbsp;Run Fedora java installer"><div class="titlepage"><div><div><h3 class="title"><a name="d0e603"></a>9.4.&nbsp;Run Fedora java installer</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">java -jar fedora- installer-3.2.1.jar</code> </p></div><p>    Installation type: custom</p><p>    Fedora home directory: /usr/local/fedora-3.2</p><p>    Fedora administrator password: apiary</p><p>    Fedora server host: hostname</p><p>    Fedora application server context: fedora</p><p>    Authentication requirement for API-A: false</p><p>    SSL availability: true</p><p>    SSL required for API-A: false</p><p>    SSL required for API-M: false</p><p>    Servlet engine: included</p><p>    Tomcat home directory: /usr/local/fedora-3.2/tomcat</p><p>    Tomcat HTTP port: 8080</p><p>    Tomcat shutdown port: 8005</p><p>    Tomcat Secure HTTP port: 8443</p><p>    Keystore file: default</p><p>    Keystore password: apiary</p><p>    Keystore type: JKS</p><p>    Database: mysql</p><p>    MySQL JDBC driver: included</p><p>    Database username: fedoraAdmin</p><p>    Database password: apiary</p><p>    JDBC URL:
                    jdbc:mysql://hostname/fedora?useUnicode=true&amp;amp;characterEncoding=UTF-8&amp;amp;autoReconnect=true</p><p>    JDBC DriverClass: com.mysql.jdbc.Driver</p><p>    Policy enforcement enabled: true</p><p>    Enable Resource Index: true</p><p>    Enable Messaging: false</p><p>    Deploy local services and demos: true</p></div><div class="sect2" title="9.5.&nbsp;Verify Fedora&#8217;s Resource Index activation"><div class="titlepage"><div><div><h3 class="title"><a name="d0e663"></a>9.5.&nbsp;Verify Fedora&#8217;s Resource Index activation</h3></div></div></div><span class="bold"><strong>
                    <p>Note: Some Ubuntu installs had this variable set to zero even using
                        &#8220;Enable Resource Index: true&#8221;</p>
                </strong></span><div class="cmdsynopsis"><p><code class="command">vi $FEDORA_HOME/server/config/fedora.fcfg</code> </p></div><p> Set fedora.server.resourceIndex.ResourceIndex to 1</p></div><div class="sect2" title="9.6.&nbsp;Startup Tomcat (which will install Tomcat Fedora features)"><div class="titlepage"><div><div><h3 class="title"><a name="d0e676"></a>9.6.&nbsp;Startup Tomcat (which will install Tomcat Fedora features)</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">$FEDORA_HOME/tomcat/bin/startup.sh</code> </p></div></div><div class="sect2" title="9.7.&nbsp;Shutdown Tomcat"><div class="titlepage"><div><div><h3 class="title"><a name="d0e682"></a>9.7.&nbsp;Shutdown Tomcat</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">$FEDORA_HOME/tomcat/bin/shutdown.sh</code> </p></div></div><div class="sect2" title="9.8.&nbsp;Copy crossdomain file"><div class="titlepage"><div><div><h3 class="title"><a name="d0e688"></a>9.8.&nbsp;Copy crossdomain file</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">cp $FEDORA_HOME/tomcat/webapps/fedora/admin/crossdomain.xml
                        /usr/local/fedora/tomcat/webapps</code> </p></div></div><div class="sect2" title="9.9.&nbsp;Setup anonymous user access"><div class="titlepage"><div><div><h3 class="title"><a name="d0e694"></a>9.9.&nbsp;Setup anonymous user access</h3></div></div></div><span class="bold"><strong>
                    <p>Note: Allows anonymous users to be able to view public objects later while
                        using Islandora.</p>
                </strong></span><div class="cmdsynopsis"><p><code class="command">vi $FEDORA_HOME/server/config/fedora-users.xml</code> </p></div><p>Note: Islandora will send the username of fedora_anonymous and password of
                    anonymous for all unauthenticated use.</p><p>Add the following &lt;user&gt; lines:</p><p>&lt;user name="fedora_anonymous" password="anonymous"&gt; </p><p>    &lt;attribute name="fedoraRole"&gt;</p><p>        &lt;value&gt;fedoraUser&lt;/value&gt;</p><p>    &lt;/attribute&gt; </p><p>&lt;/user&gt; </p></div><div class="sect2" title="9.10.&nbsp;Install Islandora Drupal filter"><div class="titlepage"><div><div><h3 class="title"><a name="d0e719"></a>9.10.&nbsp;Install Islandora Drupal filter</h3></div></div></div><div class="sect3" title="9.10.1.&nbsp;Download DrupalFilter_3.jar from http://sourceforge.net/projects/islandora/files/"><div class="titlepage"><div><div><h4 class="title"><a name="d0e722"></a>9.10.1.&nbsp;Download DrupalFilter_3.jar from
                        http://sourceforge.net/projects/islandora/files/ </h4></div></div></div><div class="cmdsynopsis"><p><code class="command">wget
                            http://softlayer.dl.sourceforge.net/project/islandora/islandora/Islandora_Dru6_Fed_3.1_beta2009-04-03/DrupalFilter_3.jar</code> </p></div></div><div class="sect3" title="9.10.2.&nbsp;Move Drupal filter to the fedora tomcat webapp"><div class="titlepage"><div><div><h4 class="title"><a name="d0e728"></a>9.10.2.&nbsp;Move Drupal filter to the fedora tomcat webapp</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">cp DrupalFilter_3.jar
                            $FEDORA_HOME/tomcat/webapps/fedora/WEB-INF/lib/DrupalFilter.jar</code> </p></div></div><div class="sect3" title="9.10.3.&nbsp;Create a fedora server filter-drupal file"><div class="titlepage"><div><div><h4 class="title"><a name="d0e734"></a>9.10.3.&nbsp;Create a fedora server filter-drupal file</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">vi $FEDORA_HOME/server/config/filter-drupal.xml</code> </p></div><div class="caution" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="file:/C:/Program%20Files%20(x86)/Oxygen%20XML%20Editor%2012/frameworks/docbook/xsl/images/caution.png"></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p><span class="bold"><strong>The xml file needs a blank line at the
                                end</strong></span></p></td></tr></table></div><p>Add the following lines:</p><p>&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;!--File to hold drupal
                        connection info for the FilterDrupal servlet filter. For multisite drupal
                        installs you can include multiple connection elements. We will query all the
                        databases and assume any user in any drupal db with the same username and
                        password are the same user. We will gather all roles for that user from all
                        databases. This is a potential security risk if a user in one drupal db has
                        the same username and password as another user in a seperate drupaldb. We
                        are also assuming all drupal dbs to be mysql. This file should be located in
                        the same directory as the fedora.cfcg file--&gt;&lt;FilterDrupal_Connection&gt;
                        &lt;connection server="hostname" dbname="drupal" user="drupalAdmin"
                        password="apiary" port="3306"&gt; &lt;sql&gt; SELECT distinct u.uid as userid,
                        u.name as Name, u.pass as Pass, r.name as role FROM drupal.users u,
                        drupal.role r, drupal.users_roles where u.name=? and u.pass=? and
                        r.rid=drupal.users_roles.rid and u.uid=drupal.users_roles.uid; &lt;/sql&gt;
                        &lt;/connection&gt; &lt;/FilterDrupal_Connection&gt;</p></div><div class="sect3" title="9.10.4.&nbsp;Edit the fedora tomcat webapp web.xml file"><div class="titlepage"><div><div><h4 class="title"><a name="d0e748"></a>9.10.4.&nbsp;Edit the fedora tomcat webapp web.xml file</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">vi $FEDORA_HOME/tomcat/webapps/fedora/WEB-INF/web.xml</code> </p></div><p>After</p><p>&lt;filter&gt;</p><p>    &lt;filter-name&gt;XmlUserfileFilter&lt;/filter-name&gt;</p><p>
                        &lt;filter-class&gt;fedora.server.security.servletfilters.xmluserfile.FilterXmlUserfile&lt;/filter-class&gt; </p><p>&lt;/filter&gt;</p><p>Add</p><p>&lt;filter&gt;</p><p>    &lt;filter-name&gt;DrupalFilter&lt;/filter-name&gt;</p><p>
                        &lt;filter-class&gt;ca.upei.roblib.fedora.servletfilter.FilterDrupal&lt;/filter-class&gt;</p><p>&lt;/filter&gt;</p><p>After</p><p>&lt;filter-mapping&gt;</p><p>    &lt;filter-name&gt;XmlUserfileFilter&lt;/filter-name&gt;</p><p>    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</p><p>&lt;/filter-mapping&gt;</p><p>Add</p><p>&lt;filter-mapping&gt;</p><p>    &lt;filter-name&gt;DrupalFilter&lt;/filter-name&gt;</p><p>    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</p><p>&lt;/filter-mapping&gt; </p></div></div><div class="sect2" title="9.11.&nbsp;Enable and rebuild Fedora&#8217;s Resource Index"><div class="titlepage"><div><div><h3 class="title"><a name="d0e794"></a>9.11.&nbsp;Enable and rebuild Fedora&#8217;s Resource Index</h3></div></div></div><div class="sect3" title="9.11.1.&nbsp;Enable Fedora&#8217;s Resource Index activation"><div class="titlepage"><div><div><h4 class="title"><a name="d0e797"></a>9.11.1.&nbsp;Enable Fedora&#8217;s Resource Index activation</h4></div></div></div><span class="bold"><strong>
                        <p>Note: Some Ubuntu installs had this variable set to zero even using
                            &#8220;Enable Resource Index: true&#8221;</p>
                    </strong></span><div class="cmdsynopsis"><p><code class="command">vi $FEDORA_HOME/server/config/fedora.fcfg</code> </p></div><p>Set fedora.server.resourceIndex.ResourceIndex to 1</p></div><div class="sect3" title="9.11.2.&nbsp;Rebuild Fedora&#8217;s Resource Index activation"><div class="titlepage"><div><div><h4 class="title"><a name="d0e810"></a>9.11.2.&nbsp;Rebuild Fedora&#8217;s Resource Index activation</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">$FEDORA_HOME/server/bin/fedora-rebuild.sh</code> </p></div><p>Choose &#8220;Rebuild the Resource Index&#8221; </p><p>Verify selection</p></div><div class="sect3" title="9.11.3.&nbsp;Restart Fedora"><div class="titlepage"><div><div><h4 class="title"><a name="d0e820"></a>9.11.3.&nbsp;Restart Fedora</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">$FEDORA_HOME/tomcat/bin/shutdown.sh</code> </p></div><div class="cmdsynopsis"><p><code class="command">$FEDORA_HOME/tomcat/bin/startup.sh</code> </p></div></div></div></div><div class="sect1" title="10.&nbsp;Install Adore-Djatoka Image Server"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e829"></a>10.&nbsp;Install <a class="link" href="http://sourceforge.net/projects/djatoka/" target="_top">Adore-Djatoka
                    Image Server</a></h2></div></div></div><div class="sect2" title="10.1.&nbsp;Download"><div class="titlepage"><div><div><h3 class="title"><a name="d0e834"></a>10.1.&nbsp;Download</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">wget
                        http://iweb.dl.sourceforge.net/project/djatoka/djatoka/1.1/adore-djatoka-1.1.tar.gz</code> </p></div></div><div class="sect2" title="10.2.&nbsp;Extract adore-djatoka-1.1"><div class="titlepage"><div><div><h3 class="title"><a name="d0e840"></a>10.2.&nbsp;Extract adore-djatoka-1.1</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">tar -zxvf adore-djatoka-1.1.tar.gz</code> </p></div></div><div class="sect2" title="10.3.&nbsp;Move adore-djatoka-1.1 to /usr/local"><div class="titlepage"><div><div><h3 class="title"><a name="d0e846"></a>10.3.&nbsp;Move adore-djatoka-1.1 to /usr/local</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">mv adore-djatoka-x.x /usr/local</code> </p></div></div><div class="sect2" title="10.4.&nbsp;Create symbolic link to adore-djatoka dir"><div class="titlepage"><div><div><h3 class="title"><a name="d0e852"></a>10.4.&nbsp;Create symbolic link to adore-djatoka dir</h3></div></div></div><span class="bold"><strong>
                    <p>Note: This preserves versioning</p>
                </strong></span><div class="cmdsynopsis"><p><code class="command">ln -s /usr/local/adore-djatoka-1.1 /usr/local/adore-djatoka</code> </p></div></div><div class="sect2" title="10.5.&nbsp;Test functionality"><div class="titlepage"><div><div><h3 class="title"><a name="d0e863"></a>10.5.&nbsp;Test functionality</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /usr/local/adore-djatoka/bin</code> </p></div><div class="cmdsynopsis"><p><code class="command">./compress.sh -i ../etc/test.jpg -o ../etc/test.jp2</code> </p></div><p>Compress jpg file into jpeg2000 format</p><div class="cmdsynopsis"><p><code class="command">./extract.sh -i ../etc/test.jp2 -o ../etc/test-size1.jpg -l 1
                    </code> </p></div><p>extracts a jpg file from a jpeg2000 file</p><div class="cmdsynopsis"><p><code class="command">ls -l ../etc </code> </p></div><p>verify test.jp2 and test-size1.jpg files were created</p></div><div class="sect2" title="10.6.&nbsp;Add Adore-Djatoka to tomcat webapps"><div class="titlepage"><div><div><h3 class="title"><a name="d0e884"></a>10.6.&nbsp;Add Adore-Djatoka to tomcat webapps</h3></div></div></div><div class="sect3" title="10.6.1.&nbsp;Shutdown running tomcat"><div class="titlepage"><div><div><h4 class="title"><a name="d0e887"></a>10.6.1.&nbsp;Shutdown running tomcat</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">$FEDORA_HOME/tomcat/bin/startup.sh</code> </p></div></div><div class="sect3" title="10.6.2.&nbsp;Copy adore-djatoka.war file to tomcat webapps"><div class="titlepage"><div><div><h4 class="title"><a name="d0e893"></a>10.6.2.&nbsp;Copy adore-djatoka.war file to tomcat webapps</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">cp /usr/local/adore-djatoka/dist/adore-djatoka.war
                            /$CATALINA_HOME/webapps</code> </p></div></div><div class="sect3" title="10.6.3.&nbsp;Start tomcat from Adore-Djatoka bin directory"><div class="titlepage"><div><div><h4 class="title"><a name="d0e899"></a>10.6.3.&nbsp;Start tomcat from Adore-Djatoka bin directory</h4></div></div></div><span class="bold"><strong>
                        <p>Note: Must be started while currently in the
                            /usr/local/adore-djatoka/bin directory</p>
                    </strong></span><div class="cmdsynopsis"><p><code class="command">cd /usr/local/adore-djatoka/bin</code> </p></div><div class="cmdsynopsis"><p><code class="command">./tomcat.sh start</code> </p></div></div></div><div class="sect2" title="10.7.&nbsp;Configure Referent Resolver"><div class="titlepage"><div><div><h3 class="title"><a name="d0e913"></a>10.7.&nbsp;Configure Referent Resolver</h3></div></div></div><div class="sect3" title="10.7.1.&nbsp;Edit Djatoka Properties"><div class="titlepage"><div><div><h4 class="title"><a name="d0e916"></a>10.7.1.&nbsp;Edit Djatoka Properties</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">vi
                            $CATALINA_HOME/webapps/adore-djatoka/WEB-INF/classes/djatoka.properties</code> </p></div><p>Add the following in the Referent Resolver Properties section</p><p>SimpleListResolver.maxRemoteCacheSize=10000</p></div><div class="sect3" title="10.7.2.&nbsp;Setup JP2 images"><div class="titlepage"><div><div><h4 class="title"><a name="d0e926"></a>10.7.2.&nbsp;Setup JP2 images</h4></div></div></div><div class="sect4" title="10.7.2.1.&nbsp;Create Image directory"><div class="titlepage"><div><div><h5 class="title"><a name="d0e929"></a>10.7.2.1.&nbsp;Create Image directory</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">mkdir -p /var/www/images/jpeg2000</code> </p></div></div><div class="sect4" title="10.7.2.2.&nbsp;Download JP2 images"><div class="titlepage"><div><div><h5 class="title"><a name="d0e935"></a>10.7.2.2.&nbsp;Download JP2 images</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /var/www/images/jpeg2000</code> </p></div><div class="cmdsynopsis"><p><code class="command">wget
                                http://research.apiaryproject.org/images/apiary-aquarius-jpeg2000-vbox.tar.gz</code> </p></div></div><div class="sect4" title="10.7.2.3.&nbsp;Extract images"><div class="titlepage"><div><div><h5 class="title"><a name="d0e944"></a>10.7.2.3.&nbsp;Extract images</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">tar &#8211;zxvf apiary-aquarius-jpeg2000-vbox.tar.gz</code> </p></div></div><div class="sect4" title="10.7.2.4.&nbsp;Edit simple resolver list location"><div class="titlepage"><div><div><h5 class="title"><a name="d0e950"></a>10.7.2.4.&nbsp;Edit simple resolver list location</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">vi /var/www/images/jpeg2000/imgIndex.txt</code> </p></div><p>Replace all /mnt/converted_images with /var/www/images</p></div><div class="sect4" title="10.7.2.5.&nbsp;Move list to appropriate location"><div class="titlepage"><div><div><h5 class="title"><a name="d0e958"></a>10.7.2.5.&nbsp;Move list to appropriate location</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">mv /var/www/images/jpeg2000/imgIndex.txt
                                $CATALINA_HOME/webapps/adore-djatoka/WEB-INF/classes</code> </p></div></div><div class="sect4" title="10.7.2.6.&nbsp;Stop and Start Tomcat from adore-djatoka bin directory"><div class="titlepage"><div><div><h5 class="title"><a name="d0e964"></a>10.7.2.6.&nbsp;Stop and Start Tomcat from adore-djatoka bin directory</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /usr/local/adore-djatoka/bin</code> </p></div><div class="cmdsynopsis"><p><code class="command">./tomcat.sh stop</code> </p></div><div class="cmdsynopsis"><p><code class="command">./tomcat.sh start</code> </p></div></div></div></div></div><div class="sect1" title="11.&nbsp;Install OCRopus"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e976"></a>11.&nbsp;Install <a class="link" href="http://code.google.com/p/ocropus/" target="_top">OCRopus</a></h2></div></div></div><div class="sect2" title="11.1.&nbsp;Download"><div class="titlepage"><div><div><h3 class="title"><a name="d0e981"></a>11.1.&nbsp;Download</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">mkdir /home/apiary/ocropus</code> </p></div><div class="cmdsynopsis"><p><code class="command">cd /home/apiary/ocropus</code> </p></div><div class="cmdsynopsis"><p><code class="command">hg clone http://iulib.googlecode.com/hg iulib</code> </p></div><div class="cmdsynopsis"><p><code class="command">hg clone http://ocropus.googlecode.com/hg ocropus</code> </p></div></div><div class="sect2" title="11.2.&nbsp;Install prerequisites"><div class="titlepage"><div><div><h3 class="title"><a name="d0e996"></a>11.2.&nbsp;Install prerequisites</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">sh -x ocropus/ubuntu-packages</code> </p></div></div><div class="sect2" title="11.3.&nbsp;Install iulib library"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1002"></a>11.3.&nbsp;Install iulib library</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /home/apiary/ocropus/iulib</code> </p></div><div class="cmdsynopsis"><p><code class="command">scons</code> </p></div><div class="cmdsynopsis"><p><code class="command">scons install</code> </p></div></div><div class="sect2" title="11.4.&nbsp;Install OCRopus library"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1014"></a>11.4.&nbsp;Install OCRopus library</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /home/apiary/ocropus/ocropus</code> </p></div><div class="cmdsynopsis"><p><code class="command">scons</code> </p></div><div class="cmdsynopsis"><p><code class="command">scons install</code> </p></div></div><div class="sect2" title="11.5.&nbsp;Configure Ubuntu for OCRopus"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1026"></a>11.5.&nbsp;Configure Ubuntu for OCRopus</h3></div></div></div><div class="sect3" title="11.5.1.&nbsp;Add /usr/local/bin to PATH"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1029"></a>11.5.1.&nbsp;Add /usr/local/bin to PATH</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">PATH=/usr/local/bin:$PATH</code> </p></div></div><div class="sect3" title="11.5.2.&nbsp;Add library reference"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1035"></a>11.5.2.&nbsp;Add library reference</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">ldconfig</code> </p></div><div class="cmdsynopsis"><p><code class="command">LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH</code> </p></div></div></div><div class="sect2" title="11.6.&nbsp;Test install"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1044"></a>11.6.&nbsp;Test install</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">ocropus page data/testimages/simple.png</code> </p></div><p>Note: should output the ocr of image simple.png</p></div></div><div class="sect1" title="12.&nbsp;Install Ocrad"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1052"></a>12.&nbsp;Install <a class="link" href="http://www.gnu.org/software/ocrad/" target="_top">Ocrad</a></h2></div></div></div><div class="sect2" title="12.1.&nbsp;Download"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1057"></a>12.1.&nbsp;Download</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">mkdir /home/apiary/ocrad</code> </p></div><div class="cmdsynopsis"><p><code class="command">cd /home/apiary/ocrad</code> </p></div><div class="cmdsynopsis"><p><code class="command">wget http://ftp.gnu.org/gnu/ocrad/ocrad-0.21.tar.gz</code> </p></div></div><div class="sect2" title="12.2.&nbsp;Extract ocrad-0.21"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1069"></a>12.2.&nbsp;Extract ocrad-0.21</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">tar -zxvf ocrad-0.21.tar.gz</code> </p></div></div><div class="sect2" title="12.3.&nbsp;Configure and make ocrad"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1075"></a>12.3.&nbsp;Configure and make ocrad</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /home/apiary/ocrad/ocrad-0.21</code> </p></div><div class="cmdsynopsis"><p><code class="command">./configure</code> </p></div><div class="cmdsynopsis"><p><code class="command">make</code> </p></div><div class="cmdsynopsis"><p><code class="command">make installd</code> </p></div><p>Note: adds ocrad file to /usr/local/bin</p></div></div><div class="sect1" title="13.&nbsp;Install GOCR"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1092"></a>13.&nbsp;Install <a class="link" href="http://jocr.sourceforge.net/" target="_top">GOCR</a></h2></div></div></div><div class="sect2" title="13.1.&nbsp;Download"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1097"></a>13.1.&nbsp;Download</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">mkdir /home/apiary/gocr</code> </p></div><div class="cmdsynopsis"><p><code class="command">cd /home/apiary/gocr</code> </p></div><div class="cmdsynopsis"><p><code class="command">wget
                        http://www-e.uni-magdeburg.de/jschulen/ocr/gocr-0.49.tar.gz</code> </p></div></div><div class="sect2" title="13.2.&nbsp;Extract ocrad-0.21"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1109"></a>13.2.&nbsp;Extract ocrad-0.21</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">tar -zxvf gocr-0.49.tar.gz</code> </p></div></div><div class="sect2" title="13.3.&nbsp;Configure and make ocrad"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1115"></a>13.3.&nbsp;Configure and make ocrad</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /home/apiary/gocr/gocr-0.49</code> </p></div><div class="cmdsynopsis"><p><code class="command">./configure</code> </p></div><div class="cmdsynopsis"><p><code class="command">make</code> </p></div><div class="cmdsynopsis"><p><code class="command">make install</code> </p></div><span class="bold"><strong>
                    <p>Note: adds gocr file to /usr/local/bin</p>
                </strong></span></div></div><div class="sect1" title="14.&nbsp;Configure Drupal to work with Apiary using fedora_repository (Islandora) and apiary_project"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1135"></a>14.&nbsp;Configure Drupal to work with Apiary using fedora_repository (Islandora) and
                apiary_project</h2></div></div></div><div class="sect2" title="14.1.&nbsp;Allow user access for druapl ajax calls"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1138"></a>14.1.&nbsp;Allow user access for druapl ajax calls<a name="editmenuinc"></a></h3></div></div></div><div class="sect3" title="14.1.1.&nbsp;Edit drupal/includes/menu.inc"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1142"></a>14.1.1.&nbsp;Edit drupal/includes/menu.inc</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">/var/www/drupal/includes/menu.inc</code> </p></div><p>In function _menu_check_access(&amp;$item, $map) </p><p>Replace: </p><p>if ($callback == 'user_access') { $item['access'] = (count($arguments) ==
                        1) ? user_access($arguments[0]) : user_access($arguments[0], $arguments[1]);
                        }</p><p>With:</p><p>if ($callback == 'user_access') { if(strpos($item['file'],
                        "modules/apiary_project") &gt; -1) { $item['access'] = user_access("View Apiary
                        Project"); } else { $item['access'] = (count($arguments) == 1) ?
                        user_access($arguments[0]) : user_access($arguments[0], $arguments[1]); }
                        }</p></div></div><div class="sect2" title="14.2.&nbsp;Enable Clean URLs"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1158"></a>14.2.&nbsp;Enable Clean URLs</h3></div></div></div><div class="sect3" title="14.2.1.&nbsp;Browse to Administer-&gt;Site configuration-&gt;Clean URLs"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1161"></a>14.2.1.&nbsp;Browse to Administer-&gt;Site configuration-&gt;Clean URLs</h4></div></div></div><div class="sect4" title="14.2.1.1.&nbsp;Select Enabled"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1164"></a>14.2.1.1.&nbsp;Select Enabled</h5></div></div></div></div><div class="sect4" title="14.2.1.2.&nbsp;Click Save Configuration"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1167"></a>14.2.1.2.&nbsp;Click Save Configuration</h5></div></div></div></div></div></div><div class="sect2" title="14.3.&nbsp;Install Required Drupal Themes"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1170"></a>14.3.&nbsp;Install Required Drupal Themes</h3></div></div></div><div class="sect3" title="14.3.1.&nbsp;Install Zen"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1173"></a>14.3.1.&nbsp;Install <a class="link" href="http://drupal.org/project/zen" target="_top">Zen</a></h4></div></div></div><div class="sect4" title="14.3.1.1.&nbsp;Download"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1178"></a>14.3.1.1.&nbsp;Download</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /var/www/drupal/themes</code> </p></div><div class="cmdsynopsis"><p><code class="command">svn co
                                svn://projects.brit.org/src/svn_apiary/trunk/servers/applications/drupal/themes/zen</code> </p></div></div><div class="sect4" title="14.3.1.2.&nbsp;Install"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1187"></a>14.3.1.2.&nbsp;Install</h5></div></div></div><div class="sect5" title="14.3.1.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/themes"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1190"></a>14.3.1.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/themes</h6></div></div></div><p>Scroll to Zen</p><p>Check Enabled</p><p>Click Save configuration</p></div></div></div><div class="sect3" title="14.3.2.&nbsp;Install Cti-flex-no-title"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1199"></a>14.3.2.&nbsp;Install Cti-flex-no-title</h4></div></div></div><span class="bold"><strong>
                        <p>Note: This is theme altered by the Apiary Project to remove all menus,
                            padding, etc</p>
                    </strong></span><div class="sect4" title="14.3.2.1.&nbsp;Download"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1207"></a>14.3.2.1.&nbsp;Download</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /var/www/drupal/themes</code> </p></div><div class="cmdsynopsis"><p><code class="command">svn co
                                svn://projects.brit.org/src/svn_apiary/trunk/servers/applications/drupal/themes/cti_flex_no_title</code> </p></div></div><div class="sect4" title="14.3.2.2.&nbsp;Install"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1216"></a>14.3.2.2.&nbsp;Install</h5></div></div></div><div class="sect5" title="14.3.2.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/themes"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1219"></a>14.3.2.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/themes</h6></div></div></div><p>Scroll to cti-flex-no-title</p><p>Check Enabled</p><p>Click Save configuration</p></div></div></div><div class="sect3" title="14.3.3.&nbsp;Install Cti-flex"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1228"></a>14.3.3.&nbsp;Install <a class="link" href="http://drupal.org/project/cti_flex" target="_top">Cti-flex</a></h4></div></div></div><div class="sect4" title="14.3.3.1.&nbsp;Download"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1233"></a>14.3.3.1.&nbsp;Download</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /var/www/drupal/themes</code> </p></div><div class="cmdsynopsis"><p><code class="command">svn co
                                svn://projects.brit.org/src/svn_apiary/trunk/servers/applications/drupal/themes/cti_flex</code> </p></div></div><div class="sect4" title="14.3.3.2.&nbsp;Install"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1242"></a>14.3.3.2.&nbsp;Install</h5></div></div></div><div class="sect5" title="14.3.3.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/themes"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1245"></a>14.3.3.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/themes</h6></div></div></div><p>Scroll to cti-flex</p><p>Check Enabled</p><p>Click Save configuration</p></div></div></div></div><div class="sect2" title="14.4.&nbsp;Install Required Drupal Modules"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1254"></a>14.4.&nbsp;Install Required Drupal Modules</h3></div></div></div><div class="sect3" title="14.4.1.&nbsp;Install ImageAPI"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1257"></a>14.4.1.&nbsp;Install <a class="link" href="http://drupal.org/project/imageapi" target="_top">ImageAPI</a></h4></div></div></div><div class="sect4" title="14.4.1.1.&nbsp;Download"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1262"></a>14.4.1.1.&nbsp;Download</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /home/apiary/</code> </p></div><div class="cmdsynopsis"><p><code class="command">wget
                                http://ftp.drupal.org/files/projects/imageapi-6.x-1.10.tar.gz</code> </p></div></div><div class="sect4" title="14.4.1.2.&nbsp;Extract"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1271"></a>14.4.1.2.&nbsp;Extract</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">tar -zxvf imageapi-6.x-1.10.tar.gz</code> </p></div></div><div class="sect4" title="14.4.1.3.&nbsp;Move"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1277"></a>14.4.1.3.&nbsp;Move</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">mv imageapi-6.x-1.10 /var/www/drupal/modules</code> </p></div></div><div class="sect4" title="14.4.1.4.&nbsp;Install"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1283"></a>14.4.1.4.&nbsp;Install</h5></div></div></div><div class="sect5" title="14.4.1.4.1.&nbsp;Browse to http://hostname/drupal/admin/build/modules"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1286"></a>14.4.1.4.1.&nbsp;Browse to http://hostname/drupal/admin/build/modules</h6></div></div></div><p>Scroll to ImageCache section</p><p>Check Enabled for ImageAPI</p><p>Click Save configuration</p></div></div></div><div class="sect3" title="14.4.2.&nbsp;Install ImageAPI GD2"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1295"></a>14.4.2.&nbsp;Install ImageAPI GD2</h4></div></div></div><div class="sect4" title="14.4.2.1.&nbsp;Download"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1298"></a>14.4.2.1.&nbsp;Download</h5></div></div></div><p><span class="bold"><strong>Note: There is no download as it is already
                                included</strong></span></p></div><div class="sect4" title="14.4.2.2.&nbsp;Install"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1304"></a>14.4.2.2.&nbsp;Install</h5></div></div></div><div class="sect5" title="14.4.2.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/modules"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1307"></a>14.4.2.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/modules</h6></div></div></div><p>Scroll to ImageCache section</p><p>Check Enabled for ImageAPI GD2</p><p>Click Save configuration</p></div></div></div><div class="sect3" title="14.4.3.&nbsp;Install Core-optional Modules"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1316"></a>14.4.3.&nbsp;Install Core-optional Modules</h4></div></div></div><div class="sect4" title="14.4.3.1.&nbsp;Download"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1319"></a>14.4.3.1.&nbsp;Download</h5></div></div></div><p><span class="bold"><strong>Note: There is no download as it is already
                                included with the drupal core</strong></span></p></div><div class="sect4" title="14.4.3.2.&nbsp;Install"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1325"></a>14.4.3.2.&nbsp;Install</h5></div></div></div><div class="sect5" title="14.4.3.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/modules"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1328"></a>14.4.3.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/modules</h6></div></div></div><p>Scroll to Core-optional section</p><p>Check Enabled for Path</p><p>Check Enabled for PHP filter</p><p>Click Save configuration</p></div></div></div><div class="sect3" title="14.4.4.&nbsp;Install Fedora_Repository (ISLANDORA)"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1339"></a>14.4.4.&nbsp;Install <a class="link" href="http://islandora.ca/" target="_top">Fedora_Repository
                            (ISLANDORA)</a></h4></div></div></div><div class="sect4" title="14.4.4.1.&nbsp;Download"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1344"></a>14.4.4.1.&nbsp;Download</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /var/www/drupal/modules</code> </p></div><div class="cmdsynopsis"><p><code class="command">svn co
                                http://fedora-commons.org/svn/root/islandora/islandora-module/Islandora-dru6-fed3/trunk/fedora_repository</code> </p></div></div><div class="sect4" title="14.4.4.2.&nbsp;Install"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1353"></a>14.4.4.2.&nbsp;Install</h5></div></div></div><div class="sect5" title="14.4.4.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/modules"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1356"></a>14.4.4.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/modules</h6></div></div></div><p>Scroll to Fedora Repository section</p><p>Check Enabled for Digital Repository</p><p>Check Enabled for Fedora ImageAPI</p><p>Click Save configuration</p></div></div><div class="sect4" title="14.4.4.3.&nbsp;Create Drupal administrator role"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1367"></a>14.4.4.3.&nbsp;Create Drupal administrator role</h5></div></div></div><div class="sect5" title="14.4.4.3.1.&nbsp;Browse to http://hostname/drupal/admin/user/roles"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1370"></a>14.4.4.3.1.&nbsp;Browse to http://hostname/drupal/admin/user/roles</h6></div></div></div><p>type &#8216;administrator&#8217; and click Add role</p></div></div><div class="sect4" title="14.4.4.4.&nbsp;Edit Drupal role administrator&#8217;s permissions"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1375"></a>14.4.4.4.&nbsp;Edit Drupal role administrator&#8217;s permissions</h5></div></div></div><div class="sect5" title="14.4.4.4.1.&nbsp;Browse to http://hostname/drupal/admin/user/roles"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1378"></a>14.4.4.4.1.&nbsp;Browse to http://hostname/drupal/admin/user/roles</h6></div></div></div><p>Click edit permissions for administrator</p><p>Check all options for fedora_repository module</p><p>Click Save permissions</p></div></div><div class="sect4" title="14.4.4.5.&nbsp;Configure Fedora Repository settings"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1387"></a>14.4.4.5.&nbsp;Configure Fedora Repository settings</h5></div></div></div><div class="sect5" title="14.4.4.5.1.&nbsp;Browse to http://hostname/drupal/admin/settings/fedora_repository"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1390"></a>14.4.4.5.1.&nbsp;Browse to
                                http://hostname/drupal/admin/settings/fedora_repository</h6></div></div></div><p>Default Collection Name: Apiary's Fedora Repository</p><p>Default Collection PID: apiary:SpecimenBinders</p><p>A user with the Drupal role administrator: apiary</p><p>Pid namespaces allowed in this Drupal install: demo: changeme:
                                Islandora: ilives: apiary: ap-specimen: ap-roi: ap-image: ap-model:
                                ap-sdef: ap-sdep: ap-sdefcm:</p><p>Fedora Soap Management Url:
                                http://hostname:8080/fedora/services/management?wsdl</p><p>Fedora base url: http://hostname:8080/fedora</p><p>Fedora RISearch URL: http://hostname:8080/fedora/risearch</p><p>Fedora Lucene Search URL:
                                http://hostname:8080/fedoragsearch/rest</p><p>Fedora Lucene Index Name: BasicIndex</p><p>Fedora Soap Url:
                                http://hostname:8080/fedora/services/access?wsdl</p><p>Click Save configuration</p></div></div></div><div class="sect3" title="14.4.5.&nbsp;Install Apiary Project"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1415"></a>14.4.5.&nbsp;Install <a class="link" href="http://www.apiaryproject.org" target="_top">Apiary
                            Project</a></h4></div></div></div><div class="sect4" title="14.4.5.1.&nbsp;Download"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1420"></a>14.4.5.1.&nbsp;Download</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /var/www/drupal/modules</code> </p></div><div class="cmdsynopsis"><p><code class="command">svn co
                                svn://projects.brit.org/src/svn_apiary/branches/mellifera-apiary-1.0.0/apiary_project</code> </p></div></div><div class="sect4" title="14.4.5.2.&nbsp;Create Drupal apiary admin role"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1429"></a>14.4.5.2.&nbsp;Create Drupal apiary admin role</h5></div></div></div><div class="sect5" title="14.4.5.2.1.&nbsp;Browse to http://hostname/drupal/admin/user/roles"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1432"></a>14.4.5.2.1.&nbsp;Browse to http://hostname/drupal/admin/user/roles</h6></div></div></div><p>type &#8216;apiary admin&#8217; and click Add role</p></div></div><div class="sect4" title="14.4.5.3.&nbsp;Edit Drupal role apiary admin&#8217;s permissions"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1437"></a>14.4.5.3.&nbsp;Edit Drupal role  apiary admin&#8217;s permissions</h5></div></div></div><div class="sect5" title="14.4.5.3.1.&nbsp;Browse to http://hostname/drupal/admin/user/roles"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1440"></a>14.4.5.3.1.&nbsp;Browse to http://hostname/drupal/admin/user/roles</h6></div></div></div><p>Click edit permissions for administrator</p><p>Check all options for apiary_project module</p><p>Click Save permissions</p></div></div><div class="sect4" title="14.4.5.4.&nbsp; Add Drupal roles apiary admin and administrator to Drupal User apiary"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1449"></a>14.4.5.4.&nbsp; Add Drupal roles apiary admin and administrator to Drupal User
                            apiary </h5></div></div></div><div class="sect5" title="14.4.5.4.1.&nbsp;Browse to http://hostname/drupal/admin/user/user"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1452"></a>14.4.5.4.1.&nbsp;Browse to http://hostname/drupal/admin/user/user</h6></div></div></div><p>Under Operations, click edit for apiary</p><p>Scroll to Roles section</p><p>Select apiary admin</p><p>Select administrator</p><p>Click Save</p></div></div><div class="sect4" title="14.4.5.5.&nbsp;Install"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1465"></a>14.4.5.5.&nbsp;Install</h5></div></div></div><div class="sect5" title="14.4.5.5.1.&nbsp;Create Writeable Directories"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1468"></a>14.4.5.5.1.&nbsp;Create Writeable Directories</h6></div></div></div><div class="cmdsynopsis"><p><code class="command">chmod 777
                                    /var/www/drupal/modules/apiary_project/workflow/templates_c</code> </p></div><div class="cmdsynopsis"><p><code class="command">mkdir
                                    /var/www/drupal/sites/default/files/apiary_datastreams</code> </p></div><div class="cmdsynopsis"><p><code class="command">chmod 777
                                    /var/www/drupal/sites/default/files/apiary_datastreams</code> </p></div></div><div class="sect5" title="14.4.5.5.2.&nbsp;Edit Apiary Project Fedora Database Connector"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1480"></a>14.4.5.5.2.&nbsp;Edit Apiary Project Fedora Database Connector</h6></div></div></div><div class="cmdsynopsis"><p><code class="command">vi
                                    /var/www/drupal/modules/apiary_project/fedora_commons/config_fedora.inc</code> </p></div><p> Set database host, username and password as specified in <a class="link" href="#createfedoradb">Create Fedora User and
                                Database</a></p><p>Note: This allows for direct reading of the fedora database
                                instead of querying fedora itself through CURL.</p><p>Queries like get all pids with a name like ap-specimen is much
                                easy to do from the database, which is done in one line, vs through
                                SPRQL or Resource Index Fedora request.</p><p>At one point, we discussed the merits of storing all data for the
                                workflow here but instead went the way of modifying the drupal
                                db.</p><a name="editextfiles"></a></div><div class="sect5" title="14.4.5.5.3.&nbsp;Edit Externally Used Workflow files"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1497"></a>14.4.5.5.3.&nbsp;Edit Externally Used Workflow files</h6></div></div></div><div class="cmdsynopsis"><p><code class="command">vi
                                    /var/www/drupal/modules/apiary_project/workflow/index.php</code> </p></div><p>    Set $drupal_url = "http://hostname/drupal";</p><p>    Set $djatoka_url = "http://hostname:8080/";</p><div class="cmdsynopsis"><p><code class="command">vi
                                    /var/www/drupal/modules/apiary_project/workflow/comparer.php</code> </p></div><p>    Set $drupal_url = "http://hostname/drupal";</p><div class="cmdsynopsis"><p><code class="command">vi
                                    /var/www/drupal/modules/apiary_project/workflow/search.php</code> </p></div><p>    Set $drupal_url = "http://hostname/drupal";</p><div class="cmdsynopsis"><p><code class="command">vi
                                    /var/www/drupal/modules/apiary_project/workflow/workflow.php</code> </p></div><p>    Set $drupal_url = "http://hostname/drupal";</p></div><div class="sect5" title="14.4.5.5.4.&nbsp;Browse to http://hostname/drupal/admin/build/modules"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1522"></a>14.4.5.5.4.&nbsp;Browse to http://hostname/drupal/admin/build/modules</h6></div></div></div><p>Scroll to Apiary Project section</p><p>Check Enabled for Apiary Research Project</p><p>Click Save configuration</p></div></div><div class="sect4" title="14.4.5.6.&nbsp;Configure Apiary Project settings"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1531"></a>14.4.5.6.&nbsp;Configure Apiary Project settings</h5></div></div></div><div class="sect5" title="14.4.5.6.1.&nbsp;Browse to http://hostname/drupal/admin/settings/apiary_project"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1534"></a>14.4.5.6.1.&nbsp;Browse to
                                http://hostname/drupal/admin/settings/apiary_project</h6></div></div></div><p>Enter variable information</p><p>Click Save configuration</p><div class="caution" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="file:/C:/Program%20Files%20(x86)/Oxygen%20XML%20Editor%2012/frameworks/docbook/xsl/images/caution.png"></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p>
                                        <span class="bold"><strong> Do this even if no changes are made.
                                        </strong></span>
                                    </p></td></tr></table></div></div></div><div class="sect4" title="14.4.5.7.&nbsp;Configure Apiary Project System Startup Script"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1547"></a>14.4.5.7.&nbsp;Configure Apiary Project System Startup Script</h5></div></div></div><div class="cmdsynopsis"><p><code class="command"> cp apiary_project/apiary_project.sh /etc/init.d/apiary_project
                            </code> </p></div><div class="cmdsynopsis"><p><code class="command">update-rc.d apiary_project defaults</code> </p></div><div class="cmdsynopsis"><p><code class="command">chmod a+rx /etc/init.d/apiary_project</code> </p></div><div class="cmdsynopsis"><p><code class="command">chmod 777
                                /var/www/drupal/modules/apiary_project/workflow/templates_c</code> </p></div><a name="themekey"></a></div></div><div class="sect3" title="14.4.6.&nbsp;Install ThemeKey"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1563"></a>14.4.6.&nbsp;Install <a class="link" href="http://drupal.org/project/themekey " target="_top">ThemeKey</a></h4></div></div></div><div class="sect4" title="14.4.6.1.&nbsp;Download"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1568"></a>14.4.6.1.&nbsp;Download</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /home/apiary/</code> </p></div><div class="cmdsynopsis"><p><code class="command">wget
                                http://ftp.drupal.org/files/projects/themekey-6.x-3.3.tar.gz</code> </p></div></div><div class="sect4" title="14.4.6.2.&nbsp;Extract"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1577"></a>14.4.6.2.&nbsp;Extract</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">tar -zxvf themekey-6.x-3.3.tar.gz</code> </p></div></div><div class="sect4" title="14.4.6.3.&nbsp;Move"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1583"></a>14.4.6.3.&nbsp;Move</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">mv themekey-6.x-3.3 /var/www/drupal/modules</code> </p></div></div><div class="sect4" title="14.4.6.4.&nbsp;Install"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1589"></a>14.4.6.4.&nbsp;Install</h5></div></div></div><div class="sect5" title="14.4.6.4.1.&nbsp;Browse to http://hostname/drupal/admin/build/modules"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1592"></a>14.4.6.4.1.&nbsp;Browse to http://hostname/drupal/admin/build/modules</h6></div></div></div><p>Scroll to ThemeKey section</p><p>Check Enabled for ThemeKey</p><p>Click Save configuration</p></div><div class="sect5" title="14.4.6.4.2.&nbsp;Browse to http://hostname/drupal/admin/settings/themekey"><div class="titlepage"><div><div><h6 class="title"><a name="d0e1601"></a>14.4.6.4.2.&nbsp;Browse to http://hostname/drupal/admin/settings/themekey</h6></div></div></div><p>Create New themekey Rule</p><p>drupal:path = apiary use CTI Flex theme No Title</p><p>check Enabled</p><p>Click Save configuration</p></div></div></div></div></div><div class="sect1" title="15.&nbsp;Install Apache-Solr"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1612"></a>15.&nbsp;Install <a class="link" href="http://www.apache.org/dyn/closer.cgi/lucene/solr/" target="_top">Apache-Solr</a></h2></div></div></div><div class="sect2" title="15.1.&nbsp;Download"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1617"></a>15.1.&nbsp;Download</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">cd /home/apiary</code> </p></div><div class="cmdsynopsis"><p><code class="command">wget
                        http://apache.tradebit.com/pub/lucene/solr/1.4.1/apache-solr-1.4.1.tgz</code> </p></div></div><div class="sect2" title="15.2.&nbsp;Extract apache-solr-1.4.1"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1626"></a>15.2.&nbsp;Extract apache-solr-1.4.1</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">tar -zxvf apache-solr-1.4.1.tar.gz</code> </p></div></div><div class="sect2" title="15.3.&nbsp;Move apache-solr-1.4.1"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1632"></a>15.3.&nbsp;Move apache-solr-1.4.1</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">mv apache-solr-1.4.1 $FEDORA_HOME/tomcat/webapps</code> </p></div></div><div class="sect2" title="15.4.&nbsp;Copy Apiary Solr Schema"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1638"></a>15.4.&nbsp;Copy Apiary Solr Schema</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">cp apiary_project/solr/conf/schema.xml
                        $FEDORA_HOME/tomcat/webapps/apache-solr-1.4.1/example/solr/conf/schema.xml</code> </p></div></div><div class="sect2" title="15.5.&nbsp;Configure Solr System Startup Script"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1644"></a>15.5.&nbsp;Configure Solr System Startup Script</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">cp apiary_project/solr/solr.sh /etc/init.d/solr</code> </p></div><div class="cmdsynopsis"><p><code class="command">update-rc.d solr defaults</code> </p></div><div class="cmdsynopsis"><p><code class="command">chmod a+rx /etc/init.d/solr</code> </p></div></div></div><div class="sect1" title="16.&nbsp;Ingest Required Fedora Digital Objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1656"></a>16.&nbsp;Ingest Required Fedora Digital Objects</h2></div></div></div><div class="sect2" title="16.1.&nbsp;Ingest SpecimenBinders"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1659"></a>16.1.&nbsp;Ingest SpecimenBinders</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">$FEDORA_HOME/client/bin/fedora-admin.sh</code> </p></div><p>Login</p><p>Username: fedoraAdmin</p><p>Password: apiary</p><p>Click File-&gt;Ingest-&gt;One Object-&gt;From File&#8230;</p><p>Navigate to
                    /var/www/drupal/modules/apiary_project/digital_objects/required/apiary_SpecimenBinders.xml</p><p>Click Open</p><p>Select FOXML version 1.1</p><p>Click OK</p></div><div class="sect2" title="16.2.&nbsp;dynamicOCR service definition"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1681"></a>16.2.&nbsp;dynamicOCR service definition</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">cp
                        /var/www/drupal/modules/apiary_project/digital_objects/sDefs/ocropus/dynamicOCR.php
                        /var/www/drupal/sites/default/files/</code> </p></div><div class="cmdsynopsis"><p><code class="command">$FEDORA_HOME/client/bin/fedora-admin.sh</code> </p></div><p>Login</p><p>Username: fedoraAdmin</p><p>Click File-&gt;Ingest-&gt;One Object-&gt;From File&#8230;</p><p>Navigate to each of the following separately:</p><p>&#8226;
                    /var/www/drupal/modules/apiary_project/digital_objects/sDefs/ocropus/ap-sdef_ocropus.xml</p><p>&#8226;
                    /var/www/drupal/modules/apiary_project/digital_objects/sDefs/ocropus/ap-sdefcm_ocropus.xml</p><p>&#8226;
                    /var/www/drupal/modules/apiary_project/digital_objects/sDefs/ocropus/ap-sdep_ocropus.xml</p><p>Click Open</p><p>Select FOXML version 1.1</p><p>Click OK</p><p>Click File-&gt;Exit</p></div></div><div class="sect1" title="17.&nbsp;Create Apiary Project Drupal items"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1712"></a>17.&nbsp;Create Apiary Project Drupal items</h2></div></div></div><div class="sect2" title="17.1.&nbsp;Create Apiary Pages"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1715"></a>17.1.&nbsp;Create Apiary Pages</h3></div></div></div><div class="sect3" title="17.1.1.&nbsp;homepage"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1718"></a>17.1.1.&nbsp;homepage</h4></div></div></div><div class="sect4" title="17.1.1.1.&nbsp;Browse to http://hostname/drupal/node/add/page"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1721"></a>17.1.1.1.&nbsp;Browse to http://hostname/drupal/node/add/page</h5></div></div></div><p>Title: Home Page</p><p>Menu settings</p><p>    Menu link title: </p><p>    Parent item: Primary links</p><p>    Weight: 0</p><p>Body: </p><p>&lt;h1&gt;Welcome to the Apiary Project Proof of Concept&lt;/h1&gt; &lt;?php
                            if (user_is_logged_in()): ?&gt; &lt;p&gt;To begin the demo, select Workspace
                            in the navigation menu above.&lt;/p&gt; &lt;?php else:?&gt; &lt;p&gt;To begin the
                            demo, &lt;a href="user"&gt;login&lt;/a&gt; with username "demo" and password
                            "demo" then select Workspace in the navigation menu above.&lt;/p&gt;
                            &lt;?php endif;?&gt;</p><p>Input Format: PHP code</p><p>URL path settings: homepage</p></div></div></div><div class="sect2" title="17.2.&nbsp;Set Homepage"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1742"></a>17.2.&nbsp;Set Homepage</h3></div></div></div><div class="sect3" title="17.2.1.&nbsp;Browse to http://hostname/drupal/admin/settings/site-information"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1745"></a>17.2.1.&nbsp;Browse to http://hostname/drupal/admin/settings/site-information</h4></div></div></div><p>Default front page: homepage</p><p>Click Save configuration</p></div></div><div class="sect2" title="17.3.&nbsp;Set Menus"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1752"></a>17.3.&nbsp;Set Menus</h3></div></div></div><div class="sect3" title="17.3.1.&nbsp; Remove menus"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1755"></a>17.3.1.&nbsp; Remove menus</h4></div></div></div><div class="sect4" title="17.3.1.1.&nbsp;Browse to http://hostname/drupal/admin/build/block"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1758"></a>17.3.1.1.&nbsp;Browse to http://hostname/drupal/admin/build/block</h5></div></div></div><p>Set all regions to &lt;none&gt;</p><p>Click Save blocks</p></div></div></div><div class="sect2" title="17.4.&nbsp;Configure Drupal Theme for Apiary site"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1765"></a>17.4.&nbsp;Configure Drupal Theme for Apiary site</h3></div></div></div><div class="sect3" title="17.4.1.&nbsp; Copy cti_flex_logo.png to files directory"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1768"></a>17.4.1.&nbsp; Copy cti_flex_logo.png to files directory</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">cp /var/www/drupal/modules/apiary_project/images/cti_flex_logo.png
                            /var/www/drupal/sites/default/files</code> </p></div></div><div class="sect3" title="17.4.2.&nbsp; Configure Zen"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1774"></a>17.4.2.&nbsp; Configure Zen</h4></div></div></div><div class="sect4" title="17.4.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/themes"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1777"></a>17.4.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/themes</h5></div></div></div><p>Click configure next to Zen</p><p>Scroll to Logo image settings</p><p>    Uncheck Use the default logo</p><p>Click Save configuration</p></div></div><div class="sect3" title="17.4.3.&nbsp; Configure CTI Flex Theme"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1788"></a>17.4.3.&nbsp; Configure CTI Flex Theme</h4></div></div></div><div class="sect4" title="17.4.3.1.&nbsp;Browse to http://hostname/drupal/admin/build/themes"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1791"></a>17.4.3.1.&nbsp;Browse to http://hostname/drupal/admin/build/themes</h5></div></div></div><p>Click configure next to CTI Flex theme</p><p>Scroll toToggle display</p><p>    Uncheck Site name</p><p>Scroll to Logo image settings</p><p>    Uncheck Use the default logo</p><p>    Path to custom logo: sites/default/files/cti_flex_logo.png</p><p>Scroll to Theme-specific settings -&gt;Custom color settings</p><p>    Select color for body background: #FFE8B7</p><p>    Select color for header and footer backgrounds: #8EB7FE</p><p>    Select color for main navigation bar and block header backgrounds:
                            #3F4F6B</p><p>    Select color for block content background: #D4DAE6</p><p>Click Save configuration</p></div></div></div><div class="sect2" title="17.5.&nbsp;Configure Drupal Primary links"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1818"></a>17.5.&nbsp;Configure Drupal Primary links</h3></div></div></div><div class="sect3" title="17.5.1.&nbsp; Browse to http://hostname/drupal/admin/build/menu-customize/primary-links"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1821"></a>17.5.1.&nbsp; Browse to
                        http://hostname/drupal/admin/build/menu-customize/primary-links</h4></div></div></div><div class="sect4" title="17.5.1.1.&nbsp;Home"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1824"></a>17.5.1.1.&nbsp;Home</h5></div></div></div><p>Click Add item tab</p><p>Path: http://hostname/drupal</p><p>Menu link title: Home</p><p>Description: home page</p><p>Parent item: &lt;Primary links&gt;</p><p>Weight: 0</p><p>Click Save</p></div><div class="sect4" title="17.5.1.2.&nbsp;Worksplace"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1841"></a>17.5.1.2.&nbsp;Worksplace</h5></div></div></div><p><span class="bold"><strong>Note: This link is now added when the module is
                                installed</strong></span></p><p>Weight: 0</p><p>Click Save</p></div><div class="sect4" title="17.5.1.3.&nbsp;Login"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1851"></a>17.5.1.3.&nbsp;Login</h5></div></div></div><p>Click Add item tab</p><p>Path: user/login</p><p>Menu link title: Login</p><p>Description:</p><p>Parent item: &lt;Primary links&gt;</p><p>Weight: 2</p><p>Click Save</p></div><div class="sect4" title="17.5.1.4.&nbsp;Logout"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1868"></a>17.5.1.4.&nbsp;Logout</h5></div></div></div><p>Click Add item tab</p><p>Path: logout</p><p>Menu link title: Logout</p><p>Description:</p><p>Parent item: &lt;Primary links&gt;</p><p>Weight: 2</p><p>Click Save</p></div><div class="sect4" title="17.5.1.5.&nbsp;About us"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1885"></a>17.5.1.5.&nbsp;About us</h5></div></div></div><p>Click Add item tab</p><p>Path: http://hostname/drupal/apiary?ref=about</p><p>Menu link title: About us</p><p>Description:</p><p>Parent item: &lt;Primary links&gt;</p><p>Weight: 3</p><p>Click Save</p></div></div></div><div class="sect2" title="17.6.&nbsp;Configure Drupal Navigation menu"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1902"></a>17.6.&nbsp;Configure Drupal Navigation menu</h3></div></div></div><div class="sect3" title="17.6.1.&nbsp; Add/remove Navigation menu links"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1905"></a>17.6.1.&nbsp; Add/remove Navigation menu links</h4></div></div></div><div class="sect4" title="17.6.1.1.&nbsp;Browse to http://hostname/drupal/admin/build/menu-customize/navigation"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1908"></a>17.6.1.1.&nbsp;Browse to
                            http://hostname/drupal/admin/build/menu-customize/navigation</h5></div></div></div><p>Uncheck the following items marked Enabled</p><p>    Digital Repository</p><p>    Create content-&gt;Fedora Repository </p><p>    Create content-&gt;Story</p><p>Click Save configuration</p></div></div><div class="sect3" title="17.6.2.&nbsp; Remove Navigation menu from the left panel for the workflow"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1921"></a>17.6.2.&nbsp;  Remove Navigation menu from the left panel for the workflow </h4></div></div></div><div class="sect4" title="17.6.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/block"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1924"></a>17.6.2.1.&nbsp;Browse to http://hostname/drupal/admin/build/block</h5></div></div></div><p>Click configure for Navigation</p><p>    Scroll to Page specific visibility settings</p><p>        Select Show only on the listed pages</p><p>        Type &#8216;homepage&#8217; in the Pages: section</p><p>    Click Save block</p></div></div></div></div><div class="sect1" title="18.&nbsp;Start Apiary"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1937"></a>18.&nbsp;Start Apiary</h2></div></div></div><div class="cmdsynopsis"><p><code class="command">/etc/init.d/solr start</code> </p></div><div class="cmdsynopsis"><p><code class="command">/etc/init.d/apiary_project start</code> </p></div></div><div class="sect1" title="19.&nbsp;Ingest Apiary Demo Objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1946"></a>19.&nbsp;Ingest Apiary Demo Objects</h2></div></div></div><div class="sect2" title="19.1.&nbsp;Browse to http://hostname/drupal/apiary/admin"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1949"></a>19.1.&nbsp;Browse to http://hostname/drupal/apiary/admin</h3></div></div></div><p><a name="ingestobjects"></a>Click Batch Create Specimens</p><p>    Max Specimens:</p><p>    File name source file:
                    http://hostname/images/jpeg2000/demo_filenames.txt</p><p>    Referent ID: apiary:jpeg2000</p><p>    JPEG2000 Url Base: http://hostname/images/jpeg2000</p><p>    Source Url Base: http://hostname/images/original</p><p>Click Submit</p></div></div></div><div class="chapter" title="Chapter&nbsp;3.&nbsp;Using the Apiary Project Module"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1966"></a>Chapter&nbsp;3.&nbsp;Using the Apiary Project Module</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d0e1971">1. (Re)Starting The Apiary Project</a></span></dt><dt><span class="sect1"><a href="#d0e1984">2. Administrating the Apiary Project</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e1987">2.1. Browse to http://hostname/drupal/apiary/admin</a></span></dt></dl></dd></dl></div><p>Preface: Chapter 2 entails a lot, so if you have objects ingested then great! It's
            time to harness the power of the Apiary Project.</p><div class="sect1" title="1.&nbsp;(Re)Starting The Apiary Project"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1971"></a>1.&nbsp;(Re)Starting The Apiary Project</h2></div></div></div><p>Anytime a reboot is felt necessary, use the following two commands to restart the
                project.</p><p>Note: start, stop and restart can all be passed in, but restart will not die if
                either are not started so it is an all-safe command to use regardless.</p><div class="cmdsynopsis"><p><code class="command">/etc/init.d/solr restart</code> </p></div><div class="cmdsynopsis"><p><code class="command">/etc/init.d/apiary_project restart</code> </p></div></div><div class="sect1" title="2.&nbsp;Administrating the Apiary Project"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1984"></a>2.&nbsp;Administrating the Apiary Project</h2></div></div></div><div class="sect2" title="2.1.&nbsp;Browse to http://hostname/drupal/apiary/admin"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1987"></a>2.1.&nbsp;Browse to http://hostname/drupal/apiary/admin</h3></div></div></div><div class="sect3" title="2.1.1.&nbsp;Create, Edit and Delete Workflows"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1990"></a>2.1.1.&nbsp;Create, Edit and Delete Workflows</h4></div></div></div><div class="sect4" title="2.1.1.1.&nbsp;Workflow Name"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1993"></a>2.1.1.1.&nbsp;Workflow Name</h5></div></div></div><p>Title Name of the workflow</p></div><div class="sect4" title="2.1.1.2.&nbsp;Workflow Description"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1998"></a>2.1.1.2.&nbsp;Workflow Description</h5></div></div></div><p>Information about the workflow</p></div><div class="sect4" title="2.1.1.3.&nbsp;Workflow Permissions"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2003"></a>2.1.1.3.&nbsp;Workflow Permissions</h5></div></div></div><p>Permissions to features users of the workflow will be allowed to
                            access.</p><div class="sect5" title="2.1.1.3.1.&nbsp;canAnalyzeSpecimen"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2008"></a>2.1.1.3.1.&nbsp;canAnalyzeSpecimen</h6></div></div></div><p>Can users assigned to the workflow use Image Analysis features,
                                like creating ROIs.</p></div><div class="sect5" title="2.1.1.3.2.&nbsp; canTranscribe"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2013"></a>2.1.1.3.2.&nbsp; canTranscribe</h6></div></div></div><p>Can users assigned to the workflow use Transcribe features.</p></div><div class="sect5" title="2.1.1.3.3.&nbsp; canParseL1"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2018"></a>2.1.1.3.3.&nbsp; canParseL1</h6></div></div></div><p>Can users assigned to the workflow use Parse Level 1
                                features.</p></div><div class="sect5" title="2.1.1.3.4.&nbsp; canParseL2"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2023"></a>2.1.1.3.4.&nbsp; canParseL2</h6></div></div></div><p>Can users assigned to the workflow use Parse Level 2
                                features.</p></div><div class="sect5" title="2.1.1.3.5.&nbsp; canParseL3"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2028"></a>2.1.1.3.5.&nbsp; canParseL3</h6></div></div></div><p>Can users assigned to the workflow use Parse Level 3
                                features.</p></div><div class="sect5" title="2.1.1.3.6.&nbsp; canQC"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2033"></a>2.1.1.3.6.&nbsp; canQC</h6></div></div></div><p>Can users assigned to the workflow use Quality Control
                                features.</p></div></div><div class="sect4" title="2.1.1.4.&nbsp;Workflow Users"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2038"></a>2.1.1.4.&nbsp;Workflow Users</h5></div></div></div><p>Assign Users to this workflow</p><div class="sect5" title="2.1.1.4.1.&nbsp;Select Drupal Apiary Project User"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2043"></a>2.1.1.4.1.&nbsp;Select Drupal Apiary Project User</h6></div></div></div><p>Select one or many or all druapal users who can view the Apiary
                                Project and assign them to the workflow</p></div><div class="sect5" title="2.1.1.4.2.&nbsp;Create New Drupal Apiary Project User"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2048"></a>2.1.1.4.2.&nbsp;Create New Drupal Apiary Project User</h6></div></div></div><p>This feature creates a new drupal user with all the roles and
                                permissions needed to view an Apiary Project workflow and
                                automatically adds that user to the workflow list.</p></div></div><div class="sect4" title="2.1.1.5.&nbsp;Workflow Strategy"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2053"></a>2.1.1.5.&nbsp;Workflow Strategy</h5></div></div></div><div class="sect5" title="2.1.1.5.1.&nbsp;Select Object Pool"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2056"></a>2.1.1.5.1.&nbsp;Select Object Pool</h6></div></div></div><p>Select an Object Pool from list of previous created Specimen
                                Pools.</p></div><div class="sect5" title="2.1.1.5.2.&nbsp;Create New Object Pool"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2061"></a>2.1.1.5.2.&nbsp;Create New Object Pool</h6></div></div></div><p>This feature creates a new object pool based on a Resource Index
                                or Solr Query.</p></div><div class="sect5" title="2.1.1.5.3.&nbsp;Object Pool Resource Index Query Example"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2066"></a>2.1.1.5.3.&nbsp;Object Pool Resource Index Query Example</h6></div></div></div><p>select $sp_pid from &lt;#ri&gt; where
                                $sp_pid&lt;fedora-rels-ext:isMemberOf&gt;
                                &lt;info:fedora/apiary:SpecimenBinders&gt;</p></div><div class="sect5" title="2.1.1.5.4.&nbsp;Object Pool Solr Query Example"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2071"></a>2.1.1.5.4.&nbsp;Object Pool Solr Query Example</h6></div></div></div><p>imageMetadata_sourceURL:("http://research.apiaryproject.org/images/original/vol062.tif")+imageMetadata_sourceURL:("http://research.apiaryproject.org/images/original/vol065.tif")&amp;fl=parent_id</p></div></div></div><div class="sect3" title="2.1.2.&nbsp;Create and Edit GroundTruth"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2076"></a>2.1.2.&nbsp;Create and Edit GroundTruth</h4></div></div></div><p>Groundtruth is the expected result of a Specimen after being accurately
                        analyzed, transcibed and parsed. This values do not necessarily associate to
                        any real fedora objects.</p><div class="sect4" title="2.1.2.1.&nbsp;Display Specimen Data"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2081"></a>2.1.2.1.&nbsp;Display Specimen Data</h5></div></div></div><p>Displays the existing Groundtruth datastream for a requested Specimen
                            pid. Can be manually entered or passed as a
                            specimen_pid=ap-specimen:Specimen-X variable</p></div><div class="sect4" title="2.1.2.2.&nbsp;Save Specimen Data"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2086"></a>2.1.2.2.&nbsp;Save Specimen Data</h5></div></div></div><p>Create or overwrites the Groundtruth datastream for the requested
                            Specimen pid.</p></div></div><div class="sect3" title="2.1.3.&nbsp;Create one or more Specimen from the Apiary Project Research Server"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2091"></a>2.1.3.&nbsp;Create one or more Specimen from the Apiary Project Research
                        Server</h4></div></div></div><p>A demonstration of the simplicity of sharing images from the djatoka image
                        server. Any installation can ingest these images.</p><div class="sect4" title="2.1.3.1.&nbsp;Select Specimen Images"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2096"></a>2.1.3.1.&nbsp;Select Specimen Images</h5></div></div></div><p>Select any number of images to ingest.</p><p>Assign Specimen Metadata to it to be saved during ingestion</p><p>Click Add Specimens</p><p>Upon successful ingestion, the Image and Specimen Pids are
                            displayed</p></div></div><div class="sect3" title="2.1.4.&nbsp;Batch Create Specimen Using a Source File"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2107"></a>2.1.4.&nbsp;Batch Create Specimen Using a Source File</h4></div></div></div><p>Ingest a number of specimen using the same rft-id base, jp2 url base and
                        source url base. See <a class="link" href="#ingestobjects">Ingest Apiary Demo
                            Objects</a></p><div class="sect4" title="2.1.4.1.&nbsp;Select Specimen Images"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2114"></a>2.1.4.1.&nbsp;Select Specimen Images</h5></div></div></div><p>Select any number of images to ingest.</p><p>Assign Specimen Metadata to it to be saved during ingestion</p><p>Click Add Specimens</p><p>Upon successful ingestion, the Image and Specimen Pids are
                            displayed</p></div></div><div class="sect3" title="2.1.5.&nbsp;Text Comparison"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2125"></a>2.1.5.&nbsp;Text Comparison</h4></div></div></div><p>Compare two text strings and see the resulting levenshtein and simple text
                        distances displayed using Daisydiff.</p></div><div class="sect3" title="2.1.6.&nbsp;Search Metadata and Object Statuses"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2130"></a>2.1.6.&nbsp;Search Metadata and Object Statuses</h4></div></div></div><div class="sect4" title="2.1.6.1.&nbsp;ROI specimenMetadata Search"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2133"></a>2.1.6.1.&nbsp;ROI specimenMetadata Search</h5></div></div></div><p>Search using specimenMetadata keywords in throughout all or one
                            specific metadata field.</p></div><div class="sect4" title="2.1.6.2.&nbsp;Image or ROI Status Search"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2138"></a>2.1.6.2.&nbsp;Image or ROI Status Search</h5></div></div></div><p>Search for all objects with workflow status and/or specimenMetadata
                            keyword.</p><p>Note: A search containing only Image status will return only
                            Image/Specimen pairs.</p></div></div><div class="sect3" title="2.1.7.&nbsp;Re-Index all Fedora Objects into Solr"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2145"></a>2.1.7.&nbsp;Re-Index all Fedora Objects into Solr</h4></div></div></div><p>If changes have been made to Fedora Objects outside the Apiary Project,
                        i.e. directly in Fedora, this useful tool will re-index all Apiary Project
                        objects.</p></div><div class="sect3" title="2.1.8.&nbsp;Example Links to Fedora Objects"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2150"></a>2.1.8.&nbsp;Example Links to Fedora Objects</h4></div></div></div><p>Example links to:</p><p>     Main Digital Object overview </p><p>     View an object's datastream </p><p>     View a list of datastreams for an object </p><p>     View a list of service methods (i.e. dynamicOCR) for an object</p></div></div></div></div><div class="chapter" title="Chapter&nbsp;4.&nbsp;Using the Apiary Project Workflow"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2163"></a>Chapter&nbsp;4.&nbsp;Using the Apiary Project Workflow</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d0e2168">1. Click Workspace or browse to http://hostname/drupal/apiary</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2171">1.1. Select Workflow to begin work</a></span></dt><dt><span class="sect2"><a href="#d0e2174">1.2. Load Workflow Queue</a></span></dt><dt><span class="sect2"><a href="#d0e2194">1.3. Select Specimen from Workflow Queue</a></span></dt><dt><span class="sect2"><a href="#d0e2208">1.4. View Specimen with Open
                    Layers</a></span></dt><dt><span class="sect2"><a href="#d0e2244">1.5. Create Regions of Interest (ROIs)</a></span></dt><dt><span class="sect2"><a href="#d0e2268">1.6. Transcribe ROI</a></span></dt><dt><span class="sect2"><a href="#d0e2343">1.7. Parse ROI</a></span></dt><dt><span class="sect2"><a href="#d0e2415">1.8. Delete ROI</a></span></dt><dt><span class="sect2"><a href="#d0e2421">1.9. Remove ROI from Queue</a></span></dt><dt><span class="sect2"><a href="#d0e2430">1.10. Remove Specimen from Queue</a></span></dt></dl></dd></dl></div><p>Preface: Now that we have covered how to create workflows, it's time to use
            them.</p><div class="sect1" title="1.&nbsp;Click Workspace or browse to http://hostname/drupal/apiary"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2168"></a>1.&nbsp;Click Workspace or browse to http://hostname/drupal/apiary</h2></div></div></div><div class="sect2" title="1.1.&nbsp;Select Workflow to begin work"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2171"></a>1.1.&nbsp;Select Workflow to begin work</h3></div></div></div></div><div class="sect2" title="1.2.&nbsp;Load Workflow Queue"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2174"></a>1.2.&nbsp;Load Workflow Queue</h3></div></div></div><div class="sect3" title="1.2.1.&nbsp;Click + in Southern Pane"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2177"></a>1.2.1.&nbsp;Click + in Southern Pane</h4></div></div></div><p>Loads the next available Specimen in to the Workflow Queue</p></div><div class="sect3" title="1.2.2.&nbsp;Glide Mouse to left to reveal Workflow Queue"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2182"></a>1.2.2.&nbsp;Glide Mouse to left to reveal Workflow Queue</h4></div></div></div><div class="sect4" title="1.2.2.1.&nbsp;Click Add Items to Bring Up the Image Bowser"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2185"></a>1.2.2.1.&nbsp;Click Add Items to Bring Up the Image Bowser</h5></div></div></div><div class="sect5" title="1.2.2.1.1.&nbsp;Select Specimen to load into the Workflow Queue"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2188"></a>1.2.2.1.1.&nbsp;Select Specimen to load into the Workflow Queue</h6></div></div></div></div><div class="sect5" title="1.2.2.1.2.&nbsp;Click Add to queue"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2191"></a>1.2.2.1.2.&nbsp;Click Add to queue</h6></div></div></div></div></div></div></div><div class="sect2" title="1.3.&nbsp;Select Specimen from Workflow Queue"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2194"></a>1.3.&nbsp;Select Specimen from Workflow Queue</h3></div></div></div><div class="sect3" title="1.3.1.&nbsp;Click Navigation Arrow in Southern Pane"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2197"></a>1.3.1.&nbsp;Click Navigation Arrow in Southern Pane</h4></div></div></div><p>Loads Specimen immediately to the right or left of the current Specimen in
                        the Workflow Queue</p></div><div class="sect3" title="1.3.2.&nbsp;Glide Mouse to left to reveal Workflow Queue"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2202"></a>1.3.2.&nbsp;Glide Mouse to left to reveal Workflow Queue</h4></div></div></div><div class="sect4" title="1.3.2.1.&nbsp;Click Specimen from List"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2205"></a>1.3.2.1.&nbsp;Click Specimen from List</h5></div></div></div></div></div></div><div class="sect2" title="1.4.&nbsp;View Specimen with Open Layers"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2208"></a>1.4.&nbsp;View Specimen with <a class="link" href="http://code.google.com/p/jquery-openlayers/" target="_top">Open
                    Layers</a></h3></div></div></div><div class="sect3" title="1.4.1.&nbsp;Zoom"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2213"></a>1.4.1.&nbsp;Zoom</h4></div></div></div><div class="sect4" title="1.4.1.1.&nbsp;Use scroll wheel"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2216"></a>1.4.1.1.&nbsp;Use scroll wheel</h5></div></div></div></div><div class="sect4" title="1.4.1.2.&nbsp;Use zoom + or - from the Open Layers control panel"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2219"></a>1.4.1.2.&nbsp;Use zoom + or - from the Open Layers control panel</h5></div></div></div></div><p>Loads Specimen immediately to the right or left of the current Specimen in
                        the Workflow Queue</p></div><div class="sect3" title="1.4.2.&nbsp;Pan"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2224"></a>1.4.2.&nbsp;Pan</h4></div></div></div><div class="sect4" title="1.4.2.1.&nbsp;Select Hand from Open Layers control panel"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2227"></a>1.4.2.1.&nbsp;Select Hand from Open Layers control panel</h5></div></div></div><div class="sect5" title="1.4.2.1.1.&nbsp;Click and drag on the image"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2230"></a>1.4.2.1.1.&nbsp;Click and drag on the image</h6></div></div></div></div></div><div class="sect4" title="1.4.2.2.&nbsp;Use navigation arrows from the Open Layers control panel"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2233"></a>1.4.2.2.&nbsp;Use navigation arrows from the Open Layers control panel</h5></div></div></div></div><p>Loads Specimen immediately to the right or left of the current Specimen in
                        the Workflow Queue</p></div><div class="sect3" title="1.4.3.&nbsp;Glide Mouse to left to reveal Workflow Queue"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2238"></a>1.4.3.&nbsp;Glide Mouse to left to reveal Workflow Queue</h4></div></div></div><div class="sect4" title="1.4.3.1.&nbsp;Click Specimen from List"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2241"></a>1.4.3.1.&nbsp;Click Specimen from List</h5></div></div></div></div></div></div><div class="sect2" title="1.5.&nbsp;Create Regions of Interest (ROIs)"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2244"></a>1.5.&nbsp;Create Regions of Interest (ROIs)</h3></div></div></div><div class="sect3" title="1.5.1.&nbsp;Click Pencil Tool from Open Layers Panel"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2247"></a>1.5.1.&nbsp;Click Pencil Tool from Open Layers Panel</h4></div></div></div></div><div class="sect3" title="1.5.2.&nbsp;Click and drag on the Image to highlight a region"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2250"></a>1.5.2.&nbsp;Click and drag on the Image to highlight a region</h4></div></div></div><div class="sect4" title="1.5.2.1.&nbsp;Assign Region an ROI Type"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2253"></a>1.5.2.1.&nbsp;Assign Region an ROI Type</h5></div></div></div><div class="sect5" title="1.5.2.1.1.&nbsp;Primary Label"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2256"></a>1.5.2.1.1.&nbsp;Primary Label</h6></div></div></div></div><div class="sect5" title="1.5.2.1.2.&nbsp;Annotation/Other"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2259"></a>1.5.2.1.2.&nbsp;Annotation/Other</h6></div></div></div></div><div class="sect5" title="1.5.2.1.3.&nbsp;Barcode"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2262"></a>1.5.2.1.3.&nbsp;Barcode</h6></div></div></div></div><div class="sect5" title="1.5.2.1.4.&nbsp;Undefined"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2265"></a>1.5.2.1.4.&nbsp;Undefined</h6></div></div></div></div></div></div></div><div class="sect2" title="1.6.&nbsp;Transcribe ROI"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2268"></a>1.6.&nbsp;Transcribe ROI</h3></div></div></div><div class="sect3" title="1.6.1.&nbsp;Select an ROI to Transcibe"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2271"></a>1.6.1.&nbsp;Select an ROI to Transcibe</h4></div></div></div><div class="sect4" title="1.6.1.1.&nbsp;Click Transcibe from the right-hand side Specimen ROI List"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2274"></a>1.6.1.1.&nbsp;Click Transcibe from the right-hand side Specimen ROI List</h5></div></div></div><p>Loads ROI immediately and switches to the Transcribe Text Tab</p></div><div class="sect4" title="1.6.1.2.&nbsp;Glide Mouse to left to reveal Workflow Queue"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2279"></a>1.6.1.2.&nbsp;Glide Mouse to left to reveal Workflow Queue</h5></div></div></div><div class="sect5" title="1.6.1.2.1.&nbsp;Click Arrow in Specimen to Expand ROIs"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2282"></a>1.6.1.2.1.&nbsp;Click Arrow in Specimen to Expand ROIs</h6></div></div></div></div><div class="sect5" title="1.6.1.2.2.&nbsp;Click Transcibe in any ROI"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2285"></a>1.6.1.2.2.&nbsp;Click Transcibe in any ROI</h6></div></div></div><p>Loads ROI immediately and switches to the Transcribe Text
                                Tab</p></div></div></div><div class="sect3" title="1.6.2.&nbsp;OCR Results Tab"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2290"></a>1.6.2.&nbsp;OCR Results Tab</h4></div></div></div><div class="sect4" title="1.6.2.1.&nbsp;OCRAD Results"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2293"></a>1.6.2.1.&nbsp;OCRAD Results</h5></div></div></div><div class="sect5" title="1.6.2.1.1.&nbsp;Reprocess OCRAD Results"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2296"></a>1.6.2.1.1.&nbsp;Reprocess OCRAD Results</h6></div></div></div><p>Reprocesses the ROI through the OCRAD OCR Engine</p></div><div class="sect5" title="1.6.2.1.2.&nbsp;Copy OCRAD Results to Transcription Textarea"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2301"></a>1.6.2.1.2.&nbsp;Copy OCRAD Results to Transcription Textarea</h6></div></div></div><p>Click the Icon that looks like a Document with a swooshing arrow
                                on it.</p></div></div><div class="sect4" title="1.6.2.2.&nbsp;OCRopus Results"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2306"></a>1.6.2.2.&nbsp;OCRopus Results</h5></div></div></div><div class="sect5" title="1.6.2.2.1.&nbsp;Reprocess OCRopus Results"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2309"></a>1.6.2.2.1.&nbsp;Reprocess OCRopus Results</h6></div></div></div><p>Reprocesses the ROI through the OCRopus OCR Engine</p></div><div class="sect5" title="1.6.2.2.2.&nbsp;Copy OCRopus Results to Transcription Textarea"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2314"></a>1.6.2.2.2.&nbsp;Copy OCRopus Results to Transcription Textarea</h6></div></div></div><p>Click the Icon that looks like a Document with a swooshing arrow
                                on it.</p></div></div><div class="sect4" title="1.6.2.3.&nbsp;GOCR Results"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2319"></a>1.6.2.3.&nbsp;GOCR Results</h5></div></div></div><div class="sect5" title="1.6.2.3.1.&nbsp;Reprocess GOCR Results"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2322"></a>1.6.2.3.1.&nbsp;Reprocess GOCR Results</h6></div></div></div><p>Reprocesses the ROI through the GOCR OCR Engine</p></div><div class="sect5" title="1.6.2.3.2.&nbsp;Copy GOCR Results to Transcription Textarea"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2327"></a>1.6.2.3.2.&nbsp;Copy GOCR Results to Transcription Textarea</h6></div></div></div><p>Click the Icon that looks like a Document with a swooshing arrow
                                on it.</p></div></div></div><div class="sect3" title="1.6.3.&nbsp;Text Transcription Tab"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2332"></a>1.6.3.&nbsp;Text Transcription Tab</h4></div></div></div><div class="sect4" title="1.6.3.1.&nbsp;Enter or correct Verbatim text as transcibed by OCR and human"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2335"></a>1.6.3.1.&nbsp;Enter or correct Verbatim text as transcibed by OCR and human</h5></div></div></div></div><div class="sect4" title="1.6.3.2.&nbsp;Click Save text"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2338"></a>1.6.3.2.&nbsp;Click Save text</h5></div></div></div><p>Click the Save Text Button to save the data to the Text datastream of
                            the ROI Object</p></div></div></div><div class="sect2" title="1.7.&nbsp;Parse ROI"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2343"></a>1.7.&nbsp;Parse ROI</h3></div></div></div><div class="sect3" title="1.7.1.&nbsp;Select an ROI to Parse"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2346"></a>1.7.1.&nbsp;Select an ROI to Parse</h4></div></div></div><div class="sect4" title="1.7.1.1.&nbsp;Click Parse from the right-hand side Specimen ROI List"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2349"></a>1.7.1.1.&nbsp;Click Parse from the right-hand side Specimen ROI List</h5></div></div></div><p>Loads ROI immediately and switches to the Parse Text Tab</p></div><div class="sect4" title="1.7.1.2.&nbsp;Glide Mouse to left to reveal Workflow Queue"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2354"></a>1.7.1.2.&nbsp;Glide Mouse to left to reveal Workflow Queue</h5></div></div></div><div class="sect5" title="1.7.1.2.1.&nbsp;Click Arrow in Specimen to Expand ROIs"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2357"></a>1.7.1.2.1.&nbsp;Click Arrow in Specimen to Expand ROIs</h6></div></div></div></div><div class="sect5" title="1.7.1.2.2.&nbsp;Click Parse in any ROI"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2360"></a>1.7.1.2.2.&nbsp;Click Parse in any ROI</h6></div></div></div><p>Loads ROI immediately and switches to the Parse Text Tab</p></div></div></div><div class="sect3" title="1.7.2.&nbsp;Image Tab"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2365"></a>1.7.2.&nbsp;Image Tab</h4></div></div></div><p>Displays the ROI Image that was Transcibed</p></div><div class="sect3" title="1.7.3.&nbsp;Text Tab"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2370"></a>1.7.3.&nbsp;Text Tab</h4></div></div></div><div class="sect4" title="1.7.3.1.&nbsp;Select a section of text"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2373"></a>1.7.3.1.&nbsp;Select a section of text</h5></div></div></div></div><div class="sect4" title="1.7.3.2.&nbsp;Assign Selection to Metadata Element"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2376"></a>1.7.3.2.&nbsp;Assign Selection to Metadata Element</h5></div></div></div><div class="sect5" title="1.7.3.2.1.&nbsp;Right Click Selection and Follow the Menus"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2379"></a>1.7.3.2.1.&nbsp;Right Click Selection and Follow the Menus</h6></div></div></div></div><div class="sect5" title="1.7.3.2.2.&nbsp; Use the Top Menu"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2382"></a>1.7.3.2.2.&nbsp; Use the Top Menu</h6></div></div></div></div></div><div class="sect4" title="1.7.3.3.&nbsp;Remove Selection of Assigned Metadata Element"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2385"></a>1.7.3.3.&nbsp;Remove Selection of Assigned Metadata Element</h5></div></div></div><div class="sect5" title="1.7.3.3.1.&nbsp;Right Click Selection and Click Remove"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2388"></a>1.7.3.3.1.&nbsp;Right Click Selection and Click Remove</h6></div></div></div></div><div class="sect5" title="1.7.3.3.2.&nbsp; Click Remove from the Top Menu"><div class="titlepage"><div><div><h6 class="title"><a name="d0e2391"></a>1.7.3.3.2.&nbsp; Click Remove from the Top Menu</h6></div></div></div></div></div><div class="sect4" title="1.7.3.4.&nbsp;Find taxa via uBio"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2394"></a>1.7.3.4.&nbsp;Find taxa via <a class="link" href="http://www.ubio.org/" target="_top">uBio</a></h5></div></div></div><p>Retrieves and displays the uBio results in an overlay</p></div><div class="sect4" title="1.7.3.5.&nbsp;Parse using HERBIS"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2401"></a>1.7.3.5.&nbsp;Parse using <a class="link" href="http://www.herbis.org/" target="_top">HERBIS</a></h5></div></div></div><p>Runs the Transcibed Text through a HERBIS Natural Language Processing
                            (NLP) algorithms whose return is mapped to Apiary Project
                            specimenMetadata elements.</p></div><div class="sect4" title="1.7.3.6.&nbsp;Save Parse Text"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2408"></a>1.7.3.6.&nbsp;Save Parse Text</h5></div></div></div><p>Click the Save Parsed Text Button to save the data to the
                            specimenMetadata datastream of the ROI Object</p><p>Note: The Text datastream is also updated to include assign Span
                            tags.</p></div></div></div><div class="sect2" title="1.8.&nbsp;Delete ROI"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2415"></a>1.8.&nbsp;Delete ROI</h3></div></div></div><div class="sect3" title="1.8.1.&nbsp;Click Delete ROI from the right-hand side Specimen ROI List"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2418"></a>1.8.1.&nbsp;Click Delete ROI from the right-hand side Specimen ROI List</h4></div></div></div></div></div><div class="sect2" title="1.9.&nbsp;Remove ROI from Queue"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2421"></a>1.9.&nbsp;Remove ROI from Queue</h3></div></div></div><div class="sect3" title="1.9.1.&nbsp;Glide Mouse to left to reveal Workflow Queue"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2424"></a>1.9.1.&nbsp;Glide Mouse to left to reveal Workflow Queue</h4></div></div></div></div><div class="sect3" title="1.9.2.&nbsp;Click remove for the ROI"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2427"></a>1.9.2.&nbsp;Click remove for the ROI</h4></div></div></div></div></div><div class="sect2" title="1.10.&nbsp;Remove Specimen from Queue"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2430"></a>1.10.&nbsp;Remove Specimen from Queue</h3></div></div></div><div class="sect3" title="1.10.1.&nbsp;Glide Mouse to left to reveal Workflow Queue"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2433"></a>1.10.1.&nbsp;Glide Mouse to left to reveal Workflow Queue</h4></div></div></div></div><div class="sect3" title="1.10.2.&nbsp;Click the gear icon"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2436"></a>1.10.2.&nbsp;Click the gear icon</h4></div></div></div><div class="sect4" title="1.10.2.1.&nbsp;Click Remove specimen"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2439"></a>1.10.2.1.&nbsp;Click Remove specimen</h5></div></div></div></div></div></div></div></div><div class="chapter" title="Chapter&nbsp;5.&nbsp;Troubleshooting the Apiary Project Workflow"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2442"></a>Chapter&nbsp;5.&nbsp;Troubleshooting the Apiary Project Workflow</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d0e2447">1. Fedora Will Not Start</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2450">1.1. Check System Variables</a></span></dt><dt><span class="sect2"><a href="#d0e2465">1.2. Check Tomcat/Catalina logs</a></span></dt></dl></dd></dl></div><p>Preface: An attempt to cover a variety of known issues</p><div class="sect1" title="1.&nbsp;Fedora Will Not Start"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2447"></a>1.&nbsp;Fedora Will Not Start</h2></div></div></div><div class="sect2" title="1.1.&nbsp;Check System Variables"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2450"></a>1.1.&nbsp;Check System Variables</h3></div></div></div><p>From a command line, typing in $FEDORA_HOME should result in the location of
                    the fedora directory</p><p>If it does not, then your variable needs to be set See <a class="link" href="#envirovariables">Edit Environment Variables</a></p><p>Others that could be missing:</p><p>JAVA_HOME, CATALINA_HOME, LD_LIBRARY_PATH</p><p>Some of these directories use Symlinks that can become invalid after an
                    update, especially JAVA_HOME</p></div><div class="sect2" title="1.2.&nbsp;Check Tomcat/Catalina logs"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2465"></a>1.2.&nbsp;Check Tomcat/Catalina logs</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">vi $FEDORA_HOME/server/config/fedora.fcfg</code> </p></div><p>Verify hostname is accurate</p><p>Verify mysql db and information is accurate</p></div></div></div><div class="chapter" title="Chapter&nbsp;6.&nbsp;Apiary Project Advanced Configuration"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2475"></a>Chapter&nbsp;6.&nbsp;Apiary Project Advanced Configuration</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d0e2480">1. Apache-Solr schema</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2483">1.1. Edit schema.xml file</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e2517">2. Configure Adore-Djatoka Database Resolver</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2520">2.1. Create and Setup djatoka mysql database</a></span></dt><dt><span class="sect2"><a href="#d0e2546">2.2. Reconfigure Djatoka properties file</a></span></dt><dt><span class="sect2"><a href="#d0e2586">2.3. Insert Images into Djatoka database</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e2605">3. Install Varnish http accelerator</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2622">3.1. Configure Apache</a></span></dt><dt><span class="sect2"><a href="#d0e2668">3.2. Install Varnish</a></span></dt><dt><span class="sect2"><a href="#d0e2689">3.3. Configure Varnish</a></span></dt><dt><span class="sect2"><a href="#d0e2713">3.4. Redirect Varnish to Apache via default.vcl file</a></span></dt><dt><span class="sect2"><a href="#d0e2739">3.5. (Re)Starting Varnish</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e2745">4. Install HERBIS</a></span></dt></dl></div><p>Other techniques used to improve the Apiary Project</p><div class="sect1" title="1.&nbsp;Apache-Solr schema"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2480"></a>1.&nbsp;Apache-Solr schema</h2></div></div></div><div class="sect2" title="1.1.&nbsp;Edit schema.xml file"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2483"></a>1.1.&nbsp;Edit schema.xml file</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">vi
                        $FEDORA_HOME/tomcat/webapps/apache-solr-1.4.1/example/solr/conf/schema.xml</code> </p></div><div class="sect3" title="1.1.1.&nbsp;Add Dynamically Indexed Item"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2489"></a>1.1.1.&nbsp;Add Dynamically Indexed Item</h4></div></div></div><p>Edit the dynamicField section of the XML document</p></div><div class="sect3" title="1.1.2.&nbsp;Add Other Solr Features"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2494"></a>1.1.2.&nbsp;Add Other Solr Features</h4></div></div></div><p>Solr offers many
                        other features that are beyond the scope of this project. They can be
                        learned about here</p></div><div class="sect3" title="1.1.3.&nbsp;Edit search.php file"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2501"></a>1.1.3.&nbsp;Edit search.php file</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">vi
                            /var/www/drupal/modules/apiary_project/workflow/include/search.php</code> </p></div><p>Add new code to include added Dynamically Indexed Item</p></div><div class="sect3" title="1.1.4.&nbsp;Restart Solr"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2509"></a>1.1.4.&nbsp;Restart Solr</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">/etc/init.d/solr restart</code> </p></div><p>Re-Index Fedora Objects into Solr from
                        http://hostname/drupal/apiary?ref=solr_index_all</p></div></div></div><div class="sect1" title="2.&nbsp;Configure Adore-Djatoka Database Resolver"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2517"></a>2.&nbsp;Configure Adore-Djatoka Database Resolver</h2></div></div></div><div class="sect2" title="2.1.&nbsp;Create and Setup djatoka mysql database"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2520"></a>2.1.&nbsp;Create and Setup djatoka mysql database</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">mysql -u root -p</code> </p></div><p>Accesses mysql command line, password is apiary</p><div class="sect3" title="2.1.1.&nbsp;Create Drupal user and database"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2528"></a>2.1.1.&nbsp;Create Drupal user and database</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">create database djatoka;</code> </p></div><div class="cmdsynopsis"><p><code class="command">grant all on djatoka.* to &#8216;djatokaAdmin&#8217;@&#8217;localhost&#8217; identified by
                            &#8216;apiary&#8217;;</code> </p></div><div class="cmdsynopsis"><p><code class="command">grant all on djatoka.* to &#8216;djatokaAdmin&#8217;@&#8217;%&#8217; identified by
                            &#8216;apiary&#8217;;</code> </p></div><div class="cmdsynopsis"><p><code class="command">use djatoka;</code> </p></div><div class="cmdsynopsis"><p><code class="command">CREATE TABLE `resources` ( `identifier` varchar(150) NOT NULL,
                            `imageFile` varchar(255) NOT NULL, `original_file_url` text NOT NULL,
                            `jp2_file_url` text NOT NULL, PRIMARY KEY (`identifier`) ) ENGINE=MyISAM
                            DEFAULT CHARSET=latin1;</code> </p></div></div></div><div class="sect2" title="2.2.&nbsp;Reconfigure Djatoka properties file"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2546"></a>2.2.&nbsp;Reconfigure Djatoka properties file</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">vi
                        /usr/local/fedora/tomcat/webapps/adore-djatoka/WEB-INF/classes/djatoka.properties</code> </p></div><div class="sect3" title="2.2.1.&nbsp;Comment out the current OpenURLJP2KService.referentResolverImpl"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2552"></a>2.2.1.&nbsp;Comment out the current OpenURLJP2KService.referentResolverImpl</h4></div></div></div><p>
                        #OpenURLJP2KService.referentResolverImpl=gov.lanl.adore.djatoka.openurl.SimpleListResolverUncomment:</p></div><div class="sect3" title="2.2.2.&nbsp;Uncomment the Database Resolver OpenURLJP2KService.referentResolverImpl"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2557"></a>2.2.2.&nbsp;Uncomment the Database Resolver
                        OpenURLJP2KService.referentResolverImpl</h4></div></div></div><p>
                        OpenURLJP2KService.referentResolverImpl=gov.lanl.adore.djatoka.openurl.plugin.r
                        ftdb.DatabaseResolver</p></div><div class="sect3" title="2.2.3.&nbsp;Uncomment the Database Resolver properties"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2562"></a>2.2.3.&nbsp;Uncomment the Database Resolver properties</h4></div></div></div><p>DatabaseResolver.url=jdbc:mysql://localhost/djatoka</p><p>DatabaseResolver.driver=com.mysql.jdbc.Driver</p><p>DatabaseResolver.login=djatokaAdmin</p><p>DatabaseResolver.pwd=apiary</p><p>DatabaseResolver.maxActive=500</p><p>DatabaseResolver.maxIdle=10</p><p>DatabaseResolver.query=SELECT identifier, imageFile FROM resources WHERE
                        identifier='\\i';</p></div><div class="sect3" title="2.2.4.&nbsp;Add Remote Caching property"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2579"></a>2.2.4.&nbsp;Add Remote Caching property</h4></div></div></div><p>DatabaseResolver.maxRemoteCacheSize=150000000</p><p>Note: This is in pixels so 150000000 is equivalent to a 15000x10000 pixel
                        image.</p></div></div><div class="sect2" title="2.3.&nbsp;Insert Images into Djatoka database"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2586"></a>2.3.&nbsp;Insert Images into Djatoka database</h3></div></div></div><div class="sect3" title="2.3.1.&nbsp;Get Image List"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2589"></a>2.3.1.&nbsp;Get Image List</h4></div></div></div><p>The images' identifiers and file names are originally stored in a text
                        file at </p><div class="cmdsynopsis"><p><code class="command">$FEDORA_HOME/tomcat/webapps/adore-djatoka/WEB-INF/classes/imgIndex.txt</code> </p></div></div><div class="sect3" title="2.3.2.&nbsp;Insert Images"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2597"></a>2.3.2.&nbsp;Insert Images</h4></div></div></div><p>For each image you wish to server, add a record modelling the following
                        sql command used to serve the image MBB064.jp2</p><div class="cmdsynopsis"><p><code class="command">INSERT INTO
                            djatoka.resources(`identifier`,`imageFile`,`original_file_url`,`jp2_file_url`)
                            values('apiary:jpeg2000/mbb064', '/var/www/jpeg2000/MBB064.jp2',
                            'http://research.apiaryproject.org/images/original/MBB064.tif',
                            'http://research.apiaryproject.org/images/jpeg2000/MBB064.jp2)</code> </p></div></div></div></div><div class="sect1" title="3.&nbsp;Install Varnish http accelerator"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2605"></a>3.&nbsp;Install Varnish http accelerator</h2></div></div></div><p>References: </p><p><a class="link" href="References: http://fak3r.com/2009/01/27/howto-serve-jpeg2000-images-with-a-scalable-infrastructure/ http://groups.drupal.org/node/25425/revisions/88248/view  http://blog.gootum.com/linux-blog/installing-varnish-reverse-proxy-for-ubuntu  http://comments.gmane.org/gmane.comp.web.varnish.misc/1840 " target="_top">http://fak3r.com/2009/01/27/howto-serve-jpeg2000-images-with-a-scalable-infrastructure/</a></p><p><a class="link" href="http://groups.drupal.org/node/25425/revisions/88248/view" target="_top">http://groups.drupal.org/node/25425/revisions/88248/view</a></p><p><a class="link" href="http://blog.gootum.com/linux-blog/installing-varnish-reverse-proxy-for-ubuntu" target="_top">http://blog.gootum.com/linux-blog/installing-varnish-reverse-proxy-for-ubuntu</a></p><p><a class="link" href="http://comments.gmane.org/gmane.comp.web.varnish.misc/1840 " target="_top">http://comments.gmane.org/gmane.comp.web.varnish.misc/1840 </a></p><div class="sect2" title="3.1.&nbsp;Configure Apache"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2622"></a>3.1.&nbsp;Configure Apache</h3></div></div></div><div class="sect3" title="3.1.1.&nbsp;Enable Modules"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2625"></a>3.1.1.&nbsp;Enable Modules</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">a2enmod proxy</code> </p></div><div class="cmdsynopsis"><p><code class="command">a2enmod proxy_ajp</code> </p></div><div class="cmdsynopsis"><p><code class="command">a2enmod disk_cache</code> </p></div><div class="cmdsynopsis"><p><code class="command">a2enmod file_cache</code> </p></div><div class="cmdsynopsis"><p><code class="command">a2enmod mem_cache</code> </p></div><div class="cmdsynopsis"><p><code class="command">a2enmod deflate</code> </p></div></div><div class="sect3" title="3.1.2.&nbsp;Set Apache to listen on port 8019 instead of standard 80"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2646"></a>3.1.2.&nbsp;Set Apache to listen on port 8019 instead of standard 80</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">vi /etc/apache2/ports.conf</code> </p></div><p>Change port 80 to 8019</p></div><div class="sect3" title="3.1.3.&nbsp;Set Apache sites to use port 8019 instead of 80"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2654"></a>3.1.3.&nbsp;Set Apache sites to use port 8019 instead of 80</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">vi /etc/apache2/sites-enabled/000-default</code> </p></div><p>Change port 80 to 8019</p></div><div class="sect3" title="3.1.4.&nbsp;Restart Apache"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2662"></a>3.1.4.&nbsp;Restart Apache</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">vi /etc/init.d/apache restart</code> </p></div></div></div><div class="sect2" title="3.2.&nbsp;Install Varnish"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2668"></a>3.2.&nbsp;Install Varnish</h3></div></div></div><div class="sect3" title="3.2.1.&nbsp;Two methods"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2671"></a>3.2.1.&nbsp;Two methods</h4></div></div></div><div class="sect4" title="3.2.1.1.&nbsp;Option 1 - via Synaptics Package Manager"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2674"></a>3.2.1.1.&nbsp;Option 1 - via Synaptics Package Manager</h5></div></div></div><p>Select the following to be installed:</p><p>varnish</p><p>libvarnish-dev</p></div><div class="sect4" title="3.2.1.2.&nbsp;Option 2 - via command line"><div class="titlepage"><div><div><h5 class="title"><a name="d0e2683"></a>3.2.1.2.&nbsp;Option 2 - via command line</h5></div></div></div><div class="cmdsynopsis"><p><code class="command">apt-get install varnish</code> </p></div></div></div></div><div class="sect2" title="3.3.&nbsp;Configure Varnish"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2689"></a>3.3.&nbsp;Configure Varnish</h3></div></div></div><div class="sect3" title="3.3.1.&nbsp;Create a pressflow directory"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2692"></a>3.3.1.&nbsp;Create a pressflow directory</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">mkdir -p /var/lib/varnish/pressflow</code> </p></div><div class="cmdsynopsis"><p><code class="command">chown varnish.varnish /var/lib/varnish/pressflow</code> </p></div></div><div class="sect3" title="3.3.2.&nbsp;Set Varnish to run on port 80"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2701"></a>3.3.2.&nbsp;Set Varnish to run on port 80</h4></div></div></div><div class="cmdsynopsis"><p><code class="command">vi /etc/default/varnish</code> </p></div><p>Change INSTANCE=pressflow</p><p>Use Alternative 2</p><p>DAEMON_OPTS="-a :80 -T localhost:6082 -f /etc/varnish/default.vcl -s
                        file,/var/lib/varnish/$INSTANCE/varnish_storage.bin,1G"</p></div></div><div class="sect2" title="3.4.&nbsp;Redirect Varnish to Apache via default.vcl file"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2713"></a>3.4.&nbsp;Redirect Varnish to Apache via default.vcl file</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">vi /etc/varnish/ default.vcl</code> </p></div><p>change the backend default values:</p><p>    backend default { </p><p>        .host = "hostname"; </p><p>        .port = "8019";</p><p>protect against apache rewrite conflicts:</p><p>    uncomment sub vcl_fetch</p><p>add after if statements:</p><p>if (obj.http.location ~ ":81"){</p><p> set obj.http.location = regsub(obj.http.location,"\:81","");</p><p> }</p></div><div class="sect2" title="3.5.&nbsp;(Re)Starting Varnish"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2739"></a>3.5.&nbsp;(Re)Starting Varnish</h3></div></div></div><div class="cmdsynopsis"><p><code class="command">/etc/init.d/varnish restart</code> </p></div></div></div><div class="sect1" title="4.&nbsp;Install HERBIS"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2745"></a>4.&nbsp;Install HERBIS</h2></div></div></div><p>Reference Guide:
                http://projects.brit.org/projects/imls/repository/raw/trunk/documents/development/HERBIS%20Installation.docx</p></div></div><div class="chapter" title="Chapter&nbsp;7.&nbsp;Apiary Project Code Flow"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2750"></a>Chapter&nbsp;7.&nbsp;Apiary Project Code Flow</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d0e2755">1. An internal PHP File as a Page</a></span></dt><dt><span class="sect1"><a href="#d0e2771">2. An external PHP File as a Page</a></span></dt><dt><span class="sect1"><a href="#d0e2793">3. What actually takes place when a workflow is started?</a></span></dt></dl></div><p>The Apiary Project uses two powerful approaches to user interfacing and data handling.
            Both provide the ability to process everything on the server side using the full
            features of drupal. First, pages can be created within drupal itself. Second, pages
            external to drupal are supported using ajax and jQuery.</p><div class="sect1" title="1.&nbsp;An internal PHP File as a Page"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2755"></a>1.&nbsp;An internal PHP File as a Page</h2></div></div></div><p>These are the primary type of pages the Apiary Admin pages use. They are called by
                the automatically created drupal node "apiary".</p><p>This file will be loaded from drupal, inside the cti-no-flex-title theme thanks to
                    <a class="link" href="#themekey">Themekey</a>.</p><p>Example:</p><p>    http://hostname/drupal/apiary?ref=groundtruth</p><p> This page is handled internally by drupal. The apiary page loads the
                apiary_project/workflow/include/groundtruth.php file and processes everything
                created therein.</p></div><div class="sect1" title="2.&nbsp;An external PHP File as a Page"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2771"></a>2.&nbsp;An external PHP File as a Page</h2></div></div></div><p>Currently index (the actual workspace page), comparer, search and workflow use
                this approach.</p><p>An externally loaded page that is popualted by ajax calls to the drupal
                site</p><p>Example:</p><p>    http://hostname/drupal/modules/apiary_project/workflow/index.php</p><p>This page is completely outside the scope of drupal allowing full control of user
                interface customization</p><p>In our case, we needed to apply jQuery to the full body of the page and this could
                not be done with drupal adding its own headers, etc first</p><p>Ajax calls can still be made to drupal, since the<a class="link" href="#editmenuinc">
                    VIEW_APIARY edit was made to the menu.inc file</a>, allowing drupal to do the
                work and the page to then be populated</p><p>The Task Queue is loaded by the response of the ajax call made to
                http://hostname/drupal/apiary/workflow_ajax/queue_list/1/0/0</p></div><div class="sect1" title="3.&nbsp;What actually takes place when a workflow is started?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2793"></a>3.&nbsp;What actually takes place when a workflow is started?</h2></div></div></div><p>Inside the external file, apiary_project/workflow/index.php, are <a class="link" href="#editextfiles">variables that must be previously have been
                set</a></p><p>    $drupal_url = "http://hostname/drupal";</p><p>    $djatoka_url = "http://hostname:8080/";</p><p>These are stored using a SMARTY template</p><p>These tell the workflow where to make its ajax calls, mainly using jQuery</p><p>There are a number of loaded javascript and css files
                (apiary_project/workflow/assets/js and apiary_project/workflow/assets/css)</p><p>The return responses are then presented to the user with the javascript and css
                styling already loaded</p><p>When a jQuery ajax call is made, drupal checks for a current login and if the user
                has the VIEW_APIARY permission</p><p>Once verified, drupal processes the request on the server side</p><p>Often the request requires connection to the Fedora Repository, and a call using
                Islandora must be made (apiary_project/fedora_commons)</p><p>We also write to the Fedora Repository using CURL</p><p>Other times drupal executes a Solr query to process the response</p><p>All this information is used to return html and JSON data in an expected
                format</p></div></div><div class="chapter" title="Chapter&nbsp;8.&nbsp;Apiary Project Metadata Documentation"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2824"></a>Chapter&nbsp;8.&nbsp;Apiary Project Metadata Documentation</h2></div></div></div><p>reference:  <a class="link" href="http://www.apiaryproject.org/technical" target="_top">http://www.apiaryproject.org/technical</a>
        </p></div><div class="chapter" title="Chapter&nbsp;9.&nbsp;Apiary Project Fedora Object Model"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2832"></a>Chapter&nbsp;9.&nbsp;Apiary Project Fedora Object Model</h2></div></div></div><p>reference:  <a class="link" href="http://www.apiaryproject.org/technical" target="_top">http://www.apiaryproject.org/technical</a>
        </p></div><div class="chapter" title="Chapter&nbsp;10.&nbsp;Apiary Project Downloads"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2840"></a>Chapter&nbsp;10.&nbsp;Apiary Project Downloads</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d0e2847">1. VirtualBox</a></span></dt></dl></div><p>Downloads for the Apiary Project are available at <a class="link" href="https://www.apiaryproject.org/downloads" target="_top">https://www.apiaryproject.org/downloads</a></p><div class="sect1" title="1.&nbsp;VirtualBox"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2847"></a>1.&nbsp;VirtualBox</h2></div></div></div><p>In an attempt to avoid the headache of following and completing the installation
                outlined in Chapter 2, a Virtual Box virtual machine image is available for
                download.</p></div></div><div class="chapter" title="Chapter&nbsp;11.&nbsp;Documentation"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2852"></a>Chapter&nbsp;11.&nbsp;Documentation</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d0e2855">1. Choices and Technical Hurdles</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2858">1.1. Working with Large Image Files</a></span></dt><dt><span class="sect2"><a href="#d0e2865">1.2. Storing Digital Objects</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e2870">2.  Performance Issues and Concerns </a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2873">2.1. Speed</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e2882">3.  Technical Documentation References</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2885">3.1. OxygenXML</a></span></dt><dt><span class="sect2"><a href="#d0e2891">3.2. Doxygen</a></span></dt></dl></dd></dl></div><div class="sect1" title="1.&nbsp;Choices and Technical Hurdles"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2855"></a>1.&nbsp;Choices and Technical Hurdles</h2></div></div></div><div class="sect2" title="1.1.&nbsp;Working with Large Image Files"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2858"></a>1.1.&nbsp;Working with Large Image Files</h3></div></div></div><p>This was a main focus since the images we would be analyzing were
                    high-resolution, 200+ MB tif files. The Adore-Djatoka Server is designed to
                    handle large images but from a JPEG2000 file format. So the image conversion had
                    to be explored. In the end, we found that a combination of ImageMagick and
                    OpenJPEG would allow us to convert the large tif files into JPEG2000. A
                    significant amount of RAM and or Swap space is definitely needed. <a class="link" href="#systemreqs">System requirements can be viewed here.</a></p></div><div class="sect2" title="1.2.&nbsp;Storing Digital Objects"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2865"></a>1.2.&nbsp;Storing Digital Objects</h3></div></div></div><p>The topic of storing the digital objects was a tough decision as the data we
                    want to keep could be stored in a database, text files or a repository. The
                    ability to track the versioning as the object progressed through the various
                    stages of the workflow was a key necessity. Fedora's inherent use of Darwin Core
                    and its multiple datastream support made it an ideal choice but its overall
                    speed and lack of interfacing was a serious hurdle. Using a database like MySQL
                    would be faster but lacked already developed tools we needed to have on hand to
                    get the rest of the project moving forward. </p></div></div><div class="sect1" title="2.&nbsp; Performance Issues and Concerns"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2870"></a>2.&nbsp; Performance Issues and Concerns </h2></div></div></div><div class="sect2" title="2.1.&nbsp;Speed"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2873"></a>2.1.&nbsp;Speed</h3></div></div></div><p>The overall objective of the Apiary Project is to reduce the number of man
                    hours it will take to process Specimens from start to finish. Plus, users in the
                    world today want things fast! The faster the UI the better our objective will be
                    met. Djatoka allowed us to handle large images effectively but sometimes had
                    caching issues. Changing the caching properties was a must. </p><p>Varnish, an http accelerator, was also installed on the Apiary Project server.
                    This receives http requests before they ever get to Apache2 to handle. So if an
                    image is requested multiple times, the subsequent requests are returned by
                    Varnish instead of being handled with Apache. Needing to see a new page can
                    become an issue if Varnish never lets Apache process it. So the use of No-Cache
                    headers is a good practice for some pages.</p><p>The API tools used to request a datastream and its content from Fedora, parse
                    the data and then return results is anything but lightning fast. We chose to
                    implement Apache-Solr indexing which is done when an indexed datastream for an
                    ROI or Specimen Image is saved. For comparison, a request to get the Specimen,
                    Image and ROI object information needed to fill the item browser with 40
                    Specimens using fedora only loaded in 10 seconds. The same 40 specimen request
                    using Solr to fetch the information loaded in under 1.5 seconds.</p></div></div><div class="sect1" title="3.&nbsp; Technical Documentation References"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2882"></a>3.&nbsp; Technical Documentation References</h2></div></div></div><div class="sect2" title="3.1.&nbsp;OxygenXML"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2885"></a>3.1.&nbsp;<a class="link" href="http://www.oxygenxml.com" target="_top">OxygenXML</a></h3></div></div></div><p>I chose to create this documentation using OxygenXML given their relationship
                    with BRIT and its ability to transform the xml into html and pdf formats.</p></div><div class="sect2" title="3.2.&nbsp;Doxygen"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2891"></a>3.2.&nbsp;<a class="link" href="http://www.stack.nl/~dimitri/doxygen/index.html" target="_top">Doxygen</a></h3></div></div></div><p>I chose to create the code document this using Doxygen with its ability to
                    layout the classes and function in an API-type format</p></div></div></div></div></body></html>