<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Apiary Project: apiary_project/analyze.functions.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cti_flex_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Apiary Project&#160;<span id="projectnumber">1.0.0</span></div>
   <div id="projectbrief">Apiary Project Drupal Module and Image Analysis Tool</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('analyze_8functions_8php.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">apiary_project/analyze.functions.php</div>  </div>
</div>
<div class="contents">
<a href="analyze_8functions_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a><a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">00002</a> <a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a> = drupal_get_path(<span class="stringliteral">&#39;module&#39;</span>,<span class="stringliteral">&#39;apiary_project&#39;</span>);
<a name="l00003"></a>00003 <span class="comment">/*include_once($rel_path.&#39;/workflow/include/class.Workflow.php&#39;);</span>
<a name="l00004"></a>00004 <span class="comment">include_once($rel_path.&#39;/workflow/include/class.Errorlog.php&#39;);</span>
<a name="l00005"></a>00005 <span class="comment">*/</span>
<a name="l00006"></a>00006 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/workflow/include/functions_error.php&#39;</span>);
<a name="l00007"></a>00007 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/workflow/include/functions_misc.php&#39;</span>);
<a name="l00008"></a>00008 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/workflow/include/db_utils.php&#39;</span>);
<a name="l00009"></a>00009
<a name="l00010"></a><a class="code" href="analyze_8functions_8php.html#a569ab637484bb1b9bcd0ce7571dd5f95">00010</a> function <a class="code" href="analyze_8functions_8php.html#a569ab637484bb1b9bcd0ce7571dd5f95">specimen_list</a>($nothing, $nothing, $workflow_id){
<a name="l00011"></a>00011         $workflow = <span class="keyword">new</span> Workflow($workflow_id, <span class="keyword">true</span>);
<a name="l00012"></a>00012         $specimen_pids = $workflow-&gt;specimen_pids;
<a name="l00013"></a>00013         $returnHTML = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00014"></a>00014         <span class="keywordflow">foreach</span> ($specimen_pids as $specimen_pid){
<a name="l00015"></a>00015                 $specimen_id = str_replace(<span class="stringliteral">&quot;:&quot;</span>,<span class="stringliteral">&quot;_&quot;</span>,$specimen_pid);
<a name="l00016"></a>00016         $returnHTML .= <span class="stringliteral">&#39;&lt;div class=&quot;widget-header&quot; id=&quot;&#39;</span>.$specimen_id.<span class="stringliteral">&#39;&quot; onclick=&quot;toggle_specimen(\&#39;content-&#39;</span>.$specimen_id.<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&gt;</span>
<a name="l00017"></a>00017 <span class="stringliteral">            &lt;div class=&quot;</span>widget-header-left  onclick=<span class="stringliteral">&quot;select_specimen(\&#39;&#39;.$specimen_pid.&#39;\&#39;)&quot;</span><span class="stringliteral">&quot;&gt;</span>
<a name="l00018"></a>00018 <span class="stringliteral">            &lt;div class=&quot;</span>specimen_name<span class="stringliteral">&quot;&gt;&#39;. $specimen_pid.&#39; - &lt;span class=&quot;</span>specimen_status<span class="stringliteral">&quot;&gt;status&lt;/span&gt;&lt;/div&gt;</span>
<a name="l00019"></a>00019 <span class="stringliteral">                &lt;div class=&quot;</span>specimen_header_detail<span class="stringliteral">&quot;&gt;Contains &lt;span id=&quot;</span>roi_count_001<span class="stringliteral">&quot;&gt;X ROIs&lt;/span&gt; - &lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;analyze&lt;/a&gt;&lt;/div&gt;</span>
<a name="l00020"></a>00020 <span class="stringliteral">        &lt;/div&gt;</span>
<a name="l00021"></a>00021 <span class="stringliteral">        &lt;div class=&quot;</span>widget-header-right<span class="stringliteral">&quot;&gt;</span>
<a name="l00022"></a>00022 <span class="stringliteral">                &lt;div class=&quot;</span>widget-control<span class="stringliteral">&quot; id=&quot;</span>control-<span class="stringliteral">&#39;.$specimen_id.&#39;</span><span class="stringliteral">&quot;&gt;&lt;img src=&quot;</span>img/icon_closed.png<span class="stringliteral">&quot;/&gt;&lt;/div&gt;</span>
<a name="l00023"></a>00023 <span class="stringliteral">        &lt;/div&gt;</span>
<a name="l00024"></a>00024 <span class="stringliteral">        &lt;div class=&quot;</span>clearfix<span class="stringliteral">&quot; style=&quot;</span>width:100%;<span class="stringliteral">&quot;&gt;&lt;/div&gt;</span>
<a name="l00025"></a>00025 <span class="stringliteral">        &lt;/div&gt;&lt;!-- widget-header --&gt;</span>
<a name="l00026"></a>00026 <span class="stringliteral">        &lt;div class=&quot;</span>widget-content<span class="stringliteral">&quot; id=&quot;</span>content-<span class="stringliteral">&#39;.$specimen_id.&#39;</span><span class="stringliteral">&quot;&gt;&#39;;</span>
<a name="l00027"></a>00027 <span class="stringliteral">        $image_pids = AP_Specimen::getImageListForSpecimen($specimen_pid);</span>
<a name="l00028"></a>00028 <span class="stringliteral">        $roi_pids = AP_Image::getROIListForImage($image_pids[0]);</span>
<a name="l00029"></a>00029 <span class="stringliteral">        foreach($roi_pids as $roi_pid){</span>
<a name="l00030"></a>00030 <span class="stringliteral">                $returnHTML .= &#39;&lt;div class=&quot;</span>widget-subheader<span class="stringliteral">&quot;&gt;</span>
<a name="l00031"></a>00031 <span class="stringliteral">            &lt;div class=&quot;</span>roi_name<span class="stringliteral">&quot;&gt;ROI Name -&#39;.$roi_pid.&#39; &lt;span class=&quot;</span>roi_status<span class="stringliteral">&quot; id=&quot;</span><span class="stringliteral">&#39;. $specimen_pid.&#39;</span>_<span class="stringliteral">&#39; . $roi_pid .&#39;</span><span class="stringliteral">&quot;&gt;status&lt;/span&gt;&lt;/div&gt;</span>
<a name="l00032"></a>00032 <span class="stringliteral">        &lt;/div&gt;</span>
<a name="l00033"></a>00033 <span class="stringliteral">        &lt;div class=&quot;</span>widget-subcontent<span class="stringliteral">&quot;&gt;</span>
<a name="l00034"></a>00034 <span class="stringliteral">            &lt;div class=&quot;</span>transcribe_link<span class="stringliteral">&quot;&gt;&lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;Transcribe&lt;/a&gt; - &lt;span id=&quot;</span>roi_001_transcribe_status<span class="stringliteral">&quot;&gt;status&lt;/span&gt;&lt;/div&gt;</span>
<a name="l00035"></a>00035 <span class="stringliteral">            &lt;div class=&quot;</span>parse_link<span class="stringliteral">&quot;&gt;&lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;Parse&lt;/a&gt; - &lt;span id=&quot;</span>roi_001_parse_status<span class="stringliteral">&quot;&gt;status&lt;/span&gt;&lt;/div&gt;</span>
<a name="l00036"></a>00036 <span class="stringliteral">        &lt;/div&gt;&#39;;</span>
<a name="l00037"></a>00037 <span class="stringliteral">    }</span>
<a name="l00038"></a>00038 <span class="stringliteral">        $returnHTML .= &#39;&lt;/div&gt;&lt;!-- widget-content --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00039"></a>00039 <span class="stringliteral">        }</span>
<a name="l00040"></a>00040 <span class="stringliteral">        echo $returnHTML;</span>
<a name="l00041"></a>00041 <span class="stringliteral">}</span>
<a name="l00042"></a>00042 <span class="stringliteral"></span>
<a name="l00043"></a><a class="code" href="analyze_8functions_8php.html#ad13e1985dddb1173b5cc748c11990c65">00043</a> <span class="stringliteral">function update_queue_list($nothing, $nothing, $workflow_id){</span>
<a name="l00044"></a>00044 <span class="stringliteral">        global $user;</span>
<a name="l00045"></a>00045 <span class="stringliteral">        $returnHTML = &quot;</span><span class="stringliteral">&quot;;</span>
<a name="l00046"></a>00046 <span class="stringliteral">        if(empty($_SESSION[&#39;apiary_session_id&#39;])) {</span>
<a name="l00047"></a>00047 <span class="stringliteral">                echo &quot;</span>Invalid Session<span class="stringliteral">&quot;;</span>
<a name="l00048"></a>00048 <span class="stringliteral">                return;</span>
<a name="l00049"></a>00049 <span class="stringliteral">        }</span>
<a name="l00050"></a>00050 <span class="stringliteral">        else{</span>
<a name="l00051"></a>00051 <span class="stringliteral">                $session_id = $_SESSION[&#39;apiary_session_id&#39;];</span>
<a name="l00052"></a>00052 <span class="stringliteral">        }</span>
<a name="l00053"></a>00053 <span class="stringliteral">        $permission_map = get_permission_map($workflow_id);</span>
<a name="l00054"></a>00054 <span class="stringliteral">        if(Workflow_Users::doesWorkflowHaveUserName($workflow_id, $user-&gt;name) &amp;&amp; Workflow_Permission::doesWorkflowHavePermission($workflow_id, &quot;</span>canAnalyzeSpecimen<span class="stringliteral">&quot;)){</span>
<a name="l00055"></a>00055 <span class="stringliteral">                list($roi_queue_list, $image_queue_list, $roi_counts) = get_queue_list($workflow_id);</span>
<a name="l00056"></a>00056 <span class="stringliteral">                $specimens = $roi_queue_list;</span>
<a name="l00057"></a>00057 <span class="stringliteral">                foreach($specimens as $specimen_pid =&gt; $images){</span>
<a name="l00058"></a>00058 <span class="stringliteral">                        foreach($images as $image_id =&gt; $rois){</span>
<a name="l00059"></a>00059 <span class="stringliteral">                                $specimen_id = str_replace(&quot;</span>:<span class="stringliteral">&quot;,&quot;</span>_<span class="stringliteral">&quot;,$specimen_pid);</span>
<a name="l00060"></a>00060 <span class="stringliteral">                                $showAll = false;$spHTMLDisplayed = false;</span>
<a name="l00061"></a>00061 <span class="stringliteral">                                $tempHTML = &#39;&lt;div class=&quot;</span>widget-header<span class="stringliteral">&quot; id=&quot;</span><span class="stringliteral">&#39;.$specimen_id;</span>
<a name="l00062"></a>00062 <span class="stringliteral">                                if ( $permission_map[&#39;</span>canAnalyzeSpecimen<span class="stringliteral">&#39;] )</span>
<a name="l00063"></a>00063 <span class="stringliteral">                                $tempHTML .= &#39;</span><span class="stringliteral">&quot; onclick=&quot;</span>toggle_specimen(\<span class="stringliteral">&#39;content-&#39;</span>.$specimen_id.<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&#39;;</span>
<a name="l00064"></a>00064 <span class="stringliteral">                                $tempHTML .= &#39;&gt;</span>
<a name="l00065"></a>00065 <span class="stringliteral">                            &lt;div class=&quot;</span>widget-header-left  onclick=<span class="stringliteral">&quot;select_specimen(\&#39;&#39;.$specimen_pid.&#39;\&#39;)&quot;</span><span class="stringliteral">&quot;&gt;</span>
<a name="l00066"></a>00066 <span class="stringliteral">                            &lt;div class=&quot;</span>specimen_name<span class="stringliteral">&quot;&gt;&#39;. $specimen_pid.&#39;&lt;span class=&quot;</span>specimen_status<span class="stringliteral">&quot;&gt;&#39;.$image_queue_list[$specimen_pid][$image_id][&quot;</span>analyzedStatus<span class="stringliteral">&quot;].&#39;&lt;/span&gt;&lt;/div&gt;</span>
<a name="l00067"></a>00067 <span class="stringliteral">                                &lt;div class=&quot;</span>specimen_header_detail<span class="stringliteral">&quot;&gt;Contains &lt;span id=&quot;</span>roi_count_<span class="stringliteral">&#39;.$specimen_id.&#39;</span><span class="stringliteral">&quot;&gt;&#39;. $roi_counts[$specimen_pid][&#39;total_rois&#39;] .&#39; ROIs&lt;/span&gt;&#39;;</span>
<a name="l00068"></a>00068 <span class="stringliteral">                        if ( $permission_map[&#39;canAnalyzeSpecimen&#39;] )</span>
<a name="l00069"></a>00069 <span class="stringliteral">                        $tempHTML .= &#39; - &lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;analyze&lt;/a&gt;&#39;;</span>
<a name="l00070"></a>00070 <span class="stringliteral">                        $tempHTML .= &#39;&lt;/div&gt;</span>
<a name="l00071"></a>00071 <span class="stringliteral">                        &lt;/div&gt;</span>
<a name="l00072"></a>00072 <span class="stringliteral">                        &lt;div class=&quot;</span>widget-header-right<span class="stringliteral">&quot;&gt;</span>
<a name="l00073"></a>00073 <span class="stringliteral">                                &lt;div class=&quot;</span>widget-control<span class="stringliteral">&quot; id=&quot;</span>control-<span class="stringliteral">&#39;.$specimen_id.&#39;</span><span class="stringliteral">&quot;&gt;&lt;img src=&quot;</span>img/icon_closed.png<span class="stringliteral">&quot;/&gt;&lt;/div&gt;</span>
<a name="l00074"></a>00074 <span class="stringliteral">                        &lt;/div&gt;</span>
<a name="l00075"></a>00075 <span class="stringliteral">                        &lt;div class=&quot;</span>clearfix<span class="stringliteral">&quot; style=&quot;</span>width:100%;<span class="stringliteral">&quot;&gt;&lt;/div&gt;</span>
<a name="l00076"></a>00076 <span class="stringliteral">                                &lt;/div&gt;&lt;!-- widget-header --&gt;</span>
<a name="l00077"></a>00077 <span class="stringliteral">                                &lt;div class=&quot;</span>widget-content<span class="stringliteral">&quot; id=&quot;</span>content-<span class="stringliteral">&#39;.$specimen_id.&#39;</span><span class="stringliteral">&quot;&gt;&#39;;</span>
<a name="l00078"></a>00078 <span class="stringliteral">                                if($image_queue_list[$specimen_pid][$image_id][&#39;locked_session&#39;]==$session_id &amp;&amp; $image_queue_list[$specimen_pid][$image_id][&#39;workflow_status&#39;]==&quot;</span>queued<span class="stringliteral">&quot;){</span>
<a name="l00079"></a>00079 <span class="stringliteral">                                        $returnHTML .= $tempHTML;</span>
<a name="l00080"></a>00080 <span class="stringliteral">                                        $showAll = true;</span>
<a name="l00081"></a>00081 <span class="stringliteral">                                        $spHTMLDisplayed = true;</span>
<a name="l00082"></a>00082 <span class="stringliteral">                                }</span>
<a name="l00083"></a>00083 <span class="stringliteral">                                foreach($rois as $roi_pid =&gt; $status){</span>
<a name="l00084"></a>00084 <span class="stringliteral">                                        $roi_id = str_replace(&quot;</span>:<span class="stringliteral">&quot;,&quot;</span>_<span class="stringliteral">&quot;,$roi_pid);</span>
<a name="l00085"></a>00085 <span class="stringliteral">                                        if($showAll || ($roi_queue_list[$specimen_pid][$image_id][$roi_pid][&#39;workflow_status&#39;] == &quot;</span>queued<span class="stringliteral">&quot; &amp;&amp; $image_queue_list[$specimen_pid][$image_id][$roi_pid][&#39;locked_session&#39;]==$session_id)){</span>
<a name="l00086"></a>00086 <span class="stringliteral">                                                if(!$spHTMLDisplayed){</span>
<a name="l00087"></a>00087 <span class="stringliteral">                                                        $returnHTML .= $tempHTML;</span>
<a name="l00088"></a>00088 <span class="stringliteral">                                                        $spHTMLDisplayed = true;</span>
<a name="l00089"></a>00089 <span class="stringliteral">                                                }</span>
<a name="l00090"></a>00090 <span class="stringliteral">                                                $returnHTML .= &#39;&lt;div class=&quot;</span>widget-subheader<span class="stringliteral">&quot;&gt;</span>
<a name="l00091"></a>00091 <span class="stringliteral">                                            &lt;div class=&quot;</span>roi_name<span class="stringliteral">&quot;&gt;ROI Name -&#39;.$roi_pid.&#39; &lt;span class=&quot;</span>roi_status<span class="stringliteral">&quot; id=&quot;</span><span class="stringliteral">&#39;. $specimen_id.&#39;</span>_<span class="stringliteral">&#39; . $roi_id .&#39;</span><span class="stringliteral">&quot;&gt;[&#39;.$status[&quot;</span><a class="code" href="workspace_8functions_8php.html#a4fd3cbdcf1282bd92e9609b5de35863c">workflow_status</a><span class="stringliteral">&quot;].&#39;]&lt;/span&gt;&lt;/div&gt;</span>
<a name="l00092"></a>00092 <span class="stringliteral">                                        &lt;/div&gt;</span>
<a name="l00093"></a>00093 <span class="stringliteral">                                        &lt;div class=&quot;</span>widget-subcontent<span class="stringliteral">&quot;&gt;</span>
<a name="l00094"></a>00094 <span class="stringliteral">                                            &lt;div class=&quot;</span>transcribe_link<span class="stringliteral">&quot;&gt;&lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;Transcribe&lt;/a&gt; - &lt;span id=&quot;</span>roi_001_transcribe_status<span class="stringliteral">&quot;&gt;&#39;.$status[&quot;</span>transcribedStatus<span class="stringliteral">&quot;].&#39;&lt;/span&gt;&lt;/div&gt;</span>
<a name="l00095"></a>00095 <span class="stringliteral">                                            &lt;div class=&quot;</span>parse_link<span class="stringliteral">&quot;&gt;&lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;Parse&lt;/a&gt; - &lt;span id=&quot;</span>roi_001_parse_status<span class="stringliteral">&quot;&gt;&#39;.$status[&quot;</span>parsedL1Status<span class="stringliteral">&quot;].&#39;&lt;/span&gt;&lt;/div&gt;</span>
<a name="l00096"></a>00096 <span class="stringliteral">                                        &lt;/div&gt;&#39;;</span>
<a name="l00097"></a>00097 <span class="stringliteral">                                        }</span>
<a name="l00098"></a>00098 <span class="stringliteral">                                }</span>
<a name="l00099"></a>00099 <span class="stringliteral">                        }</span>
<a name="l00100"></a>00100 <span class="stringliteral">                }</span>
<a name="l00101"></a>00101 <span class="stringliteral">                $returnHTML .= &#39;&lt;/div&gt;&lt;!-- widget-content --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00102"></a>00102 <span class="stringliteral">        }</span>
<a name="l00103"></a>00103 <span class="stringliteral">        echo $returnHTML;</span>
<a name="l00104"></a>00104 <span class="stringliteral">}</span>
<a name="l00105"></a>00105 <span class="stringliteral"></span>
<a name="l00106"></a><a class="code" href="analyze_8functions_8php.html#afa0647e1c898c93547dcb3f7b7d8ceda">00106</a> <span class="stringliteral">function get_queue_list($workflow_id){</span>
<a name="l00107"></a>00107 <span class="stringliteral">        global $user;</span>
<a name="l00108"></a>00108 <span class="stringliteral">        $returnHTML = &quot;</span><span class="stringliteral">&quot;;</span>
<a name="l00109"></a>00109 <span class="stringliteral">        if(Workflow_Users::doesWorkflowHaveUserName($workflow_id, $user-&gt;name) &amp;&amp; Workflow_Permission::doesWorkflowHavePermission($workflow_id, &quot;</span>canAnalyzeSpecimen<span class="stringliteral">&quot;)){</span>
<a name="l00110"></a>00110 <span class="stringliteral">                $wf = new Workflow($workflow_id, true);</span>
<a name="l00111"></a>00111 <span class="stringliteral">                $wf-&gt;loadWorkflowPools();</span>
<a name="l00112"></a>00112 <span class="stringliteral">                $wDom = $wf-&gt;workflow_dom;</span>
<a name="l00113"></a>00113 <span class="stringliteral">                $wDom = new DOMXPath($wDom);$i=0;</span>
<a name="l00114"></a>00114 <span class="stringliteral">                $specimens = $wDom-&gt;query(&quot;</span><span class="comment">//workflow/specimen&quot;);</span>
<a name="l00115"></a>00115                 <span class="keywordflow">foreach</span> ($specimens as $specimen){
<a name="l00116"></a>00116                         $sp_temp = $wDom-&gt;query(<span class="stringliteral">&quot;//workflow/specimen/pid&quot;</span>);
<a name="l00117"></a>00117                         $specimen_pid = $sp_temp-&gt;item($i++)-&gt;nodeValue;
<a name="l00118"></a>00118                         $images = $wDom-&gt;query(<span class="stringliteral">&quot;//workflow/specimen[pid=&#39;$specimen_pid&#39;]/image&quot;</span>);
<a name="l00119"></a>00119                         $j = 0;
<a name="l00120"></a>00120                         <span class="keywordflow">foreach</span>($images as $image){
<a name="l00121"></a>00121                                 $img_temp = $wDom-&gt;query(<span class="stringliteral">&quot;//workflow/specimen[pid=&#39;$specimen_pid&#39;]/image/pid&quot;</span>);
<a name="l00122"></a>00122                                 $image_pid = $img_temp-&gt;item($j++)-&gt;nodeValue;
<a name="l00123"></a>00123                                 $rois = $wDom-&gt;query(<span class="stringliteral">&quot;//workflow/specimen[pid=&#39;$specimen_pid&#39;]/image[pid=&#39;$image_pid&#39;]/roi&quot;</span>);
<a name="l00124"></a>00124                                 <span class="keywordflow">if</span>(!empty($image-&gt;getElementsByTagName(<span class="stringliteral">&#39;analyzedStatus&#39;</span>)-&gt;item(0)-&gt;nodeValue))
<a name="l00125"></a>00125                                         $image_queue_list[$specimen_pid][$image_pid][<span class="stringliteral">&quot;analyzedStatus&quot;</span>] = $image-&gt;getElementsByTagName(<span class="stringliteral">&#39;analyzedStatus&#39;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00126"></a>00126                                 <span class="keywordflow">else</span>
<a name="l00127"></a>00127                                         $image_queue_list[$specimen_pid][$image_pid][<span class="stringliteral">&quot;analyzedStatus&quot;</span>] = <span class="stringliteral">&quot;undefined&quot;</span>;
<a name="l00128"></a>00128                                 $image_queue_list[$specimen_pid][$image_pid][<span class="stringliteral">&quot;workflow_status&quot;</span>] = $image-&gt;getElementsByTagName(<span class="stringliteral">&#39;workflow_status&#39;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00129"></a>00129                                 $image_queue_list[$specimen_pid][$image_pid][<span class="stringliteral">&quot;locked_session&quot;</span>] = $image-&gt;getElementsByTagName(<span class="stringliteral">&#39;locked_session&#39;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00130"></a>00130                                 $k = 0;$roi_count=0;
<a name="l00131"></a>00131                                 $total_rois = $rois-&gt;length;
<a name="l00132"></a>00132                                 $roi_counts[$specimen_pid][<span class="stringliteral">&quot;total_rois&quot;</span>] = $total_rois;
<a name="l00133"></a>00133                                 <span class="keywordflow">if</span>($total_rois == 0){
<a name="l00134"></a>00134                                         $roi_queue_list[$specimen_pid][$image_pid] = $image_pid;
<a name="l00135"></a>00135                                 }
<a name="l00136"></a>00136                                 <span class="keywordflow">foreach</span>($rois as $roi){
<a name="l00137"></a>00137                                         $roi_temp = $wDom-&gt;query(<span class="stringliteral">&quot;//workflow/specimen[pid=&#39;$specimen_pid&#39;]/image[pid=&#39;$image_pid&#39;]/roi/pid&quot;</span>);
<a name="l00138"></a>00138                                         $roi_pid = $roi_temp-&gt;item($k++)-&gt;nodeValue;
<a name="l00139"></a>00139                                         $queue_list[$specimen_pid][$image_pid][] = $roi_pid;
<a name="l00140"></a>00140                                         $roi_queue_list[$specimen_pid][$image_pid][$roi_pid][<span class="stringliteral">&quot;locked_session&quot;</span>] = $roi-&gt;getElementsByTagName(<span class="stringliteral">&#39;locked_session&#39;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00141"></a>00141                                         <span class="keywordflow">if</span>(!empty($roi-&gt;getElementsByTagName(<span class="stringliteral">&#39;workflow_status&#39;</span>)-&gt;item(0)-&gt;nodeValue))
<a name="l00142"></a>00142                                                 $roi_queue_list[$specimen_pid][$image_pid][$roi_pid][<span class="stringliteral">&quot;workflow_status&quot;</span>] = $roi-&gt;getElementsByTagName(<span class="stringliteral">&#39;workflow_status&#39;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00143"></a>00143                                         <span class="keywordflow">else</span>
<a name="l00144"></a>00144                                                 $roi_queue_list[$specimen_pid][$image_pid][$roi_pid][<span class="stringliteral">&quot;workflow_status&quot;</span>] = <span class="stringliteral">&quot;undefined&quot;</span>;
<a name="l00145"></a>00145                                         <span class="keywordflow">if</span>(!empty($roi-&gt;getElementsByTagName(<span class="stringliteral">&#39;transcribedStatus&#39;</span>)-&gt;item(0)-&gt;nodeValue))
<a name="l00146"></a>00146                                                 $roi_queue_list[$specimen_pid][$image_pid][$roi_pid][<span class="stringliteral">&quot;transcribedStatus&quot;</span>] = $roi-&gt;getElementsByTagName(<span class="stringliteral">&#39;transcribedStatus&#39;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00147"></a>00147                                         <span class="keywordflow">else</span>
<a name="l00148"></a>00148                                                 $roi_queue_list[$specimen_pid][$image_pid][$roi_pid][<span class="stringliteral">&quot;transcribedStatus&quot;</span>] = <span class="stringliteral">&quot;undefined&quot;</span>;
<a name="l00149"></a>00149                                         <span class="keywordflow">if</span>(!empty($roi-&gt;getElementsByTagName(<span class="stringliteral">&#39;transcribedStatus&#39;</span>)-&gt;item(0)-&gt;nodeValue))
<a name="l00150"></a>00150                                                 $roi_queue_list[$specimen_pid][$image_pid][$roi_pid][<span class="stringliteral">&quot;parsedL1Status&quot;</span>] = $roi-&gt;getElementsByTagName(<span class="stringliteral">&#39;parsedL1Status&#39;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00151"></a>00151                                         <span class="keywordflow">else</span>
<a name="l00152"></a>00152                                                 $roi_queue_list[$specimen_pid][$image_pid][$roi_pid][<span class="stringliteral">&quot;parsedL1Status&quot;</span>] = <span class="stringliteral">&quot;undefined&quot;</span>;
<a name="l00153"></a>00153                                 }
<a name="l00154"></a>00154                         }
<a name="l00155"></a>00155                 }
<a name="l00156"></a>00156                 <span class="keywordflow">return</span> array($roi_queue_list, $image_queue_list, $roi_counts);
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159
<a name="l00160"></a><a class="code" href="analyze_8functions_8php.html#a5dd4d25616cb603dea2f5214f643bfb0">00160</a> function <a class="code" href="analyze_8functions_8php.html#a5dd4d25616cb603dea2f5214f643bfb0">getImageROIList</a>($image_pid, $nothing, $workflow_id){
<a name="l00161"></a>00161         global <a class="code" href="apiary__project_8php.html#a00365e6c5f70c43fb2ed86c9bc5626e0">$user</a>;
<a name="l00162"></a>00162         $returnHTML = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00163"></a>00163         <span class="keywordflow">if</span>(Workflow_Users::doesWorkflowHaveUserName($workflow_id, $user-&gt;name) &amp;&amp; Workflow_Permission::doesWorkflowHavePermission($workflow_id, <span class="stringliteral">&quot;canAnalyzeSpecimen&quot;</span>)){
<a name="l00164"></a>00164                 $roi_pids = AP_Image::getROIListForImage($image_pid);
<a name="l00165"></a>00165                 <span class="keywordflow">foreach</span>($roi_pids as $roi_pid){
<a name="l00166"></a>00166                         $roiMetadata_record = AP_ROI::getroiMetadata_record($roi_pid);
<a name="l00167"></a>00167                         $roiURL = $roiMetadata_record[<span class="stringliteral">&#39;roiURL&#39;</span>];
<a name="l00168"></a>00168                         $changedHeight = <a class="code" href="analyze_8functions_8php.html#ad640cacecc876546bdb4ed01084708aa">thumbHeightReset</a>($roiMetadata_record[<span class="charliteral">&#39;h&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;w&#39;</span>]);
<a name="l00169"></a>00169                         <span class="keywordflow">if</span>(!$changedHeight) {
<a name="l00170"></a>00170                           <span class="keywordflow">if</span>(strpos($roiURL, <span class="stringliteral">&#39;rft_id&#39;</span>) &gt; -1) {
<a name="l00171"></a>00171                             $roi_thumb_url = scaleDjatokaURL($roiURL, <span class="stringliteral">&#39;78&#39;</span>, <span class="charliteral">&#39;0&#39;</span>);
<a name="l00172"></a>00172                           }
<a name="l00173"></a>00173                           <span class="keywordflow">else</span> {
<a name="l00174"></a>00174                             $roi_thumb_url = getDjatokaURL($roiMetadata_record[<span class="stringliteral">&#39;sourceURL&#39;</span>], <span class="stringliteral">&#39;getRegion&#39;</span>, <span class="stringliteral">&#39;100&#39;</span>, $roiMetadata_record[<span class="charliteral">&#39;y&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;x&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;h&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;w&#39;</span>], <span class="stringliteral">&#39;78&#39;</span>, <span class="charliteral">&#39;0&#39;</span>);
<a name="l00175"></a>00175                           }
<a name="l00176"></a>00176                         }
<a name="l00177"></a>00177                         <span class="keywordflow">else</span> {
<a name="l00178"></a>00178                           <span class="keywordflow">if</span>(strpos($roiURL, <span class="stringliteral">&#39;rft_id&#39;</span>) &gt; -1) {
<a name="l00179"></a>00179                             $next_amp = strpos($roiURL, <span class="charliteral">&#39;&amp;&#39;</span>, strpos($roiURL, <span class="stringliteral">&#39;rft_id&#39;</span>));
<a name="l00180"></a>00180                             $rft_id = substr($roiURL, (strpos($roiURL, <span class="stringliteral">&#39;rft_id&#39;</span>)+strlen(<span class="stringliteral">&#39;rft_id&#39;</span>)+1), ($next_amp - (strpos($roiURL, <span class="stringliteral">&#39;rft_id&#39;</span>)+strlen(<span class="stringliteral">&#39;rft_id&#39;</span>)+1)));
<a name="l00181"></a>00181                             $roi_thumb_url = getDjatokaURL($rft_id, <span class="stringliteral">&#39;getRegion&#39;</span>, <span class="stringliteral">&#39;100&#39;</span>, $roiMetadata_record[<span class="charliteral">&#39;y&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;x&#39;</span>], $changedHeight , $roiMetadata_record[<span class="charliteral">&#39;w&#39;</span>], <span class="stringliteral">&#39;78&#39;</span>, <span class="charliteral">&#39;0&#39;</span>);
<a name="l00182"></a>00182                           }
<a name="l00183"></a>00183                           <span class="keywordflow">else</span> {
<a name="l00184"></a>00184                             $roi_thumb_url = getDjatokaURL($roiMetadata_record[<span class="stringliteral">&#39;sourceURL&#39;</span>], <span class="stringliteral">&#39;getRegion&#39;</span>, <span class="stringliteral">&#39;100&#39;</span>, $roiMetadata_record[<span class="charliteral">&#39;y&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;x&#39;</span>], $changedHeight , $roiMetadata_record[<span class="charliteral">&#39;w&#39;</span>], <span class="stringliteral">&#39;78&#39;</span>, <span class="charliteral">&#39;0&#39;</span>);
<a name="l00185"></a>00185                           }
<a name="l00186"></a>00186                     }
<a name="l00187"></a>00187                         $status_dom = AP_ROI::getROIStatusDom($roi_pid);
<a name="l00188"></a>00188                         $transcribed_status = $status_dom-&gt;getElementsByTagName(<span class="stringliteral">&quot;transcribedStatus&quot;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00189"></a>00189                         $parsed_status = $status_dom-&gt;getElementsByTagName(<span class="stringliteral">&quot;parsedL1Status&quot;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00190"></a>00190                         <span class="keywordflow">if</span>($transcribed_status == <span class="stringliteral">&quot;&quot;</span>)
<a name="l00191"></a>00191                                 $transcribed_status = <span class="stringliteral">&quot;Undefined&quot;</span>;
<a name="l00192"></a>00192                         <span class="keywordflow">if</span>($parsed_status == <span class="stringliteral">&quot;&quot;</span>)
<a name="l00193"></a>00193                                 $parsed_status = <span class="stringliteral">&quot;Undefined&quot;</span>;
<a name="l00194"></a>00194                         $returnHTML .= <a class="code" href="analyze_8functions_8php.html#aa7f7268265f4049f5877aea14e6e1640">generate_roi_html</a>($roi_pid, $roi_thumb_url, $roiMetadata_record, $transcribed_status, $parsed_status, $workflow_id);
<a name="l00195"></a>00195                 }
<a name="l00196"></a>00196         }
<a name="l00197"></a>00197         <span class="keywordflow">else</span>{
<a name="l00198"></a>00198                 <span class="comment">//http_send_status(401);</span>
<a name="l00199"></a>00199                 $returnHTML = <span class="stringliteral">&quot;You do not have sufficient permission&quot;</span>;
<a name="l00200"></a>00200         }
<a name="l00201"></a>00201         echo $returnHTML;
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203
<a name="l00204"></a><a class="code" href="analyze_8functions_8php.html#a6e2ed9556330362fb26ad4654e83f932">00204</a> function <a class="code" href="analyze_8functions_8php.html#a6e2ed9556330362fb26ad4654e83f932">getSpecimenROIList</a>($specimen_pid, $workflow_id, $nothing){
<a name="l00205"></a>00205         global <a class="code" href="apiary__project_8php.html#a00365e6c5f70c43fb2ed86c9bc5626e0">$user</a>;
<a name="l00206"></a>00206         $returnHTML = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00207"></a>00207         <span class="keywordflow">if</span>(Workflow_Users::doesWorkflowHaveUserName($workflow_id, $user-&gt;name) &amp;&amp; Workflow_Permission::doesWorkflowHavePermission($workflow_id, <span class="stringliteral">&quot;canAnalyzeSpecimen&quot;</span>)){
<a name="l00208"></a>00208                 $image_pids = AP_Specimen::getImageListForSpecimen($specimen_pid);
<a name="l00209"></a>00209                 $roi_pids = AP_Image::getROIListForImage($image_pids[0]);
<a name="l00210"></a>00210                 <span class="keywordflow">foreach</span>($roi_pids as $roi_pid){
<a name="l00211"></a>00211                         $roiMetadata_record = AP_ROI::getroiMetadata_record($roi_pid);
<a name="l00212"></a>00212                         $changedHeight = <a class="code" href="analyze_8functions_8php.html#ad640cacecc876546bdb4ed01084708aa">thumbHeightReset</a>($roiMetadata_record[<span class="charliteral">&#39;h&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;w&#39;</span>]);
<a name="l00213"></a>00213                         <span class="keywordflow">if</span>(!$changedHeight)
<a name="l00214"></a>00214                                 $roi_thumb_url = getDjatokaURL($roiMetadata_record[<span class="stringliteral">&#39;sourceURL&#39;</span>], <span class="stringliteral">&#39;getRegion&#39;</span>, <span class="stringliteral">&#39;100&#39;</span>, $roiMetadata_record[<span class="charliteral">&#39;y&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;x&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;h&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;w&#39;</span>], <span class="stringliteral">&#39;78&#39;</span>, <span class="charliteral">&#39;0&#39;</span>);
<a name="l00215"></a>00215                         <span class="keywordflow">else</span>
<a name="l00216"></a>00216                                 $roi_thumb_url = getDjatokaURL($roiMetadata_record[<span class="stringliteral">&#39;sourceURL&#39;</span>], <span class="stringliteral">&#39;getRegion&#39;</span>, <span class="stringliteral">&#39;100&#39;</span>, $roiMetadata_record[<span class="charliteral">&#39;y&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;x&#39;</span>], $changedHeight , $roiMetadata_record[<span class="charliteral">&#39;w&#39;</span>], <span class="stringliteral">&#39;78&#39;</span>, <span class="charliteral">&#39;0&#39;</span>);
<a name="l00217"></a>00217                         $status_dom = AP_ROI::getROIStatusDom($roi_pid);
<a name="l00218"></a>00218                         $transcribed_status = $status_dom-&gt;getElementsByTagName(<span class="stringliteral">&quot;transcribedStatus&quot;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00219"></a>00219                         $parsed_status = $status_dom-&gt;getElementsByTagName(<span class="stringliteral">&quot;parsedL1Status&quot;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00220"></a>00220                         <span class="keywordflow">if</span>($transcribed_status == <span class="stringliteral">&quot;&quot;</span>)
<a name="l00221"></a>00221                                 $transcribed_status = <span class="stringliteral">&quot;Undefined&quot;</span>;
<a name="l00222"></a>00222                         <span class="keywordflow">if</span>($parsed_status == <span class="stringliteral">&quot;&quot;</span>)
<a name="l00223"></a>00223                                 $parsed_status = <span class="stringliteral">&quot;Undefined&quot;</span>;
<a name="l00224"></a>00224                         $returnHTML .= <a class="code" href="analyze_8functions_8php.html#aa7f7268265f4049f5877aea14e6e1640">generate_roi_html</a>($roi_pid, $roi_thumb_url, $roiMetadata_record, $transcribed_status, $parsed_status, $workflow_id);
<a name="l00225"></a>00225                 }
<a name="l00226"></a>00226         }
<a name="l00227"></a>00227         <span class="keywordflow">else</span>{
<a name="l00228"></a>00228                 http_send_status(401);
<a name="l00229"></a>00229                 $returnHTML = <span class="stringliteral">&quot;You do not have sufficient permission&quot;</span>;
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231         echo $returnHTML;
<a name="l00232"></a>00232 }
<a name="l00233"></a>00233
<a name="l00234"></a><a class="code" href="analyze_8functions_8php.html#af0279594674a2ff529d0fe3bfa916a05">00234</a> function <a class="code" href="analyze_8functions_8php.html#af0279594674a2ff529d0fe3bfa916a05">get_roi_boxes</a>($image_pid, $nothing, $workflow_id){
<a name="l00235"></a>00235         global <a class="code" href="apiary__project_8php.html#a00365e6c5f70c43fb2ed86c9bc5626e0">$user</a>;
<a name="l00236"></a>00236         $returnBoxes = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00237"></a>00237         <span class="keywordflow">if</span>(Workflow_Users::doesWorkflowHaveUserName($workflow_id, $user-&gt;name) &amp;&amp; Workflow_Permission::doesWorkflowHavePermission($workflow_id, <span class="stringliteral">&quot;canAnalyzeSpecimen&quot;</span>)){
<a name="l00238"></a>00238                 $roi_pids = AP_Image::getROIListForImage($image_pid);
<a name="l00239"></a>00239                 <span class="keywordflow">foreach</span>($roi_pids as $roi_pid){
<a name="l00240"></a>00240                         $roiMetadata_record = AP_ROI::getroiMetadata_record($roi_pid);
<a name="l00241"></a>00241                         $returnBoxes[] = array(<span class="stringliteral">&quot;y&quot;</span>=&gt;$roiMetadata_record[<span class="charliteral">&#39;y&#39;</span>], <span class="stringliteral">&quot;h&quot;</span>=&gt;$roiMetadata_record[<span class="charliteral">&#39;h&#39;</span>], <span class="stringliteral">&quot;x&quot;</span>=&gt;$roiMetadata_record[<span class="charliteral">&#39;x&#39;</span>], <span class="stringliteral">&quot;w&quot;</span>=&gt;$roiMetadata_record[<span class="charliteral">&#39;w&#39;</span>], <span class="stringliteral">&quot;type&quot;</span>=&gt;$roiMetadata_record[<span class="stringliteral">&#39;roiType&#39;</span>],<span class="stringliteral">&quot;pid&quot;</span>=&gt;$roi_pid);
<a name="l00242"></a>00242                 }
<a name="l00243"></a>00243                 echo json_encode($returnBoxes);
<a name="l00244"></a>00244         }
<a name="l00245"></a>00245         <span class="keywordflow">else</span>{
<a name="l00246"></a>00246                 http_send_status(401);
<a name="l00247"></a>00247                 echo <span class="stringliteral">&quot;You do not have sufficient permission&quot;</span>;
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249 }
<a name="l00250"></a>00250
<a name="l00251"></a><a class="code" href="analyze_8functions_8php.html#ac3ad306edba53178755f1e17ba3ef052">00251</a> function <a class="code" href="analyze_8functions_8php.html#ac3ad306edba53178755f1e17ba3ef052">remove_roi</a>($roi_pid, $nothing, $workflow_id){
<a name="l00252"></a>00252         global <a class="code" href="apiary__project_8php.html#a00365e6c5f70c43fb2ed86c9bc5626e0">$user</a>;
<a name="l00253"></a>00253         $returnjs = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00254"></a>00254         <span class="keywordflow">if</span>(Workflow_Users::doesWorkflowHaveUserName($workflow_id, $user-&gt;name) &amp;&amp; Workflow_Permission::doesWorkflowHavePermission($workflow_id, <span class="stringliteral">&quot;canAnalyzeSpecimen&quot;</span>)){
<a name="l00255"></a>00255                 $roi_obj = <span class="keyword">new</span> roiHandler($roi_pid);
<a name="l00256"></a>00256                 $success = $roi_obj-&gt;removeROI($roi_pid, FEDORA_DATABASE_USERNAME.<span class="stringliteral">&quot;:&quot;</span>.FEDORA_DATABASE_PASSWORD);
<a name="l00257"></a>00257                 <span class="keywordflow">if</span>($success)
<a name="l00258"></a>00258                 $returnjs .= <span class="stringliteral">&quot;jQuery.jGrowl(&#39;ROI [$roi_pid] deleted successfully&#39;);&quot;</span>;
<a name="l00259"></a>00259                 <span class="keywordflow">else</span>
<a name="l00260"></a>00260                 $returnjs .= <span class="stringliteral">&quot;jQuery.jGrowl(&#39;ROI [$roi_pid] failed to delete&#39;);&quot;</span>;
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262         <span class="keywordflow">else</span>{
<a name="l00263"></a>00263                 $returnjs .= <span class="stringliteral">&quot;jQuery.jGrowl(&#39;Sorry! You do not have permission for this operation&#39;);&quot;</span>;
<a name="l00264"></a>00264         }
<a name="l00265"></a>00265         echo $returnjs;
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267
<a name="l00268"></a><a class="code" href="analyze_8functions_8php.html#a82d69f9619642c6bb08dc1d7ea672027">00268</a> function <a class="code" href="analyze_8functions_8php.html#a82d69f9619642c6bb08dc1d7ea672027">create_roi</a>($image_pid, $options, $workflow_id){
<a name="l00269"></a>00269         global <a class="code" href="apiary__project_8php.html#a00365e6c5f70c43fb2ed86c9bc5626e0">$user</a>;
<a name="l00270"></a>00270
<a name="l00271"></a>00271         <span class="keywordflow">if</span>(Workflow_Users::doesWorkflowHaveUserName($workflow_id, $user-&gt;name) &amp;&amp; Workflow_Permission::doesWorkflowHavePermission($workflow_id, <span class="stringliteral">&quot;canAnalyzeSpecimen&quot;</span>)){
<a name="l00272"></a>00272                 global $base_url;
<a name="l00273"></a>00273                 list($true_y1, $true_x1, $true_height, $true_width, $roi_type) = explode(<span class="stringliteral">&quot;:&quot;</span>,$options);
<a name="l00274"></a>00274                 <span class="keywordflow">if</span>($roi_type==<span class="stringliteral">&quot;Annotation&quot;</span>)
<a name="l00275"></a>00275                         $roi_type = <span class="stringliteral">&quot;Annotation/Other&quot;</span>;
<a name="l00276"></a>00276                 $roiMetadata_base_url = $base_url;
<a name="l00277"></a>00277                 $imageMetadata_record = AP_Image::getimageMetadata_record($image_pid);
<a name="l00278"></a>00278                 $parent_image_height = $imageMetadata_record[<span class="stringliteral">&quot;h&quot;</span>];<span class="comment">//To Be Removed</span>
<a name="l00279"></a>00279                 $parent_image_width = $imageMetadata_record[<span class="stringliteral">&quot;w&quot;</span>];<span class="comment">//To Be Removed</span>
<a name="l00280"></a>00280                 $sourceURL = $imageMetadata_record[<span class="stringliteral">&#39;URL&#39;</span>];<span class="comment">//To Be Removed//The ROI sourceURL is the ap-image URL</span>
<a name="l00281"></a>00281                 $parent_image_display_width = 650;<span class="comment">//To Be Removed</span>
<a name="l00282"></a>00282                 $parent_image_display_height = ($parent_image_height*$parent_image_display_width)/$parent_image_width;<span class="comment">//To Be Removed</span>
<a name="l00283"></a>00283                 $rft_id = $imageMetadata_record[<span class="stringliteral">&#39;rft_id&#39;</span>];
<a name="l00284"></a>00284                 $roiURL = getDjatokaURL($rft_id, <span class="stringliteral">&#39;getRegion&#39;</span>, <span class="stringliteral">&#39;100&#39;</span>, $true_y1, $true_x1, $true_height, $true_width, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>);
<a name="l00285"></a>00285                 $new_roi = <span class="keyword">new</span> AP_ROI();
<a name="l00286"></a>00286                 $new_roi-&gt;roiMetadata_base_url = $roiMetadata_base_url;
<a name="l00287"></a>00287                 $status = $new_roi-&gt;createROIObject($image_pid, $sourceURL, $roiURL, $roi_type, $true_x1, $true_y1, $true_width, $true_height, $parent_image_width, $parent_image_height, $parent_image_display_width, $parent_image_display_height, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00288"></a>00288                 $roi_pid = $new_roi-&gt;pid;
<a name="l00289"></a>00289                 $roiMetadata_record = AP_ROI::getroiMetadata_record($roi_pid);
<a name="l00290"></a>00290                 $changedHeight = <a class="code" href="analyze_8functions_8php.html#ad640cacecc876546bdb4ed01084708aa">thumbHeightReset</a>($roiMetadata_record[<span class="charliteral">&#39;h&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;w&#39;</span>]);
<a name="l00291"></a>00291                 <span class="keywordflow">if</span>(!$changedHeight)
<a name="l00292"></a>00292                         $roi_thumb_url = getDjatokaURL($roiMetadata_record[<span class="stringliteral">&#39;sourceURL&#39;</span>], <span class="stringliteral">&#39;getRegion&#39;</span>, <span class="stringliteral">&#39;100&#39;</span>, $roiMetadata_record[<span class="charliteral">&#39;y&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;x&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;h&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;w&#39;</span>], <span class="stringliteral">&#39;78&#39;</span>, <span class="charliteral">&#39;0&#39;</span>);
<a name="l00293"></a>00293                 <span class="keywordflow">else</span>
<a name="l00294"></a>00294                         $roi_thumb_url = getDjatokaURL($roiMetadata_record[<span class="stringliteral">&#39;sourceURL&#39;</span>], <span class="stringliteral">&#39;getRegion&#39;</span>, <span class="stringliteral">&#39;100&#39;</span>, $roiMetadata_record[<span class="charliteral">&#39;y&#39;</span>], $roiMetadata_record[<span class="charliteral">&#39;x&#39;</span>], $changedHeight , $roiMetadata_record[<span class="charliteral">&#39;w&#39;</span>], <span class="stringliteral">&#39;78&#39;</span>, <span class="charliteral">&#39;0&#39;</span>);
<a name="l00295"></a>00295                 $status_dom = AP_ROI::getROIStatusDom($roi_pid);
<a name="l00296"></a>00296                 $transcribed_status = $status_dom-&gt;getElementsByTagName(<span class="stringliteral">&quot;transcribedStatus&quot;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00297"></a>00297                 $parsed_status = $status_dom-&gt;getElementsByTagName(<span class="stringliteral">&quot;parsedL1Status&quot;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00298"></a>00298                 <span class="keywordflow">if</span>($transcribed_status == <span class="stringliteral">&quot;&quot;</span>)
<a name="l00299"></a>00299                         $transcribed_status = <span class="stringliteral">&quot;Undefined&quot;</span>;
<a name="l00300"></a>00300                 <span class="keywordflow">if</span>($parsed_status == <span class="stringliteral">&quot;&quot;</span>)
<a name="l00301"></a>00301                         $parsed_status = <span class="stringliteral">&quot;Undefined&quot;</span>;
<a name="l00302"></a>00302                 $html = <a class="code" href="analyze_8functions_8php.html#aa7f7268265f4049f5877aea14e6e1640">generate_roi_html</a>($roi_pid, $roi_thumb_url, $roiMetadata_record, $transcribed_status, $parsed_status, $workflow_id);
<a name="l00303"></a>00303                 $returnHTML[<span class="stringliteral">&#39;html&#39;</span>] = $html;
<a name="l00304"></a>00304                 $returnHTML[<span class="stringliteral">&#39;pid&#39;</span>] = $roi_pid;
<a name="l00305"></a>00305                 $returnHTML[<span class="stringliteral">&#39;roi_queue_html&#39;</span>] = <a class="code" href="analyze_8functions_8php.html#a42cc21dd56bf989bad557ca72edef3fc">add_roi_to_queue</a>($image_pid, $roi_pid, $workflow_id);
<a name="l00306"></a>00306                 <span class="keywordflow">if</span>($status == <span class="keyword">true</span>){
<a name="l00307"></a>00307                         <span class="comment">//Echo JQuery function to add HTML for new ROI</span>
<a name="l00308"></a>00308                 }
<a name="l00309"></a>00309         }
<a name="l00310"></a>00310         <span class="keywordflow">else</span>{
<a name="l00311"></a>00311                 header(<span class="stringliteral">&#39;HTTP/1.1 401 Unauthorized&#39;</span>);
<a name="l00312"></a>00312                 $returnHTML .= <span class="stringliteral">&quot;Sorry! You do not have permission for this operation&quot;</span>;
<a name="l00313"></a>00313         }
<a name="l00314"></a>00314         echo json_encode($returnHTML);
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316
<a name="l00317"></a><a class="code" href="analyze_8functions_8php.html#aa7f7268265f4049f5877aea14e6e1640">00317</a> function <a class="code" href="analyze_8functions_8php.html#aa7f7268265f4049f5877aea14e6e1640">generate_roi_html</a>($roi_pid, $roi_thumb_url, $roiMetadata_record, $transcribe_status, $parsed_status, $workflow_id=null){
<a name="l00318"></a>00318         $permission_map = <a class="code" href="analyze_8functions_8php.html#ad3ad3c24ee1cf11791c0370dba068f3d">get_permission_map</a>($workflow_id);
<a name="l00319"></a>00319         $roi_pid_replacement = str_replace(<span class="stringliteral">&quot;:&quot;</span>, <span class="stringliteral">&quot;_&quot;</span>, $roi_pid);
<a name="l00320"></a>00320         $html = <span class="stringliteral">&#39;&lt;div class=&quot;roi-section&quot; id=&quot;&#39;</span>.$roi_pid.<span class="stringliteral">&#39;-section&quot; &gt;</span>
<a name="l00321"></a>00321 <span class="stringliteral">                                                &lt;div class=&quot;roi-preview&quot; id=&quot;&#39;</span>.$roi_pid.<span class="stringliteral">&#39;-preview&quot;&gt;</span>
<a name="l00322"></a>00322 <span class="stringliteral">                                                        &lt;img src=&quot;&#39;</span>. $roi_thumb_url .<span class="stringliteral">&#39;&quot; /&gt;</span>
<a name="l00323"></a>00323 <span class="stringliteral">                                                &lt;/div&gt;</span>
<a name="l00324"></a>00324 <span class="stringliteral">                                                &lt;div class=&quot;roi-controls&quot; id=&quot;&#39;</span>.$roi_pid.<span class="stringliteral">&#39;-controls&quot;&gt;</span>
<a name="l00325"></a>00325 <span class="stringliteral">                                                        ROI Type:&lt;span class=&quot;roi-type&quot; id=&quot;&#39;</span>.$roi_pid_replacement.<span class="stringliteral">&#39;-type&quot;&gt;&#39;</span>.$roiMetadata_record[<span class="stringliteral">&quot;roiType&quot;</span>].<span class="stringliteral">&#39;&lt;/span&gt;</span>
<a name="l00326"></a>00326 <span class="stringliteral">                                                        &lt;a id=&quot;roi-type-edit-&#39;</span>.$roi_pid.<span class="stringliteral">&#39;&quot; href=&quot;javascript:editROIType(\&#39;&#39;</span>.$roi_pid.<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&gt;Edit&lt;/a&gt;&lt;br/&gt;&#39;;</span>
<a name="l00327"></a>00327 <span class="stringliteral">    if ( $permission_map[&#39;canTranscribe&#39;] )                                                     </span>
<a name="l00328"></a>00328 <span class="stringliteral">        $html .= &#39;&lt;a href=&quot;</span>#<span class="stringliteral">&quot; onclick=&quot;</span>transcribe_roi(\<span class="stringliteral">&#39;&#39;</span>.$roi_pid.<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&gt;Transcription:&lt;/a&gt;&#39;;</span>
<a name="l00329"></a>00329 <span class="stringliteral">    else</span>
<a name="l00330"></a>00330 <span class="stringliteral">        $html .= &#39;Transcription:&#39;;</span>
<a name="l00331"></a>00331 <span class="stringliteral">    $html .= &#39;&lt;span class=&quot;</span>roi-transcription-status<span class="stringliteral">&quot; id=&quot;</span><span class="stringliteral">&#39;.$roi_pid.&#39;</span>-transcription-status<span class="stringliteral">&quot;&gt;&#39;.$transcribe_status.&#39;&lt;/span&gt;&lt;br/&gt;&#39;;</span>
<a name="l00332"></a>00332 <span class="stringliteral">    if ( $permission_map[&#39;canParseL1&#39;] || $permission_map[&#39;canParseL2&#39;] || $permission_map[&#39;canParseL3&#39;] )                                                      </span>
<a name="l00333"></a>00333 <span class="stringliteral">        $html .= &#39;&lt;a href=&quot;</span>#<span class="stringliteral">&quot; onclick=&quot;</span>parse_roi(\<span class="stringliteral">&#39;&#39;</span>.$roi_pid.<span class="charliteral">&#39;\&#39;</span>, \<span class="stringliteral">&#39;1\&#39;);&quot;&gt;Parsing:&lt;/a&gt;&#39;</span>;
<a name="l00334"></a>00334     <span class="keywordflow">else</span>
<a name="l00335"></a>00335         $html .= <span class="stringliteral">&#39;Parsing:&#39;</span>;
<a name="l00336"></a>00336     $html .= <span class="stringliteral">&#39;&lt;span class=&quot;roi-parsing-status&quot; id=&quot;&#39;</span>.$roi_pid.<span class="stringliteral">&#39;parsing-status&quot;&gt;&#39;</span>.$parsed_status.<span class="stringliteral">&#39;&lt;/span&gt;</span>
<a name="l00337"></a>00337 <span class="stringliteral">                                                        &lt;div class=&quot;clearfix&quot;&gt;&lt;/div&gt;</span>
<a name="l00338"></a>00338 <span class="stringliteral">                                                        &lt;div class=&quot;floatleft&quot;&gt;&lt;a href=&quot;javascript:delete_roi(\&#39;&#39;</span>.$roi_pid.<span class="charliteral">&#39;\&#39;</span>)<span class="stringliteral">&quot; class=&quot;</span><span class="keyword">delete</span>-roi<span class="stringliteral">&quot; id=&quot;</span><span class="stringliteral">&#39;.$roi_pid.&#39;</span>-<span class="keyword">delete</span>-roi<span class="stringliteral">&quot;&gt;Delete ROI&lt;/a&gt;&lt;/div&gt;</span>
<a name="l00339"></a>00339 <span class="stringliteral">                                                &lt;/div&gt;</span>
<a name="l00340"></a>00340 <span class="stringliteral">                                                &lt;/div&gt;&#39;;</span>
<a name="l00341"></a>00341 <span class="stringliteral">        return $html;</span>
<a name="l00342"></a>00342 <span class="stringliteral">}</span>
<a name="l00343"></a>00343 <span class="stringliteral"></span>
<a name="l00344"></a><a class="code" href="analyze_8functions_8php.html#a017338342276e0f6727737108e7cee43">00344</a> <span class="stringliteral">function add_queue_roi_to_queue($image_pid, $roi_pid, $workflow_id) {</span>
<a name="l00345"></a>00345 <span class="stringliteral">        echo add_roi_to_queue($image_pid, $roi_pid, $workflow_id);</span>
<a name="l00346"></a>00346 <span class="stringliteral">}</span>
<a name="l00347"></a>00347 <span class="stringliteral"></span>
<a name="l00348"></a><a class="code" href="analyze_8functions_8php.html#a42cc21dd56bf989bad557ca72edef3fc">00348</a> <span class="stringliteral">function add_roi_to_queue($image_pid, $roi_pid, $workflow_id) {</span>
<a name="l00349"></a>00349 <span class="stringliteral">  $queue_item_html = &#39;&#39;;</span>
<a name="l00350"></a>00350 <span class="stringliteral">  $status_dom = AP_ROI::getROILock($roi_pid);</span>
<a name="l00351"></a>00351 <span class="stringliteral">  if($status_dom != false) {</span>
<a name="l00352"></a>00352 <span class="stringliteral">    $transcribedStatus = $status_dom-&gt;getElementsByTagName(&#39;transcribedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00353"></a>00353 <span class="stringliteral">    $parsedL1Status = $status_dom-&gt;getElementsByTagName(&#39;parsedL1Status&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00354"></a>00354 <span class="stringliteral">    $locked = $status_dom-&gt;getElementsByTagName(&#39;locked&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00355"></a>00355 <span class="stringliteral">    $locked_time = $status_dom-&gt;getElementsByTagName(&#39;locked_time&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00356"></a>00356 <span class="stringliteral">    $locked_session = $status_dom-&gt;getElementsByTagName(&#39;locked_session&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00357"></a>00357 <span class="stringliteral">    $workflow_status = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l00358"></a>00358 <span class="stringliteral">    $queue_item_html .= create_queue_list_roi($roi_pid, $image_pid, $transcribedStatus, $parsedL1Status, $locked_by, $workflow_status, $workflow_id);</span>
<a name="l00359"></a>00359 <span class="stringliteral">  }</span>
<a name="l00360"></a>00360 <span class="stringliteral">  else {</span>
<a name="l00361"></a>00361 <span class="stringliteral">    $queue_item_html = &quot;</span>locked<span class="stringliteral">&quot;;</span>
<a name="l00362"></a>00362 <span class="stringliteral">  }</span>
<a name="l00363"></a>00363 <span class="stringliteral">  return $queue_item_html;</span>
<a name="l00364"></a>00364 <span class="stringliteral">}</span>
<a name="l00365"></a>00365 <span class="stringliteral"></span>
<a name="l00366"></a><a class="code" href="analyze_8functions_8php.html#a734deca8701dbc178f8deab344dc6919">00366</a> <span class="stringliteral">function create_queue_list_image($image_pid, $specimen_pid, $analyzedStatus, $roi_count, $locked_by, $workflow_status,$workflow_id=null) {</span>
<a name="l00367"></a>00367 <span class="stringliteral">  if(empty($analyzedStatus)) {</span>
<a name="l00368"></a>00368 <span class="stringliteral">    $analyzedStatus = &#39;not started&#39;;</span>
<a name="l00369"></a>00369 <span class="stringliteral">  }</span>
<a name="l00370"></a>00370 <span class="stringliteral">  if($workflow_status == &quot;</span>queued<span class="stringliteral">&quot;) {</span>
<a name="l00371"></a>00371 <span class="stringliteral">        $queue_list_class = &#39;specimen_queued&#39;;</span>
<a name="l00372"></a>00372 <span class="stringliteral">  }</span>
<a name="l00373"></a>00373 <span class="stringliteral">  else if($workflow_status == &quot;</span>available<span class="stringliteral">&quot;) {</span>
<a name="l00374"></a>00374 <span class="stringliteral">        $queue_list_class = &#39;specimen_available&#39;;</span>
<a name="l00375"></a>00375 <span class="stringliteral">  }</span>
<a name="l00376"></a>00376 <span class="stringliteral">  else if($workflow_status == &quot;</span>locked<span class="stringliteral">&quot;) {</span>
<a name="l00377"></a>00377 <span class="stringliteral">        $queue_list_class = &#39;specimen_locked&#39;;</span>
<a name="l00378"></a>00378 <span class="stringliteral">  }</span>
<a name="l00379"></a>00379 <span class="stringliteral">  $permission_map = get_permission_map($workflow_id);</span>
<a name="l00380"></a>00380 <span class="stringliteral">  $image_id_url = get_djatoka_url_by_height($image_pid, &quot;</span>100<span class="stringliteral">&quot;);</span>
<a name="l00381"></a>00381 <span class="stringliteral">  $queue_list_image_html .= &#39;&lt;div class=&quot;</span>widget-header <span class="stringliteral">&#39;.$queue_list_class.&#39;</span><span class="stringliteral">&quot; id=&quot;</span><span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $image_pid).&#39;</span>_queue<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00382"></a>00382 <span class="stringliteral">  $queue_list_image_html .= &#39;&lt;div class=&quot;</span>widget-header-left<span class="stringliteral">&quot;  &#39;;</span>
<a name="l00383"></a>00383 <span class="stringliteral">  if ( $permission_map[&#39;canAnalyzeSpecimen&#39;] )</span>
<a name="l00384"></a>00384 <span class="stringliteral">      $queue_list_image_html .= &#39;onclick=&quot;</span>select_specimen(\<span class="stringliteral">&#39;&#39;</span>.$image_pid.<span class="charliteral">&#39;\&#39;</span>)<span class="stringliteral">&quot;&#39;;</span>
<a name="l00385"></a>00385 <span class="stringliteral">  $queue_list_image_html .= &#39;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00386"></a>00386 <span class="stringliteral">  $queue_list_image_html .= &#39;&lt;div class=&quot;</span>specimen_name<span class="stringliteral">&quot; image_pid=&quot;</span><span class="stringliteral">&#39;.$image_pid.&#39;</span><span class="stringliteral">&quot; image_id=&quot;</span><span class="stringliteral">&#39;.$image_id_url.&#39;</span><span class="stringliteral">&quot; specimen_pid=&quot;</span><span class="stringliteral">&#39;.$specimen_pid.&#39;</span><span class="stringliteral">&quot;&gt;Specimen: &#39;. str_replace(&#39;ap-specimen:&#39;, &#39;&#39;, $specimen_pid).&#39;&lt;span class=&quot;</span>specimen_status<span class="stringliteral">&quot;&gt; - &#39;.$analyzedStatus.&#39;&lt;/span&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00387"></a>00387 <span class="stringliteral">  //$queue_list_image_html .= &#39;&lt;div class=&quot;</span>specimen_header_detail<span class="stringliteral">&quot;&gt;Contains &lt;span id=&quot;</span>roi_count_<span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $image_pid).&#39;</span><span class="stringliteral">&quot;&gt;&#39;. $roi_count .&#39;&lt;/span&gt; ROIs - &lt;span class=&quot;</span>specimen_header_utility<span class="stringliteral">&quot;&gt;&lt;a href=&quot;</span>#<span class="stringliteral">&quot; onclick=&quot;</span>select_specimen(\<span class="stringliteral">&#39;&#39;</span>.$image_pid.<span class="charliteral">&#39;\&#39;</span>)<span class="stringliteral">&quot;&gt;analyze&lt;/a&gt; &lt;a href=&quot;</span>#<span class="stringliteral">&quot; onclick=&quot;</span>remove_specimen(\<span class="stringliteral">&#39;&#39;</span>.$image_pid.<span class="charliteral">&#39;\&#39;</span>)<span class="stringliteral">&quot;&gt;remove&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00388"></a>00388 <span class="stringliteral">  $queue_list_image_html .= &#39;&lt;div class=&quot;</span>specimen_header_detail<span class="stringliteral">&quot;&gt;Contains &lt;span id=&quot;</span>roi_count_<span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $image_pid).&#39;</span><span class="stringliteral">&quot;&gt;&#39;. $roi_count .&#39;&lt;/span&gt; ROIs - &lt;span class=&quot;</span>specimen_header_utility<span class="stringliteral">&quot;&gt;&#39;;</span>
<a name="l00389"></a>00389 <span class="stringliteral">  if ( $permission_map[&#39;canAnalyzeSpecimen&#39;] )</span>
<a name="l00390"></a>00390 <span class="stringliteral">      $queue_list_image_html .= &#39;&lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;analyze&lt;/a&gt;&#39;;</span>
<a name="l00391"></a>00391 <span class="stringliteral">  $queue_list_image_html .= &#39; &lt;/span&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00392"></a>00392 <span class="stringliteral">  $queue_list_image_html .= &#39;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00393"></a>00393 <span class="stringliteral">  $queue_list_image_html .= &#39;&lt;div class=&quot;</span>widget-header-right<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00394"></a>00394 <span class="stringliteral">  $queue_list_image_html .= &#39;&lt;div class=&quot;</span>widget-menu<span class="stringliteral">&quot; id=&quot;</span>menu-<span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $image_pid).&#39;</span><span class="stringliteral">&quot; onclick=&quot;</span>open_specimen_menu(\<span class="stringliteral">&#39;&#39;</span>.str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $image_pid).<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&gt;&lt;img src=&quot;</span>http:<span class="comment">//dev.apiaryproject.org/drupal/modules/apiary_project/workflow/assets/img/gear.png&quot;/&gt;&lt;/div&gt;&#39;.&quot;\n&quot;;</span>
<a name="l00395"></a>00395   $queue_list_image_html .= <span class="stringliteral">&#39;&lt;div class=&quot;widget-control&quot; id=&quot;control-&#39;</span>.str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $image_pid).<span class="stringliteral">&#39;&quot; onclick=&quot;toggle_specimen(\&#39;content-&#39;</span>.str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $image_pid).<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&gt;&lt;img src=&quot;</span>http:<span class="comment">//dev.apiaryproject.org/drupal/modules/apiary_project/workflow/assets/img/icon_closed.png&quot;/&gt;&lt;/div&gt;&#39;.&quot;\n&quot;;</span>
<a name="l00396"></a>00396   <span class="comment">//$queue_list_image_html .= &#39;&lt;div class=&quot;widget-header-right&quot; onclick=&quot;toggle_specimen(\&#39;content-&#39;.str_replace(&#39;:&#39;, &#39;__&#39;, $image_pid).&#39;\&#39;);&quot;&gt;&#39;.&quot;\n&quot;;</span>
<a name="l00397"></a>00397   <span class="comment">//$queue_list_image_html .= &#39;&lt;div class=&quot;widget-control&quot; id=&quot;control-&#39;.str_replace(&#39;:&#39;, &#39;__&#39;, $image_pid).&#39;&quot;&gt;&lt;img src=&quot;assets/img/icon_closed.png&quot;/&gt;&lt;/div&gt;&#39;.&quot;\n&quot;;</span>
<a name="l00398"></a>00398   $queue_list_image_html .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00399"></a>00399   $queue_list_image_html .= <span class="stringliteral">&#39;&lt;/div&gt;&lt;!-- widget-header --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00400"></a>00400   <span class="keywordflow">return</span> $queue_list_image_html;
<a name="l00401"></a>00401 }
<a name="l00402"></a>00402
<a name="l00403"></a><a class="code" href="analyze_8functions_8php.html#a3f96187322c4cb55b00f35ebda175b8b">00403</a> function <a class="code" href="analyze_8functions_8php.html#a3f96187322c4cb55b00f35ebda175b8b">create_queue_list_roi</a>($roi_pid, $image_pid, $transcribedStatus, $parsedL1Status, $locked_by, $workflow_status, $workflow_id) {
<a name="l00404"></a>00404   <span class="comment">//default style is to be shown</span>
<a name="l00405"></a>00405   $transcribe_link_style = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00406"></a>00406   $parse_link_style = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00407"></a>00407   $queue_add_link_style = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00408"></a>00408   $queue_remove_link_style = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00409"></a>00409   $queue_locked_by_style = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00410"></a>00410   <span class="keywordflow">if</span>($workflow_status == <span class="stringliteral">&quot;queued&quot;</span>) {
<a name="l00411"></a>00411         $queue_add_link_style = <span class="stringliteral">&#39;style=&quot;display:none;&quot;&#39;</span>;
<a name="l00412"></a>00412         $queue_locked_by_style = <span class="stringliteral">&#39;style=&quot;display:none;&quot;&#39;</span>;
<a name="l00413"></a>00413         $queue_list_class = <span class="stringliteral">&#39;roi_queued&#39;</span>;
<a name="l00414"></a>00414   }
<a name="l00415"></a>00415   <span class="keywordflow">else</span> <span class="keywordflow">if</span>($workflow_status == <span class="stringliteral">&quot;available&quot;</span>) {
<a name="l00416"></a>00416         $transcribe_link_style = <span class="stringliteral">&#39;style=&quot;display:none;&quot;&#39;</span>;
<a name="l00417"></a>00417         $parse_link_style = <span class="stringliteral">&#39;style=&quot;display:none;&quot;&#39;</span>;
<a name="l00418"></a>00418         $queue_remove_link_style = <span class="stringliteral">&#39;style=&quot;display:none;&quot;&#39;</span>;
<a name="l00419"></a>00419         $queue_locked_by_style = <span class="stringliteral">&#39;style=&quot;display:none;&quot;&#39;</span>;
<a name="l00420"></a>00420         $queue_list_class = <span class="stringliteral">&#39;roi_available&#39;</span>;
<a name="l00421"></a>00421   }
<a name="l00422"></a>00422   <span class="keywordflow">else</span> <span class="keywordflow">if</span>($workflow_status == <span class="stringliteral">&quot;locked&quot;</span>) {
<a name="l00423"></a>00423         $transcribe_link_style = <span class="stringliteral">&#39;style=&quot;display:none;&quot;&#39;</span>;
<a name="l00424"></a>00424         $parse_link_style = <span class="stringliteral">&#39;style=&quot;display:none;&quot;&#39;</span>;
<a name="l00425"></a>00425         $queue_add_link_style = <span class="stringliteral">&#39;style=&quot;display:none;&quot;&#39;</span>;
<a name="l00426"></a>00426         $queue_remove_link_style = <span class="stringliteral">&#39;style=&quot;display:none;&quot;&#39;</span>;
<a name="l00427"></a>00427         $queue_list_class = <span class="stringliteral">&#39;roi_locked&#39;</span>;
<a name="l00428"></a>00428   }
<a name="l00429"></a>00429   <span class="keywordflow">if</span>(empty($transcribedStatus)) {
<a name="l00430"></a>00430     $transcribedStatus = <span class="stringliteral">&#39;not started&#39;</span>;
<a name="l00431"></a>00431   }
<a name="l00432"></a>00432   <span class="keywordflow">if</span>(empty($parsedL1Status)) {
<a name="l00433"></a>00433     $parsedL1Status = <span class="stringliteral">&#39;not started&#39;</span>;
<a name="l00434"></a>00434   }
<a name="l00435"></a>00435   $permission_map = <a class="code" href="analyze_8functions_8php.html#ad3ad3c24ee1cf11791c0370dba068f3d">get_permission_map</a>($workflow_id);
<a name="l00436"></a>00436
<a name="l00437"></a>00437   $queue_list_roi_html .= <span class="stringliteral">&#39;&lt;div id=&quot;&#39;</span>.str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $roi_pid).<span class="stringliteral">&#39;_queue&quot; class=&quot;&#39;</span>.$queue_list_class.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00438"></a>00438   $queue_list_roi_html .= <span class="stringliteral">&#39;&lt;div class=&quot;widget-subheader&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00439"></a>00439   $queue_list_roi_html .= <span class="stringliteral">&#39;&lt;div class=&quot;roi_name&quot; roi_pid=&quot;&#39;</span>.$roi_pid.<span class="stringliteral">&#39;&quot; image_pid=&quot;&#39;</span>.$image_pid.<span class="stringliteral">&#39;&quot;&gt;Region: &#39;</span>.str_replace(<span class="stringliteral">&#39;ap-roi:&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $roi_pid);
<a name="l00440"></a>00440   $queue_list_roi_html .= <span class="stringliteral">&#39;&lt;span class=&quot;roi_status&quot; id=&quot;&#39;</span>. str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $image_pid).<span class="charliteral">&#39;_&#39;</span> . $roi_pid .<span class="stringliteral">&#39;_queue&quot;&gt; -- &lt;/span&gt;&#39;</span>;
<a name="l00441"></a>00441   $queue_list_roi_html .= <span class="stringliteral">&#39;&lt;span class=&quot;queue_add_link&quot; onclick=&quot;add_queue_roi_to_queue(\&#39;&#39;</span>.$image_pid.<span class="charliteral">&#39;\&#39;</span>, \<span class="stringliteral">&#39;&#39;</span>.$roi_pid.<span class="charliteral">&#39;\&#39;</span>)<span class="stringliteral">&quot; &#39;.$queue_add_link_style.&#39;&gt;not in queue &lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;add&lt;/a&gt;&lt;/span&gt;&#39;;</span>
<a name="l00442"></a>00442 <span class="stringliteral">  $queue_list_roi_html .= &#39;&lt;span class=&quot;</span>queue_remove_link<span class="stringliteral">&quot; onclick=&quot;</span>remove_queue_item_from_queue(\<span class="stringliteral">&#39;&#39;</span>.$roi_pid.<span class="charliteral">&#39;\&#39;</span>)<span class="stringliteral">&quot; &#39;.$queue_remove_link_style.&#39;&gt;in queue &lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;remove&lt;/a&gt;&lt;/span&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00443"></a>00443 <span class="stringliteral">  $queue_list_roi_html .= &#39;&lt;span class=&quot;</span>queue_locked_by<span class="stringliteral">&quot; &#39;.$queue_locked_by_style.&#39;&gt;locked by &#39;.$locked_by.&#39;&lt;/span&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00444"></a>00444 <span class="stringliteral">  $queue_list_roi_html .= &#39;&lt;/div&gt;&lt;!-- roi-name --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00445"></a>00445 <span class="stringliteral">  $queue_list_roi_html .= &#39;&lt;/div&gt;&lt;!-- widget-subheader --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00446"></a>00446 <span class="stringliteral">  $queue_list_roi_html .= &#39;&lt;div class=&quot;</span>widget-subcontent<span class="stringliteral">&quot; id=&quot;</span>widget-subcontent-<span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $roi_pid).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00447"></a>00447 <span class="stringliteral">  if ( $permission_map[&#39;canTranscribe&#39;] )</span>
<a name="l00448"></a>00448 <span class="stringliteral">      $queue_list_roi_html .= &#39;&lt;div class=&quot;</span>transcribe_link<span class="stringliteral">&quot; onclick=&quot;</span>transcribe_roi(\<span class="stringliteral">&#39;&#39;</span>.$roi_pid.<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot; &#39;.$transcribe_link_style.&#39;&gt;&lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;Transcribe&lt;/a&gt; - &lt;span class=&quot;</span>transcribe_status<span class="stringliteral">&quot; id=&quot;</span>roi_001_transcribe_status<span class="stringliteral">&quot;&gt;&#39;.$transcribedStatus.&#39;&lt;/span&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00449"></a>00449 <span class="stringliteral">  else</span>
<a name="l00450"></a>00450 <span class="stringliteral">      $queue_list_roi_html .= &#39;&lt;div class=&quot;</span>transcribe_link<span class="stringliteral">&quot; &#39;.$transcribe_link_style.&#39;&gt;Transcribe - &lt;span class=&quot;</span>transcribe_status<span class="stringliteral">&quot; id=&quot;</span>roi_001_transcribe_status<span class="stringliteral">&quot;&gt;&#39;.$transcribedStatus.&#39;&lt;/span&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00451"></a>00451 <span class="stringliteral">  if ( $permission_map[&#39;canParseL1&#39;] || $permission_map[&#39;canParseL2&#39;] || $permission_map[&#39;canParseL3&#39;] )</span>
<a name="l00452"></a>00452 <span class="stringliteral">      $queue_list_roi_html .= &#39;&lt;div class=&quot;</span>parse_link<span class="stringliteral">&quot; onclick=&quot;</span>parse_roi(\<span class="stringliteral">&#39;&#39;</span>.$roi_pid.<span class="charliteral">&#39;\&#39;</span>,1)<span class="stringliteral">&quot; &#39;.$parse_link_style.&#39;&gt;&lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;Parse&lt;/a&gt; - &lt;span class=&quot;</span>parse_status<span class="stringliteral">&quot; id=&quot;</span>roi_001_parse_status<span class="stringliteral">&quot;&gt;&#39;.$parsedL1Status.&#39;&lt;/span&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00453"></a>00453 <span class="stringliteral">  else</span>
<a name="l00454"></a>00454 <span class="stringliteral">      $queue_list_roi_html .= &#39;&lt;div class=&quot;</span>parse_link<span class="stringliteral">&quot; &#39;.$parse_link_style.&#39;&gt;Parse - &lt;span class=&quot;</span>parse_status<span class="stringliteral">&quot; id=&quot;</span>roi_001_parse_status<span class="stringliteral">&quot;&gt;&#39;.$parsedL1Status.&#39;&lt;/span&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00455"></a>00455 <span class="stringliteral">  //$queue_list_roi_html .= &#39;&lt;div class=&quot;</span>queue_add_link<span class="stringliteral">&quot; onclick=&quot;</span><a class="code" href="analyze_8functions_8php.html#a017338342276e0f6727737108e7cee43">add_queue_roi_to_queue</a>(\<span class="stringliteral">&#39;&#39;</span>.$image_pid.<span class="charliteral">&#39;\&#39;</span>, \<span class="stringliteral">&#39;&#39;</span>.$roi_pid.<span class="charliteral">&#39;\&#39;</span>)<span class="stringliteral">&quot; &#39;.$queue_add_link_style.&#39;&gt;&lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;Add to queue&lt;/a&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00456"></a>00456 <span class="stringliteral">  //$queue_list_roi_html .= &#39;&lt;div class=&quot;</span>queue_remove_link<span class="stringliteral">&quot; onclick=&quot;</span>remove_queue_item_from_queue(\<span class="stringliteral">&#39;&#39;</span>.$roi_pid.<span class="charliteral">&#39;\&#39;</span>)<span class="stringliteral">&quot; &#39;.$queue_remove_link_style.&#39;&gt;&lt;a href=&quot;</span>#<span class="stringliteral">&quot;&gt;Remove from queue&lt;/a&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00457"></a>00457 <span class="stringliteral">  //$queue_list_roi_html .= &#39;&lt;div class=&quot;</span>queue_locked_by<span class="stringliteral">&quot; &#39;.$queue_locked_by_style.&#39;&gt;Locked by &#39;.$locked_by.&#39;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00458"></a>00458 <span class="stringliteral">  $queue_list_roi_html .= &#39;&lt;/div&gt;&lt;!-- widget-subcontent --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00459"></a>00459 <span class="stringliteral">  $queue_list_roi_html .= &#39;&lt;/div&gt;&lt;!-- &#39;.str_replace(&#39;:&#39;, &#39;__&#39;, $roi_pid).&#39;_queue --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00460"></a>00460 <span class="stringliteral">  return $queue_list_roi_html;</span>
<a name="l00461"></a>00461 <span class="stringliteral">}</span>
<a name="l00462"></a>00462 <span class="stringliteral"></span>
<a name="l00463"></a><a class="code" href="analyze_8functions_8php.html#a956d8e9f9a8b25192ddfd4c594468920">00463</a> <span class="stringliteral">function get_djatoka_url_by_width($image_pid, $width) {</span>
<a name="l00464"></a>00464 <span class="stringliteral">        $djatoka_display_url = &#39;&#39;;</span>
<a name="l00465"></a>00465 <span class="stringliteral">        $imageMetadata_record = AP_Image::getimageMetadata_record($image_pid);</span>
<a name="l00466"></a>00466 <span class="stringliteral">        $rft_id = $imageMetadata_record[&#39;rft_id&#39;];</span>
<a name="l00467"></a>00467 <span class="stringliteral">        if($rft_id != &#39;&#39;) {</span>
<a name="l00468"></a>00468 <span class="stringliteral">          $djatoka_display_url = getDjatokaURL($rft_id, &#39;getRegion&#39;, &#39;3&#39;, &#39;0&#39;, &#39;0&#39;, $imageMetadata_record[&#39;h&#39;], $imageMetadata_record[&#39;w&#39;], $width, &#39;0&#39;);</span>
<a name="l00469"></a>00469 <span class="stringliteral">        }</span>
<a name="l00470"></a>00470 <span class="stringliteral">        else {</span>
<a name="l00471"></a>00471 <span class="stringliteral">          $djatoka_display_url = getDjatokaURL($imageMetadata_record[&#39;URL&#39;], &#39;getRegion&#39;, &#39;3&#39;, &#39;0&#39;, &#39;0&#39;, $imageMetadata_record[&#39;h&#39;], $imageMetadata_record[&#39;w&#39;], $width, &#39;0&#39;);</span>
<a name="l00472"></a>00472 <span class="stringliteral">        }</span>
<a name="l00473"></a>00473 <span class="stringliteral">        return $djatoka_display_url;</span>
<a name="l00474"></a>00474 <span class="stringliteral">}</span>
<a name="l00475"></a>00475 <span class="stringliteral"></span>
<a name="l00476"></a><a class="code" href="analyze_8functions_8php.html#a5b8736da01191c26d860005d1999325c">00476</a> <span class="stringliteral">function get_djatoka_url_by_height($image_pid, $height) {</span>
<a name="l00477"></a>00477 <span class="stringliteral">        $djatoka_display_url = &#39;&#39;;</span>
<a name="l00478"></a>00478 <span class="stringliteral">        $imageMetadata_record = AP_Image::getimageMetadata_record($image_pid);</span>
<a name="l00479"></a>00479 <span class="stringliteral">        $rft_id = $imageMetadata_record[&#39;rft_id&#39;];</span>
<a name="l00480"></a>00480 <span class="stringliteral">        if($rft_id != &#39;&#39;) {</span>
<a name="l00481"></a>00481 <span class="stringliteral">          $djatoka_display_url = getDjatokaURL($rft_id, &#39;getRegion&#39;, &#39;3&#39;, &#39;0&#39;, &#39;0&#39;, $imageMetadata_record[&#39;h&#39;], $imageMetadata_record[&#39;w&#39;], &#39;0&#39;, $height);</span>
<a name="l00482"></a>00482 <span class="stringliteral">        }</span>
<a name="l00483"></a>00483 <span class="stringliteral">        else {</span>
<a name="l00484"></a>00484 <span class="stringliteral">          $djatoka_display_url = getDjatokaURL($imageMetadata_record[&#39;URL&#39;], &#39;getRegion&#39;, &#39;3&#39;, &#39;0&#39;, &#39;0&#39;, $imageMetadata_record[&#39;h&#39;], $imageMetadata_record[&#39;w&#39;], &#39;0&#39;, $height);</span>
<a name="l00485"></a>00485 <span class="stringliteral">        }</span>
<a name="l00486"></a>00486 <span class="stringliteral">        return $djatoka_display_url;</span>
<a name="l00487"></a>00487 <span class="stringliteral">}</span>
<a name="l00488"></a>00488 <span class="stringliteral"></span>
<a name="l00489"></a><a class="code" href="analyze_8functions_8php.html#ad4b0e661fe8a8e5cedb6d3442f27fc6d">00489</a> <span class="stringliteral">function get_images_list($specimen_pid, $nothing, $workflow_id){</span>
<a name="l00490"></a>00490 <span class="stringliteral">        global $user;</span>
<a name="l00491"></a>00491 <span class="stringliteral">        if(Workflow_Users::doesWorkflowHaveUserName($workflow_id, $user-&gt;name) &amp;&amp; Workflow_Permission::doesWorkflowHavePermission($workflow_id, &quot;</span>canAnalyzeSpecimen<span class="stringliteral">&quot;)){</span>
<a name="l00492"></a>00492 <span class="stringliteral">                $image_pids = AP_Specimen::getImageListForSpecimen($specimen_pid);</span>
<a name="l00493"></a>00493 <span class="stringliteral">                echo json_encode($image_pids);</span>
<a name="l00494"></a>00494 <span class="stringliteral">        }</span>
<a name="l00495"></a>00495 <span class="stringliteral">}</span>
<a name="l00496"></a>00496 <span class="stringliteral"></span>
<a name="l00497"></a><a class="code" href="analyze_8functions_8php.html#ad640cacecc876546bdb4ed01084708aa">00497</a> <span class="stringliteral">function thumbHeightReset($height, $width){</span>
<a name="l00498"></a>00498 <span class="stringliteral">        if($width/$height &lt; 78/54){</span>
<a name="l00499"></a>00499 <span class="stringliteral">                $y = ($width * 54)/78;</span>
<a name="l00500"></a>00500 <span class="stringliteral">                return round($y);</span>
<a name="l00501"></a>00501 <span class="stringliteral">        }</span>
<a name="l00502"></a>00502 <span class="stringliteral">        else</span>
<a name="l00503"></a>00503 <span class="stringliteral">                return false;</span>
<a name="l00504"></a>00504 <span class="stringliteral">}</span>
<a name="l00505"></a>00505 <span class="stringliteral"></span>
<a name="l00506"></a><a class="code" href="analyze_8functions_8php.html#a84f8a9fd1fdd21b005dc0a4684b6f5fe">00506</a> <span class="stringliteral">function get_specimen_pid($image_pid, $nothing, $workflow_id){</span>
<a name="l00507"></a>00507 <span class="stringliteral">        $returnJSON[] = AP_Image::get_specimen_pid($image_pid);</span>
<a name="l00508"></a>00508 <span class="stringliteral">        echo json_encode($returnJSON);</span>
<a name="l00509"></a>00509 <span class="stringliteral">}</span>
<a name="l00510"></a>00510 <span class="stringliteral"></span>
<a name="l00511"></a><a class="code" href="analyze_8functions_8php.html#acd2326183b88a4b79d4f3812207e658a">00511</a> <span class="stringliteral">function change_roi_type($roi_pid, $roi_type){</span>
<a name="l00512"></a>00512 <span class="stringliteral">        if($roi_type==&quot;</span>Annotation<span class="stringliteral">&quot;)</span>
<a name="l00513"></a>00513 <span class="stringliteral">                        $roi_type = &quot;</span>Annotation/Other<span class="stringliteral">&quot;;</span>
<a name="l00514"></a>00514 <span class="stringliteral">        $roi = new roiHandler($roi_pid);</span>
<a name="l00515"></a>00515 <span class="stringliteral">        $roiMetadata = $roi-&gt;getDatastream(&quot;</span>roiMetadata<span class="stringliteral">&quot;);</span>
<a name="l00516"></a>00516 <span class="stringliteral">        $dom = new DOMDocument();</span>
<a name="l00517"></a>00517 <span class="stringliteral">        $dom-&gt;loadXML($roiMetadata);</span>
<a name="l00518"></a>00518 <span class="stringliteral">        $dom-&gt;getElementsByTagName(&quot;</span>roiType<span class="stringliteral">&quot;)-&gt;item(0)-&gt;nodeValue = $roi_type;</span>
<a name="l00519"></a>00519 <span class="stringliteral">        $result = $roi-&gt;setDatastream(&quot;</span>roiMetadata<span class="stringliteral">&quot;, &quot;</span>roi_Metadata<span class="stringliteral">&quot;, &quot;</span>text/xml<span class="stringliteral">&quot;, $dom-&gt;saveXML(), FEDORA_DATABASE_USERNAME.&quot;</span>:<span class="stringliteral">&quot;.FEDORA_DATABASE_PASSWORD);</span>
<a name="l00520"></a>00520 <span class="stringliteral">        if($result){</span>
<a name="l00521"></a>00521 <span class="stringliteral">                echo &quot;</span>Success<span class="stringliteral">&quot;;</span>
<a name="l00522"></a>00522 <span class="stringliteral">        }else{</span>
<a name="l00523"></a>00523 <span class="stringliteral">                echo &quot;</span>Failed<span class="stringliteral">&quot;;</span>
<a name="l00524"></a>00524 <span class="stringliteral">        }</span>
<a name="l00525"></a>00525 <span class="stringliteral">}</span>
<a name="l00526"></a>00526 <span class="stringliteral"></span>
<a name="l00527"></a><a class="code" href="analyze_8functions_8php.html#ad3ad3c24ee1cf11791c0370dba068f3d">00527</a> <span class="stringliteral">function get_permission_map($workflow_id) {</span>
<a name="l00528"></a>00528 <span class="stringliteral">    $selected_permission_list = Workflow::getPermissionList($workflow_id);</span>
<a name="l00529"></a>00529 <span class="stringliteral">    if ( is_array($selected_permission_list) )</span>
<a name="l00530"></a>00530 <span class="stringliteral">    {</span>
<a name="l00531"></a>00531 <span class="stringliteral">        foreach($selected_permission_list as $permission_string)</span>
<a name="l00532"></a>00532 <span class="stringliteral">        {</span>
<a name="l00533"></a>00533 <span class="stringliteral">            $permission_map[$permission_string] = true;</span>
<a name="l00534"></a>00534 <span class="stringliteral">        }</span>
<a name="l00535"></a>00535 <span class="stringliteral">    }</span>
<a name="l00536"></a>00536 <span class="stringliteral">    return $permission_map;</span>
<a name="l00537"></a>00537 <span class="stringliteral">}</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="analyze_8functions_8php.html">analyze.functions.php</a>      </li>
      <li class="footer">Generated on Tue Jun 28 2011 11:15:32 for Apiary Project by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
