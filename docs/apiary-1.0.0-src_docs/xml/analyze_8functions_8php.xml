<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.7.4">
  <compounddef id="analyze_8functions_8php" kind="file">
    <compoundname>analyze.functions.php</compoundname>
      <sectiondef kind="var">
      <memberdef kind="variable" id="analyze_8functions_8php_1aea941c07a4c4543da9db61e709571719" prot="public" static="no" mutable="no">
        <type></type>
        <definition>$rel_path</definition>
        <argsstring></argsstring>
        <name>$rel_path</name>
        <initializer> drupal_get_path(&apos;module&apos;,&apos;apiary_project&apos;)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="2" bodyfile="apiary_project/analyze.functions.php" bodystart="2" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="analyze_8functions_8php_1a569ab637484bb1b9bcd0ce7571dd5f95" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>specimen_list</definition>
        <argsstring>($nothing, $nothing, $workflow_id)</argsstring>
        <name>specimen_list</name>
        <param>
          <type>$</type>
          <declname>nothing</declname>
        </param>
        <param>
          <type>$</type>
          <declname>nothing</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="10" bodyfile="apiary_project/analyze.functions.php" bodystart="10" bodyend="41"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1ad13e1985dddb1173b5cc748c11990c65" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>update_queue_list</definition>
        <argsstring>($nothing, $nothing, $workflow_id)</argsstring>
        <name>update_queue_list</name>
        <param>
          <type>$</type>
          <declname>nothing</declname>
        </param>
        <param>
          <type>$</type>
          <declname>nothing</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="43" bodyfile="apiary_project/analyze.functions.php" bodystart="43" bodyend="104"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1afa0647e1c898c93547dcb3f7b7d8ceda" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>get_queue_list</definition>
        <argsstring>($workflow_id)</argsstring>
        <name>get_queue_list</name>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="106" bodyfile="apiary_project/analyze.functions.php" bodystart="106" bodyend="158"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1a5dd4d25616cb603dea2f5214f643bfb0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>getImageROIList</definition>
        <argsstring>($image_pid, $nothing, $workflow_id)</argsstring>
        <name>getImageROIList</name>
        <param>
          <type>$</type>
          <declname>image_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>nothing</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="160" bodyfile="apiary_project/analyze.functions.php" bodystart="160" bodyend="202"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1a6e2ed9556330362fb26ad4654e83f932" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>getSpecimenROIList</definition>
        <argsstring>($specimen_pid, $workflow_id, $nothing)</argsstring>
        <name>getSpecimenROIList</name>
        <param>
          <type>$</type>
          <declname>specimen_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <param>
          <type>$</type>
          <declname>nothing</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="204" bodyfile="apiary_project/analyze.functions.php" bodystart="204" bodyend="232"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1af0279594674a2ff529d0fe3bfa916a05" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>get_roi_boxes</definition>
        <argsstring>($image_pid, $nothing, $workflow_id)</argsstring>
        <name>get_roi_boxes</name>
        <param>
          <type>$</type>
          <declname>image_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>nothing</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="234" bodyfile="apiary_project/analyze.functions.php" bodystart="234" bodyend="249"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1ac3ad306edba53178755f1e17ba3ef052" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>remove_roi</definition>
        <argsstring>($roi_pid, $nothing, $workflow_id)</argsstring>
        <name>remove_roi</name>
        <param>
          <type>$</type>
          <declname>roi_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>nothing</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="251" bodyfile="apiary_project/analyze.functions.php" bodystart="251" bodyend="266"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1a82d69f9619642c6bb08dc1d7ea672027" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>create_roi</definition>
        <argsstring>($image_pid, $options, $workflow_id)</argsstring>
        <name>create_roi</name>
        <param>
          <type>$</type>
          <declname>image_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>options</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="268" bodyfile="apiary_project/analyze.functions.php" bodystart="268" bodyend="315"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1aa7f7268265f4049f5877aea14e6e1640" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>generate_roi_html</definition>
        <argsstring>($roi_pid, $roi_thumb_url, $roiMetadata_record, $transcribe_status, $parsed_status, $workflow_id=null)</argsstring>
        <name>generate_roi_html</name>
        <param>
          <type>$</type>
          <declname>roi_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>roi_thumb_url</declname>
        </param>
        <param>
          <type>$</type>
          <declname>roiMetadata_record</declname>
        </param>
        <param>
          <type>$</type>
          <declname>transcribe_status</declname>
        </param>
        <param>
          <type>$</type>
          <declname>parsed_status</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
          <defval>null</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="317" bodyfile="apiary_project/analyze.functions.php" bodystart="317" bodyend="342"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1a017338342276e0f6727737108e7cee43" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>add_queue_roi_to_queue</definition>
        <argsstring>($image_pid, $roi_pid, $workflow_id)</argsstring>
        <name>add_queue_roi_to_queue</name>
        <param>
          <type>$</type>
          <declname>image_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>roi_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="344" bodyfile="apiary_project/analyze.functions.php" bodystart="344" bodyend="346"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1a42cc21dd56bf989bad557ca72edef3fc" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>add_roi_to_queue</definition>
        <argsstring>($image_pid, $roi_pid, $workflow_id)</argsstring>
        <name>add_roi_to_queue</name>
        <param>
          <type>$</type>
          <declname>image_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>roi_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="348" bodyfile="apiary_project/analyze.functions.php" bodystart="348" bodyend="364"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1a734deca8701dbc178f8deab344dc6919" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>create_queue_list_image</definition>
        <argsstring>($image_pid, $specimen_pid, $analyzedStatus, $roi_count, $locked_by, $workflow_status, $workflow_id=null)</argsstring>
        <name>create_queue_list_image</name>
        <param>
          <type>$</type>
          <declname>image_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>specimen_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>analyzedStatus</declname>
        </param>
        <param>
          <type>$</type>
          <declname>roi_count</declname>
        </param>
        <param>
          <type>$</type>
          <declname>locked_by</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_status</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
          <defval>null</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="366" bodyfile="apiary_project/analyze.functions.php" bodystart="366" bodyend="401"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1a3f96187322c4cb55b00f35ebda175b8b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>create_queue_list_roi</definition>
        <argsstring>($roi_pid, $image_pid, $transcribedStatus, $parsedL1Status, $locked_by, $workflow_status, $workflow_id)</argsstring>
        <name>create_queue_list_roi</name>
        <param>
          <type>$</type>
          <declname>roi_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>image_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>transcribedStatus</declname>
        </param>
        <param>
          <type>$</type>
          <declname>parsedL1Status</declname>
        </param>
        <param>
          <type>$</type>
          <declname>locked_by</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_status</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="403" bodyfile="apiary_project/analyze.functions.php" bodystart="403" bodyend="461"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1a956d8e9f9a8b25192ddfd4c594468920" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>get_djatoka_url_by_width</definition>
        <argsstring>($image_pid, $width)</argsstring>
        <name>get_djatoka_url_by_width</name>
        <param>
          <type>$</type>
          <declname>image_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>width</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="463" bodyfile="apiary_project/analyze.functions.php" bodystart="463" bodyend="474"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1a5b8736da01191c26d860005d1999325c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>get_djatoka_url_by_height</definition>
        <argsstring>($image_pid, $height)</argsstring>
        <name>get_djatoka_url_by_height</name>
        <param>
          <type>$</type>
          <declname>image_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>height</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="476" bodyfile="apiary_project/analyze.functions.php" bodystart="476" bodyend="487"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1ad4b0e661fe8a8e5cedb6d3442f27fc6d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>get_images_list</definition>
        <argsstring>($specimen_pid, $nothing, $workflow_id)</argsstring>
        <name>get_images_list</name>
        <param>
          <type>$</type>
          <declname>specimen_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>nothing</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="489" bodyfile="apiary_project/analyze.functions.php" bodystart="489" bodyend="495"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1ad640cacecc876546bdb4ed01084708aa" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>thumbHeightReset</definition>
        <argsstring>($height, $width)</argsstring>
        <name>thumbHeightReset</name>
        <param>
          <type>$</type>
          <declname>height</declname>
        </param>
        <param>
          <type>$</type>
          <declname>width</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="497" bodyfile="apiary_project/analyze.functions.php" bodystart="497" bodyend="504"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1a84f8a9fd1fdd21b005dc0a4684b6f5fe" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>get_specimen_pid</definition>
        <argsstring>($image_pid, $nothing, $workflow_id)</argsstring>
        <name>get_specimen_pid</name>
        <param>
          <type>$</type>
          <declname>image_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>nothing</declname>
        </param>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="506" bodyfile="apiary_project/analyze.functions.php" bodystart="506" bodyend="509"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1acd2326183b88a4b79d4f3812207e658a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>change_roi_type</definition>
        <argsstring>($roi_pid, $roi_type)</argsstring>
        <name>change_roi_type</name>
        <param>
          <type>$</type>
          <declname>roi_pid</declname>
        </param>
        <param>
          <type>$</type>
          <declname>roi_type</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="511" bodyfile="apiary_project/analyze.functions.php" bodystart="511" bodyend="525"/>
      </memberdef>
      <memberdef kind="function" id="analyze_8functions_8php_1ad3ad3c24ee1cf11791c0370dba068f3d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>get_permission_map</definition>
        <argsstring>($workflow_id)</argsstring>
        <name>get_permission_map</name>
        <param>
          <type>$</type>
          <declname>workflow_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="apiary_project/analyze.functions.php" line="527" bodyfile="apiary_project/analyze.functions.php" bodystart="527" bodyend="537"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="2" refid="analyze_8functions_8php_1aea941c07a4c4543da9db61e709571719" refkind="member"><highlight class="normal"><ref refid="analyze_8functions_8php_1aea941c07a4c4543da9db61e709571719" kindref="member">$rel_path</ref><sp/>=<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;apiary_project&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">/*include_once($rel_path.&apos;/workflow/include/class.Workflow.php&apos;);</highlight></codeline>
<codeline lineno="4"><highlight class="comment">include_once($rel_path.&apos;/workflow/include/class.Errorlog.php&apos;);</highlight></codeline>
<codeline lineno="5"><highlight class="comment">*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal">include_once(<ref refid="analyze_8functions_8php_1aea941c07a4c4543da9db61e709571719" kindref="member">$rel_path</ref>.</highlight><highlight class="stringliteral">&apos;/workflow/include/functions_error.php&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="7"><highlight class="normal">include_once(<ref refid="analyze_8functions_8php_1aea941c07a4c4543da9db61e709571719" kindref="member">$rel_path</ref>.</highlight><highlight class="stringliteral">&apos;/workflow/include/functions_misc.php&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="8"><highlight class="normal">include_once(<ref refid="analyze_8functions_8php_1aea941c07a4c4543da9db61e709571719" kindref="member">$rel_path</ref>.</highlight><highlight class="stringliteral">&apos;/workflow/include/db_utils.php&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight></codeline>
<codeline lineno="10" refid="analyze_8functions_8php_1a569ab637484bb1b9bcd0ce7571dd5f95" refkind="member"><highlight class="normal">function<sp/><ref refid="analyze_8functions_8php_1a569ab637484bb1b9bcd0ce7571dd5f95" kindref="member">specimen_list</ref>($nothing,<sp/>$nothing,<sp/>$workflow_id){</highlight></codeline>
<codeline lineno="11"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$workflow<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Workflow($workflow_id,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="12"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$specimen_pids<sp/>=<sp/>$workflow-&gt;specimen_pids;</highlight></codeline>
<codeline lineno="13"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="14"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($specimen_pids<sp/>as<sp/>$specimen_pid){</highlight></codeline>
<codeline lineno="15"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$specimen_id<sp/>=<sp/>str_replace(</highlight><highlight class="stringliteral">&quot;:&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&quot;_&quot;</highlight><highlight class="normal">,$specimen_pid);</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;widget-header&quot;<sp/>id=&quot;&apos;</highlight><highlight class="normal">.$specimen_id.</highlight><highlight class="stringliteral">&apos;&quot;<sp/>onclick=&quot;toggle_specimen(\&apos;content-&apos;</highlight><highlight class="normal">.$specimen_id.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">);</highlight><highlight class="stringliteral">&quot;&gt;</highlight></codeline>
<codeline lineno="17"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-header-left<sp/><sp/>onclick=</highlight><highlight class="stringliteral">&quot;select_specimen(\&apos;&apos;.$specimen_pid.&apos;\&apos;)&quot;</highlight><highlight class="stringliteral">&quot;&gt;</highlight></codeline>
<codeline lineno="18"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">specimen_name</highlight><highlight class="stringliteral">&quot;&gt;&apos;.<sp/>$specimen_pid.&apos;<sp/>-<sp/>&lt;span<sp/>class=&quot;</highlight><highlight class="normal">specimen_status</highlight><highlight class="stringliteral">&quot;&gt;status&lt;/span&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="19"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">specimen_header_detail</highlight><highlight class="stringliteral">&quot;&gt;Contains<sp/>&lt;span<sp/>id=&quot;</highlight><highlight class="normal">roi_count_001</highlight><highlight class="stringliteral">&quot;&gt;X<sp/>ROIs&lt;/span&gt;<sp/>-<sp/>&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;analyze&lt;/a&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="20"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;</highlight></codeline>
<codeline lineno="21"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-header-right</highlight><highlight class="stringliteral">&quot;&gt;</highlight></codeline>
<codeline lineno="22"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-control</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="normal">control-</highlight><highlight class="stringliteral">&apos;.$specimen_id.&apos;</highlight><highlight class="stringliteral">&quot;&gt;&lt;img<sp/>src=&quot;</highlight><highlight class="normal">img/icon_closed.png</highlight><highlight class="stringliteral">&quot;/&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="23"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;</highlight></codeline>
<codeline lineno="24"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">clearfix</highlight><highlight class="stringliteral">&quot;<sp/>style=&quot;</highlight><highlight class="normal">width:100%;</highlight><highlight class="stringliteral">&quot;&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="25"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;&lt;!--<sp/>widget-header<sp/>--&gt;</highlight></codeline>
<codeline lineno="26"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-content</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="normal">content-</highlight><highlight class="stringliteral">&apos;.$specimen_id.&apos;</highlight><highlight class="stringliteral">&quot;&gt;&apos;;</highlight></codeline>
<codeline lineno="27"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$image_pids<sp/>=<sp/>AP_Specimen::getImageListForSpecimen($specimen_pid);</highlight></codeline>
<codeline lineno="28"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_pids<sp/>=<sp/>AP_Image::getROIListForImage($image_pids[0]);</highlight></codeline>
<codeline lineno="29"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>foreach($roi_pids<sp/>as<sp/>$roi_pid){</highlight></codeline>
<codeline lineno="30"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-subheader</highlight><highlight class="stringliteral">&quot;&gt;</highlight></codeline>
<codeline lineno="31"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">roi_name</highlight><highlight class="stringliteral">&quot;&gt;ROI<sp/>Name<sp/>-&apos;.$roi_pid.&apos;<sp/>&lt;span<sp/>class=&quot;</highlight><highlight class="normal">roi_status</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="stringliteral">&apos;.<sp/>$specimen_pid.&apos;</highlight><highlight class="normal">_</highlight><highlight class="stringliteral">&apos;<sp/>.<sp/>$roi_pid<sp/>.&apos;</highlight><highlight class="stringliteral">&quot;&gt;status&lt;/span&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="32"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;</highlight></codeline>
<codeline lineno="33"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-subcontent</highlight><highlight class="stringliteral">&quot;&gt;</highlight></codeline>
<codeline lineno="34"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">transcribe_link</highlight><highlight class="stringliteral">&quot;&gt;&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;Transcribe&lt;/a&gt;<sp/>-<sp/>&lt;span<sp/>id=&quot;</highlight><highlight class="normal">roi_001_transcribe_status</highlight><highlight class="stringliteral">&quot;&gt;status&lt;/span&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="35"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">parse_link</highlight><highlight class="stringliteral">&quot;&gt;&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;Parse&lt;/a&gt;<sp/>-<sp/>&lt;span<sp/>id=&quot;</highlight><highlight class="normal">roi_001_parse_status</highlight><highlight class="stringliteral">&quot;&gt;status&lt;/span&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="36"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;&apos;;</highlight></codeline>
<codeline lineno="37"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="38"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>.=<sp/>&apos;&lt;/div&gt;&lt;!--<sp/>widget-content<sp/>--&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="39"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="40"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>$returnHTML;</highlight></codeline>
<codeline lineno="41"><highlight class="stringliteral">}</highlight></codeline>
<codeline lineno="42"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="43" refid="analyze_8functions_8php_1ad13e1985dddb1173b5cc748c11990c65" refkind="member"><highlight class="stringliteral">function<sp/>update_queue_list($nothing,<sp/>$nothing,<sp/>$workflow_id){</highlight></codeline>
<codeline lineno="44"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="45"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>=<sp/>&quot;</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="46"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if(empty($_SESSION[&apos;apiary_session_id&apos;]))<sp/>{</highlight></codeline>
<codeline lineno="47"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>&quot;</highlight><highlight class="normal">Invalid<sp/>Session</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="48"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return;</highlight></codeline>
<codeline lineno="49"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="50"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>else{</highlight></codeline>
<codeline lineno="51"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$session_id<sp/>=<sp/>$_SESSION[&apos;apiary_session_id&apos;];</highlight></codeline>
<codeline lineno="52"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="53"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$permission_map<sp/>=<sp/>get_permission_map($workflow_id);</highlight></codeline>
<codeline lineno="54"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if(Workflow_Users::doesWorkflowHaveUserName($workflow_id,<sp/>$user-&gt;name)<sp/>&amp;&amp;<sp/>Workflow_Permission::doesWorkflowHavePermission($workflow_id,<sp/>&quot;</highlight><highlight class="normal">canAnalyzeSpecimen</highlight><highlight class="stringliteral">&quot;)){</highlight></codeline>
<codeline lineno="55"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>list($roi_queue_list,<sp/>$image_queue_list,<sp/>$roi_counts)<sp/>=<sp/>get_queue_list($workflow_id);</highlight></codeline>
<codeline lineno="56"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$specimens<sp/>=<sp/>$roi_queue_list;</highlight></codeline>
<codeline lineno="57"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>foreach($specimens<sp/>as<sp/>$specimen_pid<sp/>=&gt;<sp/>$images){</highlight></codeline>
<codeline lineno="58"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>foreach($images<sp/>as<sp/>$image_id<sp/>=&gt;<sp/>$rois){</highlight></codeline>
<codeline lineno="59"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$specimen_id<sp/>=<sp/>str_replace(&quot;</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">_</highlight><highlight class="stringliteral">&quot;,$specimen_pid);</highlight></codeline>
<codeline lineno="60"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$showAll<sp/>=<sp/>false;$spHTMLDisplayed<sp/>=<sp/>false;</highlight></codeline>
<codeline lineno="61"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tempHTML<sp/>=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-header</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="stringliteral">&apos;.$specimen_id;</highlight></codeline>
<codeline lineno="62"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(<sp/>$permission_map[&apos;</highlight><highlight class="normal">canAnalyzeSpecimen</highlight><highlight class="stringliteral">&apos;]<sp/>)</highlight></codeline>
<codeline lineno="63"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tempHTML<sp/>.=<sp/>&apos;</highlight><highlight class="stringliteral">&quot;<sp/>onclick=&quot;</highlight><highlight class="normal">toggle_specimen(\</highlight><highlight class="stringliteral">&apos;content-&apos;</highlight><highlight class="normal">.$specimen_id.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">);</highlight><highlight class="stringliteral">&quot;&apos;;</highlight></codeline>
<codeline lineno="64"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tempHTML<sp/>.=<sp/>&apos;&gt;</highlight></codeline>
<codeline lineno="65"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-header-left<sp/><sp/>onclick=</highlight><highlight class="stringliteral">&quot;select_specimen(\&apos;&apos;.$specimen_pid.&apos;\&apos;)&quot;</highlight><highlight class="stringliteral">&quot;&gt;</highlight></codeline>
<codeline lineno="66"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">specimen_name</highlight><highlight class="stringliteral">&quot;&gt;&apos;.<sp/>$specimen_pid.&apos;&lt;span<sp/>class=&quot;</highlight><highlight class="normal">specimen_status</highlight><highlight class="stringliteral">&quot;&gt;&apos;.$image_queue_list[$specimen_pid][$image_id][&quot;</highlight><highlight class="normal">analyzedStatus</highlight><highlight class="stringliteral">&quot;].&apos;&lt;/span&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="67"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">specimen_header_detail</highlight><highlight class="stringliteral">&quot;&gt;Contains<sp/>&lt;span<sp/>id=&quot;</highlight><highlight class="normal">roi_count_</highlight><highlight class="stringliteral">&apos;.$specimen_id.&apos;</highlight><highlight class="stringliteral">&quot;&gt;&apos;.<sp/>$roi_counts[$specimen_pid][&apos;total_rois&apos;]<sp/>.&apos;<sp/>ROIs&lt;/span&gt;&apos;;</highlight></codeline>
<codeline lineno="68"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(<sp/>$permission_map[&apos;canAnalyzeSpecimen&apos;]<sp/>)</highlight></codeline>
<codeline lineno="69"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tempHTML<sp/>.=<sp/>&apos;<sp/>-<sp/>&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;analyze&lt;/a&gt;&apos;;</highlight></codeline>
<codeline lineno="70"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tempHTML<sp/>.=<sp/>&apos;&lt;/div&gt;</highlight></codeline>
<codeline lineno="71"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;</highlight></codeline>
<codeline lineno="72"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-header-right</highlight><highlight class="stringliteral">&quot;&gt;</highlight></codeline>
<codeline lineno="73"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-control</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="normal">control-</highlight><highlight class="stringliteral">&apos;.$specimen_id.&apos;</highlight><highlight class="stringliteral">&quot;&gt;&lt;img<sp/>src=&quot;</highlight><highlight class="normal">img/icon_closed.png</highlight><highlight class="stringliteral">&quot;/&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="74"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;</highlight></codeline>
<codeline lineno="75"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">clearfix</highlight><highlight class="stringliteral">&quot;<sp/>style=&quot;</highlight><highlight class="normal">width:100%;</highlight><highlight class="stringliteral">&quot;&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="76"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;&lt;!--<sp/>widget-header<sp/>--&gt;</highlight></codeline>
<codeline lineno="77"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-content</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="normal">content-</highlight><highlight class="stringliteral">&apos;.$specimen_id.&apos;</highlight><highlight class="stringliteral">&quot;&gt;&apos;;</highlight></codeline>
<codeline lineno="78"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if($image_queue_list[$specimen_pid][$image_id][&apos;locked_session&apos;]==$session_id<sp/>&amp;&amp;<sp/>$image_queue_list[$specimen_pid][$image_id][&apos;workflow_status&apos;]==&quot;</highlight><highlight class="normal">queued</highlight><highlight class="stringliteral">&quot;){</highlight></codeline>
<codeline lineno="79"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>.=<sp/>$tempHTML;</highlight></codeline>
<codeline lineno="80"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$showAll<sp/>=<sp/>true;</highlight></codeline>
<codeline lineno="81"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$spHTMLDisplayed<sp/>=<sp/>true;</highlight></codeline>
<codeline lineno="82"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="83"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>foreach($rois<sp/>as<sp/>$roi_pid<sp/>=&gt;<sp/>$status){</highlight></codeline>
<codeline lineno="84"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_id<sp/>=<sp/>str_replace(&quot;</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">_</highlight><highlight class="stringliteral">&quot;,$roi_pid);</highlight></codeline>
<codeline lineno="85"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if($showAll<sp/>||<sp/>($roi_queue_list[$specimen_pid][$image_id][$roi_pid][&apos;workflow_status&apos;]<sp/>==<sp/>&quot;</highlight><highlight class="normal">queued</highlight><highlight class="stringliteral">&quot;<sp/>&amp;&amp;<sp/>$image_queue_list[$specimen_pid][$image_id][$roi_pid][&apos;locked_session&apos;]==$session_id)){</highlight></codeline>
<codeline lineno="86"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if(!$spHTMLDisplayed){</highlight></codeline>
<codeline lineno="87"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>.=<sp/>$tempHTML;</highlight></codeline>
<codeline lineno="88"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$spHTMLDisplayed<sp/>=<sp/>true;</highlight></codeline>
<codeline lineno="89"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="90"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-subheader</highlight><highlight class="stringliteral">&quot;&gt;</highlight></codeline>
<codeline lineno="91"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">roi_name</highlight><highlight class="stringliteral">&quot;&gt;ROI<sp/>Name<sp/>-&apos;.$roi_pid.&apos;<sp/>&lt;span<sp/>class=&quot;</highlight><highlight class="normal">roi_status</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="stringliteral">&apos;.<sp/>$specimen_id.&apos;</highlight><highlight class="normal">_</highlight><highlight class="stringliteral">&apos;<sp/>.<sp/>$roi_id<sp/>.&apos;</highlight><highlight class="stringliteral">&quot;&gt;[&apos;.$status[&quot;</highlight><highlight class="normal"><ref refid="workspace_8functions_8php_1a4fd3cbdcf1282bd92e9609b5de35863c" kindref="member">workflow_status</ref></highlight><highlight class="stringliteral">&quot;].&apos;]&lt;/span&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="92"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;</highlight></codeline>
<codeline lineno="93"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-subcontent</highlight><highlight class="stringliteral">&quot;&gt;</highlight></codeline>
<codeline lineno="94"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">transcribe_link</highlight><highlight class="stringliteral">&quot;&gt;&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;Transcribe&lt;/a&gt;<sp/>-<sp/>&lt;span<sp/>id=&quot;</highlight><highlight class="normal">roi_001_transcribe_status</highlight><highlight class="stringliteral">&quot;&gt;&apos;.$status[&quot;</highlight><highlight class="normal">transcribedStatus</highlight><highlight class="stringliteral">&quot;].&apos;&lt;/span&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="95"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;</highlight><highlight class="normal">parse_link</highlight><highlight class="stringliteral">&quot;&gt;&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;Parse&lt;/a&gt;<sp/>-<sp/>&lt;span<sp/>id=&quot;</highlight><highlight class="normal">roi_001_parse_status</highlight><highlight class="stringliteral">&quot;&gt;&apos;.$status[&quot;</highlight><highlight class="normal">parsedL1Status</highlight><highlight class="stringliteral">&quot;].&apos;&lt;/span&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="96"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;&apos;;</highlight></codeline>
<codeline lineno="97"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="98"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="99"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="100"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="101"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>.=<sp/>&apos;&lt;/div&gt;&lt;!--<sp/>widget-content<sp/>--&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="102"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="103"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>$returnHTML;</highlight></codeline>
<codeline lineno="104"><highlight class="stringliteral">}</highlight></codeline>
<codeline lineno="105"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="106" refid="analyze_8functions_8php_1afa0647e1c898c93547dcb3f7b7d8ceda" refkind="member"><highlight class="stringliteral">function<sp/>get_queue_list($workflow_id){</highlight></codeline>
<codeline lineno="107"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="108"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>=<sp/>&quot;</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="109"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if(Workflow_Users::doesWorkflowHaveUserName($workflow_id,<sp/>$user-&gt;name)<sp/>&amp;&amp;<sp/>Workflow_Permission::doesWorkflowHavePermission($workflow_id,<sp/>&quot;</highlight><highlight class="normal">canAnalyzeSpecimen</highlight><highlight class="stringliteral">&quot;)){</highlight></codeline>
<codeline lineno="110"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$wf<sp/>=<sp/>new<sp/>Workflow($workflow_id,<sp/>true);</highlight></codeline>
<codeline lineno="111"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$wf-&gt;loadWorkflowPools();</highlight></codeline>
<codeline lineno="112"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$wDom<sp/>=<sp/>$wf-&gt;workflow_dom;</highlight></codeline>
<codeline lineno="113"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$wDom<sp/>=<sp/>new<sp/>DOMXPath($wDom);$i=0;</highlight></codeline>
<codeline lineno="114"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$specimens<sp/>=<sp/>$wDom-&gt;query(&quot;</highlight><highlight class="comment">//workflow/specimen&quot;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($specimens<sp/>as<sp/>$specimen){</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$sp_temp<sp/>=<sp/>$wDom-&gt;query(</highlight><highlight class="stringliteral">&quot;//workflow/specimen/pid&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$specimen_pid<sp/>=<sp/>$sp_temp-&gt;item($i++)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$images<sp/>=<sp/>$wDom-&gt;query(</highlight><highlight class="stringliteral">&quot;//workflow/specimen[pid=&apos;$specimen_pid&apos;]/image&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$j<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal">($images<sp/>as<sp/>$image){</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$img_temp<sp/>=<sp/>$wDom-&gt;query(</highlight><highlight class="stringliteral">&quot;//workflow/specimen[pid=&apos;$specimen_pid&apos;]/image/pid&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$image_pid<sp/>=<sp/>$img_temp-&gt;item($j++)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rois<sp/>=<sp/>$wDom-&gt;query(</highlight><highlight class="stringliteral">&quot;//workflow/specimen[pid=&apos;$specimen_pid&apos;]/image[pid=&apos;$image_pid&apos;]/roi&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!empty($image-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&apos;analyzedStatus&apos;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue))</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$image_queue_list[$specimen_pid][$image_pid][</highlight><highlight class="stringliteral">&quot;analyzedStatus&quot;</highlight><highlight class="normal">]<sp/>=<sp/>$image-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&apos;analyzedStatus&apos;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$image_queue_list[$specimen_pid][$image_pid][</highlight><highlight class="stringliteral">&quot;analyzedStatus&quot;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;undefined&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$image_queue_list[$specimen_pid][$image_pid][</highlight><highlight class="stringliteral">&quot;workflow_status&quot;</highlight><highlight class="normal">]<sp/>=<sp/>$image-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&apos;workflow_status&apos;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$image_queue_list[$specimen_pid][$image_pid][</highlight><highlight class="stringliteral">&quot;locked_session&quot;</highlight><highlight class="normal">]<sp/>=<sp/>$image-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&apos;locked_session&apos;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$k<sp/>=<sp/>0;$roi_count=0;</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$total_rois<sp/>=<sp/>$rois-&gt;length;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_counts[$specimen_pid][</highlight><highlight class="stringliteral">&quot;total_rois&quot;</highlight><highlight class="normal">]<sp/>=<sp/>$total_rois;</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($total_rois<sp/>==<sp/>0){</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_queue_list[$specimen_pid][$image_pid]<sp/>=<sp/>$image_pid;</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal">($rois<sp/>as<sp/>$roi){</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_temp<sp/>=<sp/>$wDom-&gt;query(</highlight><highlight class="stringliteral">&quot;//workflow/specimen[pid=&apos;$specimen_pid&apos;]/image[pid=&apos;$image_pid&apos;]/roi/pid&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_pid<sp/>=<sp/>$roi_temp-&gt;item($k++)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list[$specimen_pid][$image_pid][]<sp/>=<sp/>$roi_pid;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_queue_list[$specimen_pid][$image_pid][$roi_pid][</highlight><highlight class="stringliteral">&quot;locked_session&quot;</highlight><highlight class="normal">]<sp/>=<sp/>$roi-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&apos;locked_session&apos;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!empty($roi-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&apos;workflow_status&apos;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue))</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_queue_list[$specimen_pid][$image_pid][$roi_pid][</highlight><highlight class="stringliteral">&quot;workflow_status&quot;</highlight><highlight class="normal">]<sp/>=<sp/>$roi-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&apos;workflow_status&apos;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_queue_list[$specimen_pid][$image_pid][$roi_pid][</highlight><highlight class="stringliteral">&quot;workflow_status&quot;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;undefined&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!empty($roi-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&apos;transcribedStatus&apos;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue))</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_queue_list[$specimen_pid][$image_pid][$roi_pid][</highlight><highlight class="stringliteral">&quot;transcribedStatus&quot;</highlight><highlight class="normal">]<sp/>=<sp/>$roi-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&apos;transcribedStatus&apos;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_queue_list[$specimen_pid][$image_pid][$roi_pid][</highlight><highlight class="stringliteral">&quot;transcribedStatus&quot;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;undefined&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!empty($roi-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&apos;transcribedStatus&apos;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue))</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_queue_list[$specimen_pid][$image_pid][$roi_pid][</highlight><highlight class="stringliteral">&quot;parsedL1Status&quot;</highlight><highlight class="normal">]<sp/>=<sp/>$roi-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&apos;parsedL1Status&apos;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_queue_list[$specimen_pid][$image_pid][$roi_pid][</highlight><highlight class="stringliteral">&quot;parsedL1Status&quot;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;undefined&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>array($roi_queue_list,<sp/>$image_queue_list,<sp/>$roi_counts);</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="158"><highlight class="normal">}</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160" refid="analyze_8functions_8php_1a5dd4d25616cb603dea2f5214f643bfb0" refkind="member"><highlight class="normal">function<sp/><ref refid="analyze_8functions_8php_1a5dd4d25616cb603dea2f5214f643bfb0" kindref="member">getImageROIList</ref>($image_pid,<sp/>$nothing,<sp/>$workflow_id){</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>global<sp/><ref refid="apiary__project_8php_1a00365e6c5f70c43fb2ed86c9bc5626e0" kindref="member">$user</ref>;</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(Workflow_Users::doesWorkflowHaveUserName($workflow_id,<sp/>$user-&gt;name)<sp/>&amp;&amp;<sp/>Workflow_Permission::doesWorkflowHavePermission($workflow_id,<sp/></highlight><highlight class="stringliteral">&quot;canAnalyzeSpecimen&quot;</highlight><highlight class="normal">)){</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_pids<sp/>=<sp/>AP_Image::getROIListForImage($image_pid);</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal">($roi_pids<sp/>as<sp/>$roi_pid){</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roiMetadata_record<sp/>=<sp/>AP_ROI::getroiMetadata_record($roi_pid);</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roiURL<sp/>=<sp/>$roiMetadata_record[</highlight><highlight class="stringliteral">&apos;roiURL&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$changedHeight<sp/>=<sp/><ref refid="analyze_8functions_8php_1ad640cacecc876546bdb4ed01084708aa" kindref="member">thumbHeightReset</ref>($roiMetadata_record[</highlight><highlight class="charliteral">&apos;h&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;w&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!$changedHeight)<sp/>{</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(strpos($roiURL,<sp/></highlight><highlight class="stringliteral">&apos;rft_id&apos;</highlight><highlight class="normal">)<sp/>&gt;<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_thumb_url<sp/>=<sp/>scaleDjatokaURL($roiURL,<sp/></highlight><highlight class="stringliteral">&apos;78&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;0&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_thumb_url<sp/>=<sp/>getDjatokaURL($roiMetadata_record[</highlight><highlight class="stringliteral">&apos;sourceURL&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;getRegion&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;100&apos;</highlight><highlight class="normal">,<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;y&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;x&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;h&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;w&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;78&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;0&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(strpos($roiURL,<sp/></highlight><highlight class="stringliteral">&apos;rft_id&apos;</highlight><highlight class="normal">)<sp/>&gt;<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$next_amp<sp/>=<sp/>strpos($roiURL,<sp/></highlight><highlight class="charliteral">&apos;&amp;&apos;</highlight><highlight class="normal">,<sp/>strpos($roiURL,<sp/></highlight><highlight class="stringliteral">&apos;rft_id&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rft_id<sp/>=<sp/>substr($roiURL,<sp/>(strpos($roiURL,<sp/></highlight><highlight class="stringliteral">&apos;rft_id&apos;</highlight><highlight class="normal">)+strlen(</highlight><highlight class="stringliteral">&apos;rft_id&apos;</highlight><highlight class="normal">)+1),<sp/>($next_amp<sp/>-<sp/>(strpos($roiURL,<sp/></highlight><highlight class="stringliteral">&apos;rft_id&apos;</highlight><highlight class="normal">)+strlen(</highlight><highlight class="stringliteral">&apos;rft_id&apos;</highlight><highlight class="normal">)+1)));</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_thumb_url<sp/>=<sp/>getDjatokaURL($rft_id,<sp/></highlight><highlight class="stringliteral">&apos;getRegion&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;100&apos;</highlight><highlight class="normal">,<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;y&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;x&apos;</highlight><highlight class="normal">],<sp/>$changedHeight<sp/>,<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;w&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;78&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;0&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_thumb_url<sp/>=<sp/>getDjatokaURL($roiMetadata_record[</highlight><highlight class="stringliteral">&apos;sourceURL&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;getRegion&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;100&apos;</highlight><highlight class="normal">,<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;y&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;x&apos;</highlight><highlight class="normal">],<sp/>$changedHeight<sp/>,<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;w&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;78&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;0&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status_dom<sp/>=<sp/>AP_ROI::getROIStatusDom($roi_pid);</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$transcribed_status<sp/>=<sp/>$status_dom-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&quot;transcribedStatus&quot;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parsed_status<sp/>=<sp/>$status_dom-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&quot;parsedL1Status&quot;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($transcribed_status<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$transcribed_status<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Undefined&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($parsed_status<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parsed_status<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Undefined&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>.=<sp/><ref refid="analyze_8functions_8php_1aa7f7268265f4049f5877aea14e6e1640" kindref="member">generate_roi_html</ref>($roi_pid,<sp/>$roi_thumb_url,<sp/>$roiMetadata_record,<sp/>$transcribed_status,<sp/>$parsed_status,<sp/>$workflow_id);</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//http_send_status(401);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;You<sp/>do<sp/>not<sp/>have<sp/>sufficient<sp/>permission&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>$returnHTML;</highlight></codeline>
<codeline lineno="202"><highlight class="normal">}</highlight></codeline>
<codeline lineno="203"><highlight class="normal"></highlight></codeline>
<codeline lineno="204" refid="analyze_8functions_8php_1a6e2ed9556330362fb26ad4654e83f932" refkind="member"><highlight class="normal">function<sp/><ref refid="analyze_8functions_8php_1a6e2ed9556330362fb26ad4654e83f932" kindref="member">getSpecimenROIList</ref>($specimen_pid,<sp/>$workflow_id,<sp/>$nothing){</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>global<sp/><ref refid="apiary__project_8php_1a00365e6c5f70c43fb2ed86c9bc5626e0" kindref="member">$user</ref>;</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(Workflow_Users::doesWorkflowHaveUserName($workflow_id,<sp/>$user-&gt;name)<sp/>&amp;&amp;<sp/>Workflow_Permission::doesWorkflowHavePermission($workflow_id,<sp/></highlight><highlight class="stringliteral">&quot;canAnalyzeSpecimen&quot;</highlight><highlight class="normal">)){</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$image_pids<sp/>=<sp/>AP_Specimen::getImageListForSpecimen($specimen_pid);</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_pids<sp/>=<sp/>AP_Image::getROIListForImage($image_pids[0]);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal">($roi_pids<sp/>as<sp/>$roi_pid){</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roiMetadata_record<sp/>=<sp/>AP_ROI::getroiMetadata_record($roi_pid);</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$changedHeight<sp/>=<sp/><ref refid="analyze_8functions_8php_1ad640cacecc876546bdb4ed01084708aa" kindref="member">thumbHeightReset</ref>($roiMetadata_record[</highlight><highlight class="charliteral">&apos;h&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;w&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!$changedHeight)</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_thumb_url<sp/>=<sp/>getDjatokaURL($roiMetadata_record[</highlight><highlight class="stringliteral">&apos;sourceURL&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;getRegion&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;100&apos;</highlight><highlight class="normal">,<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;y&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;x&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;h&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;w&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;78&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;0&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_thumb_url<sp/>=<sp/>getDjatokaURL($roiMetadata_record[</highlight><highlight class="stringliteral">&apos;sourceURL&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;getRegion&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;100&apos;</highlight><highlight class="normal">,<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;y&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;x&apos;</highlight><highlight class="normal">],<sp/>$changedHeight<sp/>,<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;w&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;78&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;0&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status_dom<sp/>=<sp/>AP_ROI::getROIStatusDom($roi_pid);</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$transcribed_status<sp/>=<sp/>$status_dom-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&quot;transcribedStatus&quot;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parsed_status<sp/>=<sp/>$status_dom-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&quot;parsedL1Status&quot;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($transcribed_status<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$transcribed_status<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Undefined&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($parsed_status<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parsed_status<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Undefined&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>.=<sp/><ref refid="analyze_8functions_8php_1aa7f7268265f4049f5877aea14e6e1640" kindref="member">generate_roi_html</ref>($roi_pid,<sp/>$roi_thumb_url,<sp/>$roiMetadata_record,<sp/>$transcribed_status,<sp/>$parsed_status,<sp/>$workflow_id);</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>http_send_status(401);</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;You<sp/>do<sp/>not<sp/>have<sp/>sufficient<sp/>permission&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>$returnHTML;</highlight></codeline>
<codeline lineno="232"><highlight class="normal">}</highlight></codeline>
<codeline lineno="233"><highlight class="normal"></highlight></codeline>
<codeline lineno="234" refid="analyze_8functions_8php_1af0279594674a2ff529d0fe3bfa916a05" refkind="member"><highlight class="normal">function<sp/><ref refid="analyze_8functions_8php_1af0279594674a2ff529d0fe3bfa916a05" kindref="member">get_roi_boxes</ref>($image_pid,<sp/>$nothing,<sp/>$workflow_id){</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>global<sp/><ref refid="apiary__project_8php_1a00365e6c5f70c43fb2ed86c9bc5626e0" kindref="member">$user</ref>;</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnBoxes<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(Workflow_Users::doesWorkflowHaveUserName($workflow_id,<sp/>$user-&gt;name)<sp/>&amp;&amp;<sp/>Workflow_Permission::doesWorkflowHavePermission($workflow_id,<sp/></highlight><highlight class="stringliteral">&quot;canAnalyzeSpecimen&quot;</highlight><highlight class="normal">)){</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_pids<sp/>=<sp/>AP_Image::getROIListForImage($image_pid);</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal">($roi_pids<sp/>as<sp/>$roi_pid){</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roiMetadata_record<sp/>=<sp/>AP_ROI::getroiMetadata_record($roi_pid);</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnBoxes[]<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&quot;y&quot;</highlight><highlight class="normal">=&gt;$roiMetadata_record[</highlight><highlight class="charliteral">&apos;y&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&quot;h&quot;</highlight><highlight class="normal">=&gt;$roiMetadata_record[</highlight><highlight class="charliteral">&apos;h&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&quot;x&quot;</highlight><highlight class="normal">=&gt;$roiMetadata_record[</highlight><highlight class="charliteral">&apos;x&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&quot;w&quot;</highlight><highlight class="normal">=&gt;$roiMetadata_record[</highlight><highlight class="charliteral">&apos;w&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&quot;type&quot;</highlight><highlight class="normal">=&gt;$roiMetadata_record[</highlight><highlight class="stringliteral">&apos;roiType&apos;</highlight><highlight class="normal">],</highlight><highlight class="stringliteral">&quot;pid&quot;</highlight><highlight class="normal">=&gt;$roi_pid);</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>json_encode($returnBoxes);</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>http_send_status(401);</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/></highlight><highlight class="stringliteral">&quot;You<sp/>do<sp/>not<sp/>have<sp/>sufficient<sp/>permission&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="249"><highlight class="normal">}</highlight></codeline>
<codeline lineno="250"><highlight class="normal"></highlight></codeline>
<codeline lineno="251" refid="analyze_8functions_8php_1ac3ad306edba53178755f1e17ba3ef052" refkind="member"><highlight class="normal">function<sp/><ref refid="analyze_8functions_8php_1ac3ad306edba53178755f1e17ba3ef052" kindref="member">remove_roi</ref>($roi_pid,<sp/>$nothing,<sp/>$workflow_id){</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>global<sp/><ref refid="apiary__project_8php_1a00365e6c5f70c43fb2ed86c9bc5626e0" kindref="member">$user</ref>;</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnjs<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(Workflow_Users::doesWorkflowHaveUserName($workflow_id,<sp/>$user-&gt;name)<sp/>&amp;&amp;<sp/>Workflow_Permission::doesWorkflowHavePermission($workflow_id,<sp/></highlight><highlight class="stringliteral">&quot;canAnalyzeSpecimen&quot;</highlight><highlight class="normal">)){</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_obj<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>roiHandler($roi_pid);</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$success<sp/>=<sp/>$roi_obj-&gt;removeROI($roi_pid,<sp/>FEDORA_DATABASE_USERNAME.</highlight><highlight class="stringliteral">&quot;:&quot;</highlight><highlight class="normal">.FEDORA_DATABASE_PASSWORD);</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($success)</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnjs<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;jQuery.jGrowl(&apos;ROI<sp/>[$roi_pid]<sp/>deleted<sp/>successfully&apos;);&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnjs<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;jQuery.jGrowl(&apos;ROI<sp/>[$roi_pid]<sp/>failed<sp/>to<sp/>delete&apos;);&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnjs<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;jQuery.jGrowl(&apos;Sorry!<sp/>You<sp/>do<sp/>not<sp/>have<sp/>permission<sp/>for<sp/>this<sp/>operation&apos;);&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>$returnjs;</highlight></codeline>
<codeline lineno="266"><highlight class="normal">}</highlight></codeline>
<codeline lineno="267"><highlight class="normal"></highlight></codeline>
<codeline lineno="268" refid="analyze_8functions_8php_1a82d69f9619642c6bb08dc1d7ea672027" refkind="member"><highlight class="normal">function<sp/><ref refid="analyze_8functions_8php_1a82d69f9619642c6bb08dc1d7ea672027" kindref="member">create_roi</ref>($image_pid,<sp/>$options,<sp/>$workflow_id){</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>global<sp/><ref refid="apiary__project_8php_1a00365e6c5f70c43fb2ed86c9bc5626e0" kindref="member">$user</ref>;</highlight></codeline>
<codeline lineno="270"><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(Workflow_Users::doesWorkflowHaveUserName($workflow_id,<sp/>$user-&gt;name)<sp/>&amp;&amp;<sp/>Workflow_Permission::doesWorkflowHavePermission($workflow_id,<sp/></highlight><highlight class="stringliteral">&quot;canAnalyzeSpecimen&quot;</highlight><highlight class="normal">)){</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>global<sp/>$base_url;</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>list($true_y1,<sp/>$true_x1,<sp/>$true_height,<sp/>$true_width,<sp/>$roi_type)<sp/>=<sp/>explode(</highlight><highlight class="stringliteral">&quot;:&quot;</highlight><highlight class="normal">,$options);</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($roi_type==</highlight><highlight class="stringliteral">&quot;Annotation&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_type<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Annotation/Other&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roiMetadata_base_url<sp/>=<sp/>$base_url;</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$imageMetadata_record<sp/>=<sp/>AP_Image::getimageMetadata_record($image_pid);</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parent_image_height<sp/>=<sp/>$imageMetadata_record[</highlight><highlight class="stringliteral">&quot;h&quot;</highlight><highlight class="normal">];</highlight><highlight class="comment">//To<sp/>Be<sp/>Removed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parent_image_width<sp/>=<sp/>$imageMetadata_record[</highlight><highlight class="stringliteral">&quot;w&quot;</highlight><highlight class="normal">];</highlight><highlight class="comment">//To<sp/>Be<sp/>Removed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$sourceURL<sp/>=<sp/>$imageMetadata_record[</highlight><highlight class="stringliteral">&apos;URL&apos;</highlight><highlight class="normal">];</highlight><highlight class="comment">//To<sp/>Be<sp/>Removed//The<sp/>ROI<sp/>sourceURL<sp/>is<sp/>the<sp/>ap-image<sp/>URL</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parent_image_display_width<sp/>=<sp/>650;</highlight><highlight class="comment">//To<sp/>Be<sp/>Removed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parent_image_display_height<sp/>=<sp/>($parent_image_height*$parent_image_display_width)/$parent_image_width;</highlight><highlight class="comment">//To<sp/>Be<sp/>Removed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rft_id<sp/>=<sp/>$imageMetadata_record[</highlight><highlight class="stringliteral">&apos;rft_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roiURL<sp/>=<sp/>getDjatokaURL($rft_id,<sp/></highlight><highlight class="stringliteral">&apos;getRegion&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;100&apos;</highlight><highlight class="normal">,<sp/>$true_y1,<sp/>$true_x1,<sp/>$true_height,<sp/>$true_width,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_roi<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>AP_ROI();</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_roi-&gt;roiMetadata_base_url<sp/>=<sp/>$roiMetadata_base_url;</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>$new_roi-&gt;createROIObject($image_pid,<sp/>$sourceURL,<sp/>$roiURL,<sp/>$roi_type,<sp/>$true_x1,<sp/>$true_y1,<sp/>$true_width,<sp/>$true_height,<sp/>$parent_image_width,<sp/>$parent_image_height,<sp/>$parent_image_display_width,<sp/>$parent_image_display_height,<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_pid<sp/>=<sp/>$new_roi-&gt;pid;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roiMetadata_record<sp/>=<sp/>AP_ROI::getroiMetadata_record($roi_pid);</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$changedHeight<sp/>=<sp/><ref refid="analyze_8functions_8php_1ad640cacecc876546bdb4ed01084708aa" kindref="member">thumbHeightReset</ref>($roiMetadata_record[</highlight><highlight class="charliteral">&apos;h&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;w&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!$changedHeight)</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_thumb_url<sp/>=<sp/>getDjatokaURL($roiMetadata_record[</highlight><highlight class="stringliteral">&apos;sourceURL&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;getRegion&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;100&apos;</highlight><highlight class="normal">,<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;y&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;x&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;h&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;w&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;78&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;0&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_thumb_url<sp/>=<sp/>getDjatokaURL($roiMetadata_record[</highlight><highlight class="stringliteral">&apos;sourceURL&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;getRegion&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;100&apos;</highlight><highlight class="normal">,<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;y&apos;</highlight><highlight class="normal">],<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;x&apos;</highlight><highlight class="normal">],<sp/>$changedHeight<sp/>,<sp/>$roiMetadata_record[</highlight><highlight class="charliteral">&apos;w&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;78&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;0&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status_dom<sp/>=<sp/>AP_ROI::getROIStatusDom($roi_pid);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$transcribed_status<sp/>=<sp/>$status_dom-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&quot;transcribedStatus&quot;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parsed_status<sp/>=<sp/>$status_dom-&gt;getElementsByTagName(</highlight><highlight class="stringliteral">&quot;parsedL1Status&quot;</highlight><highlight class="normal">)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($transcribed_status<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$transcribed_status<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Undefined&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($parsed_status<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parsed_status<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Undefined&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$html<sp/>=<sp/><ref refid="analyze_8functions_8php_1aa7f7268265f4049f5877aea14e6e1640" kindref="member">generate_roi_html</ref>($roi_pid,<sp/>$roi_thumb_url,<sp/>$roiMetadata_record,<sp/>$transcribed_status,<sp/>$parsed_status,<sp/>$workflow_id);</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML[</highlight><highlight class="stringliteral">&apos;html&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$html;</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML[</highlight><highlight class="stringliteral">&apos;pid&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$roi_pid;</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML[</highlight><highlight class="stringliteral">&apos;roi_queue_html&apos;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="analyze_8functions_8php_1a42cc21dd56bf989bad557ca72edef3fc" kindref="member">add_roi_to_queue</ref>($image_pid,<sp/>$roi_pid,<sp/>$workflow_id);</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($status<sp/>==<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">){</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//Echo<sp/>JQuery<sp/>function<sp/>to<sp/>add<sp/>HTML<sp/>for<sp/>new<sp/>ROI</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>header(</highlight><highlight class="stringliteral">&apos;HTTP/1.1<sp/>401<sp/>Unauthorized&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnHTML<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;Sorry!<sp/>You<sp/>do<sp/>not<sp/>have<sp/>permission<sp/>for<sp/>this<sp/>operation&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>json_encode($returnHTML);</highlight></codeline>
<codeline lineno="315"><highlight class="normal">}</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight></codeline>
<codeline lineno="317" refid="analyze_8functions_8php_1aa7f7268265f4049f5877aea14e6e1640" refkind="member"><highlight class="normal">function<sp/><ref refid="analyze_8functions_8php_1aa7f7268265f4049f5877aea14e6e1640" kindref="member">generate_roi_html</ref>($roi_pid,<sp/>$roi_thumb_url,<sp/>$roiMetadata_record,<sp/>$transcribe_status,<sp/>$parsed_status,<sp/>$workflow_id=null){</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$permission_map<sp/>=<sp/><ref refid="analyze_8functions_8php_1ad3ad3c24ee1cf11791c0370dba068f3d" kindref="member">get_permission_map</ref>($workflow_id);</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_pid_replacement<sp/>=<sp/>str_replace(</highlight><highlight class="stringliteral">&quot;:&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;_&quot;</highlight><highlight class="normal">,<sp/>$roi_pid);</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$html<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;roi-section&quot;<sp/>id=&quot;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="stringliteral">&apos;-section&quot;<sp/>&gt;</highlight></codeline>
<codeline lineno="321"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;roi-preview&quot;<sp/>id=&quot;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="stringliteral">&apos;-preview&quot;&gt;</highlight></codeline>
<codeline lineno="322"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;img<sp/>src=&quot;&apos;</highlight><highlight class="normal">.<sp/>$roi_thumb_url<sp/>.</highlight><highlight class="stringliteral">&apos;&quot;<sp/>/&gt;</highlight></codeline>
<codeline lineno="323"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;</highlight></codeline>
<codeline lineno="324"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;roi-controls&quot;<sp/>id=&quot;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="stringliteral">&apos;-controls&quot;&gt;</highlight></codeline>
<codeline lineno="325"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ROI<sp/>Type:&lt;span<sp/>class=&quot;roi-type&quot;<sp/>id=&quot;&apos;</highlight><highlight class="normal">.$roi_pid_replacement.</highlight><highlight class="stringliteral">&apos;-type&quot;&gt;&apos;</highlight><highlight class="normal">.$roiMetadata_record[</highlight><highlight class="stringliteral">&quot;roiType&quot;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;&lt;/span&gt;</highlight></codeline>
<codeline lineno="326"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;a<sp/>id=&quot;roi-type-edit-&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="stringliteral">&apos;&quot;<sp/>href=&quot;javascript:editROIType(\&apos;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">);</highlight><highlight class="stringliteral">&quot;&gt;Edit&lt;/a&gt;&lt;br/&gt;&apos;;</highlight></codeline>
<codeline lineno="327"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>if<sp/>(<sp/>$permission_map[&apos;canTranscribe&apos;]<sp/>)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="328"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$html<sp/>.=<sp/>&apos;&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;<sp/>onclick=&quot;</highlight><highlight class="normal">transcribe_roi(\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">);</highlight><highlight class="stringliteral">&quot;&gt;Transcription:&lt;/a&gt;&apos;;</highlight></codeline>
<codeline lineno="329"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>else</highlight></codeline>
<codeline lineno="330"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$html<sp/>.=<sp/>&apos;Transcription:&apos;;</highlight></codeline>
<codeline lineno="331"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>$html<sp/>.=<sp/>&apos;&lt;span<sp/>class=&quot;</highlight><highlight class="normal">roi-transcription-status</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="stringliteral">&apos;.$roi_pid.&apos;</highlight><highlight class="normal">-transcription-status</highlight><highlight class="stringliteral">&quot;&gt;&apos;.$transcribe_status.&apos;&lt;/span&gt;&lt;br/&gt;&apos;;</highlight></codeline>
<codeline lineno="332"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>if<sp/>(<sp/>$permission_map[&apos;canParseL1&apos;]<sp/>||<sp/>$permission_map[&apos;canParseL2&apos;]<sp/>||<sp/>$permission_map[&apos;canParseL3&apos;]<sp/>)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="333"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$html<sp/>.=<sp/>&apos;&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;<sp/>onclick=&quot;</highlight><highlight class="normal">parse_roi(\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">,<sp/>\</highlight><highlight class="stringliteral">&apos;1\&apos;);&quot;&gt;Parsing:&lt;/a&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$html<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;Parsing:&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/>$html<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;span<sp/>class=&quot;roi-parsing-status&quot;<sp/>id=&quot;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="stringliteral">&apos;parsing-status&quot;&gt;&apos;</highlight><highlight class="normal">.$parsed_status.</highlight><highlight class="stringliteral">&apos;&lt;/span&gt;</highlight></codeline>
<codeline lineno="337"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;clearfix&quot;&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="338"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>class=&quot;floatleft&quot;&gt;&lt;a<sp/>href=&quot;javascript:delete_roi(\&apos;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">)</highlight><highlight class="stringliteral">&quot;<sp/>class=&quot;</highlight><highlight class="keyword">delete</highlight><highlight class="normal">-roi</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="stringliteral">&apos;.$roi_pid.&apos;</highlight><highlight class="normal">-</highlight><highlight class="keyword">delete</highlight><highlight class="normal">-roi</highlight><highlight class="stringliteral">&quot;&gt;Delete<sp/>ROI&lt;/a&gt;&lt;/div&gt;</highlight></codeline>
<codeline lineno="339"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;</highlight></codeline>
<codeline lineno="340"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;&apos;;</highlight></codeline>
<codeline lineno="341"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>$html;</highlight></codeline>
<codeline lineno="342"><highlight class="stringliteral">}</highlight></codeline>
<codeline lineno="343"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="344" refid="analyze_8functions_8php_1a017338342276e0f6727737108e7cee43" refkind="member"><highlight class="stringliteral">function<sp/>add_queue_roi_to_queue($image_pid,<sp/>$roi_pid,<sp/>$workflow_id)<sp/>{</highlight></codeline>
<codeline lineno="345"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>add_roi_to_queue($image_pid,<sp/>$roi_pid,<sp/>$workflow_id);</highlight></codeline>
<codeline lineno="346"><highlight class="stringliteral">}</highlight></codeline>
<codeline lineno="347"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="348" refid="analyze_8functions_8php_1a42cc21dd56bf989bad557ca72edef3fc" refkind="member"><highlight class="stringliteral">function<sp/>add_roi_to_queue($image_pid,<sp/>$roi_pid,<sp/>$workflow_id)<sp/>{</highlight></codeline>
<codeline lineno="349"><highlight class="stringliteral"><sp/><sp/>$queue_item_html<sp/>=<sp/>&apos;&apos;;</highlight></codeline>
<codeline lineno="350"><highlight class="stringliteral"><sp/><sp/>$status_dom<sp/>=<sp/>AP_ROI::getROILock($roi_pid);</highlight></codeline>
<codeline lineno="351"><highlight class="stringliteral"><sp/><sp/>if($status_dom<sp/>!=<sp/>false)<sp/>{</highlight></codeline>
<codeline lineno="352"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>$transcribedStatus<sp/>=<sp/>$status_dom-&gt;getElementsByTagName(&apos;transcribedStatus&apos;)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="353"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>$parsedL1Status<sp/>=<sp/>$status_dom-&gt;getElementsByTagName(&apos;parsedL1Status&apos;)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="354"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>$locked<sp/>=<sp/>$status_dom-&gt;getElementsByTagName(&apos;locked&apos;)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="355"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>$locked_time<sp/>=<sp/>$status_dom-&gt;getElementsByTagName(&apos;locked_time&apos;)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="356"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>$locked_session<sp/>=<sp/>$status_dom-&gt;getElementsByTagName(&apos;locked_session&apos;)-&gt;item(0)-&gt;nodeValue;</highlight></codeline>
<codeline lineno="357"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>$workflow_status<sp/>=<sp/>workflow_status($locked,<sp/>$locked_time,<sp/>$locked_session);</highlight></codeline>
<codeline lineno="358"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>$queue_item_html<sp/>.=<sp/>create_queue_list_roi($roi_pid,<sp/>$image_pid,<sp/>$transcribedStatus,<sp/>$parsedL1Status,<sp/>$locked_by,<sp/>$workflow_status,<sp/>$workflow_id);</highlight></codeline>
<codeline lineno="359"><highlight class="stringliteral"><sp/><sp/>}</highlight></codeline>
<codeline lineno="360"><highlight class="stringliteral"><sp/><sp/>else<sp/>{</highlight></codeline>
<codeline lineno="361"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>$queue_item_html<sp/>=<sp/>&quot;</highlight><highlight class="normal">locked</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="362"><highlight class="stringliteral"><sp/><sp/>}</highlight></codeline>
<codeline lineno="363"><highlight class="stringliteral"><sp/><sp/>return<sp/>$queue_item_html;</highlight></codeline>
<codeline lineno="364"><highlight class="stringliteral">}</highlight></codeline>
<codeline lineno="365"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="366" refid="analyze_8functions_8php_1a734deca8701dbc178f8deab344dc6919" refkind="member"><highlight class="stringliteral">function<sp/>create_queue_list_image($image_pid,<sp/>$specimen_pid,<sp/>$analyzedStatus,<sp/>$roi_count,<sp/>$locked_by,<sp/>$workflow_status,$workflow_id=null)<sp/>{</highlight></codeline>
<codeline lineno="367"><highlight class="stringliteral"><sp/><sp/>if(empty($analyzedStatus))<sp/>{</highlight></codeline>
<codeline lineno="368"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>$analyzedStatus<sp/>=<sp/>&apos;not<sp/>started&apos;;</highlight></codeline>
<codeline lineno="369"><highlight class="stringliteral"><sp/><sp/>}</highlight></codeline>
<codeline lineno="370"><highlight class="stringliteral"><sp/><sp/>if($workflow_status<sp/>==<sp/>&quot;</highlight><highlight class="normal">queued</highlight><highlight class="stringliteral">&quot;)<sp/>{</highlight></codeline>
<codeline lineno="371"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list_class<sp/>=<sp/>&apos;specimen_queued&apos;;</highlight></codeline>
<codeline lineno="372"><highlight class="stringliteral"><sp/><sp/>}</highlight></codeline>
<codeline lineno="373"><highlight class="stringliteral"><sp/><sp/>else<sp/>if($workflow_status<sp/>==<sp/>&quot;</highlight><highlight class="normal">available</highlight><highlight class="stringliteral">&quot;)<sp/>{</highlight></codeline>
<codeline lineno="374"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list_class<sp/>=<sp/>&apos;specimen_available&apos;;</highlight></codeline>
<codeline lineno="375"><highlight class="stringliteral"><sp/><sp/>}</highlight></codeline>
<codeline lineno="376"><highlight class="stringliteral"><sp/><sp/>else<sp/>if($workflow_status<sp/>==<sp/>&quot;</highlight><highlight class="normal">locked</highlight><highlight class="stringliteral">&quot;)<sp/>{</highlight></codeline>
<codeline lineno="377"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list_class<sp/>=<sp/>&apos;specimen_locked&apos;;</highlight></codeline>
<codeline lineno="378"><highlight class="stringliteral"><sp/><sp/>}</highlight></codeline>
<codeline lineno="379"><highlight class="stringliteral"><sp/><sp/>$permission_map<sp/>=<sp/>get_permission_map($workflow_id);</highlight></codeline>
<codeline lineno="380"><highlight class="stringliteral"><sp/><sp/>$image_id_url<sp/>=<sp/>get_djatoka_url_by_height($image_pid,<sp/>&quot;</highlight><highlight class="normal">100</highlight><highlight class="stringliteral">&quot;);</highlight></codeline>
<codeline lineno="381"><highlight class="stringliteral"><sp/><sp/>$queue_list_image_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-header<sp/></highlight><highlight class="stringliteral">&apos;.$queue_list_class.&apos;</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="stringliteral">&apos;.str_replace(&apos;</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">__</highlight><highlight class="stringliteral">&apos;,<sp/>$image_pid).&apos;</highlight><highlight class="normal">_queue</highlight><highlight class="stringliteral">&quot;&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="382"><highlight class="stringliteral"><sp/><sp/>$queue_list_image_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-header-left</highlight><highlight class="stringliteral">&quot;<sp/><sp/>&apos;;</highlight></codeline>
<codeline lineno="383"><highlight class="stringliteral"><sp/><sp/>if<sp/>(<sp/>$permission_map[&apos;canAnalyzeSpecimen&apos;]<sp/>)</highlight></codeline>
<codeline lineno="384"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list_image_html<sp/>.=<sp/>&apos;onclick=&quot;</highlight><highlight class="normal">select_specimen(\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.$image_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">)</highlight><highlight class="stringliteral">&quot;&apos;;</highlight></codeline>
<codeline lineno="385"><highlight class="stringliteral"><sp/><sp/>$queue_list_image_html<sp/>.=<sp/>&apos;&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="386"><highlight class="stringliteral"><sp/><sp/>$queue_list_image_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">specimen_name</highlight><highlight class="stringliteral">&quot;<sp/>image_pid=&quot;</highlight><highlight class="stringliteral">&apos;.$image_pid.&apos;</highlight><highlight class="stringliteral">&quot;<sp/>image_id=&quot;</highlight><highlight class="stringliteral">&apos;.$image_id_url.&apos;</highlight><highlight class="stringliteral">&quot;<sp/>specimen_pid=&quot;</highlight><highlight class="stringliteral">&apos;.$specimen_pid.&apos;</highlight><highlight class="stringliteral">&quot;&gt;Specimen:<sp/>&apos;.<sp/>str_replace(&apos;ap-specimen:&apos;,<sp/>&apos;&apos;,<sp/>$specimen_pid).&apos;&lt;span<sp/>class=&quot;</highlight><highlight class="normal">specimen_status</highlight><highlight class="stringliteral">&quot;&gt;<sp/>-<sp/>&apos;.$analyzedStatus.&apos;&lt;/span&gt;&lt;/div&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="387"><highlight class="stringliteral"><sp/><sp/>//$queue_list_image_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">specimen_header_detail</highlight><highlight class="stringliteral">&quot;&gt;Contains<sp/>&lt;span<sp/>id=&quot;</highlight><highlight class="normal">roi_count_</highlight><highlight class="stringliteral">&apos;.str_replace(&apos;</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">__</highlight><highlight class="stringliteral">&apos;,<sp/>$image_pid).&apos;</highlight><highlight class="stringliteral">&quot;&gt;&apos;.<sp/>$roi_count<sp/>.&apos;&lt;/span&gt;<sp/>ROIs<sp/>-<sp/>&lt;span<sp/>class=&quot;</highlight><highlight class="normal">specimen_header_utility</highlight><highlight class="stringliteral">&quot;&gt;&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;<sp/>onclick=&quot;</highlight><highlight class="normal">select_specimen(\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.$image_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">)</highlight><highlight class="stringliteral">&quot;&gt;analyze&lt;/a&gt;<sp/>&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;<sp/>onclick=&quot;</highlight><highlight class="normal">remove_specimen(\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.$image_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">)</highlight><highlight class="stringliteral">&quot;&gt;remove&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="388"><highlight class="stringliteral"><sp/><sp/>$queue_list_image_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">specimen_header_detail</highlight><highlight class="stringliteral">&quot;&gt;Contains<sp/>&lt;span<sp/>id=&quot;</highlight><highlight class="normal">roi_count_</highlight><highlight class="stringliteral">&apos;.str_replace(&apos;</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">__</highlight><highlight class="stringliteral">&apos;,<sp/>$image_pid).&apos;</highlight><highlight class="stringliteral">&quot;&gt;&apos;.<sp/>$roi_count<sp/>.&apos;&lt;/span&gt;<sp/>ROIs<sp/>-<sp/>&lt;span<sp/>class=&quot;</highlight><highlight class="normal">specimen_header_utility</highlight><highlight class="stringliteral">&quot;&gt;&apos;;</highlight></codeline>
<codeline lineno="389"><highlight class="stringliteral"><sp/><sp/>if<sp/>(<sp/>$permission_map[&apos;canAnalyzeSpecimen&apos;]<sp/>)</highlight></codeline>
<codeline lineno="390"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list_image_html<sp/>.=<sp/>&apos;&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;analyze&lt;/a&gt;&apos;;</highlight></codeline>
<codeline lineno="391"><highlight class="stringliteral"><sp/><sp/>$queue_list_image_html<sp/>.=<sp/>&apos;<sp/>&lt;/span&gt;&lt;/div&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="392"><highlight class="stringliteral"><sp/><sp/>$queue_list_image_html<sp/>.=<sp/>&apos;&lt;/div&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="393"><highlight class="stringliteral"><sp/><sp/>$queue_list_image_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-header-right</highlight><highlight class="stringliteral">&quot;&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="394"><highlight class="stringliteral"><sp/><sp/>$queue_list_image_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-menu</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="normal">menu-</highlight><highlight class="stringliteral">&apos;.str_replace(&apos;</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">__</highlight><highlight class="stringliteral">&apos;,<sp/>$image_pid).&apos;</highlight><highlight class="stringliteral">&quot;<sp/>onclick=&quot;</highlight><highlight class="normal">open_specimen_menu(\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.str_replace(</highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;__&apos;</highlight><highlight class="normal">,<sp/>$image_pid).</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">);</highlight><highlight class="stringliteral">&quot;&gt;&lt;img<sp/>src=&quot;</highlight><highlight class="normal">http:</highlight><highlight class="comment">//dev.apiaryproject.org/drupal/modules/apiary_project/workflow/assets/img/gear.png&quot;/&gt;&lt;/div&gt;&apos;.&quot;\n&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/>$queue_list_image_html<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;widget-control&quot;<sp/>id=&quot;control-&apos;</highlight><highlight class="normal">.str_replace(</highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;__&apos;</highlight><highlight class="normal">,<sp/>$image_pid).</highlight><highlight class="stringliteral">&apos;&quot;<sp/>onclick=&quot;toggle_specimen(\&apos;content-&apos;</highlight><highlight class="normal">.str_replace(</highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;__&apos;</highlight><highlight class="normal">,<sp/>$image_pid).</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">);</highlight><highlight class="stringliteral">&quot;&gt;&lt;img<sp/>src=&quot;</highlight><highlight class="normal">http:</highlight><highlight class="comment">//dev.apiaryproject.org/drupal/modules/apiary_project/workflow/assets/img/icon_closed.png&quot;/&gt;&lt;/div&gt;&apos;.&quot;\n&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//$queue_list_image_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;widget-header-right&quot;<sp/>onclick=&quot;toggle_specimen(\&apos;content-&apos;.str_replace(&apos;:&apos;,<sp/>&apos;__&apos;,<sp/>$image_pid).&apos;\&apos;);&quot;&gt;&apos;.&quot;\n&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//$queue_list_image_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;widget-control&quot;<sp/>id=&quot;control-&apos;.str_replace(&apos;:&apos;,<sp/>&apos;__&apos;,<sp/>$image_pid).&apos;&quot;&gt;&lt;img<sp/>src=&quot;assets/img/icon_closed.png&quot;/&gt;&lt;/div&gt;&apos;.&quot;\n&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/>$queue_list_image_html<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">.</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/>$queue_list_image_html<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&lt;!--<sp/>widget-header<sp/>--&gt;&apos;</highlight><highlight class="normal">.</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$queue_list_image_html;</highlight></codeline>
<codeline lineno="401"><highlight class="normal">}</highlight></codeline>
<codeline lineno="402"><highlight class="normal"></highlight></codeline>
<codeline lineno="403" refid="analyze_8functions_8php_1a3f96187322c4cb55b00f35ebda175b8b" refkind="member"><highlight class="normal">function<sp/><ref refid="analyze_8functions_8php_1a3f96187322c4cb55b00f35ebda175b8b" kindref="member">create_queue_list_roi</ref>($roi_pid,<sp/>$image_pid,<sp/>$transcribedStatus,<sp/>$parsedL1Status,<sp/>$locked_by,<sp/>$workflow_status,<sp/>$workflow_id)<sp/>{</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//default<sp/>style<sp/>is<sp/>to<sp/>be<sp/>shown</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/>$transcribe_link_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/>$parse_link_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/>$queue_add_link_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/>$queue_remove_link_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/>$queue_locked_by_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($workflow_status<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;queued&quot;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_add_link_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;style=&quot;display:none;&quot;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_locked_by_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;style=&quot;display:none;&quot;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list_class<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;roi_queued&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($workflow_status<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;available&quot;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$transcribe_link_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;style=&quot;display:none;&quot;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parse_link_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;style=&quot;display:none;&quot;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_remove_link_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;style=&quot;display:none;&quot;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_locked_by_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;style=&quot;display:none;&quot;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list_class<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;roi_available&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($workflow_status<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;locked&quot;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$transcribe_link_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;style=&quot;display:none;&quot;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parse_link_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;style=&quot;display:none;&quot;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_add_link_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;style=&quot;display:none;&quot;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_remove_link_style<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;style=&quot;display:none;&quot;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list_class<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;roi_locked&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(empty($transcribedStatus))<sp/>{</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/>$transcribedStatus<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;not<sp/>started&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(empty($parsedL1Status))<sp/>{</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/>$parsedL1Status<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;not<sp/>started&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/>$permission_map<sp/>=<sp/><ref refid="analyze_8functions_8php_1ad3ad3c24ee1cf11791c0370dba068f3d" kindref="member">get_permission_map</ref>($workflow_id);</highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;&apos;</highlight><highlight class="normal">.str_replace(</highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;__&apos;</highlight><highlight class="normal">,<sp/>$roi_pid).</highlight><highlight class="stringliteral">&apos;_queue&quot;<sp/>class=&quot;&apos;</highlight><highlight class="normal">.$queue_list_class.</highlight><highlight class="stringliteral">&apos;&quot;&gt;&apos;</highlight><highlight class="normal">.</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;widget-subheader&quot;&gt;&apos;</highlight><highlight class="normal">.</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;roi_name&quot;<sp/>roi_pid=&quot;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="stringliteral">&apos;&quot;<sp/>image_pid=&quot;&apos;</highlight><highlight class="normal">.$image_pid.</highlight><highlight class="stringliteral">&apos;&quot;&gt;Region:<sp/>&apos;</highlight><highlight class="normal">.str_replace(</highlight><highlight class="stringliteral">&apos;ap-roi:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>$roi_pid);</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;span<sp/>class=&quot;roi_status&quot;<sp/>id=&quot;&apos;</highlight><highlight class="normal">.<sp/>str_replace(</highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;__&apos;</highlight><highlight class="normal">,<sp/>$image_pid).</highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$roi_pid<sp/>.</highlight><highlight class="stringliteral">&apos;_queue&quot;&gt;<sp/>--<sp/>&lt;/span&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;span<sp/>class=&quot;queue_add_link&quot;<sp/>onclick=&quot;add_queue_roi_to_queue(\&apos;&apos;</highlight><highlight class="normal">.$image_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">,<sp/>\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">)</highlight><highlight class="stringliteral">&quot;<sp/>&apos;.$queue_add_link_style.&apos;&gt;not<sp/>in<sp/>queue<sp/>&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;add&lt;/a&gt;&lt;/span&gt;&apos;;</highlight></codeline>
<codeline lineno="442"><highlight class="stringliteral"><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;span<sp/>class=&quot;</highlight><highlight class="normal">queue_remove_link</highlight><highlight class="stringliteral">&quot;<sp/>onclick=&quot;</highlight><highlight class="normal">remove_queue_item_from_queue(\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">)</highlight><highlight class="stringliteral">&quot;<sp/>&apos;.$queue_remove_link_style.&apos;&gt;in<sp/>queue<sp/>&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;remove&lt;/a&gt;&lt;/span&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="443"><highlight class="stringliteral"><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;span<sp/>class=&quot;</highlight><highlight class="normal">queue_locked_by</highlight><highlight class="stringliteral">&quot;<sp/>&apos;.$queue_locked_by_style.&apos;&gt;locked<sp/>by<sp/>&apos;.$locked_by.&apos;&lt;/span&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="444"><highlight class="stringliteral"><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;/div&gt;&lt;!--<sp/>roi-name<sp/>--&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="445"><highlight class="stringliteral"><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;/div&gt;&lt;!--<sp/>widget-subheader<sp/>--&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="446"><highlight class="stringliteral"><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">widget-subcontent</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="normal">widget-subcontent-</highlight><highlight class="stringliteral">&apos;.str_replace(&apos;</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">__</highlight><highlight class="stringliteral">&apos;,<sp/>$roi_pid).&apos;</highlight><highlight class="stringliteral">&quot;&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="447"><highlight class="stringliteral"><sp/><sp/>if<sp/>(<sp/>$permission_map[&apos;canTranscribe&apos;]<sp/>)</highlight></codeline>
<codeline lineno="448"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">transcribe_link</highlight><highlight class="stringliteral">&quot;<sp/>onclick=&quot;</highlight><highlight class="normal">transcribe_roi(\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">);</highlight><highlight class="stringliteral">&quot;<sp/>&apos;.$transcribe_link_style.&apos;&gt;&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;Transcribe&lt;/a&gt;<sp/>-<sp/>&lt;span<sp/>class=&quot;</highlight><highlight class="normal">transcribe_status</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="normal">roi_001_transcribe_status</highlight><highlight class="stringliteral">&quot;&gt;&apos;.$transcribedStatus.&apos;&lt;/span&gt;&lt;/div&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="449"><highlight class="stringliteral"><sp/><sp/>else</highlight></codeline>
<codeline lineno="450"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">transcribe_link</highlight><highlight class="stringliteral">&quot;<sp/>&apos;.$transcribe_link_style.&apos;&gt;Transcribe<sp/>-<sp/>&lt;span<sp/>class=&quot;</highlight><highlight class="normal">transcribe_status</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="normal">roi_001_transcribe_status</highlight><highlight class="stringliteral">&quot;&gt;&apos;.$transcribedStatus.&apos;&lt;/span&gt;&lt;/div&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="451"><highlight class="stringliteral"><sp/><sp/>if<sp/>(<sp/>$permission_map[&apos;canParseL1&apos;]<sp/>||<sp/>$permission_map[&apos;canParseL2&apos;]<sp/>||<sp/>$permission_map[&apos;canParseL3&apos;]<sp/>)</highlight></codeline>
<codeline lineno="452"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">parse_link</highlight><highlight class="stringliteral">&quot;<sp/>onclick=&quot;</highlight><highlight class="normal">parse_roi(\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">,1)</highlight><highlight class="stringliteral">&quot;<sp/>&apos;.$parse_link_style.&apos;&gt;&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;Parse&lt;/a&gt;<sp/>-<sp/>&lt;span<sp/>class=&quot;</highlight><highlight class="normal">parse_status</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="normal">roi_001_parse_status</highlight><highlight class="stringliteral">&quot;&gt;&apos;.$parsedL1Status.&apos;&lt;/span&gt;&lt;/div&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="453"><highlight class="stringliteral"><sp/><sp/>else</highlight></codeline>
<codeline lineno="454"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">parse_link</highlight><highlight class="stringliteral">&quot;<sp/>&apos;.$parse_link_style.&apos;&gt;Parse<sp/>-<sp/>&lt;span<sp/>class=&quot;</highlight><highlight class="normal">parse_status</highlight><highlight class="stringliteral">&quot;<sp/>id=&quot;</highlight><highlight class="normal">roi_001_parse_status</highlight><highlight class="stringliteral">&quot;&gt;&apos;.$parsedL1Status.&apos;&lt;/span&gt;&lt;/div&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="455"><highlight class="stringliteral"><sp/><sp/>//$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">queue_add_link</highlight><highlight class="stringliteral">&quot;<sp/>onclick=&quot;</highlight><highlight class="normal"><ref refid="analyze_8functions_8php_1a017338342276e0f6727737108e7cee43" kindref="member">add_queue_roi_to_queue</ref>(\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.$image_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">,<sp/>\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">)</highlight><highlight class="stringliteral">&quot;<sp/>&apos;.$queue_add_link_style.&apos;&gt;&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;Add<sp/>to<sp/>queue&lt;/a&gt;&lt;/div&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="456"><highlight class="stringliteral"><sp/><sp/>//$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">queue_remove_link</highlight><highlight class="stringliteral">&quot;<sp/>onclick=&quot;</highlight><highlight class="normal">remove_queue_item_from_queue(\</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">.$roi_pid.</highlight><highlight class="charliteral">&apos;\&apos;</highlight><highlight class="normal">)</highlight><highlight class="stringliteral">&quot;<sp/>&apos;.$queue_remove_link_style.&apos;&gt;&lt;a<sp/>href=&quot;</highlight><highlight class="normal">#</highlight><highlight class="stringliteral">&quot;&gt;Remove<sp/>from<sp/>queue&lt;/a&gt;&lt;/div&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="457"><highlight class="stringliteral"><sp/><sp/>//$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;div<sp/>class=&quot;</highlight><highlight class="normal">queue_locked_by</highlight><highlight class="stringliteral">&quot;<sp/>&apos;.$queue_locked_by_style.&apos;&gt;Locked<sp/>by<sp/>&apos;.$locked_by.&apos;&lt;/div&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="458"><highlight class="stringliteral"><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;/div&gt;&lt;!--<sp/>widget-subcontent<sp/>--&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="459"><highlight class="stringliteral"><sp/><sp/>$queue_list_roi_html<sp/>.=<sp/>&apos;&lt;/div&gt;&lt;!--<sp/>&apos;.str_replace(&apos;:&apos;,<sp/>&apos;__&apos;,<sp/>$roi_pid).&apos;_queue<sp/>--&gt;&apos;.&quot;</highlight><highlight class="normal">\n</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="460"><highlight class="stringliteral"><sp/><sp/>return<sp/>$queue_list_roi_html;</highlight></codeline>
<codeline lineno="461"><highlight class="stringliteral">}</highlight></codeline>
<codeline lineno="462"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="463" refid="analyze_8functions_8php_1a956d8e9f9a8b25192ddfd4c594468920" refkind="member"><highlight class="stringliteral">function<sp/>get_djatoka_url_by_width($image_pid,<sp/>$width)<sp/>{</highlight></codeline>
<codeline lineno="464"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$djatoka_display_url<sp/>=<sp/>&apos;&apos;;</highlight></codeline>
<codeline lineno="465"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$imageMetadata_record<sp/>=<sp/>AP_Image::getimageMetadata_record($image_pid);</highlight></codeline>
<codeline lineno="466"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rft_id<sp/>=<sp/>$imageMetadata_record[&apos;rft_id&apos;];</highlight></codeline>
<codeline lineno="467"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if($rft_id<sp/>!=<sp/>&apos;&apos;)<sp/>{</highlight></codeline>
<codeline lineno="468"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$djatoka_display_url<sp/>=<sp/>getDjatokaURL($rft_id,<sp/>&apos;getRegion&apos;,<sp/>&apos;3&apos;,<sp/>&apos;0&apos;,<sp/>&apos;0&apos;,<sp/>$imageMetadata_record[&apos;h&apos;],<sp/>$imageMetadata_record[&apos;w&apos;],<sp/>$width,<sp/>&apos;0&apos;);</highlight></codeline>
<codeline lineno="469"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="470"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>else<sp/>{</highlight></codeline>
<codeline lineno="471"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$djatoka_display_url<sp/>=<sp/>getDjatokaURL($imageMetadata_record[&apos;URL&apos;],<sp/>&apos;getRegion&apos;,<sp/>&apos;3&apos;,<sp/>&apos;0&apos;,<sp/>&apos;0&apos;,<sp/>$imageMetadata_record[&apos;h&apos;],<sp/>$imageMetadata_record[&apos;w&apos;],<sp/>$width,<sp/>&apos;0&apos;);</highlight></codeline>
<codeline lineno="472"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="473"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>$djatoka_display_url;</highlight></codeline>
<codeline lineno="474"><highlight class="stringliteral">}</highlight></codeline>
<codeline lineno="475"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="476" refid="analyze_8functions_8php_1a5b8736da01191c26d860005d1999325c" refkind="member"><highlight class="stringliteral">function<sp/>get_djatoka_url_by_height($image_pid,<sp/>$height)<sp/>{</highlight></codeline>
<codeline lineno="477"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$djatoka_display_url<sp/>=<sp/>&apos;&apos;;</highlight></codeline>
<codeline lineno="478"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$imageMetadata_record<sp/>=<sp/>AP_Image::getimageMetadata_record($image_pid);</highlight></codeline>
<codeline lineno="479"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rft_id<sp/>=<sp/>$imageMetadata_record[&apos;rft_id&apos;];</highlight></codeline>
<codeline lineno="480"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if($rft_id<sp/>!=<sp/>&apos;&apos;)<sp/>{</highlight></codeline>
<codeline lineno="481"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$djatoka_display_url<sp/>=<sp/>getDjatokaURL($rft_id,<sp/>&apos;getRegion&apos;,<sp/>&apos;3&apos;,<sp/>&apos;0&apos;,<sp/>&apos;0&apos;,<sp/>$imageMetadata_record[&apos;h&apos;],<sp/>$imageMetadata_record[&apos;w&apos;],<sp/>&apos;0&apos;,<sp/>$height);</highlight></codeline>
<codeline lineno="482"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="483"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>else<sp/>{</highlight></codeline>
<codeline lineno="484"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$djatoka_display_url<sp/>=<sp/>getDjatokaURL($imageMetadata_record[&apos;URL&apos;],<sp/>&apos;getRegion&apos;,<sp/>&apos;3&apos;,<sp/>&apos;0&apos;,<sp/>&apos;0&apos;,<sp/>$imageMetadata_record[&apos;h&apos;],<sp/>$imageMetadata_record[&apos;w&apos;],<sp/>&apos;0&apos;,<sp/>$height);</highlight></codeline>
<codeline lineno="485"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="486"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>$djatoka_display_url;</highlight></codeline>
<codeline lineno="487"><highlight class="stringliteral">}</highlight></codeline>
<codeline lineno="488"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="489" refid="analyze_8functions_8php_1ad4b0e661fe8a8e5cedb6d3442f27fc6d" refkind="member"><highlight class="stringliteral">function<sp/>get_images_list($specimen_pid,<sp/>$nothing,<sp/>$workflow_id){</highlight></codeline>
<codeline lineno="490"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="491"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if(Workflow_Users::doesWorkflowHaveUserName($workflow_id,<sp/>$user-&gt;name)<sp/>&amp;&amp;<sp/>Workflow_Permission::doesWorkflowHavePermission($workflow_id,<sp/>&quot;</highlight><highlight class="normal">canAnalyzeSpecimen</highlight><highlight class="stringliteral">&quot;)){</highlight></codeline>
<codeline lineno="492"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$image_pids<sp/>=<sp/>AP_Specimen::getImageListForSpecimen($specimen_pid);</highlight></codeline>
<codeline lineno="493"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>json_encode($image_pids);</highlight></codeline>
<codeline lineno="494"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="495"><highlight class="stringliteral">}</highlight></codeline>
<codeline lineno="496"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="497" refid="analyze_8functions_8php_1ad640cacecc876546bdb4ed01084708aa" refkind="member"><highlight class="stringliteral">function<sp/>thumbHeightReset($height,<sp/>$width){</highlight></codeline>
<codeline lineno="498"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if($width/$height<sp/>&lt;<sp/>78/54){</highlight></codeline>
<codeline lineno="499"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$y<sp/>=<sp/>($width<sp/>*<sp/>54)/78;</highlight></codeline>
<codeline lineno="500"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>round($y);</highlight></codeline>
<codeline lineno="501"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="502"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>else</highlight></codeline>
<codeline lineno="503"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>false;</highlight></codeline>
<codeline lineno="504"><highlight class="stringliteral">}</highlight></codeline>
<codeline lineno="505"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="506" refid="analyze_8functions_8php_1a84f8a9fd1fdd21b005dc0a4684b6f5fe" refkind="member"><highlight class="stringliteral">function<sp/>get_specimen_pid($image_pid,<sp/>$nothing,<sp/>$workflow_id){</highlight></codeline>
<codeline lineno="507"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$returnJSON[]<sp/>=<sp/>AP_Image::get_specimen_pid($image_pid);</highlight></codeline>
<codeline lineno="508"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>json_encode($returnJSON);</highlight></codeline>
<codeline lineno="509"><highlight class="stringliteral">}</highlight></codeline>
<codeline lineno="510"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="511" refid="analyze_8functions_8php_1acd2326183b88a4b79d4f3812207e658a" refkind="member"><highlight class="stringliteral">function<sp/>change_roi_type($roi_pid,<sp/>$roi_type){</highlight></codeline>
<codeline lineno="512"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if($roi_type==&quot;</highlight><highlight class="normal">Annotation</highlight><highlight class="stringliteral">&quot;)</highlight></codeline>
<codeline lineno="513"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi_type<sp/>=<sp/>&quot;</highlight><highlight class="normal">Annotation/Other</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="514"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roi<sp/>=<sp/>new<sp/>roiHandler($roi_pid);</highlight></codeline>
<codeline lineno="515"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$roiMetadata<sp/>=<sp/>$roi-&gt;getDatastream(&quot;</highlight><highlight class="normal">roiMetadata</highlight><highlight class="stringliteral">&quot;);</highlight></codeline>
<codeline lineno="516"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$dom<sp/>=<sp/>new<sp/>DOMDocument();</highlight></codeline>
<codeline lineno="517"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$dom-&gt;loadXML($roiMetadata);</highlight></codeline>
<codeline lineno="518"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$dom-&gt;getElementsByTagName(&quot;</highlight><highlight class="normal">roiType</highlight><highlight class="stringliteral">&quot;)-&gt;item(0)-&gt;nodeValue<sp/>=<sp/>$roi_type;</highlight></codeline>
<codeline lineno="519"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$result<sp/>=<sp/>$roi-&gt;setDatastream(&quot;</highlight><highlight class="normal">roiMetadata</highlight><highlight class="stringliteral">&quot;,<sp/>&quot;</highlight><highlight class="normal">roi_Metadata</highlight><highlight class="stringliteral">&quot;,<sp/>&quot;</highlight><highlight class="normal">text/xml</highlight><highlight class="stringliteral">&quot;,<sp/>$dom-&gt;saveXML(),<sp/>FEDORA_DATABASE_USERNAME.&quot;</highlight><highlight class="normal">:</highlight><highlight class="stringliteral">&quot;.FEDORA_DATABASE_PASSWORD);</highlight></codeline>
<codeline lineno="520"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if($result){</highlight></codeline>
<codeline lineno="521"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>&quot;</highlight><highlight class="normal">Success</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="522"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}else{</highlight></codeline>
<codeline lineno="523"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>echo<sp/>&quot;</highlight><highlight class="normal">Failed</highlight><highlight class="stringliteral">&quot;;</highlight></codeline>
<codeline lineno="524"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="525"><highlight class="stringliteral">}</highlight></codeline>
<codeline lineno="526"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="527" refid="analyze_8functions_8php_1ad3ad3c24ee1cf11791c0370dba068f3d" refkind="member"><highlight class="stringliteral">function<sp/>get_permission_map($workflow_id)<sp/>{</highlight></codeline>
<codeline lineno="528"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>$selected_permission_list<sp/>=<sp/>Workflow::getPermissionList($workflow_id);</highlight></codeline>
<codeline lineno="529"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>if<sp/>(<sp/>is_array($selected_permission_list)<sp/>)</highlight></codeline>
<codeline lineno="530"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="531"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>foreach($selected_permission_list<sp/>as<sp/>$permission_string)</highlight></codeline>
<codeline lineno="532"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="533"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$permission_map[$permission_string]<sp/>=<sp/>true;</highlight></codeline>
<codeline lineno="534"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="535"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="536"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>return<sp/>$permission_map;</highlight></codeline>
<codeline lineno="537"><highlight class="stringliteral">}</highlight></codeline>
    </programlisting>
    <location file="apiary_project/analyze.functions.php"/>
  </compounddef>
</doxygen>
