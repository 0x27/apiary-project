<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Apiary Project: C:/Users/sgmurphy/Documents/Apiary Project/Drupal AP Module/workspace.functions.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cti_flex_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Apiary Project&#160;<span id="projectnumber">0.5.1</span></div>
   <div id="projectbrief">Apiary Project Drupal Module and Image Analysis Tool</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('workspace_8functions_8php.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/sgmurphy/Documents/Apiary Project/Drupal AP Module/workspace.functions.php</div>  </div>
</div>
<div class="contents">
<a href="workspace_8functions_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 header(<span class="stringliteral">&quot;Cache-Control: no-cache, must-revalidate&quot;</span>); <span class="comment">// HTTP/1.1</span>
<a name="l00003"></a>00003 header(<span class="stringliteral">&quot;Expires: Sat, 26 Jul 1997 05:00:00 GMT&quot;</span>); <span class="comment">// Date in the past</span>
<a name="l00004"></a><a class="code" href="workspace_8functions_8php.html#aea941c07a4c4543da9db61e709571719">00004</a> <a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a> = drupal_get_path(<span class="stringliteral">&#39;module&#39;</span>,<span class="stringliteral">&#39;apiary_project&#39;</span>);
<a name="l00005"></a>00005 module_load_include(<span class="stringliteral">&#39;php&#39;</span>, <span class="stringliteral">&#39;apiary_project&#39;</span>, <span class="stringliteral">&#39;workflow/include/roiHandler&#39;</span>);
<a name="l00006"></a>00006 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/fedora_commons/class.AP_Specimen.php&#39;</span>);
<a name="l00007"></a>00007 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/fedora_commons/class.AP_Image.php&#39;</span>);
<a name="l00008"></a>00008 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/fedora_commons/class.AP_ROI.php&#39;</span>);
<a name="l00009"></a>00009 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/fedora_commons/class.FedoraObject.php&#39;</span>);
<a name="l00010"></a>00010 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/adore-djatoka/functions_djatoka.php&#39;</span>);
<a name="l00011"></a>00011 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/workflow/include/functions.php&#39;</span>);
<a name="l00012"></a>00012 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/workflow/include/getLevel1Parsing.php&#39;</span>);
<a name="l00013"></a><a class="code" href="workspace_8functions_8php.html#a1ec770754ff6c8671939d992f578d167">00013</a> <a class="code" href="workspace_8functions_8php.html#a1ec770754ff6c8671939d992f578d167">$server_base</a> = variable_get(<span class="stringliteral">&#39;apiary_research_base_url&#39;</span>, <span class="stringliteral">&#39;http://localhost&#39;</span>);
<a name="l00014"></a><a class="code" href="workspace_8functions_8php.html#aa6646341a4c737489965d44a47caef17">00014</a> <a class="code" href="workspace_8functions_8php.html#aa6646341a4c737489965d44a47caef17">$fedora_base_url</a> = variable_get(<span class="stringliteral">&#39;fedora_base_url&#39;</span>, <span class="stringliteral">&#39;http://localhost:8080/fedora&#39;</span>);
<a name="l00015"></a>00015 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/workflow/include/class.Workflow.php&#39;</span>);
<a name="l00016"></a>00016 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/workflow/include/class.Object_Pool.php&#39;</span>);
<a name="l00017"></a>00017 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/workflow/include/class.Workflow_Users.php&#39;</span>);
<a name="l00018"></a>00018 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/workflow/include/class.Workflow_Permission.php&#39;</span>);
<a name="l00019"></a>00019 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/workflow/include/class.Workflow_Sessions.php&#39;</span>);
<a name="l00020"></a>00020 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/workflow/include/class.Errorlog.php&#39;</span>);
<a name="l00021"></a>00021 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/workflow/include/search.php&#39;</span>);
<a name="l00022"></a>00022 include_once(<span class="stringliteral">&quot;parse.functions.php&quot;</span>);
<a name="l00023"></a>00023 include_once(<span class="stringliteral">&quot;transcribe.functions.php&quot;</span>);
<a name="l00024"></a>00024 include_once(<span class="stringliteral">&quot;analyze.functions.php&quot;</span>);
<a name="l00025"></a>00025 include_once(<a class="code" href="analyze_8functions_8php.html#aea941c07a4c4543da9db61e709571719">$rel_path</a>.<span class="stringliteral">&#39;/fedora_commons/config_fedora.inc&#39;</span>);
<a name="l00026"></a>00026 
<a name="l00027"></a><a class="code" href="workspace_8functions_8php.html#ac0cbb6a19004dceed34436c6ecbdb7f0">00027</a> function <a class="code" href="workspace_8functions_8php.html#ac0cbb6a19004dceed34436c6ecbdb7f0">define_workspace</a>($workflow_id){
<a name="l00028"></a>00028         global <a class="code" href="apiary__project_8php.html#a00365e6c5f70c43fb2ed86c9bc5626e0">$user</a>;
<a name="l00029"></a>00029         <span class="keywordflow">if</span>($workflow_id == <span class="stringliteral">&quot;0&quot;</span> || empty($workflow_id)){
<a name="l00030"></a>00030                 <span class="keywordflow">return</span> drupal_access_denied();
<a name="l00031"></a>00031         }
<a name="l00032"></a>00032         <span class="keywordflow">if</span>(Workflow_Users::doesWorkflowHaveUserName($workflow_id, $user-&gt;name) &amp;&amp; Workflow_Permission::doesWorkflowHavePermission($workflow_id, <span class="stringliteral">&quot;canAnalyzeSpecimen&quot;</span>)){
<a name="l00033"></a>00033                 $apiary_session_base = $user-&gt;name.<span class="charliteral">&#39;_&#39;</span>.$workflow_id.<span class="charliteral">&#39;_&#39;</span>;
<a name="l00034"></a>00034                 <span class="keywordflow">if</span>(empty($_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>])) {
<a name="l00035"></a>00035                         $_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>] = $apiary_session_base.date(<span class="stringliteral">&quot;Ymdhis&quot;</span>);
<a name="l00036"></a>00036                 }
<a name="l00037"></a>00037                 echo <a class="code" href="workspace_8functions_8php.html#a05c9eec0f69c46b0efede510a10c78c3">get_workspace_mark_up</a>($workflow_id);
<a name="l00038"></a>00038         }
<a name="l00039"></a>00039         <span class="keywordflow">else</span>{
<a name="l00040"></a>00040                 echo <span class="stringliteral">&quot;It seems you do not have permission to access this workflow. Please contact administrator for further instructions.&quot;</span>;
<a name="l00041"></a>00041         }
<a name="l00042"></a>00042 }
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="workspace_8functions_8php.html#a05c9eec0f69c46b0efede510a10c78c3">00044</a> function <a class="code" href="workspace_8functions_8php.html#a05c9eec0f69c46b0efede510a10c78c3">get_workspace_mark_up</a>($workflow_id){
<a name="l00045"></a>00045         $content = file_get_contents(drupal_get_path(<span class="stringliteral">&#39;module&#39;</span>, <span class="stringliteral">&#39;apiary_project&#39;</span>) . <span class="stringliteral">&#39;/mockup/index.php&#39;</span>);
<a name="l00046"></a>00046         <span class="keywordflow">return</span> $content;
<a name="l00047"></a>00047 }
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="workspace_8functions_8php.html#a74d87fc4a909ee407ee6c234183fae9d">00049</a> function <a class="code" href="workspace_8functions_8php.html#a74d87fc4a909ee407ee6c234183fae9d">send_response</a>($requestType, $param1, $param2){
<a name="l00050"></a>00050         <span class="keywordflow">if</span>(!empty($_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>])) {
<a name="l00051"></a>00051           $workflow_id = <a class="code" href="workspace_8functions_8php.html#ae6e87527dc49b6e11a52142922d0614e">getWorkflowIdFromSessionId</a>($_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>]);
<a name="l00052"></a>00052           call_user_func($requestType, $param1, $param2, $workflow_id);
<a name="l00053"></a>00053         }
<a name="l00054"></a>00054         <span class="keywordflow">else</span>{
<a name="l00055"></a>00055           echo <span class="stringliteral">&quot;Bad Session&quot;</span>;
<a name="l00056"></a>00056         }
<a name="l00057"></a>00057 }
<a name="l00058"></a>00058 
<a name="l00059"></a><a class="code" href="workspace_8functions_8php.html#a9f7db1db0cc821c4c64c17df1c48bb23">00059</a> function <a class="code" href="workspace_8functions_8php.html#a9f7db1db0cc821c4c64c17df1c48bb23">create_session</a>($workflow_id) {
<a name="l00060"></a>00060   global <a class="code" href="apiary__project_8php.html#a00365e6c5f70c43fb2ed86c9bc5626e0">$user</a>;
<a name="l00061"></a>00061   $create_new_session = <span class="keyword">false</span>;
<a name="l00062"></a>00062   $_SESSION[<span class="stringliteral">&#39;workflow_id&#39;</span>] = $workflow;
<a name="l00063"></a>00063   <span class="keywordflow">if</span>(Workflow_Users::doesWorkflowHaveUserName($workflow_id, $user-&gt;name)){
<a name="l00064"></a>00064     $apiary_session_base = $user-&gt;name.<span class="charliteral">&#39;_&#39;</span>.$workflow_id.<span class="charliteral">&#39;_&#39;</span>;
<a name="l00065"></a>00065     <span class="keywordflow">if</span>(strpos($_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>], $apiary_session_base) === <span class="keyword">false</span>) {
<a name="l00066"></a>00066       $create_new_session = <span class="keyword">true</span>;
<a name="l00067"></a>00067     }
<a name="l00068"></a>00068     <span class="keywordflow">else</span> {
<a name="l00069"></a>00069       <span class="keywordflow">if</span>(!Workflow_Sessions::session_id_exists($_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>])) {
<a name="l00070"></a>00070         $create_new_session = <span class="keyword">true</span>;
<a name="l00071"></a>00071       }
<a name="l00072"></a>00072       <span class="keywordflow">else</span> {
<a name="l00073"></a>00073         <span class="keywordflow">if</span>(!Workflow_Sessions::renew_session($_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>])) {
<a name="l00074"></a>00074           $create_new_session = <span class="keyword">true</span>;
<a name="l00075"></a>00075         }
<a name="l00076"></a>00076       }
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078     <span class="keywordflow">if</span>($create_new_session) {
<a name="l00079"></a>00079       <span class="keywordflow">if</span>(!empty($_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>])) {
<a name="l00080"></a>00080         <span class="keywordflow">if</span>(Workflow_Sessions::session_id_exists($_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>])) {
<a name="l00081"></a>00081               Workflow_Sessions::delete($_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>]);
<a name="l00082"></a>00082             }
<a name="l00083"></a>00083       }
<a name="l00084"></a>00084       $_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>] = $apiary_session_base.date(<span class="stringliteral">&quot;YmdHis&quot;</span>);
<a name="l00085"></a>00085       Workflow_Sessions::create($_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>]);
<a name="l00086"></a>00086     }
<a name="l00087"></a>00087     echo $_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>];
<a name="l00088"></a>00088   }
<a name="l00089"></a>00089   <span class="keywordflow">else</span> {
<a name="l00090"></a>00090     echo <span class="stringliteral">&quot;false&quot;</span>;
<a name="l00091"></a>00091   }
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="workspace_8functions_8php.html#ac5cf9b9706e3ebd83fd59a8003dea5cb">00094</a> function <a class="code" href="workspace_8functions_8php.html#ac5cf9b9706e3ebd83fd59a8003dea5cb">clear_session</a>() {
<a name="l00095"></a>00095   <span class="keywordflow">if</span>(<a class="code" href="workspace_8functions_8php.html#adc8a7972c0fe59df9ebeb226c30c1fcf">emptyQueue</a>()) {
<a name="l00096"></a>00096     $_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00097"></a>00097     echo <span class="stringliteral">&quot;success&quot;</span>;
<a name="l00098"></a>00098   }
<a name="l00099"></a>00099   <span class="keywordflow">else</span> {
<a name="l00100"></a>00100     echo <span class="stringliteral">&quot;false&quot;</span>;
<a name="l00101"></a>00101   }
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00104"></a><a class="code" href="workspace_8functions_8php.html#ae78eade784cc317e8ec88ff0952e492f">00104</a> function <a class="code" href="workspace_8functions_8php.html#ae78eade784cc317e8ec88ff0952e492f">delete_session</a>() {
<a name="l00105"></a>00105   <span class="keywordflow">if</span>(Workflow_Sessions::delete($_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>]) &gt; 0) {
<a name="l00106"></a>00106     $_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00107"></a>00107     echo <span class="stringliteral">&quot;success&quot;</span>;
<a name="l00108"></a>00108   }
<a name="l00109"></a>00109   <span class="keywordflow">else</span> {
<a name="l00110"></a>00110     echo <span class="stringliteral">&quot;failed&quot;</span>;
<a name="l00111"></a>00111   }
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="workspace_8functions_8php.html#ae709f2164c1170596205abd99623482d">00114</a> function <a class="code" href="workspace_8functions_8php.html#ae709f2164c1170596205abd99623482d">empty_session</a>($session_id) {
<a name="l00115"></a>00115   $_SESSION[<span class="stringliteral">&#39;apiary_cleared_session_id&#39;</span>] = $session_id;
<a name="l00116"></a>00116   <span class="keywordflow">if</span>(<a class="code" href="workspace_8functions_8php.html#a391d88ccd1497a1380618928ab5e8e02">empty_queue</a>($session_id)) {
<a name="l00117"></a>00117     echo <span class="stringliteral">&quot;success&quot;</span>;
<a name="l00118"></a>00118   }
<a name="l00119"></a>00119   <span class="keywordflow">else</span> {
<a name="l00120"></a>00120     echo <span class="stringliteral">&quot;false&quot;</span>;
<a name="l00121"></a>00121   }
<a name="l00122"></a>00122   $_SESSION[<span class="stringliteral">&#39;apiary_cleared_session_id&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="workspace_8functions_8php.html#ae6e87527dc49b6e11a52142922d0614e">00125</a> function <a class="code" href="workspace_8functions_8php.html#ae6e87527dc49b6e11a52142922d0614e">getWorkflowIdFromSessionId</a>($apiary_session_id){
<a name="l00126"></a>00126 <span class="comment">//sessionId looks like user_workflowId_timestamp</span>
<a name="l00127"></a>00127 <span class="comment">//user might have _ so work from the end</span>
<a name="l00128"></a>00128   $last_ = strripos($apiary_session_id, <span class="charliteral">&#39;_&#39;</span>);
<a name="l00129"></a>00129   <span class="keywordflow">if</span> (last_ &gt; -1) {
<a name="l00130"></a>00130     $bkwd_start = $last_ - strlen($apiary_session_id) - 1;
<a name="l00131"></a>00131     $second_last_ = strrpos($apiary_session_id, <span class="charliteral">&#39;_&#39;</span>, $bkwd_start);
<a name="l00132"></a>00132     $id_length = $last_ - $second_last_ - 1;
<a name="l00133"></a>00133     $workflow_id = substr($apiary_session_id, $second_last_+1, $id_length);
<a name="l00134"></a>00134     <span class="keywordflow">return</span> $workflow_id;
<a name="l00135"></a>00135   }
<a name="l00136"></a>00136   <span class="keywordflow">else</span> {
<a name="l00137"></a>00137     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00138"></a>00138   }
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="workspace_8functions_8php.html#a966df1417fa7c1acd731bea57a21cdfb">00141</a> function <a class="code" href="comparer_8functions_8php.html#a78bd2c85ad1dcdc1fb68e40605d593b0">send_request</a>($function, $workflow_id, $param1, $param2){
<a name="l00142"></a>00142     <span class="comment">//echo &quot;function = &quot;.$function.&quot; workflow_id = &quot;.$workflow_id.&quot; param1 = &quot;.$param1.&quot; param2 = &quot;.$param2;</span>
<a name="l00143"></a>00143         <span class="keywordflow">if</span>($param2 != <span class="stringliteral">&quot;0&quot;</span>) {
<a name="l00144"></a>00144           call_user_func($function, $workflow_id, $param1, $param2);
<a name="l00145"></a>00145         }
<a name="l00146"></a>00146         <span class="keywordflow">else</span> <span class="keywordflow">if</span>($param1 != <span class="stringliteral">&quot;0&quot;</span>) {
<a name="l00147"></a>00147           call_user_func($function, $workflow_id, $param1);
<a name="l00148"></a>00148         }
<a name="l00149"></a>00149         <span class="keywordflow">else</span> <span class="keywordflow">if</span>($function == <span class="stringliteral">&quot;clear_session&quot;</span>) {
<a name="l00150"></a>00150           call_user_func($function);
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152         <span class="keywordflow">else</span> {
<a name="l00153"></a>00153           call_user_func($function, $workflow_id);
<a name="l00154"></a>00154         }
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="workspace_8functions_8php.html#a228baa05e8acda612b60685412607100">00157</a> function <a class="code" href="workspace_8functions_8php.html#a228baa05e8acda612b60685412607100">get_workflow_items_via_solr</a>($workflow_id, $entries_per_page, $page = 0) {
<a name="l00158"></a>00158   $workflow = <span class="keyword">new</span> Workflow();<span class="comment">//by not sending the workflow_id here we avoid a lot of uneccessary pre-processing</span>
<a name="l00159"></a>00159   $workflow-&gt;workflow_id = $workflow_id;
<a name="l00160"></a>00160   $workflow-&gt;loadDBWorkflow();
<a name="l00161"></a>00161   $workflow_items = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00162"></a>00162   $totalEntries = 0;
<a name="l00163"></a>00163   $object_pool = <span class="keyword">new</span> Object_Pool($workflow-&gt;object_pool_id);
<a name="l00164"></a>00164   $solr_q = <a class="code" href="workspace_8functions_8php.html#a35996c2bae8f203dab6b8cf5c5d3d155">create_item_browser_solr_q</a>($object_pool-&gt;object_pool_pids);
<a name="l00165"></a>00165   $solr_fl = <span class="stringliteral">&#39;fl=id&#39;</span>;
<a name="l00166"></a>00166   $solr_fl .= <span class="stringliteral">&#39;+parent_id&#39;</span>;
<a name="l00167"></a>00167   $solr_fl .= <span class="stringliteral">&#39;+status_analyzedStatus&#39;</span>;
<a name="l00168"></a>00168   $solr_fl .= <span class="stringliteral">&#39;+imageMetadata_h&#39;</span>;
<a name="l00169"></a>00169   $solr_fl .= <span class="stringliteral">&#39;+imageMetadata_w&#39;</span>;
<a name="l00170"></a>00170   $solr_fl .= <span class="stringliteral">&#39;+imageMetadata_URL&#39;</span>;
<a name="l00171"></a>00171   $solr_fl .= <span class="stringliteral">&#39;+imageMetadata_rft_id&#39;</span>;
<a name="l00172"></a>00172   $solr_fl .= <span class="stringliteral">&#39;+status_locked&#39;</span>;
<a name="l00173"></a>00173   $solr_fl .= <span class="stringliteral">&#39;+locked_time&#39;</span>;
<a name="l00174"></a>00174   $solr_fl .= <span class="stringliteral">&#39;+status_locked_by&#39;</span>;
<a name="l00175"></a>00175   $solr_fl .= <span class="stringliteral">&#39;+status_locked_session&#39;</span>;
<a name="l00176"></a>00176   $solr_op = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00177"></a>00177   $solr_rows = <span class="stringliteral">&#39;rows=10000&#39;</span>;
<a name="l00178"></a>00178   $solr_sxml = <a class="code" href="search_8functions_8php.html#ae6356bbdc7e39f2f56be2e74848e4c58">solr_query_xml</a>($solr_q, $solr_fl, $solr_op, $solr_rows);
<a name="l00179"></a>00179   <span class="keywordflow">if</span>($solr_sxml != <span class="keyword">false</span>) {
<a name="l00180"></a>00180     $success = <span class="stringliteral">&quot;true&quot;</span>;
<a name="l00181"></a>00181     list($workflow_items, $item_browser_items_order_array) = <a class="code" href="workspace_8functions_8php.html#a2fcfd59c37ffd7906e09b79ea7a1a55f">generate_workflow_items_via_solr</a>($solr_sxml);
<a name="l00182"></a>00182     $totalEntries = sizeOf($item_browser_items_order_array);
<a name="l00183"></a>00183   }
<a name="l00184"></a>00184   $returnJSON[<span class="stringliteral">&#39;workflow_items_successfully_created&#39;</span>] = $success;
<a name="l00185"></a>00185   $returnJSON[<span class="stringliteral">&#39;workflow_items&#39;</span>] = $workflow_items;
<a name="l00186"></a>00186   $returnJSON[<span class="stringliteral">&#39;workflow_item_count&#39;</span>] = $totalEntries;
<a name="l00187"></a>00187   $returnJSON[<span class="stringliteral">&#39;item_browser&#39;</span>] = <a class="code" href="workspace_8functions_8php.html#ab7998174e221c7580b36db79ea435337">create_item_browser_bare</a>($entries_per_page, $totalEntries);
<a name="l00188"></a>00188   $returnJSON[<span class="stringliteral">&#39;item_browser_items_order_array&#39;</span>] = implode(<span class="stringliteral">&quot;,&quot;</span>, $item_browser_items_order_array);
<a name="l00189"></a>00189   echo json_encode($returnJSON);
<a name="l00190"></a>00190 }
<a name="l00191"></a>00191 
<a name="l00192"></a><a class="code" href="workspace_8functions_8php.html#a2fcfd59c37ffd7906e09b79ea7a1a55f">00192</a> function <a class="code" href="workspace_8functions_8php.html#a2fcfd59c37ffd7906e09b79ea7a1a55f">generate_workflow_items_via_solr</a>($solr_sxml) {
<a name="l00193"></a>00193   $workflow_items = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00194"></a>00194   $item_browser_items_order_array = array();
<a name="l00195"></a>00195   <span class="keywordflow">if</span>($solr_sxml != <span class="keyword">false</span>) {
<a name="l00196"></a>00196     <span class="keywordflow">foreach</span>($solr_sxml-&gt;result[0]-&gt;doc as $doc) {
<a name="l00197"></a>00197       $image_pid = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00198"></a>00198       $roi_count = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00199"></a>00199       $specimen_pid = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00200"></a>00200       $analyzedStatus = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00201"></a>00201       $h = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00202"></a>00202       $w = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00203"></a>00203       $url = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00204"></a>00204       $rft_id = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00205"></a>00205       $locked = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00206"></a>00206       $locked_time = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00207"></a>00207       $locked_by = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00208"></a>00208       $locked_session = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00209"></a>00209       $thumbnail_url = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00210"></a>00210       $workflow_status = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00211"></a>00211       <span class="keywordflow">foreach</span>($doc-&gt;children() as $sxml_node) {
<a name="l00212"></a>00212         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;id&#39;</span>) {
<a name="l00213"></a>00213           $image_pid = (string)$sxml_node;
<a name="l00214"></a>00214           array_push($item_browser_items_order_array, str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $image_pid));
<a name="l00215"></a>00215           $roi_count = <a class="code" href="workspace_8functions_8php.html#a85b2bb8ebd4c8259adf1656c4f80b78a">get_roi_count_via_solr</a>($image_pid);
<a name="l00216"></a>00216         }
<a name="l00217"></a>00217         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;parent_id&#39;</span>) {
<a name="l00218"></a>00218           $specimen_pid = (string)$sxml_node;
<a name="l00219"></a>00219         }
<a name="l00220"></a>00220         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;status_analyzedStatus&#39;</span>) {
<a name="l00221"></a>00221           $analyzedStatus = (string)$sxml_node;
<a name="l00222"></a>00222         }
<a name="l00223"></a>00223         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;imageMetadata_h&#39;</span>) {
<a name="l00224"></a>00224           $h = (string)$sxml_node;
<a name="l00225"></a>00225         }
<a name="l00226"></a>00226         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;imageMetadata_w&#39;</span>) {
<a name="l00227"></a>00227           $w = (string)$sxml_node;
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;imageMetadata_URL&#39;</span>) {
<a name="l00230"></a>00230           $url = (string)$sxml_node;
<a name="l00231"></a>00231         }
<a name="l00232"></a>00232         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;imageMetadata_rft_id&#39;</span>) {
<a name="l00233"></a>00233           $rft_id = (string)$sxml_node;
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;status_locked&#39;</span>) {
<a name="l00236"></a>00236           $locked = (string)$sxml_node;
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;locked_time&#39;</span>) {
<a name="l00239"></a>00239           $locked_time = (string)$sxml_node;
<a name="l00240"></a>00240         }
<a name="l00241"></a>00241         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;status_locked_by&#39;</span>) {
<a name="l00242"></a>00242           $locked_by = (string)$sxml_node;
<a name="l00243"></a>00243         }
<a name="l00244"></a>00244         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;status_locked_session&#39;</span>) {
<a name="l00245"></a>00245           $locked_session = (string)$sxml_node;
<a name="l00246"></a>00246         }
<a name="l00247"></a>00247       }
<a name="l00248"></a>00248       $thumbnail_url = <a class="code" href="workspace_8functions_8php.html#a190c5a6633720455b59a3f8766a6b6f0">djatoka_url_by_height_via_solr</a>($image_pid, $rft_id, $h, $w, $url, <span class="stringliteral">&quot;68&quot;</span>);
<a name="l00249"></a>00249       $workflow_status = <a class="code" href="workspace_8functions_8php.html#a4fd3cbdcf1282bd92e9609b5de35863c">workflow_status</a>($locked, $locked_time, $locked_session);
<a name="l00250"></a>00250       $workflow_items .= <a class="code" href="workspace_8functions_8php.html#a1dd11ac45a65b79f00a6e03a19c4d7ea">create_item_browser_page_image_item_via_solr</a>($image_pid, $specimen_pid, $analyzedStatus, $roi_count, $thumbnail_url, $workflow_status);
<a name="l00251"></a>00251     }
<a name="l00252"></a>00252   }
<a name="l00253"></a>00253   natsort($item_browser_items_order_array);
<a name="l00254"></a>00254   <span class="keywordflow">return</span> array($workflow_items, $item_browser_items_order_array);
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00257"></a><a class="code" href="workspace_8functions_8php.html#a190c5a6633720455b59a3f8766a6b6f0">00257</a> function <a class="code" href="workspace_8functions_8php.html#a190c5a6633720455b59a3f8766a6b6f0">djatoka_url_by_height_via_solr</a>($image_pid, $rft_id, $h, $w, $url, $height) {
<a name="l00258"></a>00258         $djatoka_display_url = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00259"></a>00259         <span class="keywordflow">if</span>($rft_id != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00260"></a>00260           $djatoka_display_url = getDjatokaURL($rft_id, <span class="stringliteral">&#39;getRegion&#39;</span>, <span class="charliteral">&#39;3&#39;</span>, <span class="charliteral">&#39;0&#39;</span>, <span class="charliteral">&#39;0&#39;</span>, $h, $w, <span class="charliteral">&#39;0&#39;</span>, $height);
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262         <span class="keywordflow">else</span> {
<a name="l00263"></a>00263           $djatoka_display_url = getDjatokaURL($imageMetadata_record[<span class="stringliteral">&#39;URL&#39;</span>], <span class="stringliteral">&#39;getRegion&#39;</span>, <span class="charliteral">&#39;3&#39;</span>, <span class="charliteral">&#39;0&#39;</span>, <span class="charliteral">&#39;0&#39;</span>, $h, $w, <span class="charliteral">&#39;0&#39;</span>, $height);
<a name="l00264"></a>00264         }
<a name="l00265"></a>00265         <span class="keywordflow">return</span> $djatoka_display_url;
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00268"></a><a class="code" href="workspace_8functions_8php.html#a2d7495d2abde6025c8af9db740902617">00268</a> function <a class="code" href="workspace_8functions_8php.html#a2d7495d2abde6025c8af9db740902617">get_parent_pid_via_solr</a>($pid) {
<a name="l00269"></a>00269   $solr_q = <span class="stringliteral">&#39;q=id:(&quot;&#39;</span>.$pid.<span class="stringliteral">&#39;&quot;)&#39;</span>;
<a name="l00270"></a>00270   $solr_fl = <span class="stringliteral">&#39;fl=parent_id&#39;</span>;
<a name="l00271"></a>00271   $solr_op = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00272"></a>00272   $solr_rows = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00273"></a>00273   $solr_sxml = <a class="code" href="search_8functions_8php.html#ae6356bbdc7e39f2f56be2e74848e4c58">solr_query_xml</a>($solr_q, $solr_fl, $solr_op, $solr_rows);
<a name="l00274"></a>00274   <span class="comment">//echo &quot;parent_pid = &quot;. (string)$solr_sxml-&gt;result[0]-&gt;doc[0]-&gt;str[0];</span>
<a name="l00275"></a>00275   <span class="keywordflow">return</span> (<span class="keywordtype">string</span>)$solr_sxml-&gt;result[0]-&gt;doc[0]-&gt;str[0];
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a><a class="code" href="workspace_8functions_8php.html#a9bd79e7f1ee258fbc21969a12ee694c7">00278</a> function <a class="code" href="workspace_8functions_8php.html#a9bd79e7f1ee258fbc21969a12ee694c7">get_roi_list_via_solr</a>($image_pid) {
<a name="l00279"></a>00279   $roi_list = array();
<a name="l00280"></a>00280   $solr_q = <span class="stringliteral">&#39;q=parent_id:(&quot;&#39;</span>.$image_pid.<span class="stringliteral">&#39;&quot;)&#39;</span>;
<a name="l00281"></a>00281   $solr_fl = <span class="stringliteral">&#39;fl=id&#39;</span>;
<a name="l00282"></a>00282   $solr_op = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00283"></a>00283   $solr_rows = <span class="stringliteral">&#39;rows=10000&#39;</span>;
<a name="l00284"></a>00284   $solr_sxml = <a class="code" href="search_8functions_8php.html#ae6356bbdc7e39f2f56be2e74848e4c58">solr_query_xml</a>($solr_q, $solr_fl, $solr_op, $solr_rows);
<a name="l00285"></a>00285   <span class="keywordflow">foreach</span>($solr_sxml-&gt;result[0]-&gt;doc as $doc) {
<a name="l00286"></a>00286     <span class="keywordflow">foreach</span>($doc-&gt;children() as $sxml_node) {
<a name="l00287"></a>00287       <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;id&#39;</span>) {
<a name="l00288"></a>00288         array_push($roi_list, (<span class="keywordtype">string</span>)$sxml_node);
<a name="l00289"></a>00289       }
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291   }
<a name="l00292"></a>00292   <span class="keywordflow">return</span> $roi_list;
<a name="l00293"></a>00293 }
<a name="l00294"></a>00294 
<a name="l00295"></a><a class="code" href="workspace_8functions_8php.html#a85b2bb8ebd4c8259adf1656c4f80b78a">00295</a> function <a class="code" href="workspace_8functions_8php.html#a85b2bb8ebd4c8259adf1656c4f80b78a">get_roi_count_via_solr</a>($image_pid) {
<a name="l00296"></a>00296   $solr_q = <span class="stringliteral">&#39;q=parent_id:(&quot;&#39;</span>.$image_pid.<span class="stringliteral">&#39;&quot;)&#39;</span>;
<a name="l00297"></a>00297   $solr_fl = <span class="stringliteral">&#39;fl=id&#39;</span>;
<a name="l00298"></a>00298   $solr_op = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00299"></a>00299   $solr_rows = <span class="stringliteral">&#39;rows=10000&#39;</span>;
<a name="l00300"></a>00300   $solr_sxml = <a class="code" href="search_8functions_8php.html#ae6356bbdc7e39f2f56be2e74848e4c58">solr_query_xml</a>($solr_q, $solr_fl, $solr_op, $solr_rows);
<a name="l00301"></a>00301   <span class="keywordflow">return</span> (<span class="keywordtype">string</span>)$solr_sxml-&gt;result[0][<span class="stringliteral">&#39;numFound&#39;</span>];
<a name="l00302"></a>00302 }
<a name="l00303"></a>00303 
<a name="l00304"></a><a class="code" href="workspace_8functions_8php.html#a35996c2bae8f203dab6b8cf5c5d3d155">00304</a> function <a class="code" href="workspace_8functions_8php.html#a35996c2bae8f203dab6b8cf5c5d3d155">create_item_browser_solr_q</a>($object_pool) {
<a name="l00305"></a>00305   $solr_q = <span class="stringliteral">&quot;q=&quot;</span>;
<a name="l00306"></a>00306   $first = <span class="keyword">true</span>;
<a name="l00307"></a>00307   <span class="keywordflow">foreach</span>($object_pool as $specimen_pid) {
<a name="l00308"></a>00308     <span class="keywordflow">if</span>(!$first) {
<a name="l00309"></a>00309       $solr_q .= <span class="charliteral">&#39;+&#39;</span>;
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311     <span class="keywordflow">else</span> {
<a name="l00312"></a>00312       $first = <span class="keyword">false</span>;
<a name="l00313"></a>00313     }
<a name="l00314"></a>00314     $solr_q .= <span class="stringliteral">&#39;parent_id:(&quot;&#39;</span>.$specimen_pid.<span class="stringliteral">&#39;&quot;)&#39;</span>;
<a name="l00315"></a>00315   }
<a name="l00316"></a>00316   <span class="keywordflow">return</span> $solr_q;
<a name="l00317"></a>00317 }
<a name="l00318"></a>00318 
<a name="l00319"></a><a class="code" href="workspace_8functions_8php.html#a5968cffd7c081d1152d321d4649e50d0">00319</a> function <a class="code" href="workspace_8functions_8php.html#a5968cffd7c081d1152d321d4649e50d0">get_workflow_items</a>($workflow_id, $entries_per_page, $page = 0) {
<a name="l00320"></a>00320   <span class="comment">//get_workflow_items_via_fedora($workflow_id, $entries_per_page, $page = 0);</span>
<a name="l00321"></a>00321   <a class="code" href="workspace_8functions_8php.html#a228baa05e8acda612b60685412607100">get_workflow_items_via_solr</a>($workflow_id, $entries_per_page, $page = 0);
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a><a class="code" href="workspace_8functions_8php.html#a26df2e0d7c88df97768104e8be693005">00324</a> function <a class="code" href="workspace_8functions_8php.html#a26df2e0d7c88df97768104e8be693005">get_workflow_items_via_fedora</a>($workflow_id, $entries_per_page, $page = 0) {
<a name="l00325"></a>00325   $workflow = <span class="keyword">new</span> Workflow();<span class="comment">//by not sending the workflow_id here we avoid a lot of uneccessary pre-processing</span>
<a name="l00326"></a>00326   $workflow-&gt;loadWorkflowDom($workflow_id);
<a name="l00327"></a>00327   $workflow_dom = $workflow-&gt;workflow_dom;
<a name="l00328"></a>00328   $totalEntries = 0; <span class="comment">//do the count here instead of using arrays generated from the Workflow class</span>
<a name="l00329"></a>00329   $item_browser_items_order_array = array();
<a name="l00330"></a>00330   $workflow_items = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00331"></a>00331   $success = <span class="stringliteral">&quot;false&quot;</span>;
<a name="l00332"></a>00332   <span class="keywordflow">if</span>($workflow_dom != null) {
<a name="l00333"></a>00333     $specimen_elements = $workflow_dom-&gt;getElementsByTagName(<span class="stringliteral">&#39;specimen&#39;</span>);
<a name="l00334"></a>00334     <span class="keywordflow">foreach</span>($specimen_elements as $specimen) {
<a name="l00335"></a>00335       $specimen_pid = $specimen-&gt;getElementsByTagName(<span class="stringliteral">&#39;pid&#39;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00336"></a>00336       $specimen_image_elements = $specimen-&gt;getElementsByTagName(<span class="stringliteral">&#39;image&#39;</span>);
<a name="l00337"></a>00337       <span class="keywordflow">foreach</span>($specimen_image_elements as $image) {
<a name="l00338"></a>00338         $totalEntries++;
<a name="l00339"></a>00339         $image_pid = $image-&gt;getElementsByTagName(<span class="stringliteral">&#39;pid&#39;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00340"></a>00340         array_push($item_browser_items_order_array, str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $image_pid));
<a name="l00341"></a>00341         $analyzedStatus = $image-&gt;getElementsByTagName(<span class="stringliteral">&#39;analyzedStatus&#39;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00342"></a>00342         $workflow_status = $image-&gt;getElementsByTagName(<span class="stringliteral">&#39;workflow_status&#39;</span>)-&gt;item(0)-&gt;nodeValue;
<a name="l00343"></a>00343         $workflow_items .= <a class="code" href="workspace_8functions_8php.html#ab15550a7aa0b4e5495fd073d7c10cb4e">create_item_browser_page_image_item</a>($image_pid, $specimen_pid, $analyzedStatus, $workflow_status);
<a name="l00344"></a>00344       }
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346     $success = <span class="stringliteral">&quot;true&quot;</span>;
<a name="l00347"></a>00347   }
<a name="l00348"></a>00348   <span class="comment">//$workflow_items .= &#39;&lt;/div&gt;&#39;;</span>
<a name="l00349"></a>00349   $returnJSON[<span class="stringliteral">&#39;workflow_items_successfully_created&#39;</span>] = $success;
<a name="l00350"></a>00350   $returnJSON[<span class="stringliteral">&#39;workflow_item_count&#39;</span>] = $totalEntries;
<a name="l00351"></a>00351   $returnJSON[<span class="stringliteral">&#39;workflow_items&#39;</span>] = $workflow_items;
<a name="l00352"></a>00352   <span class="comment">//$returnJSON[&#39;add_items_list&#39;] = create_add_items_list($entries_per_page, $totalEntries);</span>
<a name="l00353"></a>00353   $returnJSON[<span class="stringliteral">&#39;item_browser&#39;</span>] = <a class="code" href="workspace_8functions_8php.html#ab7998174e221c7580b36db79ea435337">create_item_browser_bare</a>($entries_per_page, $totalEntries);
<a name="l00354"></a>00354   $returnJSON[<span class="stringliteral">&#39;item_browser_items_order_array&#39;</span>] = implode(<span class="stringliteral">&quot;,&quot;</span>, $item_browser_items_order_array);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356   echo json_encode($returnJSON);
<a name="l00357"></a>00357 }
<a name="l00358"></a>00358 
<a name="l00359"></a><a class="code" href="workspace_8functions_8php.html#a7874eb316c84c820083eff9624657454">00359</a> function <a class="code" href="workspace_8functions_8php.html#a7874eb316c84c820083eff9624657454">create_bare_item_browser</a>($entries_per_page, $totalEntries) {
<a name="l00360"></a>00360   $returnJSON[<span class="stringliteral">&#39;bare_item_browser_successfully_created&#39;</span>] = <span class="stringliteral">&quot;true&quot;</span>;
<a name="l00361"></a>00361   $returnJSON[<span class="stringliteral">&#39;item_browser&#39;</span>] = <a class="code" href="workspace_8functions_8php.html#ab7998174e221c7580b36db79ea435337">create_item_browser_bare</a>($entries_per_page, $totalEntries);
<a name="l00362"></a>00362   echo json_encode($returnJSON);
<a name="l00363"></a>00363 }
<a name="l00364"></a>00364 
<a name="l00365"></a><a class="code" href="workspace_8functions_8php.html#ab7998174e221c7580b36db79ea435337">00365</a> function <a class="code" href="workspace_8functions_8php.html#ab7998174e221c7580b36db79ea435337">create_item_browser_bare</a>($entries_per_page, $totalEntries) {
<a name="l00366"></a>00366 
<a name="l00367"></a>00367   $item_browser_html .= <span class="stringliteral">&#39;&lt;div id=&quot;item_browser&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00368"></a>00368   $item_browser_html .= <span class="stringliteral">&#39;&lt;div class=&quot;dialog_box&quot; id=&quot;add_items&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00369"></a>00369   $item_browser_html .= <span class="stringliteral">&#39;    &lt;div class=&quot;dialog_box_title&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00370"></a>00370   $item_browser_html .= <span class="stringliteral">&#39;        &lt;div class=&quot;tl&quot;&gt;&lt;div class=&quot;tr&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00371"></a>00371   $item_browser_html .= <span class="stringliteral">&#39;        &lt;h3&gt;Select items to add to your queue&lt;/h3&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00372"></a>00372   $item_browser_html .= <span class="stringliteral">&#39;        &lt;/div&gt;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00373"></a>00373   $item_browser_html .= <span class="stringliteral">&#39;    &lt;/div&gt;&lt;!-- dialog_box_title --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00374"></a>00374   $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#abde27a8b7ead7d9a71ee23d285adf8f0">create_add_items_list</a>($entries_per_page, $totalEntries);
<a name="l00375"></a>00375   $item_browser_html .= <span class="stringliteral">&#39;&lt;/div&gt;&lt;!-- add_items --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00376"></a>00376   $item_browser_html .= <span class="stringliteral">&#39;&lt;/div&gt;&lt;!-- item_browser --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00377"></a>00377   <span class="keywordflow">return</span> $item_browser_html;
<a name="l00378"></a>00378 }
<a name="l00379"></a>00379 
<a name="l00380"></a><a class="code" href="workspace_8functions_8php.html#abde27a8b7ead7d9a71ee23d285adf8f0">00380</a> function <a class="code" href="workspace_8functions_8php.html#abde27a8b7ead7d9a71ee23d285adf8f0">create_add_items_list</a>($entries_per_page, $totalEntries){
<a name="l00381"></a>00381   $eppIsall = <span class="keyword">false</span>;
<a name="l00382"></a>00382   <span class="keywordflow">if</span>($entries_per_page==0 || strtolower($entries_per_page)==<span class="stringliteral">&#39;all&#39;</span>) {
<a name="l00383"></a>00383     $entries_per_page = $totalEntries;
<a name="l00384"></a>00384     $eppIsall = <span class="keyword">true</span>;
<a name="l00385"></a>00385   }
<a name="l00386"></a>00386   $maxpage = <a class="code" href="workspace_8functions_8php.html#a03e1829822f4fa388b45fc091af30f02">get_maxpage</a>($totalEntries, $entries_per_page);
<a name="l00387"></a>00387   $item_browser_html .= <span class="stringliteral">&#39;    &lt;div class=&quot;dialog_box_content&quot; id=&quot;add_items_list&quot; &gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00388"></a>00388   <span class="keywordflow">for</span>($p=1; $p &lt;= $maxpage; $p++) {
<a name="l00389"></a>00389     $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#afe5f63794b763b609679ddb4eb7016c2">start_item_borwser_page</a>($p);
<a name="l00390"></a>00390     $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#ac8190dcd062e7bdbe5026c21bbf07cac">start_item_browser_page_leftpanel</a>();
<a name="l00391"></a>00391     $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#a5abdc0ec35a882364969312123d974c4">create_item_browser_clearfix</a>();
<a name="l00392"></a>00392     $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#a1eaf28245e9f14205d262f64e45f439c">end_item_browser_page_leftpanel</a>();
<a name="l00393"></a>00393     $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#a7044e5b0e90c5de508336ab880c5c478">start_item_browser_page_rightpanel</a>();
<a name="l00394"></a>00394     $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#acb615cddac4ba844bc7c8dbbba394b37">end_item_browser_page_rightpanel</a>();
<a name="l00395"></a>00395     $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#a02118ba92691034863d360d75a8322f9">end_item_borwser_page</a>($p);
<a name="l00396"></a>00396   }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398   $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#a5abdc0ec35a882364969312123d974c4">create_item_browser_clearfix</a>();
<a name="l00399"></a>00399   $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#aa0e5888c6f195e90dc99b2d94d6a5fd4">create_item_browser_pagination</a>($maxpage, <span class="stringliteral">&quot;1&quot;</span>, $entries_per_page, $eppIsall);
<a name="l00400"></a>00400   $item_browser_html .= <span class="stringliteral">&#39;    &lt;/div&gt;&lt;!-- add_items_list --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00401"></a>00401   <span class="keywordflow">return</span> $item_browser_html;
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a><a class="code" href="workspace_8functions_8php.html#abf61ef625c1650262e4248b4dbd73f2d">00404</a> function <a class="code" href="workspace_8functions_8php.html#abf61ef625c1650262e4248b4dbd73f2d">item_browser_pagination</a>($maxpage, $page, $epp) {
<a name="l00405"></a>00405   $returnJSON[<span class="stringliteral">&#39;items_browser_pagination&#39;</span>] = <a class="code" href="workspace_8functions_8php.html#aa0e5888c6f195e90dc99b2d94d6a5fd4">create_item_browser_pagination</a>($maxpage, $page, $epp);
<a name="l00406"></a>00406   echo json_encode($returnJSON);
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 
<a name="l00409"></a><a class="code" href="workspace_8functions_8php.html#a3908b51f395452a03e910b8d0654ac70">00409</a> function <a class="code" href="workspace_8functions_8php.html#a3908b51f395452a03e910b8d0654ac70">item_browser_bare</a>() {
<a name="l00410"></a>00410   $item_browser_html .= <span class="stringliteral">&#39;&lt;div class=&quot;dialog_box&quot; id=&quot;add_items&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00411"></a>00411   $item_browser_html .= <span class="stringliteral">&#39;    &lt;div class=&quot;dialog_box_title&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00412"></a>00412   $item_browser_html .= <span class="stringliteral">&#39;        &lt;div class=&quot;tl&quot;&gt;&lt;div class=&quot;tr&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00413"></a>00413   $item_browser_html .= <span class="stringliteral">&#39;        &lt;h3&gt;Select items to add to your queue&lt;/h3&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00414"></a>00414   $item_browser_html .= <span class="stringliteral">&#39;        &lt;/div&gt;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00415"></a>00415   $item_browser_html .= <span class="stringliteral">&#39;    &lt;/div&gt;&lt;!-- dialog_box_title --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00416"></a>00416   $item_browser_html .= <span class="stringliteral">&#39;    &lt;div class=&quot;dialog_box_content&quot; id=&quot;add_items_list&quot; &gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00417"></a>00417   $item_browser_html .= <span class="stringliteral">&#39;    &lt;/div&gt;&lt;!-- add_items_list --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00418"></a>00418   $item_browser_html .= <span class="stringliteral">&#39;&lt;/div&gt;&lt;!-- add_items --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00419"></a>00419   echo $item_browser_html;
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a><a class="code" href="workspace_8functions_8php.html#a7e08d9faca4b3131d6930a60784f3ef8">00422</a> function <a class="code" href="workspace_8functions_8php.html#a7e08d9faca4b3131d6930a60784f3ef8">item_browser</a>($workflow_id, $entries_per_page, $page = 0) {
<a name="l00423"></a>00423   <span class="keywordflow">if</span>(!isset($page)){
<a name="l00424"></a>00424     $page = 0;
<a name="l00425"></a>00425   }
<a name="l00426"></a>00426   <span class="comment">//echo file_get_contents(&#39;http://apiaryubuntu904.apiaryproject.org/drupal/modules/apiary_project/apiary_layout/add_items.html&#39;);</span>
<a name="l00427"></a>00427   $workflow = <span class="keyword">new</span> Workflow($workflow_id, <span class="keyword">true</span>);
<a name="l00428"></a>00428   $workflow_dom = $workflow-&gt;workflow_dom;
<a name="l00429"></a>00429   $image_pids = $workflow-&gt;image_pids;
<a name="l00430"></a>00430   $totalEntries = sizeOf($image_pids);
<a name="l00431"></a>00431   <span class="keywordflow">if</span>($entries_per_page==0 || strtolower($entries_per_page)==<span class="stringliteral">&#39;all&#39;</span>) {
<a name="l00432"></a>00432     $entries_per_page = $totalEntries;
<a name="l00433"></a>00433   }
<a name="l00434"></a>00434   $maxpage = <a class="code" href="workspace_8functions_8php.html#a03e1829822f4fa388b45fc091af30f02">get_maxpage</a>($totalEntries, $entries_per_page);
<a name="l00435"></a>00435 
<a name="l00436"></a>00436   <span class="comment">//echo &#39;entries_per_page = &#39;.$entries_per_page.&#39;totalEntries = &#39;.$totalEntries.&#39;maxpage = &#39;.$maxpage.&quot;\n&quot;;</span>
<a name="l00437"></a>00437 
<a name="l00438"></a>00438   $item_browser_html = <a class="code" href="workspace_8functions_8php.html#af670bf78ce8af176b5de1710630a5566">create_item_browser</a>($workflow_dom, $entries_per_page, $maxpage, $page);
<a name="l00439"></a>00439   echo $item_browser_html;
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 
<a name="l00442"></a><a class="code" href="workspace_8functions_8php.html#a03e1829822f4fa388b45fc091af30f02">00442</a> function <a class="code" href="workspace_8functions_8php.html#a03e1829822f4fa388b45fc091af30f02">get_maxpage</a>($totalEntries, $entries_per_page){
<a name="l00443"></a>00443   <span class="keywordflow">return</span> ceil($totalEntries/$entries_per_page);
<a name="l00444"></a>00444 }
<a name="l00445"></a>00445 
<a name="l00446"></a><a class="code" href="workspace_8functions_8php.html#ad6f4b98127b10422b842a1c921ec5e23">00446</a> function <a class="code" href="workspace_8functions_8php.html#ad6f4b98127b10422b842a1c921ec5e23">item_browser_page</a>($workflow_id, $entries_per_page, $page) {
<a name="l00447"></a>00447   <span class="comment">//echo file_get_contents(&#39;http://apiaryubuntu904.apiaryproject.org/drupal/modules/apiary_project/apiary_layout/add_items.html&#39;);</span>
<a name="l00448"></a>00448   $workflow = <span class="keyword">new</span> Workflow($workflow_id, <span class="keyword">true</span>);
<a name="l00449"></a>00449   $workflow_dom = $workflow-&gt;workflow_dom;
<a name="l00450"></a>00450   $item_browser_page_html = <a class="code" href="workspace_8functions_8php.html#a2a83a520847eb4ca467cfc78b462ed5a">create_item_browser_page</a>($workflow_dom, $entries_per_page, $page);
<a name="l00451"></a>00451   echo $item_browser_page_html;
<a name="l00452"></a>00452 }
<a name="l00453"></a>00453 
<a name="l00454"></a><a class="code" href="workspace_8functions_8php.html#af670bf78ce8af176b5de1710630a5566">00454</a> function <a class="code" href="workspace_8functions_8php.html#af670bf78ce8af176b5de1710630a5566">create_item_browser</a>($workflow_dom, $epp, $maxpage, $page) {
<a name="l00455"></a>00455   $item_browser_html = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00456"></a>00456   <span class="keywordflow">if</span>($workflow_dom != null) {
<a name="l00457"></a>00457         $item_browser_html .= <span class="stringliteral">&#39;&lt;div class=&quot;dialog_box&quot; id=&quot;add_items&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00458"></a>00458             $item_browser_html .= <span class="stringliteral">&#39;    &lt;div class=&quot;dialog_box_title&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00459"></a>00459             $item_browser_html .= <span class="stringliteral">&#39;        &lt;div class=&quot;tl&quot;&gt;&lt;div class=&quot;tr&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00460"></a>00460             $item_browser_html .= <span class="stringliteral">&#39;        &lt;h3&gt;Select items to add to your queue&lt;/h3&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00461"></a>00461             $item_browser_html .= <span class="stringliteral">&#39;        &lt;/div&gt;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00462"></a>00462             $item_browser_html .= <span class="stringliteral">&#39;    &lt;/div&gt;&lt;!-- dialog_box_title --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00463"></a>00463         $item_browser_html .= <span class="stringliteral">&#39;    &lt;div class=&quot;dialog_box_content&quot; id=&quot;add_items_list&quot; &gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00464"></a>00464         <span class="keywordflow">if</span>($page == 0) { <span class="comment">//get all pages</span>
<a name="l00465"></a>00465           <span class="keywordflow">for</span>($p=1; $p &lt;= $maxpage; $p++) {
<a name="l00466"></a>00466             $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#a2a83a520847eb4ca467cfc78b462ed5a">create_item_browser_page</a>($workflow_dom, $epp, $p);
<a name="l00467"></a>00467           }
<a name="l00468"></a>00468         }
<a name="l00469"></a>00469         <span class="keywordflow">else</span> {
<a name="l00470"></a>00470             $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#a2a83a520847eb4ca467cfc78b462ed5a">create_item_browser_page</a>($workflow_dom, $epp, $page);
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472         $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#a5abdc0ec35a882364969312123d974c4">create_item_browser_clearfix</a>();
<a name="l00473"></a>00473         $item_browser_html .= <a class="code" href="workspace_8functions_8php.html#aa0e5888c6f195e90dc99b2d94d6a5fd4">create_item_browser_pagination</a>($maxpage, $page, $epp);
<a name="l00474"></a>00474         $item_browser_html .= <span class="stringliteral">&#39;        &lt;/div&gt;&lt;!-- add_items_list --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00475"></a>00475         $item_browser_html .= <span class="stringliteral">&#39;    &lt;/div&gt;&lt;!-- add_items --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00476"></a>00476   }
<a name="l00477"></a>00477   <span class="keywordflow">return</span> $item_browser_html;
<a name="l00478"></a>00478 }
<a name="l00479"></a>00479 
<a name="l00480"></a><a class="code" href="workspace_8functions_8php.html#aa0e5888c6f195e90dc99b2d94d6a5fd4">00480</a> function <a class="code" href="workspace_8functions_8php.html#aa0e5888c6f195e90dc99b2d94d6a5fd4">create_item_browser_pagination</a>($maxpage, $page, $epp, $eppIsAll = <span class="keyword">false</span>) {
<a name="l00481"></a>00481   $max_paginations = 5;
<a name="l00482"></a>00482   <span class="keywordflow">if</span>($page ==0) {
<a name="l00483"></a>00483     $page = 1;
<a name="l00484"></a>00484   }
<a name="l00485"></a>00485   $item_browser_pagination_html = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00486"></a>00486   $item_browser_pagination_html .= <span class="stringliteral">&#39;            &lt;div class=&quot;pagination&quot; id=&quot;add_items_pagination&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00487"></a>00487   $item_browser_pagination_html .= <span class="stringliteral">&#39;            &lt;div style=&quot;height:4px&quot;&gt;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00488"></a>00488   $item_browser_pagination_html .= <span class="stringliteral">&#39;            &lt;ul&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00489"></a>00489   $item_browser_pagination_html .= <span class="stringliteral">&#39;            &lt;li&gt;&lt;span class=&quot;first&quot;&gt;first&lt;/span&gt;&lt;/li&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00490"></a>00490   $item_browser_pagination_html .= <span class="stringliteral">&#39;            &lt;li&gt;&lt;span class=&quot;previous&quot;&gt;previous&lt;/span&gt;&lt;/li&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00491"></a>00491   <span class="keywordflow">for</span>($i = 1; $i &lt;= $maxpage; $i++) {
<a name="l00492"></a>00492     <span class="keywordflow">if</span>($i == $page) {
<a name="l00493"></a>00493       $item_browser_pagination_html .= <span class="stringliteral">&#39;            &lt;li&gt;&lt;a href=\&#39;#\&#39; id=&quot;add_items_page_&#39;</span>.$i.<span class="stringliteral">&#39;_control&quot; class=&quot;current&quot; onclick=&quot;select_page(\&#39;#add_items_page_&#39;</span>.$i.<span class="charliteral">&#39;\&#39;</span>); <span class="keywordflow">return</span> <span class="keyword">false</span>;<span class="stringliteral">&quot;&gt;&#39;.$i.&#39;&lt;/a&gt;&lt;/li&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00494"></a>00494 <span class="stringliteral">    }</span>
<a name="l00495"></a>00495 <span class="stringliteral">    else {</span>
<a name="l00496"></a>00496 <span class="stringliteral">      $item_browser_pagination_html .= &#39;            &lt;li&gt;&lt;a href=\&#39;#\&#39; id=&quot;</span>add_items_page_<span class="stringliteral">&#39;.$i.&#39;</span>_control<span class="stringliteral">&quot; onclick=&quot;</span>select_page(\<span class="stringliteral">&#39;#add_items_page_&#39;</span>.$i.<span class="charliteral">&#39;\&#39;</span>); <span class="keywordflow">return</span> <span class="keyword">false</span>;<span class="stringliteral">&quot;&gt;&#39;.$i.&#39;&lt;/a&gt;&lt;/li&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00497"></a>00497 <span class="stringliteral">    }</span>
<a name="l00498"></a>00498 <span class="stringliteral">  }</span>
<a name="l00499"></a>00499 <span class="stringliteral">  $item_browser_pagination_html .= &#39;            &lt;li&gt;&lt;a href=\&#39;#\&#39; class=&quot;</span>next<span class="stringliteral">&quot;&gt;next&lt;/a&gt;&lt;/li&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00500"></a>00500 <span class="stringliteral">  $item_browser_pagination_html .= &#39;            &lt;li&gt;&lt;a href=\&#39;#\&#39; class=&quot;</span>last<span class="stringliteral">&quot;&gt;last&lt;/a&gt;&lt;/li&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00501"></a>00501 <span class="stringliteral">  $item_browser_pagination_html .= &#39;            &lt;li&gt;Display &lt;/li&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00502"></a>00502 <span class="stringliteral">  $item_browser_pagination_html .= &#39;            &lt;li&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00503"></a>00503 <span class="stringliteral">  $item_browser_pagination_html .= &#39;                    &lt;select id=&quot;</span>epp<span class="stringliteral">&quot; name=&quot;</span>entriesperPage<span class="stringliteral">&quot; onchange=&quot;</span>reload_item_browser()<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00504"></a>00504 <span class="stringliteral">  $item_browser_pagination_html .= create_item_browser_epp_option(&quot;</span>6<span class="stringliteral">&quot;, $epp);</span>
<a name="l00505"></a>00505 <span class="stringliteral">  $item_browser_pagination_html .= create_item_browser_epp_option(&quot;</span>10<span class="stringliteral">&quot;, $epp);</span>
<a name="l00506"></a>00506 <span class="stringliteral">  $item_browser_pagination_html .= create_item_browser_epp_option(&quot;</span>16<span class="stringliteral">&quot;, $epp);</span>
<a name="l00507"></a>00507 <span class="stringliteral">  $item_browser_pagination_html .= create_item_browser_epp_option(&quot;</span>20<span class="stringliteral">&quot;, $epp);</span>
<a name="l00508"></a>00508 <span class="stringliteral">  $item_browser_pagination_html .= create_item_browser_epp_option(&quot;</span>All<span class="stringliteral">&quot;, $epp, $eppIsAll);</span>
<a name="l00509"></a>00509 <span class="stringliteral">  $item_browser_pagination_html .= &#39;                    &lt;/select&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00510"></a>00510 <span class="stringliteral">  $item_browser_pagination_html .= &#39;            &lt;/li&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00511"></a>00511 <span class="stringliteral">  $item_browser_pagination_html .= &#39;            &lt;li&gt; items per page&lt;/li&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00512"></a>00512 <span class="stringliteral">  $item_browser_pagination_html .= &#39;            &lt;/ul&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00513"></a>00513 <span class="stringliteral">  $item_browser_pagination_html .= &#39;            &lt;ul&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00514"></a>00514 <span class="stringliteral">  $item_browser_pagination_html .= &#39;            &lt;li&gt;&lt;a href=&quot;</span>#<span class="stringliteral">&quot; class=&quot;</span>action<span class="stringliteral">&quot; onclick=&quot;</span>add_items_to_queue();<span class="stringliteral">&quot;&gt;Add to queue&lt;/a&gt;&lt;/li&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00515"></a>00515 <span class="stringliteral">  $item_browser_pagination_html .= &#39;            &lt;li&gt;&lt;a href=&quot;</span>#<span class="stringliteral">&quot; class=&quot;</span>action<span class="stringliteral">&quot; id=&quot;</span>cancel<span class="stringliteral">&quot; onclick=&quot;</span>add_items_cancel();<span class="stringliteral">&quot;&gt;Cancel&lt;/a&gt;&lt;/li&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00516"></a>00516 <span class="stringliteral">  $item_browser_pagination_html .= &#39;            &lt;/ul&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00517"></a>00517 <span class="stringliteral"></span>
<a name="l00518"></a>00518 <span class="stringliteral">  $item_browser_pagination_html .= &#39;            &lt;/div&gt;&lt;!-- /pagination --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00519"></a>00519 <span class="stringliteral">  return $item_browser_pagination_html;</span>
<a name="l00520"></a>00520 <span class="stringliteral">}</span>
<a name="l00521"></a>00521 <span class="stringliteral"></span>
<a name="l00522"></a><a class="code" href="workspace_8functions_8php.html#ac16a70ff976e88b8a1c6d765606bde1a">00522</a> <span class="stringliteral">function create_item_browser_epp_option($epp_option, $current_epp, $isAll = false) {</span>
<a name="l00523"></a>00523 <span class="stringliteral">  $item_browser_epp_option_html .= &#39;                            &lt;option value=&quot;</span><span class="stringliteral">&#39;.$epp_option.&#39;</span><span class="stringliteral">&quot;&#39;;</span>
<a name="l00524"></a>00524 <span class="stringliteral">  if($epp_option == $current_epp || $isAll) {</span>
<a name="l00525"></a>00525 <span class="stringliteral">    $item_browser_epp_option_html .= &#39; selected=selected &#39;;</span>
<a name="l00526"></a>00526 <span class="stringliteral">  }</span>
<a name="l00527"></a>00527 <span class="stringliteral">  $item_browser_epp_option_html .= &#39;&gt;&#39;.$epp_option.&#39;&lt;/option&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00528"></a>00528 <span class="stringliteral">  return $item_browser_epp_option_html;</span>
<a name="l00529"></a>00529 <span class="stringliteral">}</span>
<a name="l00530"></a>00530 <span class="stringliteral"></span>
<a name="l00531"></a><a class="code" href="workspace_8functions_8php.html#a2a83a520847eb4ca467cfc78b462ed5a">00531</a> <span class="stringliteral">function create_item_browser_page($workflow_dom, $epp, $page) {</span>
<a name="l00532"></a>00532 <span class="stringliteral">  $image_display_width = &#39;450&#39;;</span>
<a name="l00533"></a>00533 <span class="stringliteral">  $leftpanel_item_start = ($page-1)*$epp+1;</span>
<a name="l00534"></a>00534 <span class="stringliteral">  $rightpanel_item_start = $leftpanel_item_start  + (round($epp/2));</span>
<a name="l00535"></a>00535 <span class="stringliteral">  $item_count = 0;</span>
<a name="l00536"></a>00536 <span class="stringliteral">  //echo &quot;</span>leftpanel_item_start = <span class="stringliteral">&quot;.$leftpanel_item_start.&quot;</span> rightpanel_item_start = <span class="stringliteral">&quot;.$rightpanel_item_start.&quot;</span> epp = <span class="stringliteral">&quot;.$epp.&quot;</span> page = <span class="stringliteral">&quot;.$page.&#39;&lt;br&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00537"></a>00537 <span class="stringliteral"></span>
<a name="l00538"></a>00538 <span class="stringliteral">  if($workflow_dom != null) {</span>
<a name="l00539"></a>00539 <span class="stringliteral">    $item_browser_page_html = &#39;&#39;;</span>
<a name="l00540"></a>00540 <span class="stringliteral">    $specimen_elements = $workflow_dom-&gt;getElementsByTagName(&#39;specimen&#39;);</span>
<a name="l00541"></a>00541 <span class="stringliteral">    foreach($specimen_elements as $specimen) {</span>
<a name="l00542"></a>00542 <span class="stringliteral">      $specimen_pid = $specimen-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00543"></a>00543 <span class="stringliteral">      $specimen_image_elements = $specimen-&gt;getElementsByTagName(&#39;image&#39;);</span>
<a name="l00544"></a>00544 <span class="stringliteral">      foreach($specimen_image_elements as $image) {</span>
<a name="l00545"></a>00545 <span class="stringliteral">        $item_count++;</span>
<a name="l00546"></a>00546 <span class="stringliteral">        if($item_count == $leftpanel_item_start) {</span>
<a name="l00547"></a>00547 <span class="stringliteral">          $item_browser_page_html .= start_item_borwser_page($page);</span>
<a name="l00548"></a>00548 <span class="stringliteral">          $item_browser_page_html .= start_item_browser_page_leftpanel();</span>
<a name="l00549"></a>00549 <span class="stringliteral">        }</span>
<a name="l00550"></a>00550 <span class="stringliteral">        else if($item_count == $rightpanel_item_start) {</span>
<a name="l00551"></a>00551 <span class="stringliteral">          $item_browser_page_html .= create_item_browser_clearfix();</span>
<a name="l00552"></a>00552 <span class="stringliteral">          $item_browser_page_html .= end_item_browser_page_leftpanel();</span>
<a name="l00553"></a>00553 <span class="stringliteral">          $item_browser_page_html .= start_item_browser_page_rightpanel();</span>
<a name="l00554"></a>00554 <span class="stringliteral">        }</span>
<a name="l00555"></a>00555 <span class="stringliteral">            if($item_count &gt;= $leftpanel_item_start &amp;&amp; $item_count &lt;= ($page*$epp)){</span>
<a name="l00556"></a>00556 <span class="stringliteral">          $imageMetadata_record = AP_Image::getimageMetadata_record($image_pid);</span>
<a name="l00557"></a>00557 <span class="stringliteral">          $rft_id = $imageMetadata_record[&#39;rft_id&#39;];</span>
<a name="l00558"></a>00558 <span class="stringliteral">          if($rft_id != &#39;&#39;) {</span>
<a name="l00559"></a>00559 <span class="stringliteral">            $djatoka_display_url = getDjatokaURL($rft_id, &#39;getRegion&#39;, &#39;3&#39;, &#39;0&#39;, &#39;0&#39;, $imageMetadata_record[&#39;h&#39;], $imageMetadata_record[&#39;w&#39;], $image_display_width, &#39;0&#39;);</span>
<a name="l00560"></a>00560 <span class="stringliteral">            $thumbnail_url = getDjatokaURL($rft_id, &#39;getRegion&#39;, &#39;3&#39;, &#39;0&#39;, &#39;0&#39;, $imageMetadata_record[&#39;h&#39;], $imageMetadata_record[&#39;w&#39;], &#39;250&#39;, &#39;0&#39;);</span>
<a name="l00561"></a>00561 <span class="stringliteral">          }</span>
<a name="l00562"></a>00562 <span class="stringliteral">          else {</span>
<a name="l00563"></a>00563 <span class="stringliteral">            $djatoka_display_url = getDjatokaURL($imageMetadata_record[&#39;URL&#39;], &#39;getRegion&#39;, &#39;3&#39;, &#39;0&#39;, &#39;0&#39;, $imageMetadata_record[&#39;h&#39;], $imageMetadata_record[&#39;w&#39;], $image_display_width, &#39;0&#39;);</span>
<a name="l00564"></a>00564 <span class="stringliteral">            $thumbnail_url = getDjatokaURL($imageMetadata_record[&#39;URL&#39;], &#39;getRegion&#39;, &#39;3&#39;, &#39;0&#39;, &#39;0&#39;, $imageMetadata_record[&#39;h&#39;], $imageMetadata_record[&#39;w&#39;], $thumb_width, &#39;0&#39;);</span>
<a name="l00565"></a>00565 <span class="stringliteral">          }</span>
<a name="l00566"></a>00566 <span class="stringliteral">          $image_pid = $image-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00567"></a>00567 <span class="stringliteral">          $analyzedStatus = $image-&gt;getElementsByTagName(&#39;analyzedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00568"></a>00568 <span class="stringliteral">          $workflow_status = $image-&gt;getElementsByTagName(&#39;workflow_status&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00569"></a>00569 <span class="stringliteral">          $item_browser_page_html .= create_item_browser_page_image_item($image_pid, $specimen_pid, $analyzedStatus, $workflow_status);</span>
<a name="l00570"></a>00570 <span class="stringliteral"></span>
<a name="l00571"></a>00571 <span class="stringliteral">          //$specimen_image_roi_elements = $image-&gt;getElementsByTagName(&#39;roi&#39;);</span>
<a name="l00572"></a>00572 <span class="stringliteral">          //foreach($specimen_image_roi_elements as $roi) {</span>
<a name="l00573"></a>00573 <span class="stringliteral">          //  $roi_pid = $roi-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00574"></a>00574 <span class="stringliteral">          //  $transcribedStatus = $image-&gt;getElementsByTagName(&#39;transcribedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00575"></a>00575 <span class="stringliteral">          //  $parsedL1Status = $image-&gt;getElementsByTagName(&#39;parsedL1Status&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00576"></a>00576 <span class="stringliteral">          //  $workflow_status = $image-&gt;getElementsByTagName(&#39;workflow_status&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00577"></a>00577 <span class="stringliteral">          //  $item_browser_page_html .= create_item_browser_page_roi_item($roi_pid, $specimen_pid, $image_pid, $transcribedStatus, $parsedL1Status, $workflow_status);</span>
<a name="l00578"></a>00578 <span class="stringliteral">          //}</span>
<a name="l00579"></a>00579 <span class="stringliteral">        }</span>
<a name="l00580"></a>00580 <span class="stringliteral">      }</span>
<a name="l00581"></a>00581 <span class="stringliteral">    }</span>
<a name="l00582"></a>00582 <span class="stringliteral">    if($item_count &gt;= $rightpanel_item_start) { //means there is an item on the right and the left has already been closed</span>
<a name="l00583"></a>00583 <span class="stringliteral">    $item_browser_page_html .= end_item_browser_page_rightpanel();</span>
<a name="l00584"></a>00584 <span class="stringliteral">    $item_browser_page_html .= end_item_borwser_page($page);</span>
<a name="l00585"></a>00585 <span class="stringliteral">    }</span>
<a name="l00586"></a>00586 <span class="stringliteral">    else {</span>
<a name="l00587"></a>00587 <span class="stringliteral">      //still create and close the right panel to not break any code</span>
<a name="l00588"></a>00588 <span class="stringliteral">      //gotta include the clearfix and close the left first</span>
<a name="l00589"></a>00589 <span class="stringliteral">      $item_browser_page_html .= create_item_browser_clearfix();</span>
<a name="l00590"></a>00590 <span class="stringliteral">      $item_browser_page_html .= end_item_browser_page_leftpanel();</span>
<a name="l00591"></a>00591 <span class="stringliteral">      $item_browser_page_html .= start_item_browser_page_rightpanel();</span>
<a name="l00592"></a>00592 <span class="stringliteral">      $item_browser_page_html .= end_item_browser_page_rightpanel();</span>
<a name="l00593"></a>00593 <span class="stringliteral">      $item_browser_page_html .= end_item_borwser_page($page);</span>
<a name="l00594"></a>00594 <span class="stringliteral">    }</span>
<a name="l00595"></a>00595 <span class="stringliteral">  }</span>
<a name="l00596"></a>00596 <span class="stringliteral">  return $item_browser_page_html;</span>
<a name="l00597"></a>00597 <span class="stringliteral">}</span>
<a name="l00598"></a>00598 <span class="stringliteral"></span>
<a name="l00599"></a><a class="code" href="workspace_8functions_8php.html#afe5f63794b763b609679ddb4eb7016c2">00599</a> <span class="stringliteral">function start_item_borwser_page($page) {</span>
<a name="l00600"></a>00600 <span class="stringliteral">  $start_item_borwser_page_html = &#39;            &lt;div class=&quot;</span>add_items_page<span class="stringliteral">&quot; id=&quot;</span>add_items_page_<span class="stringliteral">&#39;.$page.&#39;</span><span class="stringliteral">&quot; style=&quot;</span>display:none;<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00601"></a>00601 <span class="stringliteral">  return $start_item_borwser_page_html;</span>
<a name="l00602"></a>00602 <span class="stringliteral">}</span>
<a name="l00603"></a>00603 <span class="stringliteral"></span>
<a name="l00604"></a><a class="code" href="workspace_8functions_8php.html#a02118ba92691034863d360d75a8322f9">00604</a> <span class="stringliteral">function end_item_borwser_page($page) {</span>
<a name="l00605"></a>00605 <span class="stringliteral">  $end_item_borwser_page_html .= &#39;            &lt;/div&gt;&lt;!-- #add_items_page_&#39;.$page.&#39; --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00606"></a>00606 <span class="stringliteral">  return $end_item_borwser_page_html;</span>
<a name="l00607"></a>00607 <span class="stringliteral">}</span>
<a name="l00608"></a>00608 <span class="stringliteral"></span>
<a name="l00609"></a><a class="code" href="workspace_8functions_8php.html#ac8190dcd062e7bdbe5026c21bbf07cac">00609</a> <span class="stringliteral">function start_item_browser_page_leftpanel() {</span>
<a name="l00610"></a>00610 <span class="stringliteral">  $start_item_browser_page_leftpanel_html .= &#39;            &lt;div class=&quot;</span>leftpanel48<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00611"></a>00611 <span class="stringliteral">  return $start_item_browser_page_leftpanel_html;</span>
<a name="l00612"></a>00612 <span class="stringliteral">}</span>
<a name="l00613"></a>00613 <span class="stringliteral"></span>
<a name="l00614"></a><a class="code" href="workspace_8functions_8php.html#a5abdc0ec35a882364969312123d974c4">00614</a> <span class="stringliteral">function create_item_browser_clearfix() {</span>
<a name="l00615"></a>00615 <span class="stringliteral">  $create_item_browser_clearfix_html = &#39;                &lt;div class=&quot;</span>clearfix<span class="stringliteral">&quot;&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00616"></a>00616 <span class="stringliteral">  return $create_item_browser_clearfix_html;</span>
<a name="l00617"></a>00617 <span class="stringliteral">}</span>
<a name="l00618"></a>00618 <span class="stringliteral"></span>
<a name="l00619"></a><a class="code" href="workspace_8functions_8php.html#a1eaf28245e9f14205d262f64e45f439c">00619</a> <span class="stringliteral">function end_item_browser_page_leftpanel() {</span>
<a name="l00620"></a>00620 <span class="stringliteral">  $end_item_browser_page_leftpanel_html .= &#39;            &lt;/div&gt;&lt;!-- .leftpanel48 --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00621"></a>00621 <span class="stringliteral">  return $end_item_browser_page_leftpanel_html;</span>
<a name="l00622"></a>00622 <span class="stringliteral">}</span>
<a name="l00623"></a>00623 <span class="stringliteral"></span>
<a name="l00624"></a><a class="code" href="workspace_8functions_8php.html#a7044e5b0e90c5de508336ab880c5c478">00624</a> <span class="stringliteral">function start_item_browser_page_rightpanel() {</span>
<a name="l00625"></a>00625 <span class="stringliteral">  $start_item_browser_page_rightpanel_html = &#39;            &lt;div class=&quot;</span>rightpanel48<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00626"></a>00626 <span class="stringliteral">  return $start_item_browser_page_rightpanel_html;</span>
<a name="l00627"></a>00627 <span class="stringliteral">}</span>
<a name="l00628"></a>00628 <span class="stringliteral"></span>
<a name="l00629"></a><a class="code" href="workspace_8functions_8php.html#acb615cddac4ba844bc7c8dbbba394b37">00629</a> <span class="stringliteral">function end_item_browser_page_rightpanel() {</span>
<a name="l00630"></a>00630 <span class="stringliteral">  $end_item_browser_page_rightpanel_html = &#39;            &lt;/div&gt;&lt;!-- .rightpanel48 --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00631"></a>00631 <span class="stringliteral">  return $end_item_browser_page_rightpanel_html;</span>
<a name="l00632"></a>00632 <span class="stringliteral">}</span>
<a name="l00633"></a>00633 <span class="stringliteral"></span>
<a name="l00634"></a><a class="code" href="workspace_8functions_8php.html#a1dd11ac45a65b79f00a6e03a19c4d7ea">00634</a> <span class="stringliteral">function create_item_browser_page_image_item_via_solr($image_pid, $specimen_pid, $analyzedStatus, $roi_count, $thumbnail_url, $workflow_status) {</span>
<a name="l00635"></a>00635 <span class="stringliteral">  $selected_class = &#39;unselected&#39;;</span>
<a name="l00636"></a>00636 <span class="stringliteral">  $roundedcornr_class = &#39;roundedcornr_ltgray&#39;;</span>
<a name="l00637"></a>00637 <span class="stringliteral">  if($workflow_status == &quot;</span>queued<span class="stringliteral">&quot;) {</span>
<a name="l00638"></a>00638 <span class="stringliteral">    $selected_class = &#39;selected&#39;;</span>
<a name="l00639"></a>00639 <span class="stringliteral">    $roundedcornr_class = &#39;roundedcornr_dgray&#39;;</span>
<a name="l00640"></a>00640 <span class="stringliteral">  }</span>
<a name="l00641"></a>00641 <span class="stringliteral">  //workflow_status is a used class</span>
<a name="l00642"></a>00642 <span class="stringliteral">  $item_browser_page_item_html = &#39;                &lt;div class=&quot;</span><span class="stringliteral">&#39;.$roundedcornr_class.&#39;</span> pool_item <span class="stringliteral">&#39;.$selected_class.&#39;</span> <span class="stringliteral">&#39;.$workflow_status.&#39;</span><span class="stringliteral">&quot; id=&quot;</span><span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $image_pid).&#39;</span><span class="stringliteral">&quot;  specimen_pid=&quot;</span><span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $specimen_pid).&#39;</span><span class="stringliteral">&quot; onclick=&quot;</span>toggle_selected(\<span class="charliteral">&#39;#&#39;</span>.str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $image_pid).<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00643"></a>00643 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                &lt;div class=&quot;</span>t<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>b<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>l<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>r<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>bl<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>br<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>tl<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>tr<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00644"></a>00644 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                    &lt;div class=&quot;</span>pool_item_checkbox<span class="stringliteral">&quot;&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00645"></a>00645 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                    &lt;div class=&quot;</span>pool_item_area pool_item_image<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00646"></a>00646 <span class="stringliteral"></span>
<a name="l00647"></a>00647 <span class="stringliteral">  //$djatoka_image_url = get_djatoka_url_by_height($image_pid, &quot;</span>68<span class="stringliteral">&quot;);</span>
<a name="l00648"></a>00648 <span class="stringliteral">  $djatoka_image_url = $thumbnail_url;</span>
<a name="l00649"></a>00649 <span class="stringliteral"></span>
<a name="l00650"></a>00650 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                        &lt;img src=&quot;</span><span class="stringliteral">&#39;.variable_get(&#39;</span>apiary_research_base_url<span class="stringliteral">&#39;, &#39;</span>http:<span class="comment">//localhost&#39;).&#39;/drupal/modules/apiary_project/workflow/assets/img/blank.gif&quot; class=&quot;delayLoad&quot; onmouseover=&quot;this.src=\&#39;&#39;.$djatoka_image_url.&#39;\&#39;&quot; height=68px /&gt;&#39;.&quot;\n&quot;;</span>
<a name="l00651"></a>00651   $item_browser_page_item_html .= <span class="stringliteral">&#39;                    &lt;/div&gt;&lt;!-- pool_item_image --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00652"></a>00652   $item_browser_page_item_html .= <span class="stringliteral">&#39;                    &lt;div class=&quot;pool_item_area pool_item_content&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00653"></a>00653   $item_browser_page_item_html .= <span class="stringliteral">&#39;                        &lt;strong&gt;&#39;</span>.$specimen_pid.<span class="stringliteral">&#39;&lt;/strong&gt;&lt;br/&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00654"></a>00654 
<a name="l00655"></a>00655   <span class="comment">//$roi_pids = AP_Image::getROIListForImage($image_pid);</span>
<a name="l00656"></a>00656   <span class="comment">//$roi_count = sizeOf($roi_pids);</span>
<a name="l00657"></a>00657 
<a name="l00658"></a>00658   $item_browser_page_item_html .= <a class="code" href="workspace_8functions_8php.html#a011940edca79f7189587b42798ac7f7e">create_item_browser_image_item_detail</a>($analyzedStatus, $workflow_status, $roi_count);
<a name="l00659"></a>00659   $item_browser_page_item_html .= <span class="stringliteral">&#39;                    &lt;/div&gt;&lt;!-- .pool_item_content --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00660"></a>00660   $item_browser_page_item_html .= <span class="stringliteral">&#39;                &lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00661"></a>00661   $item_browser_page_item_html .= <span class="stringliteral">&#39;                &lt;/div&gt;&lt;!-- .roundedcornr_ltgray --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00662"></a>00662   <span class="keywordflow">return</span> $item_browser_page_item_html;
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 
<a name="l00665"></a><a class="code" href="workspace_8functions_8php.html#ab15550a7aa0b4e5495fd073d7c10cb4e">00665</a> function <a class="code" href="workspace_8functions_8php.html#ab15550a7aa0b4e5495fd073d7c10cb4e">create_item_browser_page_image_item</a>($image_pid, $specimen_pid, $analyzedStatus, $workflow_status) {
<a name="l00666"></a>00666   $selected_class = <span class="stringliteral">&#39;unselected&#39;</span>;
<a name="l00667"></a>00667   $roundedcornr_class = <span class="stringliteral">&#39;roundedcornr_ltgray&#39;</span>;
<a name="l00668"></a>00668   <span class="keywordflow">if</span>($workflow_status == <span class="stringliteral">&quot;queued&quot;</span>) {
<a name="l00669"></a>00669     $selected_class = <span class="stringliteral">&#39;selected&#39;</span>;
<a name="l00670"></a>00670     $roundedcornr_class = <span class="stringliteral">&#39;roundedcornr_dgray&#39;</span>;
<a name="l00671"></a>00671   }
<a name="l00672"></a>00672   <span class="comment">//workflow_status is a used class</span>
<a name="l00673"></a>00673   $item_browser_page_item_html = <span class="stringliteral">&#39;                &lt;div class=&quot;&#39;</span>.$roundedcornr_class.<span class="stringliteral">&#39; pool_item &#39;</span>.$selected_class.<span class="charliteral">&#39; &#39;</span>.$workflow_status.<span class="stringliteral">&#39;&quot; id=&quot;&#39;</span>.str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $image_pid).<span class="stringliteral">&#39;&quot;  specimen_pid=&quot;&#39;</span>.str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $specimen_pid).<span class="stringliteral">&#39;&quot; onclick=&quot;toggle_selected(\&#39;#&#39;</span>.str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $image_pid).<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00674"></a>00674 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                &lt;div class=&quot;</span>t<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>b<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>l<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>r<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>bl<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>br<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>tl<span class="stringliteral">&quot;&gt;&lt;div class=&quot;</span>tr<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00675"></a>00675 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                    &lt;div class=&quot;</span>pool_item_checkbox<span class="stringliteral">&quot;&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00676"></a>00676 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                    &lt;div class=&quot;</span>pool_item_area pool_item_image<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00677"></a>00677 <span class="stringliteral"></span>
<a name="l00678"></a>00678 <span class="stringliteral">  $djatoka_image_url = get_djatoka_url_by_height($image_pid, &quot;</span>68<span class="stringliteral">&quot;);</span>
<a name="l00679"></a>00679 <span class="stringliteral"></span>
<a name="l00680"></a>00680 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                        &lt;img src=&quot;</span><span class="stringliteral">&#39;.$djatoka_image_url.&#39;</span><span class="stringliteral">&quot; height=68px /&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00681"></a>00681 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                    &lt;/div&gt;&lt;!-- pool_item_image --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00682"></a>00682 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                    &lt;div class=&quot;</span>pool_item_area pool_item_content<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00683"></a>00683 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                        &lt;strong&gt;&#39;.$specimen_pid.&#39;&lt;/strong&gt;&lt;br/&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00684"></a>00684 <span class="stringliteral"></span>
<a name="l00685"></a>00685 <span class="stringliteral">  //$imageMetadata_record = AP_Image::getimageMetadata_record($image_pid);</span>
<a name="l00686"></a>00686 <span class="stringliteral"></span>
<a name="l00687"></a>00687 <span class="stringliteral">  $roi_pids = AP_Image::getROIListForImage($image_pid);</span>
<a name="l00688"></a>00688 <span class="stringliteral">  $roi_count = sizeOf($roi_pids);</span>
<a name="l00689"></a>00689 <span class="stringliteral"></span>
<a name="l00690"></a>00690 <span class="stringliteral">  $item_browser_page_item_html .= create_item_browser_image_item_detail($analyzedStatus, $workflow_status, $roi_count);</span>
<a name="l00691"></a>00691 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                    &lt;/div&gt;&lt;!-- .pool_item_content --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00692"></a>00692 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                &lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00693"></a>00693 <span class="stringliteral">  $item_browser_page_item_html .= &#39;                &lt;/div&gt;&lt;!-- .roundedcornr_ltgray --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00694"></a>00694 <span class="stringliteral">  return $item_browser_page_item_html;</span>
<a name="l00695"></a>00695 <span class="stringliteral">}</span>
<a name="l00696"></a>00696 <span class="stringliteral"></span>
<a name="l00697"></a><a class="code" href="workspace_8functions_8php.html#a011940edca79f7189587b42798ac7f7e">00697</a> <span class="stringliteral">function create_item_browser_image_item_detail($analyzedStatus, $workflow_status, $roi_count) {</span>
<a name="l00698"></a>00698 <span class="stringliteral">  $item_browser_image_item_detail_html = &#39;&#39;;</span>
<a name="l00699"></a>00699 <span class="stringliteral">  if($analyzedStatus != &#39;&#39; &amp;&amp; $analyzedStatus != null) {</span>
<a name="l00700"></a>00700 <span class="stringliteral">    $item_browser_image_item_detail_html .= &#39;                        analyzed status: &#39;.$analyzedStatus.&quot;</span>&lt;br/&gt;\n<span class="stringliteral">&quot;;</span>
<a name="l00701"></a>00701 <span class="stringliteral">  }</span>
<a name="l00702"></a>00702 <span class="stringliteral">  $item_browser_image_item_detail_html .= &#39;                        ROIs: &#39;.$roi_count.&quot;</span>&lt;br/&gt;\n<span class="stringliteral">&quot;;</span>
<a name="l00703"></a>00703 <span class="stringliteral">  $item_browser_image_item_detail_html .= &#39;                        workflow status: &#39;.$workflow_status.&quot;</span>&lt;br/&gt;\n<span class="stringliteral">&quot;;</span>
<a name="l00704"></a>00704 <span class="stringliteral">  return $item_browser_image_item_detail_html;</span>
<a name="l00705"></a>00705 <span class="stringliteral">}</span>
<a name="l00706"></a>00706 <span class="stringliteral"></span>
<a name="l00707"></a><a class="code" href="workspace_8functions_8php.html#ae140dc481a8fe939aefbfa1dbd61f345">00707</a> <span class="stringliteral">function queue_list($workflow_id) {</span>
<a name="l00708"></a>00708 <span class="stringliteral">        //queue_list_fedora($workflow_id);</span>
<a name="l00709"></a>00709 <span class="stringliteral">        create_queue_list_via_solr($workflow_id);</span>
<a name="l00710"></a>00710 <span class="stringliteral">}</span>
<a name="l00711"></a>00711 <span class="stringliteral"></span>
<a name="l00712"></a><a class="code" href="workspace_8functions_8php.html#aae638a872b51c2508581ad462dd985bb">00712</a> <span class="stringliteral">function queue_list_fedora($workflow_id) {</span>
<a name="l00713"></a>00713 <span class="stringliteral">  $workflow = new Workflow($workflow_id, true);</span>
<a name="l00714"></a>00714 <span class="stringliteral">  $workflow_dom = $workflow-&gt;workflow_dom;</span>
<a name="l00715"></a>00715 <span class="stringliteral">  //$queued_image_pids = $workflow-&gt;queued_image_pids;</span>
<a name="l00716"></a>00716 <span class="stringliteral">  //$queued_roi_pids = $workflow-&gt;queued_roi_pids;</span>
<a name="l00717"></a>00717 <span class="stringliteral">  $queue_list_html = create_queue_list($workflow_dom,$workflow_id);</span>
<a name="l00718"></a>00718 <span class="stringliteral">  echo $queue_list_html;</span>
<a name="l00719"></a>00719 <span class="stringliteral">}</span>
<a name="l00720"></a>00720 <span class="stringliteral"></span>
<a name="l00721"></a><a class="code" href="workspace_8functions_8php.html#a9e49f9eb721481e7144e045c3dc714d0">00721</a> <span class="stringliteral">function create_queue_list($workflow_dom,$workflow_id=null) {</span>
<a name="l00722"></a>00722 <span class="stringliteral">  $queue_list_html = &#39;&#39;;</span>
<a name="l00723"></a>00723 <span class="stringliteral">  if($workflow_dom != null) {</span>
<a name="l00724"></a>00724 <span class="stringliteral">    $queue_list_html .= &#39;&lt;!-- queue_list content begin --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00725"></a>00725 <span class="stringliteral">    $specimen_elements = $workflow_dom-&gt;getElementsByTagName(&#39;specimen&#39;);</span>
<a name="l00726"></a>00726 <span class="stringliteral">    foreach($specimen_elements as $specimen) {</span>
<a name="l00727"></a>00727 <span class="stringliteral">      $specimen_pid = $specimen-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00728"></a>00728 <span class="stringliteral">      $specimen_image_elements = $specimen-&gt;getElementsByTagName(&#39;image&#39;);</span>
<a name="l00729"></a>00729 <span class="stringliteral">      foreach($specimen_image_elements as $image) {</span>
<a name="l00730"></a>00730 <span class="stringliteral">        $workflow_status = $image-&gt;getElementsByTagName(&#39;workflow_status&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00731"></a>00731 <span class="stringliteral">        if($workflow_status == &quot;</span>queued<span class="stringliteral">&quot;) {</span>
<a name="l00732"></a>00732 <span class="stringliteral">          $image_pid = $image-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00733"></a>00733 <span class="stringliteral">          $analyzedStatus = $image-&gt;getElementsByTagName(&#39;analyzedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00734"></a>00734 <span class="stringliteral">          $locked_by = $image-&gt;getElementsByTagName(&#39;locked_by&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00735"></a>00735 <span class="stringliteral">          $workflow_status = $image-&gt;getElementsByTagName(&#39;workflow_status&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00736"></a>00736 <span class="stringliteral">          $specimen_image_roi_elements = $image-&gt;getElementsByTagName(&#39;roi&#39;);</span>
<a name="l00737"></a>00737 <span class="stringliteral">          $roi_count = $specimen_image_roi_elements-&gt;length;</span>
<a name="l00738"></a>00738 <span class="stringliteral"></span>
<a name="l00739"></a>00739 <span class="stringliteral">          $queue_list_html .= create_queue_list_image($image_pid, $specimen_pid, $analyzedStatus, $roi_count, $locked_by, $workflow_status,$workflow_id);</span>
<a name="l00740"></a>00740 <span class="stringliteral">          $queue_list_html .= &#39;&lt;div class=&quot;</span>widget-content<span class="stringliteral">&quot; id=&quot;</span>content-<span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $image_pid).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00741"></a>00741 <span class="stringliteral">          foreach($specimen_image_roi_elements as $roi) {</span>
<a name="l00742"></a>00742 <span class="stringliteral">            $workflow_status = $roi-&gt;getElementsByTagName(&#39;workflow_status&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00743"></a>00743 <span class="stringliteral">            $roi_pid = $roi-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00744"></a>00744 <span class="stringliteral">            $transcribedStatus = $roi-&gt;getElementsByTagName(&#39;transcribedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00745"></a>00745 <span class="stringliteral">            $parsedL1Status = $roi-&gt;getElementsByTagName(&#39;parsedL1Status&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00746"></a>00746 <span class="stringliteral">            $locked_by = $roi-&gt;getElementsByTagName(&#39;locked_by&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00747"></a>00747 <span class="stringliteral">            $queue_list_html .= create_queue_list_roi($roi_pid, $image_pid, $transcribedStatus, $parsedL1Status, $locked_by, $workflow_status,$workflow_id);</span>
<a name="l00748"></a>00748 <span class="stringliteral">          }</span>
<a name="l00749"></a>00749 <span class="stringliteral">          $queue_list_html .= &#39;&lt;/div&gt;&lt;!-- widget-content --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00750"></a>00750 <span class="stringliteral">        }</span>
<a name="l00751"></a>00751 <span class="stringliteral">      }</span>
<a name="l00752"></a>00752 <span class="stringliteral">    }</span>
<a name="l00753"></a>00753 <span class="stringliteral">    $queue_list_html .= &#39;&lt;!-- queue_list content end --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00754"></a>00754 <span class="stringliteral">  }</span>
<a name="l00755"></a>00755 <span class="stringliteral">  else {</span>
<a name="l00756"></a>00756 <span class="stringliteral">    return &quot;</span><span class="keyword">false</span><span class="stringliteral">&quot;;</span>
<a name="l00757"></a>00757 <span class="stringliteral">  }</span>
<a name="l00758"></a>00758 <span class="stringliteral">  return $queue_list_html;</span>
<a name="l00759"></a>00759 <span class="stringliteral">}</span>
<a name="l00760"></a>00760 <span class="stringliteral"></span>
<a name="l00761"></a><a class="code" href="workspace_8functions_8php.html#a03809983fff35fb23a8e7d7788cc6b0e">00761</a> <span class="stringliteral">function create_queue_list_via_solr($workflow_id=null) {</span>
<a name="l00762"></a>00762 <span class="stringliteral">  $apiary_session = $_SESSION[&#39;apiary_session_id&#39;];</span>
<a name="l00763"></a>00763 <span class="stringliteral">  $now = date(&quot;</span>YmdHis<span class="stringliteral">&quot;);</span>
<a name="l00764"></a>00764 <span class="stringliteral">  $apiary_timeout = variable_get(&#39;apiary_object_timeout&#39;, &#39;1800&#39;);</span>
<a name="l00765"></a>00765 <span class="stringliteral">  $unexpired = $now - $apiary_timeout;</span>
<a name="l00766"></a>00766 <span class="stringliteral">  $locked_time_min = sprintf(&quot;</span>%.0f<span class="stringliteral">&quot;, $unexpired);</span>
<a name="l00767"></a>00767 <span class="stringliteral">  $solr_q = &#39;q=status_locked_session:(&quot;</span><span class="stringliteral">&#39;.$apiary_session.&#39;</span><span class="stringliteral">&quot;)&#39;;</span>
<a name="l00768"></a>00768 <span class="stringliteral">  $solr_q .= &#39;+status_locked:(&quot;</span><span class="keyword">true</span><span class="stringliteral">&quot;)&#39;;</span>
<a name="l00769"></a>00769 <span class="stringliteral">  $solr_q .= &#39;+locked_time:[&#39;.$locked_time_min.&#39;+*]&#39;;</span>
<a name="l00770"></a>00770 <span class="stringliteral">  $solr_fl = &#39;fl=id&#39;;</span>
<a name="l00771"></a>00771 <span class="stringliteral">  $solr_fl .= &#39;+parent_id&#39;;</span>
<a name="l00772"></a>00772 <span class="stringliteral">  $solr_fl .= &#39;+status_analyzedStatus&#39;;</span>
<a name="l00773"></a>00773 <span class="stringliteral">  $solr_fl .= &#39;+status_transcribedStatus&#39;;</span>
<a name="l00774"></a>00774 <span class="stringliteral">  $solr_fl .= &#39;+status_transcribedStatusUpdatedBy&#39;;</span>
<a name="l00775"></a>00775 <span class="stringliteral">  $solr_fl .= &#39;+status_parsedL1Status&#39;;</span>
<a name="l00776"></a>00776 <span class="stringliteral">  $solr_fl .= &#39;+status_parsedL1StausUpdatedBy&#39;;</span>
<a name="l00777"></a>00777 <span class="stringliteral">  $solr_fl .= &#39;+status_parsedL2Status&#39;;</span>
<a name="l00778"></a>00778 <span class="stringliteral">  $solr_fl .= &#39;+status_parsedL3Status&#39;;</span>
<a name="l00779"></a>00779 <span class="stringliteral">  $solr_fl .= &#39;+status_qcStatus&#39;;</span>
<a name="l00780"></a>00780 <span class="stringliteral">  $solr_fl .= &#39;+status_qcStatusUpdatedBy&#39;;</span>
<a name="l00781"></a>00781 <span class="stringliteral">  $solr_fl .= &#39;+status_locked&#39;;</span>
<a name="l00782"></a>00782 <span class="stringliteral">  $solr_fl .= &#39;+locked_time&#39;;</span>
<a name="l00783"></a>00783 <span class="stringliteral">  $solr_fl .= &#39;+status_locked_by&#39;;</span>
<a name="l00784"></a>00784 <span class="stringliteral">  $solr_fl .= &#39;+status_locked_session&#39;;</span>
<a name="l00785"></a>00785 <span class="stringliteral">  $solr_op = &#39;q.op=AND&#39;;</span>
<a name="l00786"></a>00786 <span class="stringliteral">  $solr_rows = &#39;rows=10000&#39;;</span>
<a name="l00787"></a>00787 <span class="stringliteral">  $solr_sxml = solr_query_xml($solr_q, $solr_fl, $solr_op, $solr_rows);</span>
<a name="l00788"></a>00788 <span class="stringliteral">  if($solr_sxml != false) {</span>
<a name="l00789"></a>00789 <span class="stringliteral">    $workflow_dom = create_workflow_dom($solr_sxml);</span>
<a name="l00790"></a>00790 <span class="stringliteral">    //$workflow_dom-&gt;save(&#39;/tmp/solr_workflow_dom.xml&#39;);</span>
<a name="l00791"></a>00791 <span class="stringliteral">    $queue_list_html = create_queue_list($workflow_dom,$workflow_id);</span>
<a name="l00792"></a>00792 <span class="stringliteral">    echo $queue_list_html;</span>
<a name="l00793"></a>00793 <span class="stringliteral">  }</span>
<a name="l00794"></a>00794 <span class="stringliteral">  else {</span>
<a name="l00795"></a>00795 <span class="stringliteral">    echo &quot;</span>false&lt;br&gt;\n<span class="stringliteral">&quot;;</span>
<a name="l00796"></a>00796 <span class="stringliteral">  }</span>
<a name="l00797"></a>00797 <span class="stringliteral">}</span>
<a name="l00798"></a>00798 <span class="stringliteral"></span>
<a name="l00799"></a><a class="code" href="workspace_8functions_8php.html#a75e0ded2e7d256d7c50a84c8ec47acbd">00799</a> <span class="stringliteral">function get_parent_via_solr($pid) {</span>
<a name="l00800"></a>00800 <span class="stringliteral">  $solr_q = &#39;q=id:(&quot;</span><span class="stringliteral">&#39;.$pid.&#39;</span><span class="stringliteral">&quot;)&#39;;</span>
<a name="l00801"></a>00801 <span class="stringliteral">  $solr_fl = &#39;fl=parent_id&#39;;</span>
<a name="l00802"></a>00802 <span class="stringliteral">  $solr_sxml = solr_query_xml($solr_q, $solr_fl);</span>
<a name="l00803"></a>00803 <span class="stringliteral">  if($solr_sxml != false) {</span>
<a name="l00804"></a>00804 <span class="stringliteral">    foreach($solr_sxml-&gt;result[0]-&gt;doc[0]-&gt;children() as $str) {</span>
<a name="l00805"></a>00805 <span class="stringliteral">      return (string)$str;</span>
<a name="l00806"></a>00806 <span class="stringliteral">    }</span>
<a name="l00807"></a>00807 <span class="stringliteral">  }</span>
<a name="l00808"></a>00808 <span class="stringliteral">  else {</span>
<a name="l00809"></a>00809 <span class="stringliteral">    return false;</span>
<a name="l00810"></a>00810 <span class="stringliteral">  }</span>
<a name="l00811"></a>00811 <span class="stringliteral">}</span>
<a name="l00812"></a><a class="code" href="workspace_8functions_8php.html#a004e58be3cc3bc417d4649db23f2089c">00812</a> <span class="stringliteral">  function create_workflow_dom($solr_sxml) {</span>
<a name="l00813"></a>00813 <span class="stringliteral">    $workflow_dom = new DOMDocument(&#39;1.0&#39;, &#39;iso-8859-1&#39;);</span>
<a name="l00814"></a>00814 <span class="stringliteral">    $workflow_root_element = $workflow_dom-&gt;createElement(&#39;workflow&#39;, &#39;&#39;);//rootElement</span>
<a name="l00815"></a>00815 <span class="stringliteral">    $workflow_dom-&gt;appendChild($workflow_root_element);</span>
<a name="l00816"></a>00816 <span class="stringliteral">    foreach($solr_sxml-&gt;result[0]-&gt;doc as $doc) {</span>
<a name="l00817"></a>00817 <span class="stringliteral">      $pid = &#39;&#39;;</span>
<a name="l00818"></a>00818 <span class="stringliteral">      $parent_pid = &#39;&#39;;</span>
<a name="l00819"></a>00819 <span class="stringliteral">      $analyzedStatus = &#39;&#39;;</span>
<a name="l00820"></a>00820 <span class="stringliteral">      $transcribedStatus = &#39;&#39;;</span>
<a name="l00821"></a>00821 <span class="stringliteral">      $transcribedStatusUpdatedBy = &#39;&#39;;</span>
<a name="l00822"></a>00822 <span class="stringliteral">      $parsedL1Status = &#39;&#39;;</span>
<a name="l00823"></a>00823 <span class="stringliteral">      $parsedL1StausUpdatedBy = &#39;&#39;;</span>
<a name="l00824"></a>00824 <span class="stringliteral">      $parsedL2Status = &#39;&#39;;</span>
<a name="l00825"></a>00825 <span class="stringliteral">      $parsedL3Status = &#39;&#39;;</span>
<a name="l00826"></a>00826 <span class="stringliteral">      $qcStatus = &#39;&#39;;</span>
<a name="l00827"></a>00827 <span class="stringliteral">      $qcStatusUpdatedBy = &#39;&#39;;</span>
<a name="l00828"></a>00828 <span class="stringliteral">      $locked = &#39;&#39;;</span>
<a name="l00829"></a>00829 <span class="stringliteral">      $locked_time = &#39;&#39;;</span>
<a name="l00830"></a>00830 <span class="stringliteral">      $locked_by = &#39;&#39;;</span>
<a name="l00831"></a>00831 <span class="stringliteral">      $locked_session = &#39;&#39;;</span>
<a name="l00832"></a>00832 <span class="stringliteral">      foreach($doc-&gt;children() as $sxml_node) {</span>
<a name="l00833"></a>00833 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;id&#39;) {</span>
<a name="l00834"></a>00834 <span class="stringliteral">          $pid = (string)$sxml_node;</span>
<a name="l00835"></a>00835 <span class="stringliteral">        }</span>
<a name="l00836"></a>00836 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;parent_id&#39;) {</span>
<a name="l00837"></a>00837 <span class="stringliteral">          $parent_pid = (string)$sxml_node;</span>
<a name="l00838"></a>00838 <span class="stringliteral">        }</span>
<a name="l00839"></a>00839 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_analyzedStatus&#39;) {</span>
<a name="l00840"></a>00840 <span class="stringliteral">          $analyzedStatus = (string)$sxml_node;</span>
<a name="l00841"></a>00841 <span class="stringliteral">        }</span>
<a name="l00842"></a>00842 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_transcribedStatus&#39;) {</span>
<a name="l00843"></a>00843 <span class="stringliteral">          $transcribedStatus = (string)$sxml_node;</span>
<a name="l00844"></a>00844 <span class="stringliteral">        }</span>
<a name="l00845"></a>00845 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_transcribedStatusUpdatedBy&#39;) {</span>
<a name="l00846"></a>00846 <span class="stringliteral">          $transcribedStatusUpdatedBy = (string)$sxml_node;</span>
<a name="l00847"></a>00847 <span class="stringliteral">        }</span>
<a name="l00848"></a>00848 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL1Status&#39;) {</span>
<a name="l00849"></a>00849 <span class="stringliteral">          $parsedL1Status = (string)$sxml_node;</span>
<a name="l00850"></a>00850 <span class="stringliteral">        }</span>
<a name="l00851"></a>00851 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL1StausUpdatedBy&#39;) {</span>
<a name="l00852"></a>00852 <span class="stringliteral">          $parsedL1StausUpdatedBy = (string)$sxml_node;</span>
<a name="l00853"></a>00853 <span class="stringliteral">        }</span>
<a name="l00854"></a>00854 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL2Status&#39;) {</span>
<a name="l00855"></a>00855 <span class="stringliteral">          $parsedL2Status = (string)$sxml_node;</span>
<a name="l00856"></a>00856 <span class="stringliteral">        }</span>
<a name="l00857"></a>00857 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL3Status&#39;) {</span>
<a name="l00858"></a>00858 <span class="stringliteral">          $parsedL3Status = (string)$sxml_node;</span>
<a name="l00859"></a>00859 <span class="stringliteral">        }</span>
<a name="l00860"></a>00860 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_qcStatus&#39;) {</span>
<a name="l00861"></a>00861 <span class="stringliteral">          $qcStatus = (string)$sxml_node;</span>
<a name="l00862"></a>00862 <span class="stringliteral">        }</span>
<a name="l00863"></a>00863 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_qcStatusUpdatedBy&#39;) {</span>
<a name="l00864"></a>00864 <span class="stringliteral">          $qcStatusUpdatedBy = (string)$sxml_node;</span>
<a name="l00865"></a>00865 <span class="stringliteral">        }</span>
<a name="l00866"></a>00866 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_locked&#39;) {</span>
<a name="l00867"></a>00867 <span class="stringliteral">          $locked = (string)$sxml_node;</span>
<a name="l00868"></a>00868 <span class="stringliteral">        }</span>
<a name="l00869"></a>00869 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;locked_time&#39;) {</span>
<a name="l00870"></a>00870 <span class="stringliteral">          $locked_time = (double)$sxml_node;</span>
<a name="l00871"></a>00871 <span class="stringliteral">        }</span>
<a name="l00872"></a>00872 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_locked_by&#39;) {</span>
<a name="l00873"></a>00873 <span class="stringliteral">          $locked_by = (string)$sxml_node;</span>
<a name="l00874"></a>00874 <span class="stringliteral">        }</span>
<a name="l00875"></a>00875 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_locked_session&#39;) {</span>
<a name="l00876"></a>00876 <span class="stringliteral">          $locked_session = (string)$sxml_node;</span>
<a name="l00877"></a>00877 <span class="stringliteral">        }</span>
<a name="l00878"></a>00878 <span class="stringliteral">      }</span>
<a name="l00879"></a>00879 <span class="stringliteral">      if(strpos($pid, &#39;ap-image:&#39;) &gt; -1) {</span>
<a name="l00880"></a>00880 <span class="stringliteral">        $specimenElement = get_workflow_dom_specimen($workflow_dom, $workflow_root_element, $parent_pid);</span>
<a name="l00881"></a>00881 <span class="stringliteral">        $image = array();</span>
<a name="l00882"></a>00882 <span class="stringliteral">        $image[&#39;pid&#39;] = $pid;</span>
<a name="l00883"></a>00883 <span class="stringliteral">        $image[&#39;parent_pid&#39;] = $parent_pid;</span>
<a name="l00884"></a>00884 <span class="stringliteral">        $image[&#39;analyzedStatus&#39;] = $analyzedStatus;</span>
<a name="l00885"></a>00885 <span class="stringliteral">        $image[&#39;locked&#39;] = $locked;</span>
<a name="l00886"></a>00886 <span class="stringliteral">        $image[&#39;locked_time&#39;] = $locked_time;</span>
<a name="l00887"></a>00887 <span class="stringliteral">        $image[&#39;locked_by&#39;] = $locked_by;</span>
<a name="l00888"></a>00888 <span class="stringliteral">        $image[&#39;locked_session&#39;] = $locked_session;</span>
<a name="l00889"></a>00889 <span class="stringliteral">        $image[&#39;qcStatus&#39;] = $qcStatus;</span>
<a name="l00890"></a>00890 <span class="stringliteral">        $image[&#39;qcStatusUpdatedBy&#39;] = $qcStatusUpdatedBy;</span>
<a name="l00891"></a>00891 <span class="stringliteral">        $image[&#39;workflow_status&#39;] = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l00892"></a>00892 <span class="stringliteral">        $imageElement = create_workflow_dom_image($workflow_dom, $specimenElement, $image);</span>
<a name="l00893"></a>00893 <span class="stringliteral">      }</span>
<a name="l00894"></a>00894 <span class="stringliteral">      else if(strpos($pid, &#39;ap-roi:&#39;) &gt; -1) {</span>
<a name="l00895"></a>00895 <span class="stringliteral">        $imageElement = get_workflow_dom_image($workflow_dom, $workflow_root_element, $parent_pid);</span>
<a name="l00896"></a>00896 <span class="stringliteral">        $roi = array();</span>
<a name="l00897"></a>00897 <span class="stringliteral">        $roi[&#39;pid&#39;] = $pid;</span>
<a name="l00898"></a>00898 <span class="stringliteral">        $roi[&#39;parent_pid&#39;] = $parent_pid;</span>
<a name="l00899"></a>00899 <span class="stringliteral">        $roi[&#39;transcribedStatus&#39;] = $transcribedStatus;</span>
<a name="l00900"></a>00900 <span class="stringliteral">        $roi[&#39;transcribedStatusUpdatedBy&#39;] = $transcribedStatusUpdatedBy;</span>
<a name="l00901"></a>00901 <span class="stringliteral">        $roi[&#39;parsedL1Status&#39;] = $parsedL1Status;</span>
<a name="l00902"></a>00902 <span class="stringliteral">        $roi[&#39;parsedL1StausUpdatedBy&#39;] = $parsedL1StausUpdatedBy;</span>
<a name="l00903"></a>00903 <span class="stringliteral">        $roi[&#39;parsedL2Status&#39;] = $parsedL2Status;</span>
<a name="l00904"></a>00904 <span class="stringliteral">        $roi[&#39;parsedL3Status&#39;] = $parsedL3Status;</span>
<a name="l00905"></a>00905 <span class="stringliteral">        $roi[&#39;locked&#39;] = $locked;</span>
<a name="l00906"></a>00906 <span class="stringliteral">        $roi[&#39;locked_time&#39;] = $locked_time;</span>
<a name="l00907"></a>00907 <span class="stringliteral">        $roi[&#39;locked_by&#39;] = $locked_by;</span>
<a name="l00908"></a>00908 <span class="stringliteral">        $roi[&#39;locked_session&#39;] = $locked_session;</span>
<a name="l00909"></a>00909 <span class="stringliteral">        $roi[&#39;qcStatus&#39;] = $qcStatus;</span>
<a name="l00910"></a>00910 <span class="stringliteral">        $roi[&#39;qcStatusUpdatedBy&#39;] = $qcStatusUpdatedBy;</span>
<a name="l00911"></a>00911 <span class="stringliteral">        $roi[&#39;workflow_status&#39;] = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l00912"></a>00912 <span class="stringliteral">        $roiElement = create_workflow_dom_roi($workflow_dom, $imageElement, $roi);</span>
<a name="l00913"></a>00913 <span class="stringliteral">      }</span>
<a name="l00914"></a>00914 <span class="stringliteral">    }</span>
<a name="l00915"></a>00915 <span class="stringliteral">    add_non_queued_items($workflow_dom);</span>
<a name="l00916"></a>00916 <span class="stringliteral">    return $workflow_dom;</span>
<a name="l00917"></a>00917 <span class="stringliteral">  }</span>
<a name="l00918"></a>00918 <span class="stringliteral"></span>
<a name="l00919"></a><a class="code" href="workspace_8functions_8php.html#a6615ff66fec46bb4f8574f8d9910f5cb">00919</a> <span class="stringliteral">function add_non_queued_items($workflow_dom) {</span>
<a name="l00920"></a>00920 <span class="stringliteral">  $imageElements = $workflow_dom-&gt;getElementsByTagName(&#39;image&#39;);</span>
<a name="l00921"></a>00921 <span class="stringliteral">  foreach($imageElements as $imageElement) {</span>
<a name="l00922"></a>00922 <span class="stringliteral">    $image_pid = $imageElement-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l00923"></a>00923 <span class="stringliteral">    $solr_sxml = get_roi_solr_sxml($image_pid);</span>
<a name="l00924"></a>00924 <span class="stringliteral">    foreach($solr_sxml-&gt;result[0]-&gt;doc as $doc) {</span>
<a name="l00925"></a>00925 <span class="stringliteral">      $pid = &#39;&#39;;</span>
<a name="l00926"></a>00926 <span class="stringliteral">      $parent_pid = &#39;&#39;;</span>
<a name="l00927"></a>00927 <span class="stringliteral">      $analyzedStatus = &#39;&#39;;</span>
<a name="l00928"></a>00928 <span class="stringliteral">      $transcribedStatus = &#39;&#39;;</span>
<a name="l00929"></a>00929 <span class="stringliteral">      $transcribedStatusUpdatedBy = &#39;&#39;;</span>
<a name="l00930"></a>00930 <span class="stringliteral">      $parsedL1Status = &#39;&#39;;</span>
<a name="l00931"></a>00931 <span class="stringliteral">      $parsedL1StausUpdatedBy = &#39;&#39;;</span>
<a name="l00932"></a>00932 <span class="stringliteral">      $parsedL2Status = &#39;&#39;;</span>
<a name="l00933"></a>00933 <span class="stringliteral">      $parsedL3Status = &#39;&#39;;</span>
<a name="l00934"></a>00934 <span class="stringliteral">      $qcStatus = &#39;&#39;;</span>
<a name="l00935"></a>00935 <span class="stringliteral">      $qcStatusUpdatedBy = &#39;&#39;;</span>
<a name="l00936"></a>00936 <span class="stringliteral">      $locked = &#39;&#39;;</span>
<a name="l00937"></a>00937 <span class="stringliteral">      $locked_time = &#39;&#39;;</span>
<a name="l00938"></a>00938 <span class="stringliteral">      $locked_by = &#39;&#39;;</span>
<a name="l00939"></a>00939 <span class="stringliteral">      $locked_session = &#39;&#39;;</span>
<a name="l00940"></a>00940 <span class="stringliteral">      foreach($doc-&gt;children() as $sxml_node) {</span>
<a name="l00941"></a>00941 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;id&#39;) {</span>
<a name="l00942"></a>00942 <span class="stringliteral">          $pid = (string)$sxml_node;</span>
<a name="l00943"></a>00943 <span class="stringliteral">        }</span>
<a name="l00944"></a>00944 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;parent_id&#39;) {</span>
<a name="l00945"></a>00945 <span class="stringliteral">          $parent_pid = (string)$sxml_node;</span>
<a name="l00946"></a>00946 <span class="stringliteral">        }</span>
<a name="l00947"></a>00947 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_analyzedStatus&#39;) {</span>
<a name="l00948"></a>00948 <span class="stringliteral">          $analyzedStatus = (string)$sxml_node;</span>
<a name="l00949"></a>00949 <span class="stringliteral">        }</span>
<a name="l00950"></a>00950 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_transcribedStatus&#39;) {</span>
<a name="l00951"></a>00951 <span class="stringliteral">          $transcribedStatus = (string)$sxml_node;</span>
<a name="l00952"></a>00952 <span class="stringliteral">        }</span>
<a name="l00953"></a>00953 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_transcribedStatusUpdatedBy&#39;) {</span>
<a name="l00954"></a>00954 <span class="stringliteral">          $transcribedStatusUpdatedBy = (string)$sxml_node;</span>
<a name="l00955"></a>00955 <span class="stringliteral">        }</span>
<a name="l00956"></a>00956 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL1Status&#39;) {</span>
<a name="l00957"></a>00957 <span class="stringliteral">          $parsedL1Status = (string)$sxml_node;</span>
<a name="l00958"></a>00958 <span class="stringliteral">        }</span>
<a name="l00959"></a>00959 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL1StausUpdatedBy&#39;) {</span>
<a name="l00960"></a>00960 <span class="stringliteral">          $parsedL1StausUpdatedBy = (string)$sxml_node;</span>
<a name="l00961"></a>00961 <span class="stringliteral">        }</span>
<a name="l00962"></a>00962 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL2Status&#39;) {</span>
<a name="l00963"></a>00963 <span class="stringliteral">          $parsedL2Status = (string)$sxml_node;</span>
<a name="l00964"></a>00964 <span class="stringliteral">        }</span>
<a name="l00965"></a>00965 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL3Status&#39;) {</span>
<a name="l00966"></a>00966 <span class="stringliteral">          $parsedL3Status = (string)$sxml_node;</span>
<a name="l00967"></a>00967 <span class="stringliteral">        }</span>
<a name="l00968"></a>00968 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_qcStatus&#39;) {</span>
<a name="l00969"></a>00969 <span class="stringliteral">          $qcStatus = (string)$sxml_node;</span>
<a name="l00970"></a>00970 <span class="stringliteral">        }</span>
<a name="l00971"></a>00971 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_qcStatusUpdatedBy&#39;) {</span>
<a name="l00972"></a>00972 <span class="stringliteral">          $qcStatusUpdatedBy = (string)$sxml_node;</span>
<a name="l00973"></a>00973 <span class="stringliteral">        }</span>
<a name="l00974"></a>00974 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_locked&#39;) {</span>
<a name="l00975"></a>00975 <span class="stringliteral">          $locked = (string)$sxml_node;</span>
<a name="l00976"></a>00976 <span class="stringliteral">        }</span>
<a name="l00977"></a>00977 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;locked_time&#39;) {</span>
<a name="l00978"></a>00978 <span class="stringliteral">          $locked_time = (double)$sxml_node;</span>
<a name="l00979"></a>00979 <span class="stringliteral">        }</span>
<a name="l00980"></a>00980 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_locked_by&#39;) {</span>
<a name="l00981"></a>00981 <span class="stringliteral">          $locked_by = (string)$sxml_node;</span>
<a name="l00982"></a>00982 <span class="stringliteral">        }</span>
<a name="l00983"></a>00983 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_locked_session&#39;) {</span>
<a name="l00984"></a>00984 <span class="stringliteral">          $locked_session = (string)$sxml_node;</span>
<a name="l00985"></a>00985 <span class="stringliteral">        }</span>
<a name="l00986"></a>00986 <span class="stringliteral">      }</span>
<a name="l00987"></a>00987 <span class="stringliteral">      if(strpos($workflow_dom-&gt;saveXML($imageElement), $pid.&quot;</span>&lt;/pid&gt;<span class="stringliteral">&quot;) === false) {</span>
<a name="l00988"></a>00988 <span class="stringliteral">        $roi = array();</span>
<a name="l00989"></a>00989 <span class="stringliteral">        $roi[&#39;pid&#39;] = $pid;</span>
<a name="l00990"></a>00990 <span class="stringliteral">        $roi[&#39;parent_pid&#39;] = $parent_pid;</span>
<a name="l00991"></a>00991 <span class="stringliteral">        $roi[&#39;transcribedStatus&#39;] = $transcribedStatus;</span>
<a name="l00992"></a>00992 <span class="stringliteral">        $roi[&#39;transcribedStatusUpdatedBy&#39;] = $transcribedStatusUpdatedBy;</span>
<a name="l00993"></a>00993 <span class="stringliteral">        $roi[&#39;parsedL1Status&#39;] = $parsedL1Status;</span>
<a name="l00994"></a>00994 <span class="stringliteral">        $roi[&#39;parsedL1StausUpdatedBy&#39;] = $parsedL1StausUpdatedBy;</span>
<a name="l00995"></a>00995 <span class="stringliteral">        $roi[&#39;parsedL2Status&#39;] = $parsedL2Status;</span>
<a name="l00996"></a>00996 <span class="stringliteral">        $roi[&#39;parsedL3Status&#39;] = $parsedL3Status;</span>
<a name="l00997"></a>00997 <span class="stringliteral">        $roi[&#39;locked&#39;] = $locked;</span>
<a name="l00998"></a>00998 <span class="stringliteral">        $roi[&#39;locked_time&#39;] = $locked_time;</span>
<a name="l00999"></a>00999 <span class="stringliteral">        $roi[&#39;locked_by&#39;] = $locked_by;</span>
<a name="l01000"></a>01000 <span class="stringliteral">        $roi[&#39;locked_session&#39;] = $locked_session;</span>
<a name="l01001"></a>01001 <span class="stringliteral">        $roi[&#39;qcStatus&#39;] = $qcStatus;</span>
<a name="l01002"></a>01002 <span class="stringliteral">        $roi[&#39;qcStatusUpdatedBy&#39;] = $qcStatusUpdatedBy;</span>
<a name="l01003"></a>01003 <span class="stringliteral">        $roi[&#39;workflow_status&#39;] = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l01004"></a>01004 <span class="stringliteral">        $roiElement = create_workflow_dom_roi($workflow_dom, $imageElement, $roi);</span>
<a name="l01005"></a>01005 <span class="stringliteral">      }</span>
<a name="l01006"></a>01006 <span class="stringliteral">    }</span>
<a name="l01007"></a>01007 <span class="stringliteral">  }</span>
<a name="l01008"></a>01008 <span class="stringliteral">}</span>
<a name="l01009"></a>01009 <span class="stringliteral"></span>
<a name="l01010"></a><a class="code" href="workspace_8functions_8php.html#ae6abbcdfbf74b12c5d08a29ca8feafab">01010</a> <span class="stringliteral">function get_roi_solr_sxml($image_pid) {</span>
<a name="l01011"></a>01011 <span class="stringliteral">  $solr_q = &#39;q=parent_id:(&quot;</span><span class="stringliteral">&#39;.$image_pid.&#39;</span><span class="stringliteral">&quot;)&#39;;</span>
<a name="l01012"></a>01012 <span class="stringliteral">  $solr_fl = &#39;fl=id&#39;;</span>
<a name="l01013"></a>01013 <span class="stringliteral">  $solr_fl .= &#39;+parent_id&#39;;</span>
<a name="l01014"></a>01014 <span class="stringliteral">  $solr_fl .= &#39;+status_analyzedStatus&#39;;</span>
<a name="l01015"></a>01015 <span class="stringliteral">  $solr_fl .= &#39;+status_transcribedStatus&#39;;</span>
<a name="l01016"></a>01016 <span class="stringliteral">  $solr_fl .= &#39;+status_transcribedStatusUpdatedBy&#39;;</span>
<a name="l01017"></a>01017 <span class="stringliteral">  $solr_fl .= &#39;+status_parsedL1Status&#39;;</span>
<a name="l01018"></a>01018 <span class="stringliteral">  $solr_fl .= &#39;+status_parsedL1StausUpdatedBy&#39;;</span>
<a name="l01019"></a>01019 <span class="stringliteral">  $solr_fl .= &#39;+status_parsedL2Status&#39;;</span>
<a name="l01020"></a>01020 <span class="stringliteral">  $solr_fl .= &#39;+status_parsedL3Status&#39;;</span>
<a name="l01021"></a>01021 <span class="stringliteral">  $solr_fl .= &#39;+status_qcStatus&#39;;</span>
<a name="l01022"></a>01022 <span class="stringliteral">  $solr_fl .= &#39;+status_qcStatusUpdatedBy&#39;;</span>
<a name="l01023"></a>01023 <span class="stringliteral">  $solr_fl .= &#39;+status_locked&#39;;</span>
<a name="l01024"></a>01024 <span class="stringliteral">  $solr_fl .= &#39;+locked_time&#39;;</span>
<a name="l01025"></a>01025 <span class="stringliteral">  $solr_fl .= &#39;+status_locked_by&#39;;</span>
<a name="l01026"></a>01026 <span class="stringliteral">  $solr_fl .= &#39;+status_locked_session&#39;;</span>
<a name="l01027"></a>01027 <span class="stringliteral">  $solr_op = &#39;q.op=AND&#39;;</span>
<a name="l01028"></a>01028 <span class="stringliteral">  $solr_rows = &#39;rows=10000&#39;;</span>
<a name="l01029"></a>01029 <span class="stringliteral">  $solr_sxml = solr_query_xml($solr_q, $solr_fl, $solr_op, $solr_rows);</span>
<a name="l01030"></a>01030 <span class="stringliteral">  if($solr_sxml != false) {</span>
<a name="l01031"></a>01031 <span class="stringliteral">    return $solr_sxml;</span>
<a name="l01032"></a>01032 <span class="stringliteral">  }</span>
<a name="l01033"></a>01033 <span class="stringliteral">  else {</span>
<a name="l01034"></a>01034 <span class="stringliteral">    return false;</span>
<a name="l01035"></a>01035 <span class="stringliteral">  }</span>
<a name="l01036"></a>01036 <span class="stringliteral">}</span>
<a name="l01037"></a>01037 <span class="stringliteral"></span>
<a name="l01038"></a><a class="code" href="workspace_8functions_8php.html#a6118f481ac5e7b30edc6442f7c181829">01038</a> <span class="stringliteral">  function get_workflow_dom_specimen($workflow_dom, $workflow_root_element, $specimen_pid) {</span>
<a name="l01039"></a>01039 <span class="stringliteral">    $specimens = $workflow_dom-&gt;getElementsByTagName(&#39;specimen&#39;);</span>
<a name="l01040"></a>01040 <span class="stringliteral">    foreach($specimens as $specimen) {</span>
<a name="l01041"></a>01041 <span class="stringliteral">      $pid_element = $specimen-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0);</span>
<a name="l01042"></a>01042 <span class="stringliteral">      if($pid_element-&gt;nodeValue == $specimen_pid) {</span>
<a name="l01043"></a>01043 <span class="stringliteral">        return $specimen;</span>
<a name="l01044"></a>01044 <span class="stringliteral">      }</span>
<a name="l01045"></a>01045 <span class="stringliteral">    }</span>
<a name="l01046"></a>01046 <span class="stringliteral">    return create_workflow_dom_specimen($workflow_dom, $workflow_root_element, $specimen_pid);</span>
<a name="l01047"></a>01047 <span class="stringliteral">  }</span>
<a name="l01048"></a>01048 <span class="stringliteral"></span>
<a name="l01049"></a><a class="code" href="workspace_8functions_8php.html#a710d72e0f09268599d3349600150785e">01049</a> <span class="stringliteral">  function get_workflow_dom_image($workflow_dom, $workflow_root_element, $image_pid) {</span>
<a name="l01050"></a>01050 <span class="stringliteral">    $images = $workflow_dom-&gt;getElementsByTagName(&#39;image&#39;);</span>
<a name="l01051"></a>01051 <span class="stringliteral">    foreach($images as $image) {</span>
<a name="l01052"></a>01052 <span class="stringliteral">      $pid_element = $image-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0);</span>
<a name="l01053"></a>01053 <span class="stringliteral">      if($pid_element-&gt;nodeValue == $image_pid) {</span>
<a name="l01054"></a>01054 <span class="stringliteral">        return $image;</span>
<a name="l01055"></a>01055 <span class="stringliteral">      }</span>
<a name="l01056"></a>01056 <span class="stringliteral">    }</span>
<a name="l01057"></a>01057 <span class="stringliteral">    //means the image hasn&#39;t been added yet so check for specimen parent</span>
<a name="l01058"></a>01058 <span class="stringliteral">    $specimen_pid = get_parent_via_solr($image_pid);</span>
<a name="l01059"></a>01059 <span class="stringliteral">    $specimens = $workflow_dom-&gt;getElementsByTagName(&#39;specimen&#39;);</span>
<a name="l01060"></a>01060 <span class="stringliteral">    $foundSpecimenElement = false;</span>
<a name="l01061"></a>01061 <span class="stringliteral">    foreach($specimens as $specimen) {</span>
<a name="l01062"></a>01062 <span class="stringliteral">      $pid_element = $specimen-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0);</span>
<a name="l01063"></a>01063 <span class="stringliteral">      if($pid_element-&gt;nodeValue == $specimen_pid) {</span>
<a name="l01064"></a>01064 <span class="stringliteral">        $specimenElement = $specimen;</span>
<a name="l01065"></a>01065 <span class="stringliteral">        $foundSpecimenElement = true;</span>
<a name="l01066"></a>01066 <span class="stringliteral">      }</span>
<a name="l01067"></a>01067 <span class="stringliteral">    }</span>
<a name="l01068"></a>01068 <span class="stringliteral">    if(!$foundSpecimenElement) {</span>
<a name="l01069"></a>01069 <span class="stringliteral">      $specimenElement = create_workflow_dom_specimen($workflow_dom, $workflow_root_element, $specimen_pid);</span>
<a name="l01070"></a>01070 <span class="stringliteral">      $image_array[&#39;pid&#39;] = $image_pid;</span>
<a name="l01071"></a>01071 <span class="stringliteral">      return create_workflow_dom_image($workflow_dom, $specimenElement, $image_array);</span>
<a name="l01072"></a>01072 <span class="stringliteral">    }</span>
<a name="l01073"></a>01073 <span class="stringliteral">    else {</span>
<a name="l01074"></a>01074 <span class="stringliteral">      $images = $specimenElement-&gt;getElementsByTagName(&#39;image&#39;);</span>
<a name="l01075"></a>01075 <span class="stringliteral">      foreach($images as $image) {</span>
<a name="l01076"></a>01076 <span class="stringliteral">        $pid_element = $image-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0);</span>
<a name="l01077"></a>01077 <span class="stringliteral">        if($pid_element-&gt;nodeValue == $image_pid) {</span>
<a name="l01078"></a>01078 <span class="stringliteral">          return $image;</span>
<a name="l01079"></a>01079 <span class="stringliteral">        }</span>
<a name="l01080"></a>01080 <span class="stringliteral">      }</span>
<a name="l01081"></a>01081 <span class="stringliteral">      $image_array[&#39;pid&#39;] = $image_pid;</span>
<a name="l01082"></a>01082 <span class="stringliteral">      return create_workflow_dom_image($workflow_dom, $specimenElement, $image_array);</span>
<a name="l01083"></a>01083 <span class="stringliteral">    }</span>
<a name="l01084"></a>01084 <span class="stringliteral">  }</span>
<a name="l01085"></a>01085 <span class="stringliteral"></span>
<a name="l01086"></a><a class="code" href="workspace_8functions_8php.html#a245ca1ffb4324b1074534fd6db5ef0df">01086</a> <span class="stringliteral">  function append_workflow_dom_child($workflow_dom, $workflow_element, $child_name, $child_value) {</span>
<a name="l01087"></a>01087 <span class="stringliteral">    $child_element = $workflow_dom-&gt;createElement($child_name, $child_value);</span>
<a name="l01088"></a>01088 <span class="stringliteral">    $workflow_element-&gt;appendChild($child_element);</span>
<a name="l01089"></a>01089 <span class="stringliteral">  }</span>
<a name="l01090"></a>01090 <span class="stringliteral"></span>
<a name="l01091"></a><a class="code" href="workspace_8functions_8php.html#afc7c3079ed1dae453510d27a4bf09a82">01091</a> <span class="stringliteral">  function create_workflow_dom_specimen($workflow_dom, $workflow_root_element, $specimen_pid) {</span>
<a name="l01092"></a>01092 <span class="stringliteral">    $specimenElement = $workflow_dom-&gt;createElement(&quot;</span>specimen<span class="stringliteral">&quot;);</span>
<a name="l01093"></a>01093 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $specimenElement, &quot;</span>pid<span class="stringliteral">&quot;, $specimen_pid);</span>
<a name="l01094"></a>01094 <span class="stringliteral">    $workflow_root_element-&gt;appendChild($specimenElement);</span>
<a name="l01095"></a>01095 <span class="stringliteral">    return $specimenElement;</span>
<a name="l01096"></a>01096 <span class="stringliteral">  }</span>
<a name="l01097"></a>01097 <span class="stringliteral"></span>
<a name="l01098"></a><a class="code" href="workspace_8functions_8php.html#ad37f55c7999d3a7ea44fddd01846cf23">01098</a> <span class="stringliteral">  function create_workflow_dom_image($workflow_dom, $specimenElement, $image) {</span>
<a name="l01099"></a>01099 <span class="stringliteral">    $imageElement = $workflow_dom-&gt;createElement(&quot;</span>image<span class="stringliteral">&quot;);</span>
<a name="l01100"></a>01100 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $imageElement, &quot;</span>pid<span class="stringliteral">&quot;, $image[&#39;pid&#39;]);</span>
<a name="l01101"></a>01101 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $imageElement, &quot;</span>locked<span class="stringliteral">&quot;, $image[&#39;locked&#39;]);</span>
<a name="l01102"></a>01102 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $imageElement, &quot;</span>locked_time<span class="stringliteral">&quot;, $image[&#39;locked_time&#39;]);</span>
<a name="l01103"></a>01103 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $imageElement, &quot;</span>locked_by<span class="stringliteral">&quot;, $image[&#39;locked_by&#39;]);</span>
<a name="l01104"></a>01104 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $imageElement, &quot;</span>locked_session<span class="stringliteral">&quot;, $image[&#39;locked_session&#39;]);</span>
<a name="l01105"></a>01105 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $imageElement, &quot;</span>analyzedStatus<span class="stringliteral">&quot;, $image[&#39;analyzedStatus&#39;]);</span>
<a name="l01106"></a>01106 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $imageElement, &quot;</span>qcStatus<span class="stringliteral">&quot;, $image[&#39;qcStatus&#39;]);</span>
<a name="l01107"></a>01107 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $imageElement, &quot;</span>qcStatusUpdatedBy<span class="stringliteral">&quot;, $image[&#39;qcStatusUpdatedBy&#39;]);</span>
<a name="l01108"></a>01108 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $imageElement, &quot;</span><a class="code" href="workspace_8functions_8php.html#a4fd3cbdcf1282bd92e9609b5de35863c">workflow_status</a><span class="stringliteral">&quot;, $image[&#39;workflow_status&#39;]);</span>
<a name="l01109"></a>01109 <span class="stringliteral">    $specimenElement-&gt;appendChild($imageElement);</span>
<a name="l01110"></a>01110 <span class="stringliteral">    return $imageElement;</span>
<a name="l01111"></a>01111 <span class="stringliteral">  }</span>
<a name="l01112"></a>01112 <span class="stringliteral"></span>
<a name="l01113"></a><a class="code" href="workspace_8functions_8php.html#a3f73ed40f7993e373ce17d85824abb83">01113</a> <span class="stringliteral">  function create_workflow_dom_roi($workflow_dom, $imageElement, $roi) {</span>
<a name="l01114"></a>01114 <span class="stringliteral">    $roiElement = $workflow_dom-&gt;createElement(&quot;</span>roi<span class="stringliteral">&quot;);</span>
<a name="l01115"></a>01115 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>pid<span class="stringliteral">&quot;, $roi[&#39;pid&#39;]);</span>
<a name="l01116"></a>01116 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>locked<span class="stringliteral">&quot;, $roi[&#39;locked&#39;]);</span>
<a name="l01117"></a>01117 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>locked_time<span class="stringliteral">&quot;, $roi[&#39;locked_time&#39;]);</span>
<a name="l01118"></a>01118 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>locked_by<span class="stringliteral">&quot;, $roi[&#39;locked_by&#39;]);</span>
<a name="l01119"></a>01119 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>locked_session<span class="stringliteral">&quot;, $roi[&#39;locked_session&#39;]);</span>
<a name="l01120"></a>01120 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>transcribedStatus<span class="stringliteral">&quot;, $roi[&#39;transcribedStatus&#39;]);</span>
<a name="l01121"></a>01121 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>transcribedStatusUpdatedBy<span class="stringliteral">&quot;, $roi[&#39;transcribedStatusUpdatedBy&#39;]);</span>
<a name="l01122"></a>01122 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>parsedL1Status<span class="stringliteral">&quot;, $roi[&#39;parsedL1Status&#39;]);</span>
<a name="l01123"></a>01123 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>parsedL1StausUpdatedBy<span class="stringliteral">&quot;, $roi[&#39;parsedL1StausUpdatedBy&#39;]);</span>
<a name="l01124"></a>01124 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>parsedL2Status<span class="stringliteral">&quot;, $roi[&#39;parsedL2Status&#39;]);</span>
<a name="l01125"></a>01125 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>parsedL3Status<span class="stringliteral">&quot;, $roi[&#39;parsedL3Status&#39;]);</span>
<a name="l01126"></a>01126 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>qcStatus<span class="stringliteral">&quot;, $roi[&#39;qcStatus&#39;]);</span>
<a name="l01127"></a>01127 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span>qcStatusUpdatedBy<span class="stringliteral">&quot;, $roi[&#39;qcStatusUpdatedBy&#39;]);</span>
<a name="l01128"></a>01128 <span class="stringliteral">    append_workflow_dom_child($workflow_dom, $roiElement, &quot;</span><a class="code" href="workspace_8functions_8php.html#a4fd3cbdcf1282bd92e9609b5de35863c">workflow_status</a><span class="stringliteral">&quot;, $roi[&#39;workflow_status&#39;]);</span>
<a name="l01129"></a>01129 <span class="stringliteral">    $imageElement-&gt;appendChild($roiElement);</span>
<a name="l01130"></a>01130 <span class="stringliteral">    return $roiElement;</span>
<a name="l01131"></a>01131 <span class="stringliteral">  }</span>
<a name="l01132"></a>01132 <span class="stringliteral"></span>
<a name="l01133"></a><a class="code" href="workspace_8functions_8php.html#adfcd9fab20ef467d28028fde721a99e8">01133</a> <span class="stringliteral">function create_images_array($solr_sxml) {</span>
<a name="l01134"></a>01134 <span class="stringliteral">  $images = array();</span>
<a name="l01135"></a>01135 <span class="stringliteral">  foreach($solr_sxml-&gt;result[0]-&gt;doc as $doc) {</span>
<a name="l01136"></a>01136 <span class="stringliteral">    $pid = &#39;&#39;;</span>
<a name="l01137"></a>01137 <span class="stringliteral">    $parent_pid = &#39;&#39;;</span>
<a name="l01138"></a>01138 <span class="stringliteral">    $analyzedStatus = &#39;&#39;;</span>
<a name="l01139"></a>01139 <span class="stringliteral">    $transcribedStatus = &#39;&#39;;</span>
<a name="l01140"></a>01140 <span class="stringliteral">    $transcribedStatusUpdatedBy = &#39;&#39;;</span>
<a name="l01141"></a>01141 <span class="stringliteral">    $parsedL1Status = &#39;&#39;;</span>
<a name="l01142"></a>01142 <span class="stringliteral">    $parsedL1StausUpdatedBy = &#39;&#39;;</span>
<a name="l01143"></a>01143 <span class="stringliteral">    $parsedL2Status = &#39;&#39;;</span>
<a name="l01144"></a>01144 <span class="stringliteral">    $parsedL3Status = &#39;&#39;;</span>
<a name="l01145"></a>01145 <span class="stringliteral">    $qcStatus = &#39;&#39;;</span>
<a name="l01146"></a>01146 <span class="stringliteral">    $qcStatusUpdatedBy = &#39;&#39;;</span>
<a name="l01147"></a>01147 <span class="stringliteral">    $locked = &#39;&#39;;</span>
<a name="l01148"></a>01148 <span class="stringliteral">    $locked_time = &#39;&#39;;</span>
<a name="l01149"></a>01149 <span class="stringliteral">    $locked_by = &#39;&#39;;</span>
<a name="l01150"></a>01150 <span class="stringliteral">    $locked_session = &#39;&#39;;</span>
<a name="l01151"></a>01151 <span class="stringliteral">    foreach($doc-&gt;children() as $sxml_node) {</span>
<a name="l01152"></a>01152 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;id&#39;) {</span>
<a name="l01153"></a>01153 <span class="stringliteral">        $pid = (string)$sxml_node;</span>
<a name="l01154"></a>01154 <span class="stringliteral">      }</span>
<a name="l01155"></a>01155 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;parent_id&#39;) {</span>
<a name="l01156"></a>01156 <span class="stringliteral">        $parent_pid = (string)$sxml_node;</span>
<a name="l01157"></a>01157 <span class="stringliteral">      }</span>
<a name="l01158"></a>01158 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;status_analyzedStatus&#39;) {</span>
<a name="l01159"></a>01159 <span class="stringliteral">        $analyzedStatus = (string)$sxml_node;</span>
<a name="l01160"></a>01160 <span class="stringliteral">      }</span>
<a name="l01161"></a>01161 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;status_transcribedStatus&#39;) {</span>
<a name="l01162"></a>01162 <span class="stringliteral">        $transcribedStatus = (string)$sxml_node;</span>
<a name="l01163"></a>01163 <span class="stringliteral">      }</span>
<a name="l01164"></a>01164 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;status_transcribedStatusUpdatedBy&#39;) {</span>
<a name="l01165"></a>01165 <span class="stringliteral">        $transcribedStatusUpdatedBy = (string)$sxml_node;</span>
<a name="l01166"></a>01166 <span class="stringliteral">      }</span>
<a name="l01167"></a>01167 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL1Status&#39;) {</span>
<a name="l01168"></a>01168 <span class="stringliteral">        $parsedL1Status = (string)$sxml_node;</span>
<a name="l01169"></a>01169 <span class="stringliteral">      }</span>
<a name="l01170"></a>01170 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL1StausUpdatedBy&#39;) {</span>
<a name="l01171"></a>01171 <span class="stringliteral">        $parsedL1StausUpdatedBy = (string)$sxml_node;</span>
<a name="l01172"></a>01172 <span class="stringliteral">      }</span>
<a name="l01173"></a>01173 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL2Status&#39;) {</span>
<a name="l01174"></a>01174 <span class="stringliteral">        $parsedL2Status = (string)$sxml_node;</span>
<a name="l01175"></a>01175 <span class="stringliteral">      }</span>
<a name="l01176"></a>01176 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL3Status&#39;) {</span>
<a name="l01177"></a>01177 <span class="stringliteral">        $parsedL3Status = (string)$sxml_node;</span>
<a name="l01178"></a>01178 <span class="stringliteral">      }</span>
<a name="l01179"></a>01179 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;status_qcStatus&#39;) {</span>
<a name="l01180"></a>01180 <span class="stringliteral">        $qcStatus = (string)$sxml_node;</span>
<a name="l01181"></a>01181 <span class="stringliteral">      }</span>
<a name="l01182"></a>01182 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;status_qcStatusUpdatedBy&#39;) {</span>
<a name="l01183"></a>01183 <span class="stringliteral">        $qcStatusUpdatedBy = (string)$sxml_node;</span>
<a name="l01184"></a>01184 <span class="stringliteral">      }</span>
<a name="l01185"></a>01185 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;status_locked&#39;) {</span>
<a name="l01186"></a>01186 <span class="stringliteral">        $locked = (string)$sxml_node;</span>
<a name="l01187"></a>01187 <span class="stringliteral">      }</span>
<a name="l01188"></a>01188 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;locked_time&#39;) {</span>
<a name="l01189"></a>01189 <span class="stringliteral">        $locked_time = (string)$sxml_node;</span>
<a name="l01190"></a>01190 <span class="stringliteral">      }</span>
<a name="l01191"></a>01191 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;status_locked_by&#39;) {</span>
<a name="l01192"></a>01192 <span class="stringliteral">        $locked_by = (string)$sxml_node;</span>
<a name="l01193"></a>01193 <span class="stringliteral">      }</span>
<a name="l01194"></a>01194 <span class="stringliteral">      if($sxml_node-&gt;attributes()-&gt;name == &#39;status_locked_session&#39;) {</span>
<a name="l01195"></a>01195 <span class="stringliteral">        $locked_session = (string)$sxml_node;</span>
<a name="l01196"></a>01196 <span class="stringliteral">      }</span>
<a name="l01197"></a>01197 <span class="stringliteral">    }</span>
<a name="l01198"></a>01198 <span class="stringliteral">    if(strpos($pid, &#39;ap-image:&#39;) &gt; -1) {</span>
<a name="l01199"></a>01199 <span class="stringliteral">      $image = array();</span>
<a name="l01200"></a>01200 <span class="stringliteral">      $image[&#39;pid&#39;] = $pid;</span>
<a name="l01201"></a>01201 <span class="stringliteral">      $image[&#39;parent_pid&#39;] = $parent_pid;</span>
<a name="l01202"></a>01202 <span class="stringliteral">      $image[&#39;analyzedStatus&#39;] = $analyzedStatus;</span>
<a name="l01203"></a>01203 <span class="stringliteral">      $image[&#39;locked&#39;] = $locked;</span>
<a name="l01204"></a>01204 <span class="stringliteral">      $image[&#39;locked_time&#39;] = $locked_time;</span>
<a name="l01205"></a>01205 <span class="stringliteral">      $image[&#39;locked_by&#39;] = $locked_by;</span>
<a name="l01206"></a>01206 <span class="stringliteral">      $image[&#39;locked_session&#39;] = $locked_session;</span>
<a name="l01207"></a>01207 <span class="stringliteral">      $image[&#39;qcStatus&#39;] = $qcStatus;</span>
<a name="l01208"></a>01208 <span class="stringliteral">      $image[&#39;qcStatusUpdatedBy&#39;] = $qcStatusUpdatedBy;</span>
<a name="l01209"></a>01209 <span class="stringliteral">      $image[&#39;workflow_status&#39;] = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l01210"></a>01210 <span class="stringliteral">    }</span>
<a name="l01211"></a>01211 <span class="stringliteral">    else if(strpos($pid, &#39;ap-roi:&#39;) &gt; -1) {</span>
<a name="l01212"></a>01212 <span class="stringliteral">      $roi = array();</span>
<a name="l01213"></a>01213 <span class="stringliteral">      $roi[&#39;pid&#39;] = $pid;</span>
<a name="l01214"></a>01214 <span class="stringliteral">      $roi[&#39;parent_pid&#39;] = $parent_pid;</span>
<a name="l01215"></a>01215 <span class="stringliteral">      $roi[&#39;transcribedStatus&#39;] = $transcribedStatus;</span>
<a name="l01216"></a>01216 <span class="stringliteral">      $roi[&#39;transcribedStatusUpdatedBy&#39;] = $transcribedStatusUpdatedBy;</span>
<a name="l01217"></a>01217 <span class="stringliteral">      $roi[&#39;parsedL1Status&#39;] = $parsedL1Status;</span>
<a name="l01218"></a>01218 <span class="stringliteral">      $roi[&#39;parsedL1StausUpdatedBy&#39;] = $parsedL1StausUpdatedBy;</span>
<a name="l01219"></a>01219 <span class="stringliteral">      $roi[&#39;parsedL2Status&#39;] = $parsedL2Status;</span>
<a name="l01220"></a>01220 <span class="stringliteral">      $roi[&#39;parsedL3Status&#39;] = $parsedL3Status;</span>
<a name="l01221"></a>01221 <span class="stringliteral">      $roi[&#39;locked&#39;] = $locked;</span>
<a name="l01222"></a>01222 <span class="stringliteral">      $roi[&#39;locked_time&#39;] = $locked_time;</span>
<a name="l01223"></a>01223 <span class="stringliteral">      $roi[&#39;locked_by&#39;] = $locked_by;</span>
<a name="l01224"></a>01224 <span class="stringliteral">      $roi[&#39;locked_session&#39;] = $locked_session;</span>
<a name="l01225"></a>01225 <span class="stringliteral">      $roi[&#39;qcStatus&#39;] = $qcStatus;</span>
<a name="l01226"></a>01226 <span class="stringliteral">      $roi[&#39;qcStatusUpdatedBy&#39;] = $qcStatusUpdatedBy;</span>
<a name="l01227"></a>01227 <span class="stringliteral">      $roi[&#39;workflow_status&#39;] = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l01228"></a>01228 <span class="stringliteral">    }</span>
<a name="l01229"></a>01229 <span class="stringliteral">  }</span>
<a name="l01230"></a>01230 <span class="stringliteral">}</span>
<a name="l01231"></a>01231 <span class="stringliteral"></span>
<a name="l01232"></a><a class="code" href="workspace_8functions_8php.html#a024dcf99823d7692f81c247176d8e81c">01232</a> <span class="stringliteral">function add_image_with_rois_to_queue($workflow_id, $image_pid) {</span>
<a name="l01233"></a>01233 <span class="stringliteral">  $queue_item_html = &#39;&#39;;</span>
<a name="l01234"></a>01234 <span class="stringliteral">  $status_dom = AP_Image::getImageLock($image_pid);</span>
<a name="l01235"></a>01235 <span class="stringliteral">  if($status_dom != false) {</span>
<a name="l01236"></a>01236 <span class="stringliteral">    $analyzedStatus = $status_dom-&gt;getElementsByTagName(&#39;analyzedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01237"></a>01237 <span class="stringliteral">    $locked_by = $status_dom-&gt;getElementsByTagName(&#39;locked_by&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01238"></a>01238 <span class="stringliteral">    $locked = $status_dom-&gt;getElementsByTagName(&#39;locked&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01239"></a>01239 <span class="stringliteral">    $locked_time = $status_dom-&gt;getElementsByTagName(&#39;locked_time&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01240"></a>01240 <span class="stringliteral">    $locked_session = $status_dom-&gt;getElementsByTagName(&#39;locked_session&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01241"></a>01241 <span class="stringliteral">    $workflow_status = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l01242"></a>01242 <span class="stringliteral">    $specimen_pid = AP_Image::get_specimen_pid($image_pid);</span>
<a name="l01243"></a>01243 <span class="stringliteral">    $roi_pids = AP_Image::getROIListForImage($image_pid);</span>
<a name="l01244"></a>01244 <span class="stringliteral">    $roi_count = sizeOf($roi_pids);</span>
<a name="l01245"></a>01245 <span class="stringliteral">    $queue_item_html .= create_queue_list_image($image_pid, $specimen_pid, $analyzedStatus, $roi_count, $locked_by, $workflow_status, $workflow_id);</span>
<a name="l01246"></a>01246 <span class="stringliteral"></span>
<a name="l01247"></a>01247 <span class="stringliteral">    $queue_item_html .= &#39;&lt;div class=&quot;</span>widget-content<span class="stringliteral">&quot; id=&quot;</span>content-<span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $image_pid).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01248"></a>01248 <span class="stringliteral">    foreach($roi_pids as $roi_pid) {</span>
<a name="l01249"></a>01249 <span class="stringliteral">      $roi_status_dom = AP_ROI::getROILock($roi_pid);</span>
<a name="l01250"></a>01250 <span class="stringliteral">      if($roi_status_dom != false) {</span>
<a name="l01251"></a>01251 <span class="stringliteral">        $transcribedStatus = $roi_status_dom-&gt;getElementsByTagName(&#39;transcribedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01252"></a>01252 <span class="stringliteral">        $parsedL1Status = $roi_status_dom-&gt;getElementsByTagName(&#39;parsedL1Status&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01253"></a>01253 <span class="stringliteral">        $locked_by = $roi_status_dom-&gt;getElementsByTagName(&#39;locked_by&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01254"></a>01254 <span class="stringliteral">        $locked = $roi_status_dom-&gt;getElementsByTagName(&#39;locked&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01255"></a>01255 <span class="stringliteral">        $locked_time = $roi_status_dom-&gt;getElementsByTagName(&#39;locked_time&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01256"></a>01256 <span class="stringliteral">        $locked_session = $roi_status_dom-&gt;getElementsByTagName(&#39;locked_session&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01257"></a>01257 <span class="stringliteral">        $workflow_status = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l01258"></a>01258 <span class="stringliteral">        $queue_item_html .= create_queue_list_roi($roi_pid, $image_pid, $transcribedStatus, $parsedL1Status, $locked_by, $workflow_status,$workflow_id);</span>
<a name="l01259"></a>01259 <span class="stringliteral">      }</span>
<a name="l01260"></a>01260 <span class="stringliteral">    }</span>
<a name="l01261"></a>01261 <span class="stringliteral">    $queue_item_html .= &#39;&lt;/div&gt;&lt;!-- widget-content --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01262"></a>01262 <span class="stringliteral">  }</span>
<a name="l01263"></a>01263 <span class="stringliteral">  else {</span>
<a name="l01264"></a>01264 <span class="stringliteral">    $queue_item_html = &quot;</span>locked<span class="stringliteral">&quot;;</span>
<a name="l01265"></a>01265 <span class="stringliteral">  }</span>
<a name="l01266"></a>01266 <span class="stringliteral">  echo $queue_item_html;</span>
<a name="l01267"></a>01267 <span class="stringliteral">}</span>
<a name="l01268"></a>01268 <span class="stringliteral"></span>
<a name="l01269"></a><a class="code" href="workspace_8functions_8php.html#a4295d0f4ddc3d821000c2f27098995e0">01269</a> <span class="stringliteral">function add_images_with_rois_to_queue($workflow_id, $image_list) {</span>
<a name="l01270"></a>01270 <span class="stringliteral">  //add_images_with_rois_to_queue_via_fedora($workflow_id, $image_list);</span>
<a name="l01271"></a>01271 <span class="stringliteral">  add_images_with_rois_to_queue_via_solr($workflow_id, $image_list);</span>
<a name="l01272"></a>01272 <span class="stringliteral">}</span>
<a name="l01273"></a>01273 <span class="stringliteral"></span>
<a name="l01274"></a><a class="code" href="workspace_8functions_8php.html#a969f4513f3066aa70a74af9590a64f8f">01274</a> <span class="stringliteral">function add_images_with_rois_to_queue_via_solr($workflow_id, $image_list) {</span>
<a name="l01275"></a>01275 <span class="stringliteral">  $images = explode(&quot;</span>,<span class="stringliteral">&quot;, $image_list);</span>
<a name="l01276"></a>01276 <span class="stringliteral">  $queue_html = &#39;&#39;;</span>
<a name="l01277"></a>01277 <span class="stringliteral">  $queued_count = 0;</span>
<a name="l01278"></a>01278 <span class="stringliteral">  $queued_list = &#39;&#39;;</span>
<a name="l01279"></a>01279 <span class="stringliteral">  $locked_count = 0;</span>
<a name="l01280"></a>01280 <span class="stringliteral">  $locked_list = &#39;&#39;;</span>
<a name="l01281"></a>01281 <span class="stringliteral">  $message = &#39;&#39;;</span>
<a name="l01282"></a>01282 <span class="stringliteral">  for($i=0; $i &lt; sizeOf($images); $i++) {</span>
<a name="l01283"></a>01283 <span class="stringliteral">    $image_pid = $images[$i];</span>
<a name="l01284"></a>01284 <span class="stringliteral">    $status_dom = AP_Image::getImageLock($image_pid); //cannot use solr here as we have to write to fedora when we get a successful lock</span>
<a name="l01285"></a>01285 <span class="stringliteral">    if($status_dom != false) {</span>
<a name="l01286"></a>01286 <span class="stringliteral">      $queued_count++;</span>
<a name="l01287"></a>01287 <span class="stringliteral">      if(strlen($queued_list) &gt; 0){</span>
<a name="l01288"></a>01288 <span class="stringliteral">        $queued_list .= &#39;,&#39;;</span>
<a name="l01289"></a>01289 <span class="stringliteral">      }</span>
<a name="l01290"></a>01290 <span class="stringliteral">      $queued_list .= str_replace(&#39;:&#39;, &#39;__&#39;, $image_pid);</span>
<a name="l01291"></a>01291 <span class="stringliteral">      $analyzedStatus = $status_dom-&gt;getElementsByTagName(&#39;analyzedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01292"></a>01292 <span class="stringliteral">      $locked_by = $status_dom-&gt;getElementsByTagName(&#39;locked_by&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01293"></a>01293 <span class="stringliteral">      $locked = $status_dom-&gt;getElementsByTagName(&#39;locked&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01294"></a>01294 <span class="stringliteral">      $locked_time = $status_dom-&gt;getElementsByTagName(&#39;locked_time&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01295"></a>01295 <span class="stringliteral">      $locked_session = $status_dom-&gt;getElementsByTagName(&#39;locked_session&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01296"></a>01296 <span class="stringliteral">      $workflow_status = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l01297"></a>01297 <span class="stringliteral"></span>
<a name="l01298"></a>01298 <span class="stringliteral">      $specimen_pid = get_parent_pid_via_solr($image_pid);</span>
<a name="l01299"></a>01299 <span class="stringliteral">      $roi_pids = get_roi_list_via_solr($image_pid);</span>
<a name="l01300"></a>01300 <span class="stringliteral">      $roi_count = sizeOf($roi_pids);</span>
<a name="l01301"></a>01301 <span class="stringliteral">      $queue_html .= create_queue_list_image($image_pid, $specimen_pid, $analyzedStatus, $roi_count, $locked_by, $workflow_status,$workflow_id);</span>
<a name="l01302"></a>01302 <span class="stringliteral">      $queue_html .= &#39;&lt;div class=&quot;</span>widget-content<span class="stringliteral">&quot; id=&quot;</span>content-<span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $image_pid).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01303"></a>01303 <span class="stringliteral">      foreach($roi_pids as $roi_pid) {</span>
<a name="l01304"></a>01304 <span class="stringliteral">        $roi_status_dom = AP_ROI::getROILock($roi_pid);</span>
<a name="l01305"></a>01305 <span class="stringliteral">        if($roi_status_dom != false) {</span>
<a name="l01306"></a>01306 <span class="stringliteral">          $transcribedStatus = $roi_status_dom-&gt;getElementsByTagName(&#39;transcribedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01307"></a>01307 <span class="stringliteral">          $parsedL1Status = $roi_status_dom-&gt;getElementsByTagName(&#39;parsedL1Status&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01308"></a>01308 <span class="stringliteral">          $locked_by = $roi_status_dom-&gt;getElementsByTagName(&#39;locked_by&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01309"></a>01309 <span class="stringliteral">          $locked = $roi_status_dom-&gt;getElementsByTagName(&#39;locked&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01310"></a>01310 <span class="stringliteral">          $locked_time = $roi_status_dom-&gt;getElementsByTagName(&#39;locked_time&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01311"></a>01311 <span class="stringliteral">          $locked_session = $roi_status_dom-&gt;getElementsByTagName(&#39;locked_session&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01312"></a>01312 <span class="stringliteral">          $workflow_status = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l01313"></a>01313 <span class="stringliteral">          $queue_html .= create_queue_list_roi($roi_pid, $image_pid, $transcribedStatus, $parsedL1Status, $locked_by, $workflow_status,$workflow_id);</span>
<a name="l01314"></a>01314 <span class="stringliteral">        }</span>
<a name="l01315"></a>01315 <span class="stringliteral">      }</span>
<a name="l01316"></a>01316 <span class="stringliteral">      $queue_html .= &#39;&lt;/div&gt;&lt;!-- widget-content --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01317"></a>01317 <span class="stringliteral">    }</span>
<a name="l01318"></a>01318 <span class="stringliteral">    else {</span>
<a name="l01319"></a>01319 <span class="stringliteral">      $locked_count++;</span>
<a name="l01320"></a>01320 <span class="stringliteral">      if(strlen($locked_list) &gt; 0){</span>
<a name="l01321"></a>01321 <span class="stringliteral">        $locked_list .= &#39;,&#39;;</span>
<a name="l01322"></a>01322 <span class="stringliteral">      }</span>
<a name="l01323"></a>01323 <span class="stringliteral">      $locked_list .= str_replace(&#39;:&#39;, &#39;__&#39;, $image_pid);</span>
<a name="l01324"></a>01324 <span class="stringliteral">    }</span>
<a name="l01325"></a>01325 <span class="stringliteral">  }</span>
<a name="l01326"></a>01326 <span class="stringliteral">  $returnHTML[&#39;queue_html&#39;] = $queue_html;</span>
<a name="l01327"></a>01327 <span class="stringliteral">  $returnHTML[&#39;queued_list&#39;] = $queued_list;</span>
<a name="l01328"></a>01328 <span class="stringliteral">  $returnHTML[&#39;locked_list&#39;] = $locked_list;</span>
<a name="l01329"></a>01329 <span class="stringliteral">  $message = $queued_count.&#39; items and their ROIs added to the queue.&#39;;</span>
<a name="l01330"></a>01330 <span class="stringliteral">  if($locked_count &gt; 0) {</span>
<a name="l01331"></a>01331 <span class="stringliteral">    $message .= &#39; &#39;.$locked_count.&#39; items locked and unable to be added to the queue.&#39;;</span>
<a name="l01332"></a>01332 <span class="stringliteral">  }</span>
<a name="l01333"></a>01333 <span class="stringliteral">  $returnHTML[&#39;message&#39;] = $message;</span>
<a name="l01334"></a>01334 <span class="stringliteral">  echo json_encode($returnHTML);</span>
<a name="l01335"></a>01335 <span class="stringliteral">}</span>
<a name="l01336"></a>01336 <span class="stringliteral"></span>
<a name="l01337"></a><a class="code" href="workspace_8functions_8php.html#a92545a3b3fdf140f59288f377fb9e981">01337</a> <span class="stringliteral">function create_queue_list_rois_via_solr($image_pid) {</span>
<a name="l01338"></a>01338 <span class="stringliteral">  $solr_sxml = get_roi_solr_sxml($image_pid);</span>
<a name="l01339"></a>01339 <span class="stringliteral">  $queue_html = &#39;&#39;;</span>
<a name="l01340"></a>01340 <span class="stringliteral">  if($solr_sxml != false) {</span>
<a name="l01341"></a>01341 <span class="stringliteral">    foreach($solr_sxml-&gt;result[0]-&gt;doc as $doc) {</span>
<a name="l01342"></a>01342 <span class="stringliteral">      $pid = &#39;&#39;;</span>
<a name="l01343"></a>01343 <span class="stringliteral">      $transcribedStatus = &#39;&#39;;</span>
<a name="l01344"></a>01344 <span class="stringliteral">      $parsedL1Status = &#39;&#39;;</span>
<a name="l01345"></a>01345 <span class="stringliteral">      $locked = &#39;&#39;;</span>
<a name="l01346"></a>01346 <span class="stringliteral">      $locked_time = &#39;&#39;;</span>
<a name="l01347"></a>01347 <span class="stringliteral">      $locked_by = &#39;&#39;;</span>
<a name="l01348"></a>01348 <span class="stringliteral">      $locked_session = &#39;&#39;;</span>
<a name="l01349"></a>01349 <span class="stringliteral">      foreach($doc-&gt;children() as $sxml_node) {</span>
<a name="l01350"></a>01350 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;id&#39;) {</span>
<a name="l01351"></a>01351 <span class="stringliteral">          $pid = (string)$sxml_node;</span>
<a name="l01352"></a>01352 <span class="stringliteral">        }</span>
<a name="l01353"></a>01353 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_transcribedStatus&#39;) {</span>
<a name="l01354"></a>01354 <span class="stringliteral">          $transcribedStatus = (string)$sxml_node;</span>
<a name="l01355"></a>01355 <span class="stringliteral">        }</span>
<a name="l01356"></a>01356 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_parsedL1Status&#39;) {</span>
<a name="l01357"></a>01357 <span class="stringliteral">          $parsedL1Status = (string)$sxml_node;</span>
<a name="l01358"></a>01358 <span class="stringliteral">        }</span>
<a name="l01359"></a>01359 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_locked&#39;) {</span>
<a name="l01360"></a>01360 <span class="stringliteral">          $locked = (string)$sxml_node;</span>
<a name="l01361"></a>01361 <span class="stringliteral">        }</span>
<a name="l01362"></a>01362 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;locked_time&#39;) {</span>
<a name="l01363"></a>01363 <span class="stringliteral">          $locked_time = (double)$sxml_node;</span>
<a name="l01364"></a>01364 <span class="stringliteral">        }</span>
<a name="l01365"></a>01365 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_locked_by&#39;) {</span>
<a name="l01366"></a>01366 <span class="stringliteral">          $locked_by = (string)$sxml_node;</span>
<a name="l01367"></a>01367 <span class="stringliteral">        }</span>
<a name="l01368"></a>01368 <span class="stringliteral">        if($sxml_node-&gt;attributes()-&gt;name == &#39;status_locked_session&#39;) {</span>
<a name="l01369"></a>01369 <span class="stringliteral">          $locked_session = (string)$sxml_node;</span>
<a name="l01370"></a>01370 <span class="stringliteral">        }</span>
<a name="l01371"></a>01371 <span class="stringliteral">      }</span>
<a name="l01372"></a>01372 <span class="stringliteral">      $workflow_status = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l01373"></a>01373 <span class="stringliteral">      $queue_html .= create_queue_list_roi($pid, $image_pid, $transcribedStatus, $parsedL1Status, $locked_by, $workflow_status, $workflow_id);</span>
<a name="l01374"></a>01374 <span class="stringliteral">    }</span>
<a name="l01375"></a>01375 <span class="stringliteral">  }</span>
<a name="l01376"></a>01376 <span class="stringliteral">  return $queue_html;</span>
<a name="l01377"></a>01377 <span class="stringliteral">}</span>
<a name="l01378"></a>01378 <span class="stringliteral"></span>
<a name="l01379"></a><a class="code" href="workspace_8functions_8php.html#a9c86489822e487e1438f143b4ebae17f">01379</a> <span class="stringliteral">function add_images_with_rois_to_queue_via_fedora($workflow_id, $image_list) {</span>
<a name="l01380"></a>01380 <span class="stringliteral">    //echo &#39;$image_list = &#39;.$image_list.&#39;&lt;br&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01381"></a>01381 <span class="stringliteral">  $images = explode(&quot;</span>,<span class="stringliteral">&quot;, $image_list);</span>
<a name="l01382"></a>01382 <span class="stringliteral">    //echo &#39;$images = &#39;.$images.&#39;&lt;br&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01383"></a>01383 <span class="stringliteral">    //echo &#39;$images[0] = &#39;.$images[0].&#39;&lt;br&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01384"></a>01384 <span class="stringliteral">    //echo &#39;$images[1] = &#39;.$images[1].&#39;&lt;br&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01385"></a>01385 <span class="stringliteral">  $queue_html = &#39;&#39;;</span>
<a name="l01386"></a>01386 <span class="stringliteral">  $queued_count = 0;</span>
<a name="l01387"></a>01387 <span class="stringliteral">  $queued_list = &#39;&#39;;</span>
<a name="l01388"></a>01388 <span class="stringliteral">  $locked_count = 0;</span>
<a name="l01389"></a>01389 <span class="stringliteral">  $locked_list = &#39;&#39;;</span>
<a name="l01390"></a>01390 <span class="stringliteral">  $message = &#39;&#39;;</span>
<a name="l01391"></a>01391 <span class="stringliteral">  for($i=0; $i &lt; sizeOf($images); $i++) {</span>
<a name="l01392"></a>01392 <span class="stringliteral">    $image_pid = $images[$i];</span>
<a name="l01393"></a>01393 <span class="stringliteral">    //echo &#39;$image_pid = &#39;.$image_pid.&#39;&lt;br&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01394"></a>01394 <span class="stringliteral">    $status_dom = AP_Image::getImageLock($image_pid);</span>
<a name="l01395"></a>01395 <span class="stringliteral">    if($status_dom != false) {</span>
<a name="l01396"></a>01396 <span class="stringliteral">      $queued_count++;</span>
<a name="l01397"></a>01397 <span class="stringliteral">      if(strlen($queued_list) &gt; 0){</span>
<a name="l01398"></a>01398 <span class="stringliteral">        $queued_list .= &#39;,&#39;;</span>
<a name="l01399"></a>01399 <span class="stringliteral">      }</span>
<a name="l01400"></a>01400 <span class="stringliteral">      $queued_list .= str_replace(&#39;:&#39;, &#39;__&#39;, $image_pid);</span>
<a name="l01401"></a>01401 <span class="stringliteral">      $analyzedStatus = $status_dom-&gt;getElementsByTagName(&#39;analyzedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01402"></a>01402 <span class="stringliteral">      $locked_by = $status_dom-&gt;getElementsByTagName(&#39;locked_by&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01403"></a>01403 <span class="stringliteral">      $locked = $status_dom-&gt;getElementsByTagName(&#39;locked&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01404"></a>01404 <span class="stringliteral">      $locked_time = $status_dom-&gt;getElementsByTagName(&#39;locked_time&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01405"></a>01405 <span class="stringliteral">      $locked_session = $status_dom-&gt;getElementsByTagName(&#39;locked_session&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01406"></a>01406 <span class="stringliteral">      $workflow_status = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l01407"></a>01407 <span class="stringliteral">      $specimen_pid = AP_Image::get_specimen_pid($image_pid);</span>
<a name="l01408"></a>01408 <span class="stringliteral">      $roi_pids = AP_Image::getROIListForImage($image_pid);</span>
<a name="l01409"></a>01409 <span class="stringliteral">      $roi_count = sizeOf($roi_pids);</span>
<a name="l01410"></a>01410 <span class="stringliteral">      $queue_html .= create_queue_list_image($image_pid, $specimen_pid, $analyzedStatus, $roi_count, $locked_by, $workflow_status,$workflow_id);</span>
<a name="l01411"></a>01411 <span class="stringliteral"></span>
<a name="l01412"></a>01412 <span class="stringliteral">      $queue_html .= &#39;&lt;div class=&quot;</span>widget-content<span class="stringliteral">&quot; id=&quot;</span>content-<span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $image_pid).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01413"></a>01413 <span class="stringliteral">      foreach($roi_pids as $roi_pid) {</span>
<a name="l01414"></a>01414 <span class="stringliteral">        $roi_status_dom = AP_ROI::getROILock($roi_pid);</span>
<a name="l01415"></a>01415 <span class="stringliteral">        if($roi_status_dom != false) {</span>
<a name="l01416"></a>01416 <span class="stringliteral">          $transcribedStatus = $roi_status_dom-&gt;getElementsByTagName(&#39;transcribedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01417"></a>01417 <span class="stringliteral">          $parsedL1Status = $roi_status_dom-&gt;getElementsByTagName(&#39;parsedL1Status&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01418"></a>01418 <span class="stringliteral">          $locked_by = $roi_status_dom-&gt;getElementsByTagName(&#39;locked_by&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01419"></a>01419 <span class="stringliteral">          $locked = $roi_status_dom-&gt;getElementsByTagName(&#39;locked&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01420"></a>01420 <span class="stringliteral">          $locked_time = $roi_status_dom-&gt;getElementsByTagName(&#39;locked_time&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01421"></a>01421 <span class="stringliteral">          $locked_session = $roi_status_dom-&gt;getElementsByTagName(&#39;locked_session&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01422"></a>01422 <span class="stringliteral">          $workflow_status = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l01423"></a>01423 <span class="stringliteral">          $queue_html .= create_queue_list_roi($roi_pid, $image_pid, $transcribedStatus, $parsedL1Status, $locked_by, $workflow_status, $workflow_id);</span>
<a name="l01424"></a>01424 <span class="stringliteral">        }</span>
<a name="l01425"></a>01425 <span class="stringliteral">      }</span>
<a name="l01426"></a>01426 <span class="stringliteral">      $queue_html .= &#39;&lt;/div&gt;&lt;!-- widget-content --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01427"></a>01427 <span class="stringliteral">    }</span>
<a name="l01428"></a>01428 <span class="stringliteral">    else {</span>
<a name="l01429"></a>01429 <span class="stringliteral">      $locked_count++;</span>
<a name="l01430"></a>01430 <span class="stringliteral">      if(strlen($locked_list) &gt; 0){</span>
<a name="l01431"></a>01431 <span class="stringliteral">        $locked_list .= &#39;,&#39;;</span>
<a name="l01432"></a>01432 <span class="stringliteral">      }</span>
<a name="l01433"></a>01433 <span class="stringliteral">      $locked_list .= str_replace(&#39;:&#39;, &#39;__&#39;, $image_pid);</span>
<a name="l01434"></a>01434 <span class="stringliteral">    }</span>
<a name="l01435"></a>01435 <span class="stringliteral">  }</span>
<a name="l01436"></a>01436 <span class="stringliteral">  $returnHTML[&#39;queue_html&#39;] = $queue_html;</span>
<a name="l01437"></a>01437 <span class="stringliteral">  $returnHTML[&#39;queued_list&#39;] = $queued_list;</span>
<a name="l01438"></a>01438 <span class="stringliteral">  $returnHTML[&#39;locked_list&#39;] = $locked_list;</span>
<a name="l01439"></a>01439 <span class="stringliteral">  $message = $queued_count.&#39; items and their ROIs added to the queue.&#39;;</span>
<a name="l01440"></a>01440 <span class="stringliteral">  if($locked_count &gt; 0) {</span>
<a name="l01441"></a>01441 <span class="stringliteral">    $message .= &#39; &#39;.$locked_count.&#39; items locked and unable to be added to the queue.&#39;;</span>
<a name="l01442"></a>01442 <span class="stringliteral">  }</span>
<a name="l01443"></a>01443 <span class="stringliteral">  $returnHTML[&#39;message&#39;] = $message;</span>
<a name="l01444"></a>01444 <span class="stringliteral">  echo json_encode($returnHTML);</span>
<a name="l01445"></a>01445 <span class="stringliteral">}</span>
<a name="l01446"></a>01446 <span class="stringliteral"></span>
<a name="l01447"></a><a class="code" href="workspace_8functions_8php.html#a9c4a73bd57f1024ddeae416b8013e961">01447</a> <span class="stringliteral">function add_next_image_with_rois_to_queue($workflow_id) {</span>
<a name="l01448"></a>01448 <span class="stringliteral">    $timeout = date(&quot;</span>YmdHis<span class="stringliteral">&quot;,strtotime(&#39;now&#39;)-1800);</span>
<a name="l01449"></a>01449 <span class="stringliteral">    $workflow = new Workflow($workflow_id, true);</span>
<a name="l01450"></a>01450 <span class="stringliteral">    $workflow_dom = $workflow-&gt;workflow_dom;</span>
<a name="l01451"></a>01451 <span class="stringliteral">    $image_pids = $workflow-&gt;image_pids;</span>
<a name="l01452"></a>01452 <span class="stringliteral">    $totalEntries = sizeOf($image_pids);</span>
<a name="l01453"></a>01453 <span class="stringliteral"></span>
<a name="l01454"></a>01454 <span class="stringliteral">    $specimen_elements = $workflow_dom-&gt;getElementsByTagName(&#39;specimen&#39;);</span>
<a name="l01455"></a>01455 <span class="stringliteral">    foreach($specimen_elements as $specimen)</span>
<a name="l01456"></a>01456 <span class="stringliteral">    {</span>
<a name="l01457"></a>01457 <span class="stringliteral">        $specimen_pid = $specimen-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01458"></a>01458 <span class="stringliteral">        $specimen_image_elements = $specimen-&gt;getElementsByTagName(&#39;image&#39;);</span>
<a name="l01459"></a>01459 <span class="stringliteral">        foreach($specimen_image_elements as $image)</span>
<a name="l01460"></a>01460 <span class="stringliteral">        {</span>
<a name="l01461"></a>01461 <span class="stringliteral">            $image_pid = $image-&gt;getElementsByTagName(&#39;pid&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01462"></a>01462 <span class="stringliteral">            $status_dom = AP_Image::getImageStatusDom($image_pid);</span>
<a name="l01463"></a>01463 <span class="stringliteral">            if($status_dom != false &amp;&amp; ($status_dom-&gt;getElementsByTagName(&#39;locked&#39;)-&gt;item(0)-&gt;nodeValue == &quot;</span><span class="keyword">false</span><span class="stringliteral">&quot; || $status_dom-&gt;getElementsByTagName(&#39;locked_time&#39;)-&gt;item(0)-&gt;nodeValue &lt; $timeout)) {</span>
<a name="l01464"></a>01464 <span class="stringliteral">              $status_dom = AP_Image::getImageLock($image_pid);</span>
<a name="l01465"></a>01465 <span class="stringliteral">              $analyzedStatus = $status_dom-&gt;getElementsByTagName(&#39;analyzedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01466"></a>01466 <span class="stringliteral">              $locked_by = $status_dom-&gt;getElementsByTagName(&#39;locked_by&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01467"></a>01467 <span class="stringliteral">              $locked = $status_dom-&gt;getElementsByTagName(&#39;locked&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01468"></a>01468 <span class="stringliteral">              $locked_time = $status_dom-&gt;getElementsByTagName(&#39;locked_time&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01469"></a>01469 <span class="stringliteral">              $locked_session = $status_dom-&gt;getElementsByTagName(&#39;locked_session&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01470"></a>01470 <span class="stringliteral">              $workflow_status = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l01471"></a>01471 <span class="stringliteral">              $roi_pids = AP_Image::getROIListForImage($image_pid);</span>
<a name="l01472"></a>01472 <span class="stringliteral">              $roi_count = sizeOf($roi_pids);</span>
<a name="l01473"></a>01473 <span class="stringliteral">              $queue_item_html .= create_queue_list_image($image_pid, $specimen_pid, $analyzedStatus, $roi_count, $locked_by, $workflow_status,$workflow_id);</span>
<a name="l01474"></a>01474 <span class="stringliteral"></span>
<a name="l01475"></a>01475 <span class="stringliteral">              //$queue_item_html .= &#39;&lt;div class=&quot;</span>widget-content<span class="stringliteral">&quot; id=&quot;</span>content-<span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $image_pid).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01476"></a>01476 <span class="stringliteral">              $found_queued_roi = false;</span>
<a name="l01477"></a>01477 <span class="stringliteral">              foreach($roi_pids as $roi_pid) {</span>
<a name="l01478"></a>01478 <span class="stringliteral">                $roi_status_dom = AP_ROI::getROILock($roi_pid);</span>
<a name="l01479"></a>01479 <span class="stringliteral">                if($roi_status_dom != false) {</span>
<a name="l01480"></a>01480 <span class="stringliteral">                  if(!$found_queued_roi) {</span>
<a name="l01481"></a>01481 <span class="stringliteral">                    $queue_item_html .= &#39;&lt;div class=&quot;</span>widget-content<span class="stringliteral">&quot; id=&quot;</span>content-<span class="stringliteral">&#39;.str_replace(&#39;</span>:<span class="stringliteral">&#39;, &#39;</span>__<span class="stringliteral">&#39;, $image_pid).&#39;</span><span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01482"></a>01482 <span class="stringliteral">                    $found_queued_roi = true;</span>
<a name="l01483"></a>01483 <span class="stringliteral">                  }</span>
<a name="l01484"></a>01484 <span class="stringliteral">                  $transcribedStatus = $roi_status_dom-&gt;getElementsByTagName(&#39;transcribedStatus&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01485"></a>01485 <span class="stringliteral">                  $parsedL1Status = $roi_status_dom-&gt;getElementsByTagName(&#39;parsedL1Status&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01486"></a>01486 <span class="stringliteral">                  $locked_by = $roi_status_dom-&gt;getElementsByTagName(&#39;locked_by&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01487"></a>01487 <span class="stringliteral">                  $locked = $roi_status_dom-&gt;getElementsByTagName(&#39;locked&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01488"></a>01488 <span class="stringliteral">                  $locked_time = $roi_status_dom-&gt;getElementsByTagName(&#39;locked_time&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01489"></a>01489 <span class="stringliteral">                  $locked_session = $roi_status_dom-&gt;getElementsByTagName(&#39;locked_session&#39;)-&gt;item(0)-&gt;nodeValue;</span>
<a name="l01490"></a>01490 <span class="stringliteral">                  $workflow_status = workflow_status($locked, $locked_time, $locked_session);</span>
<a name="l01491"></a>01491 <span class="stringliteral">                  $queue_item_html .= create_queue_list_roi($roi_pid, $image_pid, $transcribedStatus, $parsedL1Status, $locked_by, $workflow_status, $workflow_id);</span>
<a name="l01492"></a>01492 <span class="stringliteral">                }</span>
<a name="l01493"></a>01493 <span class="stringliteral">              }</span>
<a name="l01494"></a>01494 <span class="stringliteral">              if($found_queued_roi) {</span>
<a name="l01495"></a>01495 <span class="stringliteral">                $queue_item_html .= &#39;&lt;/div&gt;&lt;!-- widget-content --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01496"></a>01496 <span class="stringliteral">              }</span>
<a name="l01497"></a>01497 <span class="stringliteral">              break 2;</span>
<a name="l01498"></a>01498 <span class="stringliteral">            }</span>
<a name="l01499"></a>01499 <span class="stringliteral">        }</span>
<a name="l01500"></a>01500 <span class="stringliteral">    }</span>
<a name="l01501"></a>01501 <span class="stringliteral">    echo $queue_item_html;</span>
<a name="l01502"></a>01502 <span class="stringliteral">}</span>
<a name="l01503"></a>01503 <span class="stringliteral"></span>
<a name="l01504"></a><a class="code" href="workspace_8functions_8php.html#a48e20dce520fdabf3c5e1f6de04d0393">01504</a> <span class="stringliteral">function getImageMetadata($image_pid, $operation, $workflow_id){</span>
<a name="l01505"></a>01505 <span class="stringliteral">        $image_metadata = AP_Image::getimageMetadata_record($image_pid);</span>
<a name="l01506"></a>01506 <span class="stringliteral">        if($operation == &quot;</span>rft_id<span class="stringliteral">&quot;){</span>
<a name="l01507"></a>01507 <span class="stringliteral">                echo json_encode($image_metadata);</span>
<a name="l01508"></a>01508 <span class="stringliteral">        }</span>
<a name="l01509"></a>01509 <span class="stringliteral">        else{</span>
<a name="l01510"></a>01510 <span class="stringliteral">                $url = &quot;</span>http:<span class="comment">//demo.apiaryproject.org:8080/adore-djatoka/resolver?url_ver=Z39.88-2004&amp;rft_id=&quot; . $image_metadata[&#39;URL&#39;] . &quot;&amp;svc_id=info:lanl-repo/svc/getMetadata&quot;;</span>
<a name="l01511"></a>01511                 $send = curl_init();
<a name="l01512"></a>01512                 curl_setopt($send, CURLOPT_URL, $url);
<a name="l01513"></a>01513                 curl_setopt($send, CURLOPT_RETURNTRANSFER, 1);
<a name="l01514"></a>01514                 curl_setopt($send, CURLINFO_HEADER_OUT, 1);
<a name="l01515"></a>01515                 $output = curl_exec($send);
<a name="l01516"></a>01516                 <span class="keywordflow">if</span>(curl_errno($send))
<a name="l01517"></a>01517                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01518"></a>01518                 <span class="keywordflow">else</span>{
<a name="l01519"></a>01519                         $info = curl_getinfo($send);
<a name="l01520"></a>01520                         <span class="keywordflow">if</span>($info[<span class="stringliteral">&#39;http_code&#39;</span>]==200){
<a name="l01521"></a>01521                                 echo $output;
<a name="l01522"></a>01522                         }
<a name="l01523"></a>01523                         <span class="keywordflow">else</span>
<a name="l01524"></a>01524                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01525"></a>01525                 }
<a name="l01526"></a>01526         }
<a name="l01527"></a>01527 }
<a name="l01528"></a>01528 
<a name="l01529"></a>01529 <span class="comment">/*</span>
<a name="l01530"></a>01530 <span class="comment">function empty_queue($session_id) {</span>
<a name="l01531"></a>01531 <span class="comment">  //$solr_query .= &#39;&amp;fl=id+status_analyzedStatus+status_transcribedStatus+status_parsedL1Status+status_parsedL2Status+status_parsedL3Status&#39;;</span>
<a name="l01532"></a>01532 <span class="comment">  $apiary_session = $session_id;</span>
<a name="l01533"></a>01533 <span class="comment">  $solr_q = &#39;q=status_locked_session:(&quot;&#39;.$apiary_session.&#39;&quot;)&#39;;</span>
<a name="l01534"></a>01534 <span class="comment">  $solr_fl = &#39;fl=id&#39;;</span>
<a name="l01535"></a>01535 <span class="comment">  //$solr_op = &#39;q.op=AND&#39;;</span>
<a name="l01536"></a>01536 <span class="comment">  $solr_op = &#39;&#39;;</span>
<a name="l01537"></a>01537 <span class="comment">  $solr_rows = &#39;rows=10000&#39;;</span>
<a name="l01538"></a>01538 <span class="comment">  $solr_sxml = solr_query_xml($solr_q, $solr_fl, $solr_op, $solr_rows);</span>
<a name="l01539"></a>01539 <span class="comment">  if($solr_sxml != false) {</span>
<a name="l01540"></a>01540 <span class="comment">    $queue_count = 0;</span>
<a name="l01541"></a>01541 <span class="comment">    $cleared_count = 0;</span>
<a name="l01542"></a>01542 <span class="comment">    foreach($solr_sxml-&gt;result[0]-&gt;doc as $doc) {</span>
<a name="l01543"></a>01543 <span class="comment">      foreach($doc-&gt;children() as $sxml_node) {</span>
<a name="l01544"></a>01544 <span class="comment">        $queue_count++;</span>
<a name="l01545"></a>01545 <span class="comment">        $pid = $sxml_node;</span>
<a name="l01546"></a>01546 <span class="comment">        if(strpos($pid, &#39;ap-image:&#39;) &gt; -1) {</span>
<a name="l01547"></a>01547 <span class="comment">          $success = AP_Image::releaseImageLock($pid);</span>
<a name="l01548"></a>01548 <span class="comment">          if($success != false) {</span>
<a name="l01549"></a>01549 <span class="comment">            $cleared_count++;</span>
<a name="l01550"></a>01550 <span class="comment">          }</span>
<a name="l01551"></a>01551 <span class="comment">        }</span>
<a name="l01552"></a>01552 <span class="comment">        else if(strpos($pid, &#39;ap-roi:&#39;) &gt; -1) {</span>
<a name="l01553"></a>01553 <span class="comment">          $success = AP_ROI::releaseROILock($pid);</span>
<a name="l01554"></a>01554 <span class="comment">          if($success != false) {</span>
<a name="l01555"></a>01555 <span class="comment">            $cleared_count++;</span>
<a name="l01556"></a>01556 <span class="comment">          }</span>
<a name="l01557"></a>01557 <span class="comment">        }</span>
<a name="l01558"></a>01558 <span class="comment">      }</span>
<a name="l01559"></a>01559 <span class="comment">    }</span>
<a name="l01560"></a>01560 <span class="comment">    if($queue_count == $queue_count) {</span>
<a name="l01561"></a>01561 <span class="comment">      return true;</span>
<a name="l01562"></a>01562 <span class="comment">    }</span>
<a name="l01563"></a>01563 <span class="comment">    else {</span>
<a name="l01564"></a>01564 <span class="comment">      return false;</span>
<a name="l01565"></a>01565 <span class="comment">    }</span>
<a name="l01566"></a>01566 <span class="comment">  }</span>
<a name="l01567"></a>01567 <span class="comment">  else {</span>
<a name="l01568"></a>01568 <span class="comment">    return false;</span>
<a name="l01569"></a>01569 <span class="comment">  }</span>
<a name="l01570"></a>01570 <span class="comment">}</span>
<a name="l01571"></a>01571 <span class="comment">*/</span>
<a name="l01572"></a>01572 
<a name="l01573"></a><a class="code" href="workspace_8functions_8php.html#a391d88ccd1497a1380618928ab5e8e02">01573</a> function <a class="code" href="workspace_8functions_8php.html#a391d88ccd1497a1380618928ab5e8e02">empty_queue</a>($session_id) {
<a name="l01574"></a>01574   <span class="comment">//$solr_query .= &#39;&amp;fl=id+status_analyzedStatus+status_transcribedStatus+status_parsedL1Status+status_parsedL2Status+status_parsedL3Status&#39;;</span>
<a name="l01575"></a>01575   $apiary_session = $session_id;
<a name="l01576"></a>01576   $solr_q = <span class="stringliteral">&#39;q=status_locked_session:(&quot;&#39;</span>.$apiary_session.<span class="stringliteral">&#39;&quot;)&#39;</span>;
<a name="l01577"></a>01577   $solr_fl = <span class="stringliteral">&#39;fl=id+status_analyzedStatus+status_transcribedStatus+status_parsedL1Status+status_parsedL2Status+status_parsedL3Status&#39;</span>;
<a name="l01578"></a>01578   $solr_op = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01579"></a>01579   $solr_rows = <span class="stringliteral">&#39;rows=10000&#39;</span>;
<a name="l01580"></a>01580   $solr_sxml = <a class="code" href="search_8functions_8php.html#ae6356bbdc7e39f2f56be2e74848e4c58">solr_query_xml</a>($solr_q, $solr_fl, $solr_op, $solr_rows);
<a name="l01581"></a>01581   <span class="keywordflow">if</span>($solr_sxml != <span class="keyword">false</span>) {
<a name="l01582"></a>01582     <span class="keywordflow">foreach</span>($solr_sxml-&gt;result[0]-&gt;doc as $doc) {
<a name="l01583"></a>01583       $pid = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01584"></a>01584       $analyzedStatus = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01585"></a>01585       $transcribedStatus = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01586"></a>01586       $parsedL1Status = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01587"></a>01587       $parsedL2Status = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01588"></a>01588       $parsedL3Status = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01589"></a>01589       <span class="keywordflow">foreach</span>($doc-&gt;children() as $sxml_node) {
<a name="l01590"></a>01590         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;id&#39;</span>) {
<a name="l01591"></a>01591           $pid = $sxml_node;
<a name="l01592"></a>01592         }
<a name="l01593"></a>01593         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;status_analyzedStatus&#39;</span>) {
<a name="l01594"></a>01594           $analyzedStatus = $sxml_node;
<a name="l01595"></a>01595         }
<a name="l01596"></a>01596         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;status_transcribedStatus&#39;</span>) {
<a name="l01597"></a>01597           $transcribedStatus = $sxml_node;
<a name="l01598"></a>01598         }
<a name="l01599"></a>01599         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;status_parsedL1Status&#39;</span>) {
<a name="l01600"></a>01600           $parsedL1Status = $sxml_node;
<a name="l01601"></a>01601         }
<a name="l01602"></a>01602         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;status_parsedL2Status&#39;</span>) {
<a name="l01603"></a>01603           $parsedL2Status = $sxml_node;
<a name="l01604"></a>01604         }
<a name="l01605"></a>01605         <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;status_parsedL3Status&#39;</span>) {
<a name="l01606"></a>01606           $parsedL3Status = $sxml_node;
<a name="l01607"></a>01607         }
<a name="l01608"></a>01608       }
<a name="l01609"></a>01609       <span class="keywordflow">if</span>(strpos($pid, <span class="stringliteral">&#39;ap-image:&#39;</span>) &gt; -1) {
<a name="l01610"></a>01610         <span class="keywordflow">if</span>($analyzedStatus == <span class="stringliteral">&quot;in progress&quot;</span>) {
<a name="l01611"></a>01611           <a class="code" href="workspace_8functions_8php.html#ab698518e69f8e41be92fc0e1576f69f6">updateStatus</a>($pid, <span class="stringliteral">&quot;analyzedStatus&quot;</span>, <span class="stringliteral">&quot;incomplete&quot;</span>);
<a name="l01612"></a>01612         }
<a name="l01613"></a>01613         AP_Image::releaseImageLock($pid);
<a name="l01614"></a>01614       }
<a name="l01615"></a>01615       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strpos($pid, <span class="stringliteral">&#39;ap-roi:&#39;</span>) &gt; -1) {
<a name="l01616"></a>01616         <span class="keywordflow">if</span>($transcribedStatus == <span class="stringliteral">&quot;in progress&quot;</span>) {
<a name="l01617"></a>01617           <a class="code" href="workspace_8functions_8php.html#ab698518e69f8e41be92fc0e1576f69f6">updateStatus</a>($pid, <span class="stringliteral">&quot;transcribedStatus&quot;</span>, <span class="stringliteral">&quot;incomplete&quot;</span>);
<a name="l01618"></a>01618         }
<a name="l01619"></a>01619         <span class="keywordflow">if</span>($parsedL1Status == <span class="stringliteral">&quot;in progress&quot;</span>) {
<a name="l01620"></a>01620           <a class="code" href="workspace_8functions_8php.html#ab698518e69f8e41be92fc0e1576f69f6">updateStatus</a>($pid, <span class="stringliteral">&quot;parsedL1Status&quot;</span>, <span class="stringliteral">&quot;incomplete&quot;</span>);
<a name="l01621"></a>01621         }
<a name="l01622"></a>01622         <span class="keywordflow">if</span>($parsedL2Status == <span class="stringliteral">&quot;in progress&quot;</span>) {
<a name="l01623"></a>01623           <a class="code" href="workspace_8functions_8php.html#ab698518e69f8e41be92fc0e1576f69f6">updateStatus</a>($pid, <span class="stringliteral">&quot;parsedL2Status&quot;</span>, <span class="stringliteral">&quot;incomplete&quot;</span>);
<a name="l01624"></a>01624         }
<a name="l01625"></a>01625         <span class="keywordflow">if</span>($parsedL3Status == <span class="stringliteral">&quot;in progress&quot;</span>) {
<a name="l01626"></a>01626           <a class="code" href="workspace_8functions_8php.html#ab698518e69f8e41be92fc0e1576f69f6">updateStatus</a>($pid, <span class="stringliteral">&quot;parsedL3Status&quot;</span>, <span class="stringliteral">&quot;incomplete&quot;</span>);
<a name="l01627"></a>01627         }
<a name="l01628"></a>01628         AP_ROI::releaseROILock($pid);
<a name="l01629"></a>01629       }
<a name="l01630"></a>01630     }
<a name="l01631"></a>01631     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01632"></a>01632   }
<a name="l01633"></a>01633   <span class="keywordflow">else</span> {
<a name="l01634"></a>01634     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01635"></a>01635   }
<a name="l01636"></a>01636 }
<a name="l01637"></a>01637 
<a name="l01638"></a><a class="code" href="workspace_8functions_8php.html#adc8a7972c0fe59df9ebeb226c30c1fcf">01638</a> function <a class="code" href="workspace_8functions_8php.html#adc8a7972c0fe59df9ebeb226c30c1fcf">emptyQueue</a>() {
<a name="l01639"></a>01639   <span class="comment">//$solr_query .= &#39;&amp;fl=id+status_analyzedStatus+status_transcribedStatus+status_parsedL1Status+status_parsedL2Status+status_parsedL3Status&#39;;</span>
<a name="l01640"></a>01640   $apiary_session = $_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>];
<a name="l01641"></a>01641   $solr_q = <span class="stringliteral">&#39;q=status_locked_session:(&quot;&#39;</span>.$apiary_session.<span class="stringliteral">&#39;&quot;)&#39;</span>;
<a name="l01642"></a>01642   $solr_fl = <span class="stringliteral">&#39;fl=id&#39;</span>;
<a name="l01643"></a>01643   $solr_op = <span class="stringliteral">&#39;q.op=AND&#39;</span>;
<a name="l01644"></a>01644   $solr_rows = <span class="stringliteral">&#39;rows=10000&#39;</span>;
<a name="l01645"></a>01645   $solr_sxml = <a class="code" href="search_8functions_8php.html#ae6356bbdc7e39f2f56be2e74848e4c58">solr_query_xml</a>($solr_q, $solr_fl, $solr_op, $solr_rows);
<a name="l01646"></a>01646   <span class="keywordflow">if</span>($solr_sxml != <span class="keyword">false</span>) {
<a name="l01647"></a>01647     $queue_count = 0;
<a name="l01648"></a>01648     $cleared_count = 0;
<a name="l01649"></a>01649     <span class="keywordflow">foreach</span>($solr_sxml-&gt;result[0]-&gt;doc as $doc) {
<a name="l01650"></a>01650       <span class="keywordflow">foreach</span>($doc-&gt;children() as $sxml_node) {
<a name="l01651"></a>01651         $queue_count++;
<a name="l01652"></a>01652         $pid = $sxml_node;
<a name="l01653"></a>01653         <span class="keywordflow">if</span>(strpos($pid, <span class="stringliteral">&#39;ap-image:&#39;</span>) &gt; -1) {
<a name="l01654"></a>01654           $success = AP_Image::releaseImageLock($pid);
<a name="l01655"></a>01655           <span class="keywordflow">if</span>($success != <span class="keyword">false</span>) {
<a name="l01656"></a>01656             $cleared_count++;
<a name="l01657"></a>01657           }
<a name="l01658"></a>01658         }
<a name="l01659"></a>01659         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strpos($pid, <span class="stringliteral">&#39;ap-roi:&#39;</span>) &gt; -1) {
<a name="l01660"></a>01660           $success = AP_ROI::releaseROILock($pid);
<a name="l01661"></a>01661           <span class="keywordflow">if</span>($success != <span class="keyword">false</span>) {
<a name="l01662"></a>01662             $cleared_count++;
<a name="l01663"></a>01663           }
<a name="l01664"></a>01664         }
<a name="l01665"></a>01665       }
<a name="l01666"></a>01666     }
<a name="l01667"></a>01667     <span class="keywordflow">if</span>($queue_count == $queue_count) {
<a name="l01668"></a>01668       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01669"></a>01669     }
<a name="l01670"></a>01670     <span class="keywordflow">else</span> {
<a name="l01671"></a>01671       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01672"></a>01672     }
<a name="l01673"></a>01673   }
<a name="l01674"></a>01674   <span class="keywordflow">else</span> {
<a name="l01675"></a>01675     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01676"></a>01676   }
<a name="l01677"></a>01677 }
<a name="l01678"></a>01678 
<a name="l01679"></a><a class="code" href="workspace_8functions_8php.html#ab698518e69f8e41be92fc0e1576f69f6">01679</a> function <a class="code" href="workspace_8functions_8php.html#ab698518e69f8e41be92fc0e1576f69f6">updateStatus</a>($pid, $status_type, $status) {
<a name="l01680"></a>01680   <span class="keywordflow">if</span>(strpos($pid, <span class="stringliteral">&#39;ap-image:&#39;</span>) &gt; -1) {
<a name="l01681"></a>01681     $success = AP_Image::setImageStatus($pid, $status_type, $status);
<a name="l01682"></a>01682   }
<a name="l01683"></a>01683   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strpos($pid, <span class="stringliteral">&#39;ap-roi:&#39;</span>) &gt; -1) {
<a name="l01684"></a>01684     $success = AP_ROI::setROIStatus($pid, $status_type, $status);
<a name="l01685"></a>01685   }
<a name="l01686"></a>01686   <span class="keywordflow">else</span> {
<a name="l01687"></a>01687     $success = <span class="keyword">false</span>;
<a name="l01688"></a>01688   }
<a name="l01689"></a>01689   <span class="keywordflow">if</span>($success != <span class="keyword">false</span>){
<a name="l01690"></a>01690     echo <span class="stringliteral">&#39;&lt;status_successfully_updated&gt;true&lt;/status_successfully_updated&gt;&#39;</span>; <span class="comment">//or whatever we want the return to be</span>
<a name="l01691"></a>01691   }
<a name="l01692"></a>01692   <span class="keywordflow">else</span> {
<a name="l01693"></a>01693     echo <span class="stringliteral">&#39;&lt;status_successfully_updated&gt;false&lt;/status_successfully_updated&gt;&#39;</span>; <span class="comment">//or whatever we want the return to be</span>
<a name="l01694"></a>01694   }
<a name="l01695"></a>01695 }
<a name="l01696"></a>01696 
<a name="l01697"></a><a class="code" href="workspace_8functions_8php.html#af009f86f57dec896f8c08dbccd931822">01697</a> function <a class="code" href="workspace_8functions_8php.html#af009f86f57dec896f8c08dbccd931822">releaseLock</a>($pid){
<a name="l01698"></a>01698   <span class="keywordflow">if</span>(strpos($pid, <span class="stringliteral">&#39;ap-image:&#39;</span>) &gt; -1) {
<a name="l01699"></a>01699     $success = AP_Image::releaseImageLock($pid);
<a name="l01700"></a>01700     <span class="keywordflow">if</span>($success != <span class="keyword">false</span>) {
<a name="l01701"></a>01701       echo <span class="stringliteral">&quot;success&quot;</span>;
<a name="l01702"></a>01702     }
<a name="l01703"></a>01703     <span class="keywordflow">else</span> {
<a name="l01704"></a>01704       echo <span class="stringliteral">&quot;false&quot;</span>;
<a name="l01705"></a>01705     }
<a name="l01706"></a>01706   }
<a name="l01707"></a>01707   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strpos($pid, <span class="stringliteral">&#39;ap-roi:&#39;</span>) &gt; -1) {
<a name="l01708"></a>01708     $success = AP_ROI::releaseROILock($pid);
<a name="l01709"></a>01709     <span class="keywordflow">if</span>($success != <span class="keyword">false</span>) {
<a name="l01710"></a>01710       echo <span class="stringliteral">&quot;success&quot;</span>;
<a name="l01711"></a>01711     }
<a name="l01712"></a>01712     <span class="keywordflow">else</span> {
<a name="l01713"></a>01713       echo <span class="stringliteral">&quot;false&quot;</span>;
<a name="l01714"></a>01714     }
<a name="l01715"></a>01715   }
<a name="l01716"></a>01716 }
<a name="l01717"></a>01717 
<a name="l01718"></a><a class="code" href="workspace_8functions_8php.html#ae4bb84838e415581eb08082d9018478e">01718</a> function <a class="code" href="workspace_8functions_8php.html#ae4bb84838e415581eb08082d9018478e">get_workflow_status_via_solr</a>($pid) {
<a name="l01719"></a>01719   $solr_q = <span class="stringliteral">&#39;q=id:(&quot;&#39;</span>.$pid.<span class="stringliteral">&#39;&quot;)&#39;</span>;
<a name="l01720"></a>01720   $solr_fl = <span class="stringliteral">&#39;fl=status_locked+locked_time+status_locked_session&#39;</span>;
<a name="l01721"></a>01721   $solr_sxml = <a class="code" href="search_8functions_8php.html#ae6356bbdc7e39f2f56be2e74848e4c58">solr_query_xml</a>($solr_q, $solr_fl);
<a name="l01722"></a>01722   <span class="keywordflow">if</span>($solr_sxml != <span class="keyword">false</span>) {
<a name="l01723"></a>01723     <span class="keywordflow">foreach</span>($solr_sxml-&gt;result[0]-&gt;doc[0]-&gt;children() as $sxml_node) {
<a name="l01724"></a>01724       $sxml_arr = $sxml_node-&gt;attributes();
<a name="l01725"></a>01725       $sxml_attrib_name = $sxml_arr[<span class="stringliteral">&quot;name&quot;</span>];
<a name="l01726"></a>01726       <span class="keywordflow">if</span>($sxml_attrib_name == <span class="stringliteral">&#39;status_locked&#39;</span>) {
<a name="l01727"></a>01727         $locked = $sxml_node;
<a name="l01728"></a>01728       }
<a name="l01729"></a>01729       <span class="keywordflow">if</span>($sxml_attrib_name == <span class="stringliteral">&#39;locked_time&#39;</span>) {
<a name="l01730"></a>01730         $locked_time = (double)$sxml_node;
<a name="l01731"></a>01731       }
<a name="l01732"></a>01732       <span class="keywordflow">if</span>($sxml_attrib_name == <span class="stringliteral">&#39;status_locked_session&#39;</span>) {
<a name="l01733"></a>01733         $locked_session = $sxml_node;
<a name="l01734"></a>01734       }
<a name="l01735"></a>01735     }
<a name="l01736"></a>01736     <span class="keywordflow">return</span> <a class="code" href="workspace_8functions_8php.html#a4fd3cbdcf1282bd92e9609b5de35863c">workflow_status</a>($locked, $locked_time, $locked_session);
<a name="l01737"></a>01737   }
<a name="l01738"></a>01738   <span class="keywordflow">else</span> {
<a name="l01739"></a>01739     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01740"></a>01740   }
<a name="l01741"></a>01741 }
<a name="l01742"></a>01742 
<a name="l01743"></a><a class="code" href="workspace_8functions_8php.html#a4fd3cbdcf1282bd92e9609b5de35863c">01743</a> function <a class="code" href="workspace_8functions_8php.html#a4fd3cbdcf1282bd92e9609b5de35863c">workflow_status</a>($locked, $locked_time, $locked_session) {
<a name="l01744"></a>01744   $workflow_status = <span class="stringliteral">&quot;locked&quot;</span>;
<a name="l01745"></a>01745   <span class="keywordflow">if</span>($locked == <span class="stringliteral">&quot;true&quot;</span>) {
<a name="l01746"></a>01746     <span class="keywordflow">if</span>(Workflow::isLockedExpired($locked_time, $locked_session)) {
<a name="l01747"></a>01747       $workflow_status = <span class="stringliteral">&quot;available&quot;</span>;
<a name="l01748"></a>01748     }
<a name="l01749"></a>01749     <span class="keywordflow">else</span> <span class="keywordflow">if</span>($_SESSION[<span class="stringliteral">&#39;apiary_session_id&#39;</span>] == $locked_session) {
<a name="l01750"></a>01750       $workflow_status = <span class="stringliteral">&quot;queued&quot;</span>;
<a name="l01751"></a>01751     }
<a name="l01752"></a>01752   }
<a name="l01753"></a>01753   <span class="keywordflow">else</span> {
<a name="l01754"></a>01754     $workflow_status = <span class="stringliteral">&quot;available&quot;</span>;
<a name="l01755"></a>01755   }
<a name="l01756"></a>01756   <span class="keywordflow">return</span> $workflow_status;
<a name="l01757"></a>01757 }
<a name="l01758"></a>01758 
<a name="l01759"></a><a class="code" href="workspace_8functions_8php.html#ae6356bbdc7e39f2f56be2e74848e4c58">01759</a> function <a class="code" href="search_8functions_8php.html#ae6356bbdc7e39f2f56be2e74848e4c58">solr_query_xml</a>($q, $fl = <span class="stringliteral">&#39;&#39;</span>, $op = <span class="stringliteral">&#39;&#39;</span>, $rows = <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01760"></a>01760   $solr_search = <span class="keyword">new</span> search();
<a name="l01761"></a>01761   <span class="keywordflow">if</span>(strpos($q, <span class="stringliteral">&quot;q=&quot;</span>) === <span class="keyword">false</span>) {
<a name="l01762"></a>01762     $q = <span class="stringliteral">&#39;q=&#39;</span>.str_replace(<span class="charliteral">&#39;&amp;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $q);
<a name="l01763"></a>01763   }
<a name="l01764"></a>01764   $solr_query = $q;
<a name="l01765"></a>01765   <span class="keywordflow">if</span>(!empty($fl)) {
<a name="l01766"></a>01766     <span class="keywordflow">if</span>(strpos($fl, <span class="stringliteral">&#39;fl=&#39;</span>) === <span class="keyword">false</span>) {
<a name="l01767"></a>01767       $fl = <span class="stringliteral">&#39;fl=&#39;</span>.$fl;
<a name="l01768"></a>01768     }
<a name="l01769"></a>01769     $solr_query .= <span class="charliteral">&#39;&amp;&#39;</span>.str_replace(<span class="charliteral">&#39;&amp;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $fl);
<a name="l01770"></a>01770   }
<a name="l01771"></a>01771   <span class="keywordflow">if</span>(!empty($op)) {
<a name="l01772"></a>01772     <span class="keywordflow">if</span>(strpos($op, <span class="stringliteral">&#39;op=&#39;</span>) === <span class="keyword">false</span>) {
<a name="l01773"></a>01773       $op = <span class="stringliteral">&#39;op=&#39;</span>.$op;
<a name="l01774"></a>01774     }
<a name="l01775"></a>01775     $solr_query .= <span class="charliteral">&#39;&amp;&#39;</span>.str_replace(<span class="charliteral">&#39;&amp;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $op);
<a name="l01776"></a>01776   }
<a name="l01777"></a>01777   <span class="keywordflow">if</span>(!empty($rows)) {
<a name="l01778"></a>01778     <span class="keywordflow">if</span>(strpos($rows, <span class="stringliteral">&#39;rows=&#39;</span>) === <span class="keyword">false</span>) {
<a name="l01779"></a>01779       $rows = <span class="stringliteral">&#39;rows=&#39;</span>.$rows;
<a name="l01780"></a>01780     }
<a name="l01781"></a>01781     $solr_query .= <span class="charliteral">&#39;&amp;&#39;</span>.str_replace(<span class="charliteral">&#39;&amp;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $rows);
<a name="l01782"></a>01782   }
<a name="l01783"></a>01783   <span class="comment">//echo &quot;solr_query = &quot;.$solr_query.&quot;&lt;br&gt;\n&quot;;</span>
<a name="l01784"></a>01784   $solr_results = $solr_search-&gt;doSearch($solr_query);
<a name="l01785"></a>01785   <span class="keywordflow">if</span>($solr_results != <span class="keyword">false</span>) {
<a name="l01786"></a>01786     $solr_sxml = <span class="keyword">new</span> SimpleXMLElement($solr_results);
<a name="l01787"></a>01787     <span class="keywordflow">return</span> $solr_sxml;
<a name="l01788"></a>01788   }
<a name="l01789"></a>01789   <span class="keywordflow">else</span> {
<a name="l01790"></a>01790     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01791"></a>01791   }
<a name="l01792"></a>01792 }
<a name="l01793"></a>01793 
<a name="l01794"></a><a class="code" href="workspace_8functions_8php.html#a4400883073feeaa376e7a5d300ec6ba3">01794</a> function <a class="code" href="workspace_8functions_8php.html#a4400883073feeaa376e7a5d300ec6ba3">research_server_djatoka_records</a>() {
<a name="l01795"></a>01795   $curl_handle=curl_init();
<a name="l01796"></a>01796   $url = <span class="stringliteral">&#39;http://research.apiaryproject.org/adore-djatoka/images.php&#39;</span>;
<a name="l01797"></a>01797   curl_setopt($curl_handle, CURLOPT_URL, $url);
<a name="l01798"></a>01798   curl_setopt($curl_handle, CURLOPT_CONNECTTIMEOUT, 2);
<a name="l01799"></a>01799   curl_setopt($curl_handle, CURLOPT_RETURNTRANSFER, 1);
<a name="l01800"></a>01800   $output = curl_exec($curl_handle);
<a name="l01801"></a>01801   curl_close($curl_handle);
<a name="l01802"></a>01802   <span class="keywordflow">if</span>(strpos($output, <span class="stringliteral">&quot;404 Not Found&quot;</span>)==FALSE) {
<a name="l01803"></a>01803     $records = array();
<a name="l01804"></a>01804     $lines = explode(<span class="stringliteral">&quot;\n&quot;</span>,trim($output));
<a name="l01805"></a>01805     $count = 0;
<a name="l01806"></a>01806     <span class="keywordflow">foreach</span> ($lines as $line) {
<a name="l01807"></a>01807       <span class="keywordflow">if</span> (trim($line)) {
<a name="l01808"></a>01808         $values = explode(<span class="stringliteral">&quot;, &quot;</span>,$line);
<a name="l01809"></a>01809         $records[$count][<span class="stringliteral">&#39;rft_id&#39;</span>] = $values[0];
<a name="l01810"></a>01810         $records[$count][<span class="stringliteral">&#39;original_url&#39;</span>] = $values[1];
<a name="l01811"></a>01811         $records[$count][<span class="stringliteral">&#39;jp2_url&#39;</span>] = $values[2];
<a name="l01812"></a>01812         $count++;
<a name="l01813"></a>01813       }
<a name="l01814"></a>01814     }
<a name="l01815"></a>01815     <span class="keywordflow">return</span> $records;
<a name="l01816"></a>01816   }
<a name="l01817"></a>01817   <span class="keywordflow">else</span> {
<a name="l01818"></a>01818     echo <span class="stringliteral">&quot;Unable to get image list for this djatoka server&quot;</span>;
<a name="l01819"></a>01819   }
<a name="l01820"></a>01820 }
<a name="l01821"></a>01821 
<a name="l01822"></a><a class="code" href="workspace_8functions_8php.html#ad361b927889bc4fdfef4e2f01cf384dc">01822</a> function <a class="code" href="workspace_8functions_8php.html#ad361b927889bc4fdfef4e2f01cf384dc">research_server_image_list</a>() {
<a name="l01823"></a>01823   $records = <a class="code" href="workspace_8functions_8php.html#a4400883073feeaa376e7a5d300ec6ba3">research_server_djatoka_records</a>();
<a name="l01824"></a>01824   $specimen_list_html = <span class="stringliteral">&#39;&lt;div id=&quot;add_items&quot; class=&quot;dialog_box&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01825"></a>01825   $specimen_list_html .= <span class="stringliteral">&#39;&lt;div id=&quot;add_items_list&quot; class=&quot;dialog_box_content&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01826"></a>01826   $specimen_list_html .= <span class="stringliteral">&#39;&lt;div id=&quot;add_items_page_1&quot; class=&quot;add_items_page&quot; style=&quot;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01827"></a>01827   <span class="keywordflow">foreach</span>($records as $record) {
<a name="l01828"></a>01828     $specimen_list_html .= <a class="code" href="workspace_8functions_8php.html#a26e860b17a8534a5a2bb240d494b76c0">create_image_list_div</a>($record[<span class="stringliteral">&#39;rft_id&#39;</span>], $record[<span class="stringliteral">&#39;original_url&#39;</span>], $record[<span class="stringliteral">&#39;jp2_url&#39;</span>]);
<a name="l01829"></a>01829   }
<a name="l01830"></a>01830   $specimen_list_html .= <span class="stringliteral">&#39;&lt;/div&gt;&lt;!-- add_items_page_1 --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01831"></a>01831   $specimen_list_html .= <span class="stringliteral">&#39;&lt;/div&gt;&lt;!-- add_items_list --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01832"></a>01832   $specimen_list_html .= <span class="stringliteral">&#39;&lt;/div&gt;&lt;!-- add_items --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01833"></a>01833   $specimen_list_html .= <span class="stringliteral">&#39;&lt;input type=&quot;button&quot; id=&quot;ingest_specimen_images_btn&quot; name=&quot;ingest_specimen_images_btn&quot; onClick=&quot;ingest_specimen_images();&quot; value=&quot;Add Specimens&quot; /&gt;&#39;</span>;
<a name="l01834"></a>01834   echo $specimen_list_html;
<a name="l01835"></a>01835 }
<a name="l01836"></a>01836 
<a name="l01837"></a><a class="code" href="workspace_8functions_8php.html#afd4c34745073e420fe7eb937bce76c84">01837</a> function <a class="code" href="workspace_8functions_8php.html#afd4c34745073e420fe7eb937bce76c84">get_exisitng_original_url_list</a>(){
<a name="l01838"></a>01838   $original_url_list = array();
<a name="l01839"></a>01839   $solr_q = <span class="stringliteral">&#39;q=imageMetadata_sourceURL:(*)&#39;</span>;
<a name="l01840"></a>01840   $solr_fl = <span class="stringliteral">&#39;fl=imageMetadata_sourceURL&#39;</span>;
<a name="l01841"></a>01841   $solr_op = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01842"></a>01842   $solr_rows = <span class="stringliteral">&#39;rows=10000&#39;</span>;
<a name="l01843"></a>01843   $solr_sxml = <a class="code" href="search_8functions_8php.html#ae6356bbdc7e39f2f56be2e74848e4c58">solr_query_xml</a>($solr_q, $solr_fl, $solr_op, $solr_rows);
<a name="l01844"></a>01844   <span class="keywordflow">foreach</span>($solr_sxml-&gt;result[0]-&gt;doc as $doc) {
<a name="l01845"></a>01845     <span class="keywordflow">foreach</span>($doc-&gt;children() as $sxml_node) {
<a name="l01846"></a>01846       <span class="keywordflow">if</span>($sxml_node-&gt;attributes()-&gt;name == <span class="stringliteral">&#39;imageMetadata_sourceURL&#39;</span>) {
<a name="l01847"></a>01847         array_push($original_url_list, (<span class="keywordtype">string</span>)$sxml_node);
<a name="l01848"></a>01848       }
<a name="l01849"></a>01849     }
<a name="l01850"></a>01850   }
<a name="l01851"></a>01851   <span class="keywordflow">return</span> $original_url_list;
<a name="l01852"></a>01852 }
<a name="l01853"></a>01853 
<a name="l01854"></a><a class="code" href="workspace_8functions_8php.html#a26e860b17a8534a5a2bb240d494b76c0">01854</a> function <a class="code" href="workspace_8functions_8php.html#a26e860b17a8534a5a2bb240d494b76c0">create_image_list_div</a>($rft_id, $original_url, $jp2_url) {
<a name="l01855"></a>01855   $original_url_list = <a class="code" href="workspace_8functions_8php.html#afd4c34745073e420fe7eb937bce76c84">get_exisitng_original_url_list</a>();
<a name="l01856"></a>01856   $selected_class = <span class="stringliteral">&#39;unselected&#39;</span>;
<a name="l01857"></a>01857   $roundedcornr_class = <span class="stringliteral">&#39;roundedcornr_ltgray&#39;</span>;
<a name="l01858"></a>01858   $ingested = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01859"></a>01859   <span class="keywordflow">if</span>(array_search($original_url, $original_url_list) &gt; -1) {
<a name="l01860"></a>01860     $selected_class = <span class="stringliteral">&#39;selected ingested&#39;</span>;
<a name="l01861"></a>01861     $roundedcornr_class = <span class="stringliteral">&#39;roundedcornr_dgray&#39;</span>;
<a name="l01862"></a>01862     $ingested = <span class="stringliteral">&#39; -- Already Ingested!&#39;</span>;
<a name="l01863"></a>01863   }
<a name="l01864"></a>01864   $id = str_replace(<span class="charliteral">&#39;:&#39;</span>, <span class="stringliteral">&#39;__&#39;</span>, $rft_id);
<a name="l01865"></a>01865   $id = str_replace(<span class="charliteral">&#39;/&#39;</span>, <span class="stringliteral">&#39;_s_&#39;</span>, $id);
<a name="l01866"></a>01866   $id = str_replace(<span class="charliteral">&#39;.&#39;</span>, <span class="stringliteral">&#39;_d_&#39;</span>, $id);
<a name="l01867"></a>01867   $image_list_div_html = <span class="stringliteral">&#39;            &lt;div id=&quot;&#39;</span>.$id.<span class="stringliteral">&#39;&quot; class=&quot;pool_item &#39;</span>.$roundedcornr_class.<span class="charliteral">&#39; &#39;</span>.$selected_class.<span class="stringliteral">&#39;&quot; original_url=&quot;&#39;</span>.$original_url.<span class="stringliteral">&#39;&quot; jp2_url=&quot;&#39;</span>.$jp2_url.<span class="stringliteral">&#39;&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01868"></a>01868 
<a name="l01869"></a>01869   $djatoka_server_base = variable_get(<span class="stringliteral">&#39;apiary_research_djatoka_url&#39;</span>, <span class="stringliteral">&#39;http://img.apiaryproject.org&#39;</span>);
<a name="l01870"></a>01870   $djatoka_image_url = $djatoka_server_base.<span class="stringliteral">&#39;/resolver?url_ver=Z39.88-2004&#39;</span>;
<a name="l01871"></a>01871   $djatoka_image_url .= <span class="stringliteral">&#39;&amp;rft_id=&#39;</span>.$rft_id;
<a name="l01872"></a>01872   $djatoka_image_url .= <span class="stringliteral">&#39;&amp;svc_id=info:lanl-repo/svc/getRegion&#39;</span>;
<a name="l01873"></a>01873   $djatoka_image_url .= <span class="stringliteral">&#39;&amp;svc_val_fmt=info:ofi/fmt:kev:mtx:jpeg2000&#39;</span>;
<a name="l01874"></a>01874   $djatoka_image_url .= <span class="stringliteral">&#39;&amp;svc.format=image/jpeg&#39;</span>;
<a name="l01875"></a>01875   $djatoka_image_url .= <span class="stringliteral">&#39;&amp;svc.level=3&#39;</span>;
<a name="l01876"></a>01876   $djatoka_image_url .= <span class="stringliteral">&#39;&amp;svc.rotate=0&#39;</span>;
<a name="l01877"></a>01877   $djatoka_image_url .= <span class="stringliteral">&#39;&amp;svc.scale=0,68&#39;</span>;
<a name="l01878"></a>01878 
<a name="l01879"></a>01879   $image_list_div_html .= <span class="stringliteral">&#39;              &lt;div class=&quot;t&quot;&gt;&lt;div class=&quot;b&quot;&gt;&lt;div class=&quot;l&quot;&gt;&lt;div class=&quot;r&quot;&gt;&lt;div class=&quot;bl&quot;&gt;&lt;div class=&quot;br&quot;&gt;&lt;div class=&quot;tl&quot;&gt;&lt;div class=&quot;tr&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01880"></a>01880   $image_list_div_html .= <span class="stringliteral">&#39;                &lt;div class=&quot;pool_item_checkbox&quot; onclick=&quot;toggle_selected(\&#39;#&#39;</span>.$id.<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01881"></a>01881 <span class="stringliteral">  $image_list_div_html .= &#39;                &lt;div class=&quot;</span>pool_item_area pool_item_image<span class="stringliteral">&quot; onclick=&quot;</span>toggle_selected(\<span class="charliteral">&#39;#&#39;</span>.$id.<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01882"></a>01882 <span class="stringliteral">  $image_list_div_html .= &#39;                  &lt;img src=&quot;</span><span class="stringliteral">&#39;.$djatoka_image_url.&#39;</span><span class="stringliteral">&quot; height=68px /&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01883"></a>01883 <span class="stringliteral">  $image_list_div_html .= &#39;                &lt;/div&gt;&lt;!-- .pool_item_area .pool_item_image --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01884"></a>01884 <span class="stringliteral">  $image_list_div_html .= &#39;                &lt;div class=&quot;</span>pool_item_area pool_item_content<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01885"></a>01885 <span class="stringliteral">  $image_list_div_html .= &#39;                  &lt;div class=&quot;</span>no_specimen_image_metadata<span class="stringliteral">&quot; style=&quot;</span>display:block;<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01886"></a>01886 <span class="stringliteral">  $image_list_div_html .= &#39;                    &lt;strong&gt;&#39;.$rft_id.$ingested.&#39;&lt;/strong&gt;&lt;br/&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01887"></a>01887 <span class="stringliteral">  $image_list_div_html .= &#39;                  &lt;/div&gt;&lt;!-- no_specimen_image_metadata --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01888"></a>01888 <span class="stringliteral">  $image_list_div_html .= &#39;                  &lt;div id=&quot;</span><span class="stringliteral">&#39;.$id.&#39;</span>_metadata<span class="stringliteral">&quot; class=&quot;</span>specimen_image_metadata<span class="stringliteral">&quot; style=&quot;</span>display:none;<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01889"></a>01889 <span class="stringliteral">  $image_list_div_html .= &#39;                    &lt;strong&gt;&#39;.$rft_id.$ingested.&#39;&lt;/strong&gt;&lt;br/&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01890"></a>01890 <span class="stringliteral">  $image_list_div_html .= &#39;                    Collector:&lt;input type=text id=&quot;</span><span class="stringliteral">&#39;.$id.&#39;</span>_collector<span class="stringliteral">&quot;&gt; Collection number:&lt;input type=text id=&quot;</span><span class="stringliteral">&#39;.$id.&#39;</span>_collection_number<span class="stringliteral">&quot;&gt;&lt;br/&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01891"></a>01891 <span class="stringliteral">  $image_list_div_html .= &#39;                    Collection date:&lt;input type=text id=&quot;</span><span class="stringliteral">&#39;.$id.&#39;</span>_collection_date<span class="stringliteral">&quot;&gt; Scientific name:&lt;input type=text id=&quot;</span><span class="stringliteral">&#39;.$id.&#39;</span>_scientific_name<span class="stringliteral">&quot;&gt;&lt;br/&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01892"></a>01892 <span class="stringliteral">  $image_list_div_html .= &#39;                  &lt;/div&gt;&lt;!-- specimen_image_metadata --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01893"></a>01893 <span class="stringliteral">  $image_list_div_html .= &#39;                &lt;/div&gt;&lt;!-- .pool_item_area .pool_item_content --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01894"></a>01894 <span class="stringliteral">  $image_list_div_html .= &#39;              &lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01895"></a>01895 <span class="stringliteral">  $image_list_div_html .= &#39;            &lt;/div&gt;&lt;!-- &#39;.$id.&#39; --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01896"></a>01896 <span class="stringliteral">  return $image_list_div_html;</span>
<a name="l01897"></a>01897 <span class="stringliteral">}</span>
<a name="l01898"></a>01898 <span class="stringliteral"></span>
<a name="l01899"></a><a class="code" href="workspace_8functions_8php.html#ad6f3771cf2c736aca9e2f2eb7a9faeb5">01899</a> <span class="stringliteral">function ingest_specimen_image() {</span>
<a name="l01900"></a>01900 <span class="stringliteral">  $specimen_image_successfully_ingested = &quot;</span><span class="keyword">false</span><span class="stringliteral">&quot;;</span>
<a name="l01901"></a>01901 <span class="stringliteral">  $rft_id = $_POST[&#39;rft_id&#39;];</span>
<a name="l01902"></a>01902 <span class="stringliteral">  $original_url = $_POST[&#39;original_url&#39;];</span>
<a name="l01903"></a>01903 <span class="stringliteral">  $jp2_url = $_POST[&#39;jp2_url&#39;];</span>
<a name="l01904"></a>01904 <span class="stringliteral">  $institution = $_POST[&#39;institution&#39;];</span>
<a name="l01905"></a>01905 <span class="stringliteral">  $collector = $_POST[&#39;collector&#39;];</span>
<a name="l01906"></a>01906 <span class="stringliteral">  $collection_number = $_POST[&#39;collection_number&#39;];</span>
<a name="l01907"></a>01907 <span class="stringliteral">  $collection_date = $_POST[&#39;collection_date&#39;];</span>
<a name="l01908"></a>01908 <span class="stringliteral">  $scientific_name = $_POST[&#39;scientific_name&#39;];</span>
<a name="l01909"></a>01909 <span class="stringliteral">  if(isset($_POST[&#39;rft_id&#39;])){</span>
<a name="l01910"></a>01910 <span class="stringliteral">    include_once(drupal_get_path(&#39;module&#39;, &#39;apiary_project&#39;) . &#39;/adore-djatoka/functions_djatoka.php&#39;);</span>
<a name="l01911"></a>01911 <span class="stringliteral">    module_load_include(&#39;php&#39;, &#39;Apiary_Project&#39;, &#39;fedora_commons/class.AP_Specimen&#39;);</span>
<a name="l01912"></a>01912 <span class="stringliteral">    $new_specimen = new AP_Specimen();</span>
<a name="l01913"></a>01913 <span class="stringliteral">    $specimen_label = &#39;&#39;;</span>
<a name="l01914"></a>01914 <span class="stringliteral">    if($new_specimen-&gt;createSpecimenObject($scientific_name, &#39;&#39;, $collection_date, $collector, $collection_number, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, $specimen_label)) {</span>
<a name="l01915"></a>01915 <span class="stringliteral">      $specimen_image_successfully_ingested = &quot;</span><span class="keyword">true</span><span class="stringliteral">&quot;;</span>
<a name="l01916"></a>01916 <span class="stringliteral">      module_load_include(&#39;php&#39;, &#39;Apiary_Project&#39;, &#39;fedora_commons/class.AP_Image&#39;);</span>
<a name="l01917"></a>01917 <span class="stringliteral">      $new_image = new AP_Image();</span>
<a name="l01918"></a>01918 <span class="stringliteral">      list($width, $height) = getimagesize($jp2_url);</span>
<a name="l01919"></a>01919 <span class="stringliteral">      $image_label = &#39;&#39;;</span>
<a name="l01920"></a>01920 <span class="stringliteral">      $jpeg_datastream_url = getDjatokaURL($rft_id, &#39;getRegion&#39;, &#39;4&#39;, &#39;0&#39;, &#39;0&#39;, $height, $width, &#39;&#39;, &#39;&#39;);</span>
<a name="l01921"></a>01921 <span class="stringliteral">      if($new_image-&gt;createImageObject($new_specimen-&gt;pid, $jp2_url, $rft_id, $original_url, $width, $height, $jpeg_datastream_url, $image_label)) {</span>
<a name="l01922"></a>01922 <span class="stringliteral">        $msg = &#39;Specimen &#39;.$new_specimen-&gt;pid.&#39; and image &#39;.$new_image-&gt;pid.&#39; successfully created.&lt;br&gt;&#39;;</span>
<a name="l01923"></a>01923 <span class="stringliteral">      }</span>
<a name="l01924"></a>01924 <span class="stringliteral">      else {</span>
<a name="l01925"></a>01925 <span class="stringliteral">        $msg = &#39;Unable to create a new image. Specimen &#39;.$new_specimen-&gt;pid.&#39; successfully created.&lt;br&gt;&#39;;;</span>
<a name="l01926"></a>01926 <span class="stringliteral">      }</span>
<a name="l01927"></a>01927 <span class="stringliteral">    }</span>
<a name="l01928"></a>01928 <span class="stringliteral">    else {</span>
<a name="l01929"></a>01929 <span class="stringliteral">      $msg = &#39;Unable to create a new specimen or image object.&lt;br&gt;&#39;;</span>
<a name="l01930"></a>01930 <span class="stringliteral">    }</span>
<a name="l01931"></a>01931 <span class="stringliteral">  }</span>
<a name="l01932"></a>01932 <span class="stringliteral">  $returnJSON[&#39;specimen_image_successfully_ingested&#39;] = $specimen_image_successfully_ingested;</span>
<a name="l01933"></a>01933 <span class="stringliteral">  $returnJSON[&#39;msg&#39;] = $msg;</span>
<a name="l01934"></a>01934 <span class="stringliteral">  echo json_encode($returnJSON);</span>
<a name="l01935"></a>01935 <span class="stringliteral">}</span>
<a name="l01936"></a>01936 <span class="stringliteral"></span>
<a name="l01937"></a><a class="code" href="workspace_8functions_8php.html#aa907bebbf9d9ff75c35b10ee24d48014">01937</a> <span class="stringliteral">function solr_index_content() {</span>
<a name="l01938"></a>01938 <span class="stringliteral">  $specimen_list_html = &#39;&lt;div id=&quot;</span><a class="code" href="workspace_8functions_8php.html#aa907bebbf9d9ff75c35b10ee24d48014">solr_index_content</a><span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01939"></a>01939 <span class="stringliteral">  $specimen_list_html .= &quot;</span>WARNING: Do not interrupt the process once it has been started!&lt;br&gt;\n<span class="stringliteral">&quot;;</span>
<a name="l01940"></a>01940 <span class="stringliteral">  $specimen_list_html .= &#39;&lt;/div&gt;&lt;!-- solr_index_content --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01941"></a>01941 <span class="stringliteral">  $specimen_list_html .= &#39;&lt;input type=&quot;</span>button<span class="stringliteral">&quot; id=&quot;</span>solr_index_all_btn<span class="stringliteral">&quot; name=&quot;</span>solr_index_all_btn<span class="stringliteral">&quot; onClick=&quot;</span><a class="code" href="workspace_8functions_8php.html#ae9693dc9f84cbbc0af0a55c846368601">solr_index_all</a>();<span class="stringliteral">&quot; value=&quot;</span>Index Solr<span class="stringliteral">&quot; /&gt;&#39;;</span>
<a name="l01942"></a>01942 <span class="stringliteral">  echo $specimen_list_html;</span>
<a name="l01943"></a>01943 <span class="stringliteral">}</span>
<a name="l01944"></a>01944 <span class="stringliteral"></span>
<a name="l01945"></a><a class="code" href="workspace_8functions_8php.html#ae9693dc9f84cbbc0af0a55c846368601">01945</a> <span class="stringliteral">function solr_index_all() {</span>
<a name="l01946"></a>01946 <span class="stringliteral">  $specimen_list_html = &#39;&lt;div id=&quot;</span><a class="code" href="workspace_8functions_8php.html#aa907bebbf9d9ff75c35b10ee24d48014">solr_index_content</a><span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01947"></a>01947 <span class="stringliteral">  $specimen_list_html .= &quot;</span>WARNING: Do not interrupt the process once it has been started!&lt;br&gt;\n<span class="stringliteral">&quot;;</span>
<a name="l01948"></a>01948 <span class="stringliteral">  $search_instance = new search();</span>
<a name="l01949"></a>01949 <span class="stringliteral"></span>
<a name="l01950"></a>01950 <span class="stringliteral">  $specimen_list_html .= &quot;</span>Removing all current solr indexes &lt;br&gt;\n<span class="stringliteral">&quot;;</span>
<a name="l01951"></a>01951 <span class="stringliteral">  $search_instance-&gt;delete_all_index();</span>
<a name="l01952"></a>01952 <span class="stringliteral">  $specimen_list_html .= &quot;</span>Finished removing solr indexes &lt;br&gt;\n<span class="stringliteral">&quot;;</span>
<a name="l01953"></a>01953 <span class="stringliteral"></span>
<a name="l01954"></a>01954 <span class="stringliteral">  $specimen_list_html .= &quot;</span>Beginning solr reindexing &lt;br&gt;\n<span class="stringliteral">&quot;;</span>
<a name="l01955"></a>01955 <span class="stringliteral">  $search_instance-&gt;index_all();</span>
<a name="l01956"></a>01956 <span class="stringliteral">  $specimen_list_html .= &quot;</span>Finished solr reindexing &lt;br&gt;\n<span class="stringliteral">&quot;;</span>
<a name="l01957"></a>01957 <span class="stringliteral"></span>
<a name="l01958"></a>01958 <span class="stringliteral">  $specimen_list_html .= &#39;&lt;/div&gt;&lt;!-- solr_index_content --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01959"></a>01959 <span class="stringliteral">  $specimen_list_html .= &#39;&lt;input type=&quot;</span>button<span class="stringliteral">&quot; id=&quot;</span>solr_index_all_btn<span class="stringliteral">&quot; name=&quot;</span>solr_index_all_btn<span class="stringliteral">&quot; onClick=&quot;</span><a class="code" href="workspace_8functions_8php.html#ae9693dc9f84cbbc0af0a55c846368601">solr_index_all</a>();<span class="stringliteral">&quot; value=&quot;</span>Index Solr<span class="stringliteral">&quot; /&gt;&#39;;</span>
<a name="l01960"></a>01960 <span class="stringliteral">  echo $specimen_list_html;</span>
<a name="l01961"></a>01961 <span class="stringliteral">}</span>
<a name="l01962"></a>01962 <span class="stringliteral"></span>
<a name="l01963"></a><a class="code" href="workspace_8functions_8php.html#af809f04afe95b229e0dc950ce3b6769d">01963</a> <span class="stringliteral">function get_permissions($workflow_id) {</span>
<a name="l01964"></a>01964 <span class="stringliteral">  $selected_permission_list = Workflow::getPermissionList($workflow_id);</span>
<a name="l01965"></a>01965 <span class="stringliteral">  $returnJSON[&#39;selected_permission_list&#39;] = $selected_permission_list;</span>
<a name="l01966"></a>01966 <span class="stringliteral">  $returnJSON[&#39;workflow_id&#39;] = $workflow_id;</span>
<a name="l01967"></a>01967 <span class="stringliteral"></span>
<a name="l01968"></a>01968 <span class="stringliteral">  echo json_encode($returnJSON);</span>
<a name="l01969"></a>01969 <span class="stringliteral">}</span>
<a name="l01970"></a>01970 <span class="stringliteral"></span>
<a name="l01971"></a><a class="code" href="workspace_8functions_8php.html#a280fc131731bf4215c07840696bf8800">01971</a> <span class="stringliteral">function get_messages(){</span>
<a name="l01972"></a>01972 <span class="stringliteral">  $messages = $_SESSION[&#39;messages&#39;];</span>
<a name="l01973"></a>01973 <span class="stringliteral">  unset($_SESSION[&#39;messages&#39;]);</span>
<a name="l01974"></a>01974 <span class="stringliteral">  echo json_encode($messages);</span>
<a name="l01975"></a>01975 <span class="stringliteral">}</span>
<a name="l01976"></a>01976 <span class="stringliteral"></span>
<a name="l01977"></a><a class="code" href="workspace_8functions_8php.html#a3fcbb2d7c87717858ed2c67810edb332">01977</a> <span class="stringliteral">function groundtruth_content($specimen_pid = null) {</span>
<a name="l01978"></a>01978 <span class="stringliteral">  global $base_url;</span>
<a name="l01979"></a>01979 <span class="stringliteral">  if($specimen_pid != null &amp;&amp; $specimen_pid != &quot;</span>0<span class="stringliteral">&quot;) {</span>
<a name="l01980"></a>01980 <span class="stringliteral">    $groundtruth_xml .= specimenGroundtruthXML($specimen_pid);</span>
<a name="l01981"></a>01981 <span class="stringliteral">  }</span>
<a name="l01982"></a>01982 <span class="stringliteral">  else {</span>
<a name="l01983"></a>01983 <span class="stringliteral">    $groundtruth_xml = &#39;&#39;;</span>
<a name="l01984"></a>01984 <span class="stringliteral">    $specimen_pid = &#39;&#39;;</span>
<a name="l01985"></a>01985 <span class="stringliteral">  }</span>
<a name="l01986"></a>01986 <span class="stringliteral">  //$roi_type_combobox = generateROITypeComboBox();</span>
<a name="l01987"></a>01987 <span class="stringliteral">  $html = &#39;&#39;;</span>
<a name="l01988"></a>01988 <span class="stringliteral">  $html .= &#39;&lt;div id=&quot;</span><a class="code" href="workspace_8functions_8php.html#a3fcbb2d7c87717858ed2c67810edb332">groundtruth_content</a><span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01989"></a>01989 <span class="stringliteral">  $html .= &#39;&lt;label for=&quot;</span>specimen_pid<span class="stringliteral">&quot;&gt;Specimen:&lt;/label&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01990"></a>01990 <span class="stringliteral">  $html .= &#39;&lt;input type=&quot;</span>text<span class="stringliteral">&quot; name=&quot;</span>specimen_pid<span class="stringliteral">&quot; id=&quot;</span>specimen_pid<span class="stringliteral">&quot; onkeypress=&quot;</span>display_groundtruth_keyPressEvent(event);<span class="stringliteral">&quot; value=&quot;</span><span class="stringliteral">&#39;.$specimen_pid.&#39;</span><span class="stringliteral">&quot; style=&quot;</span>width: 300px;<span class="stringliteral">&quot;/&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01991"></a>01991 <span class="stringliteral">  $html .= &#39;&lt;input type=&quot;</span>button<span class="stringliteral">&quot; name=&quot;</span>display_groundtruth_btn<span class="stringliteral">&quot; onClick=&quot;</span>display_groundtruth();<span class="stringliteral">&quot; value=&quot;</span>Display Specimen Data<span class="stringliteral">&quot; /&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01992"></a>01992 <span class="stringliteral">  $html .= &#39;&lt;br/&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01993"></a>01993 <span class="stringliteral">  $html .= &#39;&lt;textarea name=&quot;</span>groundtruth_data<span class="stringliteral">&quot; id=&quot;</span>groundtruth_data<span class="stringliteral">&quot; style=&quot;</span>width: 800px; height: 250px;<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01994"></a>01994 <span class="stringliteral">  $html .= $groundtruth_xml.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01995"></a>01995 <span class="stringliteral">  $html .= &#39;&lt;/textarea&gt;&lt;!-- groundtruth_data --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01996"></a>01996 <span class="stringliteral">  $html .= &#39;&lt;br/&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01997"></a>01997 <span class="stringliteral">  $html .= &#39;&lt;span&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01998"></a>01998 <span class="stringliteral">  $html .= &#39; &lt;input type=&quot;</span>button<span class="stringliteral">&quot; name=&quot;</span>reset_groundtruth_btn<span class="stringliteral">&quot; onClick=&quot;</span>reset_groundtruth();<span class="stringliteral">&quot; value=&quot;</span>Reset<span class="stringliteral">&quot; /&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l01999"></a>01999 <span class="stringliteral">  $html .= &#39; &lt;input type=&quot;</span>button<span class="stringliteral">&quot; name=&quot;</span>save_groundtruth_btn<span class="stringliteral">&quot; onClick=&quot;</span><a class="code" href="workspace_8functions_8php.html#aeee9947eee2bb5bdfd11770c7e396f0f">save_groundtruth</a>();<span class="stringliteral">&quot; value=&quot;</span>Save<span class="stringliteral">&quot; /&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02000"></a>02000 <span class="stringliteral">  $html .= &#39; &lt;input type=&quot;</span>button<span class="stringliteral">&quot; name=&quot;</span>cancel_groundtruth_btn<span class="stringliteral">&quot; onClick=&quot;</span>cancel_groundtruth();<span class="stringliteral">&quot; value=&quot;</span>Cancel<span class="stringliteral">&quot; /&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02001"></a>02001 <span class="stringliteral">  $html .= &#39;&lt;/span&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02002"></a>02002 <span class="stringliteral">  $html .= &#39;&lt;br/&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02003"></a>02003 <span class="stringliteral">  $html .= &#39;&lt;/div&gt;&lt;!-- groundtruth_content --&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02004"></a>02004 <span class="stringliteral">  echo $html;</span>
<a name="l02005"></a>02005 <span class="stringliteral">}</span>
<a name="l02006"></a>02006 <span class="stringliteral"></span>
<a name="l02007"></a><a class="code" href="workspace_8functions_8php.html#ab9a8172f63d537dbc410950d9d4bb6c7">02007</a> <span class="stringliteral">function generateROITypeComboBox($roi_type = null) {</span>
<a name="l02008"></a>02008 <span class="stringliteral">  $roi_type_list = getROItypeList();</span>
<a name="l02009"></a>02009 <span class="stringliteral">  $combobox_html = &#39;&#39;;</span>
<a name="l02010"></a>02010 <span class="stringliteral">  $combobox_html .= &#39;&lt;select name=&quot;</span>roi_types<span class="stringliteral">&quot; id=&quot;</span>roi_types<span class="stringliteral">&quot;&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02011"></a>02011 <span class="stringliteral">  for($i = 0; $i &lt; sizeof($roi_type_list); $i++) {</span>
<a name="l02012"></a>02012 <span class="stringliteral">    $selected = &#39;&#39;;</span>
<a name="l02013"></a>02013 <span class="stringliteral">    if($roi_type_list[$i] == $roi_type) {</span>
<a name="l02014"></a>02014 <span class="stringliteral">      $selected = &#39; selected&#39;;</span>
<a name="l02015"></a>02015 <span class="stringliteral">    }</span>
<a name="l02016"></a>02016 <span class="stringliteral">    $combobox_html .= &#39;&lt;option onClick=&quot;</span>update_roi_type(\<span class="stringliteral">&#39;&#39;</span>.$roi_type_list[$i].<span class="charliteral">&#39;\&#39;</span>);<span class="stringliteral">&quot; value=&quot;</span><span class="stringliteral">&#39;.$roi_type_list[$i].&#39;</span><span class="stringliteral">&quot;&#39;.$selected.&#39;&gt;&#39;.$roi_type_list[$i].&#39;&lt;/option&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02017"></a>02017 <span class="stringliteral">  }</span>
<a name="l02018"></a>02018 <span class="stringliteral">  $combobox_html .= &#39;&lt;/select&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02019"></a>02019 <span class="stringliteral">  return $combobox_html;</span>
<a name="l02020"></a>02020 <span class="stringliteral">}</span>
<a name="l02021"></a>02021 <span class="stringliteral"></span>
<a name="l02022"></a><a class="code" href="workspace_8functions_8php.html#a825237a28262df1a190ada50bee6cdc3">02022</a> <span class="stringliteral">function specimenGroundtruthXML($specimen_pid) {</span>
<a name="l02023"></a>02023 <span class="stringliteral">  global $base_url;</span>
<a name="l02024"></a>02024 <span class="stringliteral">  $roi_obj = new roiHandler($specimen_pid);</span>
<a name="l02025"></a>02025 <span class="stringliteral">  if($roi_obj-&gt;ifExist(&quot;</span>groundtruth<span class="stringliteral">&quot;)){</span>
<a name="l02026"></a>02026 <span class="stringliteral">    $groundtruth_xml = $roi_obj-&gt;getDatastream(&quot;</span>groundtruth<span class="stringliteral">&quot;);</span>
<a name="l02027"></a>02027 <span class="stringliteral">  }</span>
<a name="l02028"></a>02028 <span class="stringliteral">  else {</span>
<a name="l02029"></a>02029 <span class="stringliteral">    $groundtruth_xml = &#39;&lt;groundtruth&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02030"></a>02030 <span class="stringliteral">    $groundtruth_xml .= &quot;</span>\t<span class="stringliteral">&quot;.&#39;&lt;apiary_instance_ID&gt;&#39;.$base_url.&#39;&lt;/apiary_instance_ID&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02031"></a>02031 <span class="stringliteral">    $groundtruth_xml .= &quot;</span>\t<span class="stringliteral">&quot;.&#39;&lt;specimenID&gt;&#39;.$specimen_pid.&#39;&lt;/specimenID&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02032"></a>02032 <span class="stringliteral">    $groundtruth_xml .= &quot;</span>\t<span class="stringliteral">&quot;.&#39;&lt;specimenMetadata&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02033"></a>02033 <span class="stringliteral">    $groundtruth_xml .= &quot;</span>\t<span class="stringliteral">&quot;.&#39;&lt;/specimenMetadata&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02034"></a>02034 <span class="stringliteral">    $groundtruth_xml .= &quot;</span>\t<span class="stringliteral">&quot;.&#39;&lt;rois&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02035"></a>02035 <span class="stringliteral">    $groundtruth_xml .= &quot;</span>\t<span class="stringliteral">&quot;.&#39;&lt;/rois&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02036"></a>02036 <span class="stringliteral">    $groundtruth_xml .= &#39;&lt;/groundtruth&gt;&#39;.&quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l02037"></a>02037 <span class="stringliteral">  }</span>
<a name="l02038"></a>02038 <span class="stringliteral">  //$groundtruth_dom = new DOMDocument;</span>
<a name="l02039"></a>02039 <span class="stringliteral">  //$groundtruth_dom-&gt;loadXML($groundtruth);</span>
<a name="l02040"></a>02040 <span class="stringliteral">  return $groundtruth_xml;</span>
<a name="l02041"></a>02041 <span class="stringliteral">}</span>
<a name="l02042"></a>02042 <span class="stringliteral"></span>
<a name="l02043"></a><a class="code" href="workspace_8functions_8php.html#aeee9947eee2bb5bdfd11770c7e396f0f">02043</a> <span class="stringliteral">function save_groundtruth() {</span>
<a name="l02044"></a>02044 <span class="stringliteral">  $successfully_saved_groundtruth = &quot;</span><span class="keyword">false</span><span class="stringliteral">&quot;;</span>
<a name="l02045"></a>02045 <span class="stringliteral">  $msg = &#39;&#39;;</span>
<a name="l02046"></a>02046 <span class="stringliteral">  $specimen_pid = $_POST[&#39;specimen_pid&#39;];</span>
<a name="l02047"></a>02047 <span class="stringliteral">  $groundtruth_xml = $_POST[&#39;groundtruth_xml&#39;];</span>
<a name="l02048"></a>02048 <span class="stringliteral">  $groundtruth_dom = new DOMDocument;</span>
<a name="l02049"></a>02049 <span class="stringliteral">  if($specimen_pid != null &amp;&amp; $specimen_pid != &#39;&#39;)</span>
<a name="l02050"></a>02050 <span class="stringliteral">  {</span>
<a name="l02051"></a>02051 <span class="stringliteral">    if($groundtruth_xml != null &amp;&amp; $groundtruth_xml != &#39;&#39;) {</span>
<a name="l02052"></a>02052 <span class="stringliteral">      if($groundtruth_dom-&gt;loadXML($groundtruth_xml)) {</span>
<a name="l02053"></a>02053 <span class="stringliteral">        if(saveSpecimenGroundtruth($specimen_pid, $groundtruth_dom)) {</span>
<a name="l02054"></a>02054 <span class="stringliteral">          $successfully_saved_groundtruth = &quot;</span><span class="keyword">true</span><span class="stringliteral">&quot;;</span>
<a name="l02055"></a>02055 <span class="stringliteral">        }</span>
<a name="l02056"></a>02056 <span class="stringliteral">        else {</span>
<a name="l02057"></a>02057 <span class="stringliteral">          $msg = &quot;</span>Failed saving groundtruth xml <span class="keywordflow">for</span> <span class="keyword">this</span> specimen.<span class="stringliteral">&quot;;</span>
<a name="l02058"></a>02058 <span class="stringliteral">        }</span>
<a name="l02059"></a>02059 <span class="stringliteral">      }</span>
<a name="l02060"></a>02060 <span class="stringliteral">      else {</span>
<a name="l02061"></a>02061 <span class="stringliteral">        $msg = &quot;</span>Invalid xml <span class="keywordflow">for</span> groundtruth<span class="stringliteral">&quot;;</span>
<a name="l02062"></a>02062 <span class="stringliteral">      }</span>
<a name="l02063"></a>02063 <span class="stringliteral">    }</span>
<a name="l02064"></a>02064 <span class="stringliteral">    else {</span>
<a name="l02065"></a>02065 <span class="stringliteral">      $msg = &quot;</span>No groundtruth xml was passed <span class="keywordflow">for</span> <span class="keyword">this</span> specimen.<span class="stringliteral">&quot;;</span>
<a name="l02066"></a>02066 <span class="stringliteral">    }</span>
<a name="l02067"></a>02067 <span class="stringliteral">  }</span>
<a name="l02068"></a>02068 <span class="stringliteral">  else {</span>
<a name="l02069"></a>02069 <span class="stringliteral">      $msg = &quot;</span>There is no Specimen pid passed to save <span class="keyword">this</span> groundtruth.<span class="stringliteral">&quot;;</span>
<a name="l02070"></a>02070 <span class="stringliteral">  }</span>
<a name="l02071"></a>02071 <span class="stringliteral">  $returnJSON[&#39;successfully_saved_groundtruth&#39;] = $successfully_saved_groundtruth;</span>
<a name="l02072"></a>02072 <span class="stringliteral">  $returnJSON[&#39;msg&#39;] = $msg;</span>
<a name="l02073"></a>02073 <span class="stringliteral">  echo json_encode($returnJSON);</span>
<a name="l02074"></a>02074 <span class="stringliteral"></span>
<a name="l02075"></a>02075 <span class="stringliteral">}</span>
<a name="l02076"></a>02076 <span class="stringliteral"></span>
<a name="l02077"></a><a class="code" href="workspace_8functions_8php.html#a45640349162da1bfbf1814e8fbef3c31">02077</a> <span class="stringliteral">function saveSpecimenGroundtruth($specimen_pid, $groundtruth_dom) {</span>
<a name="l02078"></a>02078 <span class="stringliteral">  $roi_obj = new roiHandler($specimen_pid);</span>
<a name="l02079"></a>02079 <span class="stringliteral">  $result = $roi_obj-&gt;setDatastream(&quot;</span>groundtruth<span class="stringliteral">&quot;, &quot;</span>Specimen+Ground+Truth<span class="stringliteral">&quot;, &quot;</span>text/xml<span class="stringliteral">&quot;, $groundtruth_dom-&gt;saveXML(), FEDORA_DATABASE_USERNAME.&quot;</span>:<span class="stringliteral">&quot;.FEDORA_DATABASE_PASSWORD);</span>
<a name="l02080"></a>02080 <span class="stringliteral">  if($result) {</span>
<a name="l02081"></a>02081 <span class="stringliteral">    return true;</span>
<a name="l02082"></a>02082 <span class="stringliteral">  }</span>
<a name="l02083"></a>02083 <span class="stringliteral">  else {</span>
<a name="l02084"></a>02084 <span class="stringliteral">    return false;</span>
<a name="l02085"></a>02085 <span class="stringliteral">  }</span>
<a name="l02086"></a>02086 <span class="stringliteral">}</span>
<a name="l02087"></a>02087 <span class="stringliteral"></span>
<a name="l02088"></a><a class="code" href="workspace_8functions_8php.html#a514e188b2f9918409ed91f774a9f8299">02088</a> <span class="stringliteral">function specimenMetadata_details_content($roi_pid = null) {</span>
<a name="l02089"></a>02089 <span class="stringliteral">  global $base_url;</span>
<a name="l02090"></a>02090 <span class="stringliteral">  $fedora_base_url = variable_get(&quot;</span>fedora_base_url<span class="stringliteral">&quot;, &quot;</span>http:<span class="comment">//localhost:8080/fedora&quot;);</span>
<a name="l02091"></a>02091   $html = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02092"></a>02092   $html .= <span class="stringliteral">&#39;&lt;div id=&quot;specimenMetadata_details_content&quot;&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l02093"></a>02093   <span class="keywordflow">if</span>($roi_pid != null &amp;&amp; $roi_pid != <span class="stringliteral">&quot;0&quot;</span>) {
<a name="l02094"></a>02094     $roi = <span class="keyword">new</span> AP_ROI();
<a name="l02095"></a>02095     $image_pid = $roi-&gt;get_image_pid($roi_pid);
<a name="l02096"></a>02096     $sp_pid = <a class="code" href="analyze_8functions_8php.html#a84f8a9fd1fdd21b005dc0a4684b6f5fe">AP_Image::get_specimen_pid</a>($image_pid);
<a name="l02097"></a>02097     $roiMetadata_record = $roi-&gt;getroiMetadata_record($roi_pid);
<a name="l02098"></a>02098     $roiURL = $roiMetadata_record[<span class="stringliteral">&#39;roiURL&#39;</span>];
<a name="l02099"></a>02099     $djatoka_url = scaleDjatokaURL($roiURL, <span class="stringliteral">&#39;300&#39;</span>, <span class="charliteral">&#39;0&#39;</span>);
<a name="l02100"></a>02100     $html .= <span class="stringliteral">&quot;&lt;h3&gt;Details: $roi_pid&lt;/h3&gt;&quot;</span>;
<a name="l02101"></a>02101     $html .= <span class="stringliteral">&quot;&lt;table&gt;&lt;tr&gt;&lt;td valign=&#39;top&#39; width=&#39;300&#39;&gt;&quot;</span>;
<a name="l02102"></a>02102     $html .= <span class="stringliteral">&quot;&lt;img src=&#39;$djatoka_url&#39;/&gt;&lt;/td&gt;&quot;</span>;
<a name="l02103"></a>02103     $html .= <span class="stringliteral">&quot;&lt;td&gt;Specimen: $sp_pid&lt;br/&gt;Image: $image_pid&lt;br/&gt;ROI: $roi_pid&lt;br/&gt;Datastream: specimenMetadata&lt;br/&gt;&lt;br/&gt;&quot;</span>;
<a name="l02104"></a>02104     $text = shell_exec(<span class="stringliteral">&quot;curl -H - XGET $fedora_base_url/get/$roi_pid/specimenMetadata&quot;</span>);
<a name="l02105"></a>02105     $check=strpos($text, <span class="stringliteral">&quot;404 Not Found&quot;</span>);
<a name="l02106"></a>02106     <span class="keywordflow">if</span>($check === FALSE) {
<a name="l02107"></a>02107       $specimenMetadata_xml_url = <a class="code" href="workspace_8functions_8php.html#a1ec770754ff6c8671939d992f578d167">$server_base</a>.<span class="stringliteral">&#39;/drupal/modules/apiary_project/workflow/include/specimenMetadata_xml.php?pid=&#39;</span>.$roi_pid;
<a name="l02108"></a>02108       $html .= <span class="stringliteral">&#39;&lt;textarea style=&quot;width:500px; height:200px&quot;&gt;&#39;</span>.$text.<span class="stringliteral">&#39;&lt;/textarea&gt;&lt;/td&gt;&#39;</span>;
<a name="l02109"></a>02109       $html .= <span class="stringliteral">&quot;&lt;/tr&gt;&lt;/table&gt;&quot;</span>;
<a name="l02110"></a>02110     }
<a name="l02111"></a>02111     <span class="keywordflow">else</span> {
<a name="l02112"></a>02112       $html .= <span class="stringliteral">&quot;No specimenMetadata found&quot;</span>;
<a name="l02113"></a>02113     }
<a name="l02114"></a>02114   }
<a name="l02115"></a>02115   <span class="keywordflow">else</span> {
<a name="l02116"></a>02116   }
<a name="l02117"></a>02117   $html .= <span class="stringliteral">&#39;&lt;/div&gt;&lt;!-- specimenMetadata_details_content --&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l02118"></a>02118   echo $html;
<a name="l02119"></a>02119 }
<a name="l02120"></a>02120 
<a name="l02121"></a>02121 ?&gt;
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="workspace_8functions_8php.html">workspace.functions.php</a>      </li>
      <li class="footer">Generated on Tue Jun 28 2011 11:15:32 for Apiary Project by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
