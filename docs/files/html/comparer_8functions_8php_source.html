<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Apiary Project: C:/Users/sgmurphy/Documents/Apiary Project/Drupal AP Module/comparer.functions.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cti_flex_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Apiary Project&#160;<span id="projectnumber">0.5.1</span></div>
   <div id="projectbrief">Apiary Project Drupal Module and Image Analysis Tool</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('comparer_8functions_8php.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/sgmurphy/Documents/Apiary Project/Drupal AP Module/comparer.functions.php</div>  </div>
</div>
<div class="contents">
<a href="comparer_8functions_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 header(<span class="stringliteral">&quot;Cache-Control: no-cache, must-revalidate&quot;</span>); <span class="comment">// HTTP/1.1</span>
<a name="l00003"></a>00003 header(<span class="stringliteral">&quot;Expires: Sat, 26 Jul 1997 05:00:00 GMT&quot;</span>); <span class="comment">// Date in the past</span>
<a name="l00004"></a><a class="code" href="comparer_8functions_8php.html#a00365e6c5f70c43fb2ed86c9bc5626e0">00004</a> global <a class="code" href="apiary__project_8php.html#a00365e6c5f70c43fb2ed86c9bc5626e0">$user</a>;
<a name="l00005"></a>00005 include_once(drupal_get_path(<span class="stringliteral">&#39;module&#39;</span>, <span class="stringliteral">&#39;apiary_project&#39;</span>) . <span class="stringliteral">&#39;/apiaryPermissionsClass.php&#39;</span>);
<a name="l00006"></a>00006 include_once(drupal_get_path(<span class="stringliteral">&#39;module&#39;</span>, <span class="stringliteral">&#39;apiary_project&#39;</span>) . <span class="stringliteral">&#39;/workflow/include/search.php&#39;</span>);
<a name="l00007"></a>00007 
<a name="l00008"></a><a class="code" href="comparer_8functions_8php.html#a78bd2c85ad1dcdc1fb68e40605d593b0">00008</a> function <a class="code" href="comparer_8functions_8php.html#a78bd2c85ad1dcdc1fb68e40605d593b0">send_request</a>($function, $param1, $param2, $param3){
<a name="l00009"></a>00009   <span class="comment">//echo &quot;function = &quot;.$function.&quot; param1 = &quot;.$param1.&quot; param2 = &quot;.$param2.&quot; param3 = &quot;.$param3;</span>
<a name="l00010"></a>00010   <span class="keywordflow">if</span>($param3 != <span class="stringliteral">&quot;0&quot;</span>) {
<a name="l00011"></a>00011     call_user_func($function, $param1, $param2, $param3);
<a name="l00012"></a>00012   }
<a name="l00013"></a>00013   <span class="keywordflow">else</span> <span class="keywordflow">if</span>($param2 != <span class="stringliteral">&quot;0&quot;</span>) {
<a name="l00014"></a>00014     call_user_func($function, $param1, $param2);
<a name="l00015"></a>00015   }
<a name="l00016"></a>00016   <span class="keywordflow">else</span> <span class="keywordflow">if</span>($function == <span class="stringliteral">&quot;clear_session&quot;</span>) {
<a name="l00017"></a>00017     call_user_func($function);
<a name="l00018"></a>00018   }
<a name="l00019"></a>00019   <span class="keywordflow">else</span> {
<a name="l00020"></a>00020     call_user_func($function, $param1);
<a name="l00021"></a>00021   }
<a name="l00022"></a>00022 }
<a name="l00023"></a>00023 
<a name="l00024"></a><a class="code" href="comparer_8functions_8php.html#aad11dd972f6f5ce0ef30f089e4a7686c">00024</a> function <a class="code" href="comparer_8functions_8php.html#aad11dd972f6f5ce0ef30f089e4a7686c">get_comparer</a>() {
<a name="l00025"></a>00025   $return_html = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00026"></a>00026   <a class="code" href="workspace_8functions_8php.html#a1ec770754ff6c8671939d992f578d167">$server_base</a> = variable_get(<span class="stringliteral">&#39;apiary_research_base_url&#39;</span>, <span class="stringliteral">&#39;http://localhost&#39;</span>);
<a name="l00027"></a>00027   $home_link = <span class="stringliteral">&#39;&lt;p&gt;&lt;h3&gt;&lt;a href=&quot;&#39;</span>.$server_base.<span class="stringliteral">&#39;/drupal&quot;&gt;Home&lt;/a&gt;&amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp;&lt;a href=&quot;&#39;</span>.<a class="code" href="workspace_8functions_8php.html#a1ec770754ff6c8671939d992f578d167">$server_base</a>.<span class="stringliteral">&#39;/drupal/apiary/admin&quot;&gt;Administer Apiary&lt;/a&gt;&lt;/h3&gt;&lt;/p&gt;&#39;</span>;
<a name="l00028"></a>00028   $return_html .= $home_link;
<a name="l00029"></a>00029   $return_html .= <span class="stringliteral">&#39;Please enter text to compare. Results are displayed in daisydiff and highlighted format with similar text percentages.&lt;/br&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00030"></a>00030   $return_html .= <span class="stringliteral">&#39;&lt;table&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00031"></a>00031   $return_html .= <span class="stringliteral">&#39;&lt;tr&gt;&lt;td&gt;Old Text:&lt;/td&gt;&lt;/td&gt;&lt;td&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00032"></a>00032   $return_html .= <span class="stringliteral">&#39;New Text: &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00033"></a>00033   $return_html .= <span class="stringliteral">&#39;&lt;td&gt;&lt;textarea rows=&quot;10&quot; cols=&quot;40&quot; id=&quot;old_text&quot; name=&quot;old_text&quot; wrap=&quot;physical&quot;&gt;&#39;</span>.$_GET[<span class="stringliteral">&#39;quote1&#39;</span>].<span class="stringliteral">&#39;&lt;/textarea&gt;&lt;/td&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00034"></a>00034   $return_html .= <span class="stringliteral">&#39;&lt;td&gt;&lt;textarea rows=&quot;10&quot; cols=&quot;40&quot; id=&quot;new_text&quot; name=&quot;new_text&quot; wrap=&quot;physical&quot;&gt;&#39;</span>.$_GET[<span class="stringliteral">&#39;quote2&#39;</span>].<span class="stringliteral">&#39;&lt;/textarea&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00035"></a>00035   $return_html .= <span class="stringliteral">&quot;&lt;button onclick=&#39;reset();&#39; style=&#39;margin: 5px 0px; border: 1px solid grey;&#39;&gt;Reset&lt;/button&gt;&quot;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00036"></a>00036   $return_html .= <span class="stringliteral">&quot;&lt;button onclick=&#39;compare_text();&#39; style=&#39;margin: 5px 0px; border: 1px solid grey;&#39;&gt;Compare Text&lt;/button&gt;&lt;br&gt;&quot;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00037"></a>00037   $return_html .= <span class="stringliteral">&#39;&lt;div id=&quot;daisydiff&quot;&gt;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00038"></a>00038   $return_html .= <span class="stringliteral">&#39;&lt;div id=&quot;highlight_diff&quot;&gt;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00039"></a>00039   $return_html .= <span class="stringliteral">&#39;&lt;div id=&quot;percent_results&quot;&gt;&lt;/div&gt;&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00040"></a>00040   echo $return_html;
<a name="l00041"></a>00041 }
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="comparer_8functions_8php.html#ac5cb087f09745fea9c8721f198b38179">00043</a> function <a class="code" href="comparer_8functions_8php.html#ac5cb087f09745fea9c8721f198b38179">compare_text</a>() {
<a name="l00044"></a>00044   $successfully_compared_text = <span class="stringliteral">&quot;false&quot;</span>;
<a name="l00045"></a>00045   $msg = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00046"></a>00046   $highlight_diff_html = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00047"></a>00047   $daisydiff_html = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00048"></a>00048   $percent_results_html = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00049"></a>00049   <span class="keywordflow">if</span>((isset($_POST[<span class="stringliteral">&#39;old_text&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;old_text&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) || (isset($_POST[<span class="stringliteral">&#39;new_text&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;new_text&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>)){
<a name="l00050"></a>00050     $old_text = $_POST[<span class="stringliteral">&#39;old_text&#39;</span>];
<a name="l00051"></a>00051     $new_text = $_POST[<span class="stringliteral">&#39;new_text&#39;</span>];
<a name="l00052"></a>00052     $levenshtein_distance = levenshtein($old_text,$new_text);<span class="comment">//levenshtein</span>
<a name="l00053"></a>00053     $levenshtein_percentage = <a class="code" href="comparer_8functions_8php.html#a15529edea898e11a52232cc4baec11d1">asimilar</a>($old_text,$new_text);<span class="comment">//levenshtein percentage</span>
<a name="l00054"></a>00054     similar_text($old_text,$new_text,$similar_text_percentage);<span class="comment">//returns similar text percentage</span>
<a name="l00055"></a>00055     $trimmedstr1 = trim($old_text);
<a name="l00056"></a>00056     $trimmedstr2 = trim($new_text);
<a name="l00057"></a>00057     $f1_arr = explode(<span class="stringliteral">&quot; &quot;</span>, $trimmedstr1);
<a name="l00058"></a>00058     $f2_arr = explode(<span class="stringliteral">&quot; &quot;</span>, $trimmedstr2);
<a name="l00059"></a>00059 
<a name="l00060"></a>00060     $f1 = implode( <span class="stringliteral">&quot;\n&quot;</span>, $f1_arr );
<a name="l00061"></a>00061     $f2 = implode( <span class="stringliteral">&quot;\n&quot;</span>, $f2_arr );
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     $array_val = <a class="code" href="comparer_8functions_8php.html#a0f38a41d4ad4a9c68a214af946514c3a">PHPDiff</a>( $f1, $f2 );
<a name="l00064"></a>00064 
<a name="l00065"></a>00065     $f2_string = explode(<span class="stringliteral">&quot;\n&quot;</span>, $f2);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     $array_val_arr = explode(<span class="stringliteral">&quot;\n&quot;</span>,$array_val);
<a name="l00068"></a>00068     array_pop($array_val_arr);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     $highlightarr = array();
<a name="l00071"></a>00071     <span class="keywordflow">foreach</span> ($array_val_arr as &amp;$value) {
<a name="l00072"></a>00072       $range = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00073"></a>00073       $range = strstr($value, <span class="charliteral">&#39;,&#39;</span>);
<a name="l00074"></a>00074       <span class="keywordflow">if</span> ($range) {
<a name="l00075"></a>00075         $rangefrom = substr($value, 0, strpos($value, <span class="charliteral">&#39;,&#39;</span>));
<a name="l00076"></a>00076         $rangeto = substr($value, strpos($value, <span class="charliteral">&#39;,&#39;</span>)+1);
<a name="l00077"></a>00077 
<a name="l00078"></a>00078         <span class="keywordflow">for</span>($i=$rangefrom;$i&lt;=$rangeto;$i++) {
<a name="l00079"></a>00079           $highlightarr[] = $i - 1;
<a name="l00080"></a>00080         }
<a name="l00081"></a>00081       }
<a name="l00082"></a>00082       <span class="keywordflow">else</span> {
<a name="l00083"></a>00083         $highlightarr[] = $value - 1;
<a name="l00084"></a>00084       }
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     $highlight_diff_html = <span class="stringliteral">&#39;&lt;p&gt;&lt;h2&gt;Simple text comparison results&lt;/h2&gt;&lt;/p&gt;&#39;</span>;
<a name="l00088"></a>00088     $highlight_diff_html .= <span class="stringliteral">&quot;&lt;table width=&#39;100%&#39; border=&#39;1&#39;&gt;&lt;tr&gt;&lt;td width=&#39;10%&#39;&gt;Orginal:&lt;/td&gt;&lt;td&gt;&quot;</span> .$old_text. <span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;
<a name="l00089"></a>00089     $highlight_diff_html .= <span class="stringliteral">&quot;&lt;tr&gt;&lt;td width=&#39;10%&#39;&gt;Change:&lt;/td&gt;&lt;td&gt;&quot;</span>;
<a name="l00090"></a>00090     <span class="keywordflow">for</span>($i = 0;$i&lt;<span class="keyword">sizeof</span>($f2_string); $i++) {
<a name="l00091"></a>00091       <span class="keywordflow">foreach</span> ($highlightarr as $value) {
<a name="l00092"></a>00092         <span class="keywordflow">if</span> ($i== $value) {
<a name="l00093"></a>00093           $flg = 1;
<a name="l00094"></a>00094         }
<a name="l00095"></a>00095       }
<a name="l00096"></a>00096       <span class="keywordflow">if</span> ($flg == 1) {
<a name="l00097"></a>00097         $flg = 0;
<a name="l00098"></a>00098         $highlight_diff_html .= <span class="stringliteral">&quot;&lt;font color=&#39;#00FF00&#39;&gt;&quot;</span> .$f2_string[$i].<span class="stringliteral">&quot;&lt;/font&gt;&amp;nbsp;&quot;</span>;
<a name="l00099"></a>00099       }
<a name="l00100"></a>00100       <span class="keywordflow">else</span> {
<a name="l00101"></a>00101         $highlight_diff_html .= $f2_string[$i].<span class="stringliteral">&quot;&amp;nbsp;&quot;</span>;
<a name="l00102"></a>00102       }
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104     $highlight_diff_html .= <span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;</span>;
<a name="l00105"></a>00105     $daisydiff_html = <span class="stringliteral">&#39;&lt;p&gt;&lt;h2&gt;Daisydiff comparison results&lt;/h2&gt;&lt;/p&gt;&#39;</span>;
<a name="l00106"></a>00106     $daisydiff_html .= <a class="code" href="comparer_8functions_8php.html#a810bd640e21ac2129a0e7f53f5d45164">daisydiff_text</a>($old_text, $new_text);
<a name="l00107"></a>00107     $percent_results_html = <span class="stringliteral">&#39;&lt;p&gt;&lt;h2&gt;Percentage of similar text&lt;/h2&gt;&lt;/p&gt;&#39;</span>;
<a name="l00108"></a>00108     $percent_results_html .= <span class="stringliteral">&quot;The levenshtein distance for the strings is &quot;</span> .$levenshtein_distance. <span class="stringliteral">&quot; &lt;br/&gt;&quot;</span>;
<a name="l00109"></a>00109     $percent_results_html .= <span class="stringliteral">&quot;Using levenshtein distance, the strings are &quot;</span> .$levenshtein_percentage. <span class="stringliteral">&quot; percent similar &lt;br/&gt;&quot;</span>;
<a name="l00110"></a>00110     $percent_results_html .= <span class="stringliteral">&quot;Using similar text, the strings are &quot;</span>.$similar_text_percentage.<span class="stringliteral">&quot; percent similar &lt;br/&gt;&quot;</span>;
<a name="l00111"></a>00111     $successfully_compared_text = <span class="stringliteral">&quot;true&quot;</span>;
<a name="l00112"></a>00112   }
<a name="l00113"></a>00113   <span class="keywordflow">else</span> {
<a name="l00114"></a>00114     $msg = <span class="stringliteral">&#39;No text passed to compare!&#39;</span>;
<a name="l00115"></a>00115   }
<a name="l00116"></a>00116   $returnJSON[<span class="stringliteral">&#39;levenshtein_distance&#39;</span>] = $levenshtein_percentage;
<a name="l00117"></a>00117   $returnJSON[<span class="stringliteral">&#39;levenshtein_percentage&#39;</span>] = $levenshtein_percentage;
<a name="l00118"></a>00118   $returnJSON[<span class="stringliteral">&#39;similar_text_percentage&#39;</span>] = $similar_text_percentage;
<a name="l00119"></a>00119   $returnJSON[<span class="stringliteral">&#39;daisydiff_html&#39;</span>] = $daisydiff_html;
<a name="l00120"></a>00120   $returnJSON[<span class="stringliteral">&#39;highlight_diff_html&#39;</span>] = $highlight_diff_html;
<a name="l00121"></a>00121   $returnJSON[<span class="stringliteral">&#39;percent_results_html&#39;</span>] = $percent_results_html;
<a name="l00122"></a>00122   $returnJSON[<span class="stringliteral">&#39;successfully_compared_text&#39;</span>] = $successfully_compared_text;
<a name="l00123"></a>00123   $returnJSON[<span class="stringliteral">&#39;msg&#39;</span>] = $msg;
<a name="l00124"></a>00124   echo json_encode($returnJSON);
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="comparer_8functions_8php.html#a0f38a41d4ad4a9c68a214af946514c3a">00127</a> function <a class="code" href="comparer_8functions_8php.html#a0f38a41d4ad4a9c68a214af946514c3a">PHPDiff</a>($old, $new)
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129 <span class="preprocessor">  # split the source text into arrays of lines</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>  $t1 = explode(<span class="stringliteral">&quot;\n&quot;</span>,$old);
<a name="l00131"></a>00131   $x=array_pop($t1);
<a name="l00132"></a>00132   <span class="keywordflow">if</span> ($x&gt;<span class="stringliteral">&#39;&#39;</span>) $t1[]=<span class="stringliteral">&quot;$x\n\\ No newline at end of file&quot;</span>;
<a name="l00133"></a>00133   $t2 = explode(<span class="stringliteral">&quot;\n&quot;</span>,$new);
<a name="l00134"></a>00134   $x=array_pop($t2);
<a name="l00135"></a>00135   <span class="keywordflow">if</span> ($x&gt;<span class="stringliteral">&#39;&#39;</span>) $t2[]=<span class="stringliteral">&quot;$x\n\\ No newline at end of file&quot;</span>;
<a name="l00136"></a>00136 <span class="preprocessor">    # build a reverse-index array using the line as key and line number as value</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span><span class="preprocessor">    # don&#39;t store blank lines, so they won&#39;t be targets of the shortest distance</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span><span class="preprocessor">    # search</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>    <span class="keywordflow">foreach</span>($t1 as $i=&gt;$x) {
<a name="l00140"></a>00140       <span class="keywordflow">if</span> ($x&gt;<span class="stringliteral">&#39;&#39;</span>) {
<a name="l00141"></a>00141         $r1[$x][]=$i;
<a name="l00142"></a>00142       }
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144     <span class="keywordflow">foreach</span>($t2 as $i=&gt;$x) {
<a name="l00145"></a>00145       <span class="keywordflow">if</span> ($x&gt;<span class="stringliteral">&#39;&#39;</span>) {
<a name="l00146"></a>00146         $r2[$x][]=$i;
<a name="l00147"></a>00147       }
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     $a1=0; $a2=0;   # start at beginning of each list
<a name="l00151"></a>00151     $actions=array();
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="preprocessor">    # walk this loop until we reach the end of one of the lists</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>    <span class="keywordflow">while</span> ($a1&lt;count($t1) &amp;&amp; $a2&lt;count($t2)) {
<a name="l00155"></a>00155 <span class="preprocessor">      # if we have a common element, save it and go to the next</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span>      <span class="keywordflow">if</span> ($t1[$a1]==$t2[$a2]) {
<a name="l00157"></a>00157         $actions[]=4; $a1++; $a2++; <span class="keywordflow">continue</span>;
<a name="l00158"></a>00158       }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 <span class="preprocessor">      # otherwise, find the shortest move (Manhattan-distance) from the</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span><span class="preprocessor">      # current location</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span>      $best1=count($t1); $best2=count($t2);
<a name="l00163"></a>00163       $s1=$a1; $s2=$a2;
<a name="l00164"></a>00164       <span class="keywordflow">while</span>(($s1+$s2-$a1-$a2) &lt; ($best1+$best2-$a1-$a2)) {
<a name="l00165"></a>00165         $d=-1;
<a name="l00166"></a>00166         <span class="keywordflow">foreach</span>((array)@$r1[$t2[$s2]] as $n) {
<a name="l00167"></a>00167           <span class="keywordflow">if</span> ($n&gt;=$s1) {
<a name="l00168"></a>00168             $d=$n; <span class="keywordflow">break</span>;
<a name="l00169"></a>00169           }
<a name="l00170"></a>00170         }
<a name="l00171"></a>00171         <span class="keywordflow">if</span> ($d&gt;=$s1 &amp;&amp; ($d+$s2-$a1-$a2)&lt;($best1+$best2-$a1-$a2)) {
<a name="l00172"></a>00172           $best1=$d; $best2=$s2;
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174         $d=-1;
<a name="l00175"></a>00175         <span class="keywordflow">foreach</span>((array)@$r2[$t1[$s1]] as $n) {
<a name="l00176"></a>00176           <span class="keywordflow">if</span> ($n&gt;=$s2) {
<a name="l00177"></a>00177             $d=$n; <span class="keywordflow">break</span>;
<a name="l00178"></a>00178           }
<a name="l00179"></a>00179         }
<a name="l00180"></a>00180         <span class="keywordflow">if</span> ($d&gt;=$s2 &amp;&amp; ($s1+$d-$a1-$a2)&lt;($best1+$best2-$a1-$a2)) {
<a name="l00181"></a>00181           $best1=$s1; $best2=$d;
<a name="l00182"></a>00182         }
<a name="l00183"></a>00183         $s1++; $s2++;
<a name="l00184"></a>00184      }
<a name="l00185"></a>00185      <span class="keywordflow">while</span> ($a1&lt;$best1) {
<a name="l00186"></a>00186        $actions[]=1; $a1++;
<a name="l00187"></a>00187      }  # deleted elements
<a name="l00188"></a>00188      <span class="keywordflow">while</span> ($a2&lt;$best2) {
<a name="l00189"></a>00189        $actions[]=2; $a2++;
<a name="l00190"></a>00190      }  # added elements
<a name="l00191"></a>00191   }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="preprocessor">  # we haveve reached the end of one list, now walk to the end of the other</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>  <span class="keywordflow">while</span>($a1&lt;count($t1)) {
<a name="l00195"></a>00195     $actions[]=1; $a1++;
<a name="l00196"></a>00196   }  # deleted elements
<a name="l00197"></a>00197   <span class="keywordflow">while</span>($a2&lt;count($t2)) {
<a name="l00198"></a>00198     $actions[]=2; $a2++;
<a name="l00199"></a>00199   }  # added elements
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="preprocessor">  # and this marks our ending point</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span>  $actions[]=8;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 <span class="preprocessor">  # now, let us follow the path we just took and report the added/deleted</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span><span class="preprocessor">  # elements into $out.</span>
<a name="l00206"></a>00206 <span class="preprocessor"></span>  $op = 0;
<a name="l00207"></a>00207   $x0=$x1=0; $y0=$y1=0;
<a name="l00208"></a>00208   $out = array();
<a name="l00209"></a>00209   <span class="keywordflow">foreach</span>($actions as $act) {
<a name="l00210"></a>00210     <span class="keywordflow">if</span> ($act==1) {
<a name="l00211"></a>00211       $op|=$act;
<a name="l00212"></a>00212       $x1++; <span class="keywordflow">continue</span>;
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214     <span class="keywordflow">if</span> ($act==2) {
<a name="l00215"></a>00215       $op|=$act;
<a name="l00216"></a>00216       $y1++;
<a name="l00217"></a>00217       <span class="keywordflow">continue</span>;
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219     <span class="keywordflow">if</span> ($op&gt;0) {
<a name="l00220"></a>00220       $xstr = ($x1==($x0+1)) ? $x1 : ($x0+1).<span class="stringliteral">&quot;,$x1&quot;</span>;
<a name="l00221"></a>00221       $ystr = ($y1==($y0+1)) ? $y1 : ($y0+1).<span class="stringliteral">&quot;,$y1&quot;</span>;
<a name="l00222"></a>00222       <span class="keywordflow">if</span> ($op==1) {
<a name="l00223"></a>00223         $out[] = <span class="stringliteral">&quot;{$y1}&quot;</span>;
<a name="l00224"></a>00224       }
<a name="l00225"></a>00225       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($op==3) {
<a name="l00226"></a>00226         $out[] = <span class="stringliteral">&quot;{$ystr}&quot;</span>;
<a name="l00227"></a>00227         <span class="keywordflow">while</span> ($x0&lt;$x1) {
<a name="l00228"></a>00228           <span class="comment">// $out[] = &#39;&lt; &#39;.$t1[$x0];</span>
<a name="l00229"></a>00229               $x0++;
<a name="l00230"></a>00230             }   # deleted elems
<a name="l00231"></a>00231           }
<a name="l00232"></a>00232       <span class="keywordflow">if</span> ($op==2) {
<a name="l00233"></a>00233         $out[] = <span class="stringliteral">&quot;{$ystr}&quot;</span>;
<a name="l00234"></a>00234       }
<a name="l00235"></a>00235       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($op==3) {
<a name="l00236"></a>00236         <span class="comment">// $out[] = &#39;---&#39;;</span>
<a name="l00237"></a>00237         <span class="keywordflow">while</span> ($y0&lt;$y1) {
<a name="l00238"></a>00238           <span class="comment">//$out[] = &#39;&gt; &#39;.$t2[$y0];</span>
<a name="l00239"></a>00239               $y0++;
<a name="l00240"></a>00240             }   # added elems
<a name="l00241"></a>00241           }
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243     $x1++;
<a name="l00244"></a>00244     $x0=$x1;
<a name="l00245"></a>00245     $y1++;
<a name="l00246"></a>00246     $y0=$y1;
<a name="l00247"></a>00247     $op=0;
<a name="l00248"></a>00248   }
<a name="l00249"></a>00249   $out[] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00250"></a>00250   <span class="keywordflow">return</span> join(<span class="stringliteral">&quot;\n&quot;</span>,$out);
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00253"></a><a class="code" href="comparer_8functions_8php.html#a15529edea898e11a52232cc4baec11d1">00253</a> function <a class="code" href="comparer_8functions_8php.html#a15529edea898e11a52232cc4baec11d1">asimilar</a>($str1, $str2) {
<a name="l00254"></a>00254   $strlen1=strlen($str1);
<a name="l00255"></a>00255   $strlen2=strlen($str2);
<a name="l00256"></a>00256   $max=max($strlen1, $strlen2);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258   $splitSize=250;
<a name="l00259"></a>00259   <span class="keywordflow">if</span>($max&gt;$splitSize) {
<a name="l00260"></a>00260     $lev=0;
<a name="l00261"></a>00261     <span class="keywordflow">for</span>($cont=0;$cont&lt;$max;$cont+=$splitSize) {
<a name="l00262"></a>00262       <span class="keywordflow">if</span>($strlen1&lt;=$cont || $strlen2&lt;=$cont) {
<a name="l00263"></a>00263         $lev=$lev/($max/min($strlen1,$strlen2));
<a name="l00264"></a>00264         <span class="keywordflow">break</span>;
<a name="l00265"></a>00265       }
<a name="l00266"></a>00266       $lev+=levenshtein(substr($str1,$cont,$splitSize), substr($str2,$cont,$splitSize));
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268   }
<a name="l00269"></a>00269   <span class="keywordflow">else</span> {
<a name="l00270"></a>00270     $lev=levenshtein($str1, $str2);
<a name="l00271"></a>00271   }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273   $percentage= -100*$lev/$max+100;
<a name="l00274"></a>00274   <span class="keywordflow">if</span>($percentage&gt;75) {
<a name="l00275"></a>00275     <span class="comment">//Ajustar con similar_text</span>
<a name="l00276"></a>00276     similar_text($str1,$str2,$percentage);
<a name="l00277"></a>00277   }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279   <span class="keywordflow">return</span> $percentage;
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="comparer_8functions_8php.html#a810bd640e21ac2129a0e7f53f5d45164">00282</a> function <a class="code" href="comparer_8functions_8php.html#a810bd640e21ac2129a0e7f53f5d45164">daisydiff_text</a>($old_text, $new_text) {
<a name="l00283"></a>00283 <span class="comment">//save old and new texts to old_text_file and new_text_file</span>
<a name="l00284"></a>00284   $now = date(<span class="stringliteral">&quot;Ymdhis&quot;</span>);
<a name="l00285"></a>00285   $old_text_file = <span class="stringliteral">&#39;/tmp/old_text_file_&#39;</span>.$now.<span class="stringliteral">&#39;.txt&#39;</span>;
<a name="l00286"></a>00286   $new_text_file = <span class="stringliteral">&#39;/tmp/new_text_file_&#39;</span>.$now.<span class="stringliteral">&#39;.txt&#39;</span>;
<a name="l00287"></a>00287   $fp_old = fopen($old_text_file, <span class="charliteral">&#39;w&#39;</span>);
<a name="l00288"></a>00288   fwrite($fp_old, $old_text);
<a name="l00289"></a>00289   fclose($fp_old);
<a name="l00290"></a>00290   $fp_new = fopen($new_text_file, <span class="charliteral">&#39;w&#39;</span>);
<a name="l00291"></a>00291   fwrite($fp_new, $new_text);
<a name="l00292"></a>00292   fclose($fp_new);
<a name="l00293"></a>00293   $return_html = <a class="code" href="comparer_8functions_8php.html#ae170b4e0e13feab0bbbde7445f320bed">daisydiff</a>($old_text_file, $new_text_file);
<a name="l00294"></a>00294   unlink($old_text_file);
<a name="l00295"></a>00295   unlink($new_text_file);
<a name="l00296"></a>00296   <span class="keywordflow">return</span> $return_html;
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 
<a name="l00299"></a><a class="code" href="comparer_8functions_8php.html#ae170b4e0e13feab0bbbde7445f320bed">00299</a> function <a class="code" href="comparer_8functions_8php.html#ae170b4e0e13feab0bbbde7445f320bed">daisydiff</a>($url_old, $url_new) {
<a name="l00300"></a>00300   $daisydiff_dir = <span class="stringliteral">&#39;/var/www/drupal/modules/apiary_project/daisydiff&#39;</span>;
<a name="l00301"></a>00301   $daisydiff_output = <span class="stringliteral">&#39;/tmp/daisydiff_output_&#39;</span>.date(<span class="stringliteral">&quot;Ymdhis&quot;</span>).<span class="stringliteral">&#39;.xml&#39;</span>;
<a name="l00302"></a>00302   $daisydiff_cmd = <span class="stringliteral">&quot;java -jar $daisydiff_dir/daisydiff.jar $url_old $url_new --file=$daisydiff_output --output=xml --type=tag --q&quot;</span>;
<a name="l00303"></a>00303   shell_exec($daisydiff_cmd);
<a name="l00304"></a>00304   $daisydiff_doc = <span class="keyword">new</span> DOMDocument();
<a name="l00305"></a>00305   $daisydiff_doc-&gt;load($daisydiff_output);
<a name="l00306"></a>00306   <span class="comment">//$daisydiff_xml = $daisydiff_doc-&gt;saveXML();</span>
<a name="l00307"></a>00307   <span class="keywordflow">foreach</span>($daisydiff_doc-&gt;getElementsByTagName(<span class="stringliteral">&#39;diff&#39;</span>) as $diff) {
<a name="l00308"></a>00308     $daisydiff_html = $daisydiff_doc-&gt;saveXML($diff);
<a name="l00309"></a>00309   };
<a name="l00310"></a>00310   unlink($daisydiff_output);
<a name="l00311"></a>00311   <span class="keywordflow">return</span> $daisydiff_html;
<a name="l00312"></a>00312 }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 ?&gt;
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="comparer_8functions_8php.html">comparer.functions.php</a>      </li>
      <li class="footer">Generated on Tue Jun 28 2011 11:15:32 for Apiary Project by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
